<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ESP8266开发参考资料 | 柊</title><meta name="author" content="棨"><meta name="copyright" content="棨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#59b9c6"><meta name="description" content="ESP8266开发参考资料，第三方库使用说明">
<meta property="og:type" content="article">
<meta property="og:title" content="ESP8266开发参考资料">
<meta property="og:url" content="https://chaoqijiang.github.io/2023/06/07/ESP8266%E5%BC%80%E5%8F%91%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99_%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/index.html">
<meta property="og:site_name" content="柊">
<meta property="og:description" content="ESP8266开发参考资料，第三方库使用说明">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chaoqijiang.github.io/Image/avatar.png">
<meta property="article:published_time" content="2023-06-07T14:00:00.000Z">
<meta property="article:modified_time" content="2025-10-12T07:40:14.495Z">
<meta property="article:author" content="棨">
<meta property="article:tag" content="ESP8266">
<meta property="article:tag" content="protected">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chaoqijiang.github.io/Image/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ESP8266开发参考资料",
  "url": "https://chaoqijiang.github.io/2023/06/07/ESP8266%E5%BC%80%E5%8F%91%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99_%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/",
  "image": "https://chaoqijiang.github.io/Image/avatar.png",
  "datePublished": "2023-06-07T14:00:00.000Z",
  "dateModified": "2025-10-12T07:40:14.495Z",
  "author": [
    {
      "@type": "Person",
      "name": "棨",
      "url": "https://chaoqijiang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://chaoqijiang.github.io/2023/06/07/ESP8266%E5%BC%80%E5%8F%91%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99_%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#59b9c6')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 24
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":30,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#165e83","bgDark":"#507ea4","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ESP8266开发参考资料',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/Image/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">58</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴/归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/Image/topImage.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/Image/Logo.ico" alt="Logo"><span class="site-name">柊</span></a><a class="nav-page-title" href="/"><span class="site-name">ESP8266开发参考资料</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴/归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ESP8266开发参考资料</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-07T14:00:00.000Z" title="发表于 2023-06-07 22:00:00">2023-06-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-12T07:40:14.495Z" title="更新于 2025-10-12 15:40:14">2025-10-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ESP8266/">ESP8266</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ESP8266/%E5%BC%80%E5%8F%91%E8%B5%84%E6%96%99/">开发资料</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">155.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>595分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="开发参考资料"><a href="#开发参考资料" class="headerlink" title="开发参考资料"></a>开发参考资料</h1><h2 id="ESP8266-Arduino库-总览"><a href="#ESP8266-Arduino库-总览" class="headerlink" title="ESP8266-Arduino库 总览"></a>ESP8266-Arduino库 总览</h2><p><img src="/./Image/ESP8266.assets/image-20230525094015023.png" alt="image-20230525094015023"></p>
<h3 id="网络功能"><a href="#网络功能" class="headerlink" title="网络功能"></a>网络功能</h3><p>物联网相关的ESP8266库。这些库主要用于控制ESP8266连接WiFi网络、设置工作模式以及利用通用的互联网协议（TCP&#x2F;IP协议族）实现ESP8266物联网应用。</p>
<h4 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h4><p>ESP8266共有三种工作模式，分别是<code>无线接入点模式（AP）</code>、<code>无线终端模式（Wireless Station）</code>以及<code>混合模式（以上两种模式的混合）</code>。这一部分的库主要用于控制ESP8266的工作模式。</p>
<ul>
<li>ESP8266WiFiAP库 – ESP8266 WiFi接入点工作模式应用库</li>
<li>ESP8266WiFiSTA库– ESP8266 WiFi终端工作模式应用库</li>
</ul>
<h4 id="联网"><a href="#联网" class="headerlink" title="联网"></a>联网</h4><ul>
<li>ESP8266WiFiGeneric库 – ESP8266基本功能库</li>
<li>ESP8266WiFiMulti库 – ESP8266记录多个WiFi网络信息并自动连接信号最强的WiFi网络</li>
<li>ESP8266WiFiScan库 – ESP8266扫描WiFi网络信号库</li>
</ul>
<h4 id="物联网通讯"><a href="#物联网通讯" class="headerlink" title="物联网通讯"></a>物联网通讯</h4><h5 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h5><ul>
<li>WiFiClient库 – TCP客户端库</li>
<li>WiFiServer库 – TCP服务器库</li>
</ul>
<h5 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h5><ul>
<li>ESP8266HTTPClient库 – HTTP客户端库</li>
<li>ESP8266WebServer库 – HTTP服务器库</li>
</ul>
<h5 id="HTTPS协议"><a href="#HTTPS协议" class="headerlink" title="HTTPS协议"></a>HTTPS协议</h5><ul>
<li>WiFiClientSecure库 – HTTPS客户端库</li>
<li>WiFiServerSecure库 – HTTPS服务器库</li>
</ul>
<h5 id="UDP协议"><a href="#UDP协议" class="headerlink" title="UDP协议"></a>UDP协议</h5><ul>
<li>WiFiUDP库 – UDP通讯库</li>
</ul>
<h5 id="DNS协议"><a href="#DNS协议" class="headerlink" title="DNS协议"></a>DNS协议</h5><ul>
<li>DNSServer库 – DNS服务器应用库</li>
</ul>
<h4 id="其它部分"><a href="#其它部分" class="headerlink" title="其它部分"></a>其它部分</h4><p>由于本部分库相对应用较少，因此仅对它们进行简单介绍，而不像以上库内容具有较为详细介绍内容。</p>
<ul>
<li>ESP8266mDNS库</li>
<li>ESP8266LLMNR库</li>
<li>Ethernet库</li>
<li>ESP8266NetBIOS库</li>
<li>ESP8266SSDP库</li>
</ul>
<h4 id="ESP8266库网络功能其它部分各库简介"><a href="#ESP8266库网络功能其它部分各库简介" class="headerlink" title="ESP8266库网络功能其它部分各库简介"></a>ESP8266库网络功能其它部分各库简介</h4><p>由于本部分库中的内容较少被用户所使用。因此我们仅对这部分内容进行简单介绍。</p>
<p>— <strong>ESP8266mDNS库</strong><br>通过本库，我们可以利用mDNS协议(multicast DNS协议)为ESP8266建立域名访问功能。也就是说，我们在通过WiFi访问ESP8266时，无需使用ESP8266的IP地址，而可以为ESP8266分配域名并实现访问。就像我们在访问某一个网址服务器一样。但由于安卓系统不支持mDNS协议，因此使用本库时要慎重。</p>
<p>— <strong>ESP8266LLMNR库</strong><br>通过本库，我们可以利用LLMNR协议(Link-Local Multicast Name Resolution协议)为ESP8266建立域名访问功能。也就是说，我们在通过WiFi访问ESP8266时，无需使用ESP8266的IP地址，而可以为ESP8266分配域名并实现访问。就像我们在访问某一个网址服务器一样。但由于Linux和苹果电脑mac系统不支持LLMNR协议，因此使用本库时要慎重。</p>
<p>— <strong>Ethernet库</strong><br>本库用于ESP8266的以太网通讯。该库是由<a target="_blank" rel="noopener" href="https://www.arduino.cc/en/Reference/Ethernet">Arduino的Ethernet库</a>修改而来，以使ESP8266模块具备以太网通讯功能。</p>
<p>— <strong>ESP8266NetBIOS库</strong><br>本库用于ESP8266的NetBIOS应用。NetBIOS是Network Basic Input&#x2F;Output System的缩写，其中文名称是网上基本输入输出系统。NetBIOS可用于局域网设备间传输数据信息。如需了解更多关于NetBIOS的基本介绍，可前往<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/NETBIOS">百度百科的NETBIOS介绍页面</a>。</p>
<p>— <strong>ESP8266SSDP库</strong><br>本库用于ESP8266的SSDP应用。SSDP是Simple Service Discovery Protocol的缩写，其中文名称是简单服务发现协议。SSDP协议提供了在网络里面发现设备的机制。控制点（也就是接受服务的客户端）可以通过使用SSDP协议，根据自己的需要查询网络里面提供服务的设备。设备（也就是提供服务的服务器端）也可以通过使用SSDP协议，向网络里的控制点宣告它的存在。</p>
<h3 id="非网络功能"><a href="#非网络功能" class="headerlink" title="非网络功能"></a>非网络功能</h3><h4 id="时控部分"><a href="#时控部分" class="headerlink" title="时控部分"></a>时控部分</h4><ul>
<li>TICKER库 – 控制ESP8266定时执行任务。通过Ticker库，我们可以实现ESP8266的多任务处理功能。</li>
</ul>
<h4 id="哈希部分"><a href="#哈希部分" class="headerlink" title="哈希部分"></a>哈希部分</h4><ul>
<li>HASH库 – 哈希算法库</li>
</ul>
<h4 id="数据储存部分"><a href="#数据储存部分" class="headerlink" title="数据储存部分"></a>数据储存部分</h4><ul>
<li>EEPROM库 – EEPROM数据储存库</li>
<li>SPIFFS库 – 闪存文件系统控制库</li>
<li>LittleFS库 – 闪存文件系统控制库</li>
<li>SD库 – SD文件储存库</li>
<li>ESP8266SdFat库 – Fat文件储存库</li>
</ul>
<h4 id="通讯部分"><a href="#通讯部分" class="headerlink" title="通讯部分"></a>通讯部分</h4><h5 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h5><ul>
<li>SPI库 – SPI通讯库</li>
<li>SPISlave库 – SPI通讯库</li>
</ul>
<h5 id="I2C"><a href="#I2C" class="headerlink" title="I2C"></a>I2C</h5><ul>
<li>Wire库 – I2C通讯库</li>
</ul>
<h5 id="串行通讯"><a href="#串行通讯" class="headerlink" title="串行通讯"></a>串行通讯</h5><ul>
<li>SoftwareSerial库 – 软件串口库</li>
</ul>
<h5 id="电机控制部分"><a href="#电机控制部分" class="headerlink" title="电机控制部分"></a>电机控制部分</h5><ul>
<li>Servo库 – 舵机控制库</li>
</ul>
<h5 id="显示屏控制部分"><a href="#显示屏控制部分" class="headerlink" title="显示屏控制部分"></a>显示屏控制部分</h5><ul>
<li>TFT_Touch_Shield_V2库 – TFT触摸屏控制库</li>
</ul>
<h5 id="其它部分-1"><a href="#其它部分-1" class="headerlink" title="其它部分"></a>其它部分</h5><ul>
<li>GDBStub库 – GDB调试支持</li>
</ul>
<hr>
<h3 id="OTA功能"><a href="#OTA功能" class="headerlink" title="OTA功能"></a>OTA功能</h3><p>所谓OTA即Over The Air的英文缩写。该词对ESP8266来说指通过WiFi来向ESP8266上传控制程序或向ESP8266的闪存写入信息。如需了解以下各库的基本介绍，<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266-ota/">请点击此处</a>。</p>
<ul>
<li>ArduinoOTA库 – 使用Arduino IDE通过WiFi为开发板上传控制程序</li>
<li>ESP8266HTTPUpdateServer库 – 使用WiFi通过HTTP协议为ESP8266上传程序或闪存文件（有服务器功能）</li>
<li>ESP8266httpUpdate库 – 使用WiFi通过HTTP协议为ESP8266上传程序或闪存文件</li>
<li>ArduinoAVRISP库 – 通过WiFi为与ESP8266相连的Arduino控制器上传程序</li>
</ul>
<h2 id="ESP8266WiFiAP库"><a href="#ESP8266WiFiAP库" class="headerlink" title="ESP8266WiFiAP库"></a>ESP8266WiFiAP库</h2><p>ESP8266可以建立WiFi网络供其它设备连接。当ESP8266以此模式运行时，我们可以使用手机搜索ESP8266所建立的WiFi网络并进行连接。</p>
<p><img src="/./Image/ESP8266.assets/image-20230525141729646.png" alt="image-20230525141729646"></p>
<p>当ESP8266以上图所示的模式进行工作时，我们称ESP8266的工作模式是“接入点模式(AP模式)”。</p>
<p>ESP8266模块的工作模式一共有三种。分别是：1，接入点模式（AP）2，无线终端模式（Wireless Station）3，混合模式。</p>
<p>ESP8266WiFiAP库用于ESP8266的接入点工作模式启动和设置。以下为ESP8266WiFiAP库的整体结构图。在此图下方有ESP8266WiFiAP库的函数目录。您可以通过点击目录项目打开各个函数的说明页面。</p>
<p><img src="/./Image/ESP8266.assets/image-20230525141521748.png" alt="image-20230525141521748"></p>
<h3 id="管理类型"><a href="#管理类型" class="headerlink" title="管理类型"></a>管理类型</h3><h4 id="softAP"><a href="#softAP" class="headerlink" title="softAP"></a>softAP</h4><h5 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h5><p>softAP函数可用于启动校验式wifi网络或开放式wifi网络。校验式网络就是需要我们输入密码的网络，开放网络也就是不需要密码，只需要知道网络的名字就可以链接的无密码网络。</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.softAP</code>()<br><code>WiFi.softAP(ssid, passphrase, channel, ssid_hidden, max_connection)</code></p>
<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><ul>
<li><p>ssid: char型，WiFi网络名称</p>
</li>
<li><p>passphrase: int型，WiFi密码(对于WPA2加密类型最少8个字符，对于开放网络设置为NULL)</p>
<p>channel: int型，wifi信道。可选通道有1-13，不设置的情况下默认是1。</p>
<p>hidden: bool型，控制 WiFI是否隐藏的标志变量。设置为0不隐藏，设置为1隐藏。</p>
</li>
<li></li>
<li><p>passphrase: int型，WiFi密码(对于WPA2加密类型最少8个字符，对于开放网络设置为NULL)</p>
<p>channel: int型，wifi信道。可选通道有1-13，不设置的情况下默认是1。</p>
<p>hidden: bool型，控制 WiFI是否隐藏的标志变量。设置为0不隐藏，设置为1隐藏。</p>
</li>
<li><p>max_connection: int型，最大的允许连接的无线终端数量。可选数值范围是1 – 4(ESP8266模块最多允许同时连接的无线终端设备数量是4个）。</p>
</li>
</ul>
<h5 id="示例程序"><a href="#示例程序" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将以下示例程序上传给ESP8266开发板后，ESP8266将会建立一个隐藏的WiFi网络。网络名称(SSID)为”TaichiMaker_WIFI”,网络密码为”12345678″ 。这些信息都是通过以下程序中的<code>WiFi.softAP(AP_ssid, password,3,1);</code>实现的。当然您也可以自行修改网络名称(SSID)和网络密码。</p>
<p>值得注意的是，<code>WiFi.softAP(AP_ssid, password,3,1)</code>语句中的3意味着ESP8266所建立的WiFi网络使用信道3。最后一个参数1意味着此WiFi网络是隐藏网络。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : softAP()</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用ESP8266WiFiAP库来演示softAP()函数的用法</span></span><br><span class="line"><span class="comment">softAP()函数会开启一个校验式wifi。我们可以在代码中设置WiFi网络名称、</span></span><br><span class="line"><span class="comment">WiFi密码、最大允许连接设备数量、信号通道编号、是否广播WiFi名称。</span></span><br><span class="line"><span class="comment">-----------------------------------------------------****************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">  <span class="comment">//配置接入点信息</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  <span class="comment">//启动接入点模式，并设置账号和密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）,通道为3，wifi隐藏，最大连接数=4</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password,<span class="number">3</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);    </span><br><span class="line">  Serial.println(AP_ssid);         <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="softAPConfig"><a href="#softAPConfig" class="headerlink" title="softAPConfig"></a>softAPConfig</h4><h5 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h5><p>softAPConfig函数可用于配置ESP8266开发板所建立的接入点网络信息，如开发板IP地址，网关，子网掩码。</p>
<p>假如您对IP地址、网关、以及子网掩码的概念不甚清楚，可通过以下百度百科内容来对它们进行初步了解。</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80">百度百科-IP地址介绍页面</a><br><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E5%85%B3">百度百科-网关介绍页面</a><br><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81">百度百科-子网掩码介绍页面</a></p>
<h5 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.softAPConfig() WiFi.softAPConfig (local_ip, gateway, subnet)</code></p>
<h5 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h5><ul>
<li>local_ip： 接入点的ip地址。(IPAddress型)</li>
<li>gateway： 网关IP地址。 (IPAddress型)</li>
<li>subnet： 子网掩码。(IPAddress型）</li>
</ul>
<h5 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h5><p>返回设置结果。设置成功返回true，否则返回false。数据类型为bool型。</p>
<h5 id="示例程序-1"><a href="#示例程序-1" class="headerlink" title="示例程序"></a>示例程序</h5><p>在以下示例程序中，我们使用了以下语句建立了三个IPAddress类型的变量。</p>
<p><code>IPAddress local_IP(192,168,4,22);//手动设置的开启的网络的ip地址 </code></p>
<p><code>IPAddress gateway(192,168,4,9); //手动设置的网关IP地址</code></p>
<p><code>IPAddress subnet(255,255,255,0); //手动设置的子网掩码</code></p>
<p>接下来我们使用以下语句，利用以上变量对ESP8266所建立的WiFi网络进行设置。</p>
<p><code>WiFi.softAPConfig(local_IP, gateway, subnet);</code></p>
<p><strong>注意：在不同的网络环境中，子网掩码，网关IP等信息各不相同，所以您在使用本示例程序时要根据您网络环境的网关IP、设备IP、子网掩码进行相应设置。请不要照搬示例程序中的IP地址，否则例程可能会无法正常运行。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : softAPConfig()演示</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用ESP8266WiFiAP库来演示softAPConfig()函数可用于配置网络信息.在wifi初始化</span></span><br><span class="line"><span class="comment">时可配置接入点IP地址，网关IP地址，子网掩码和默认的IP地址.</span></span><br><span class="line"><span class="comment">****************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>          <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"> </span><br><span class="line">IPAddress <span class="title function_">local_IP</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">22</span>)</span>;<span class="comment">//手动设置的开启的网络的ip地址</span></span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">9</span>)</span>;  <span class="comment">//手动设置的网关IP地址</span></span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span>; <span class="comment">//手动设置的子网掩码</span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> flag;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//配置接入点的IP，网关IP，子网掩码</span></span><br><span class="line">  WiFi.softAPConfig(local_IP, gateway, subnet);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）,通道为3，wifi隐藏，最大连接数=4</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password,<span class="number">3</span>,<span class="number">1</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result </span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password); </span><br><span class="line">  <span class="keyword">if</span>(flag)&#123; </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);    </span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码   </span></span><br><span class="line">  Serial.println(<span class="string">&quot;网络IP&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;local_IP&quot;</span>);     <span class="comment">//打印ip地址</span></span><br><span class="line">  Serial.println(<span class="string">&quot;网关IP&quot;</span>);</span><br><span class="line">  Serial.println(gateway);        <span class="comment">//打印网关IP</span></span><br><span class="line">  Serial.println(<span class="string">&quot;子网掩码：&quot;</span>);</span><br><span class="line">  Serial.println(subnet);         <span class="comment">//打印子网掩码</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="softAPDisconnect"><a href="#softAPDisconnect" class="headerlink" title="softAPDisconnect"></a>softAPDisconnect</h4><h5 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h5><p>softAPdisconnect函数可用于关闭ESP8266开发板的接入点模式，即关闭ESP8266所建立的WiFi网络。</p>
<h5 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h5><ul>
<li>WiFi.softAPdisconnect()</li>
<li>WiFi.softAPdisconnect(val)</li>
</ul>
<h5 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h5><p>参数val类型为bool。如果将该参数设置为true，设备将直接关闭接入点模式。</p>
<p>在不输入参数的情况下调用该函数，设备会将当前配置的网络名和密码设置为空值。</p>
<h5 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h5><p>返回设置是否成功的结果。设置成功返回true。数据类型为bool型。</p>
<h5 id="示例程序-2"><a href="#示例程序-2" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : softAPdisconnect()函数演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiAP库来演示softAPdisconnect()可用，可关闭AP模式***************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> flag;</span><br><span class="line"><span class="type">bool</span> wifioff = <span class="literal">true</span>;      <span class="comment">// 接入点模式设置变量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）,通道为3，wifi隐藏，最大连接数=4</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result</span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">    Serial.println(WiFi.getMode());</span><br><span class="line">    Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);</span><br><span class="line">    Serial.println(AP_ssid);         <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">    Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);</span><br><span class="line">    Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">    Serial.println(<span class="string">&quot;接入点模式成功开启&quot;</span>);</span><br><span class="line">    Serial.println(<span class="string">&quot;15秒后关闭接入点&quot;</span>);</span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line">    delay(<span class="number">5000</span>); <span class="comment">//延时15s检查接入点开启效果</span></span><br><span class="line">    Serial.println(<span class="string">&quot;即将关闭接入点&quot;</span>);</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    WiFi.softAPdisconnect(wifioff);<span class="comment">//关闭接入点</span></span><br><span class="line">    Serial.println(<span class="string">&quot;接入点已经关闭&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="信息类型"><a href="#信息类型" class="headerlink" title="信息类型"></a>信息类型</h3><h4 id="softAPIP"><a href="#softAPIP" class="headerlink" title="softAPIP"></a>softAPIP</h4><h5 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h5><p>ESP8266开发板建立WiFi接入点后， 我们可以使用本函数获取ESP8266开发板的IP地址。</p>
<h5 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h5><p><code>wiFiAP.softAPIP()</code></p>
<p><code>Serial.println(wiFiAP.softAPIP());</code></p>
<h5 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h5><p>此函数的返回值是ESP8266开发板的IP地址。（类型：IPAddress）</p>
<h5 id="示例程序-3"><a href="#示例程序-3" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将以下示例程序上传给ESP8266开发板后，ESP8266将会建立一个隐藏的WiFi网络。网络名称(SSID)为”TaichiMaker_WIFI”,网络密码为”12345678″ 。在开发板成功建立WiFi网络后，您也可以通过串口监视器看到ESP8266开发板的IP地址。该信息是由以下程序中的WiFi.softAPIP()所获取的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : softAPIP获取接入点的IP地址</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">演示softAPIP()函数的用法，获取接入点的ip地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> flag;    </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）,通道为3，wifi隐藏，最大连接数=4</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result</span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password);</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">    Serial.println(WiFi.getMode());</span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);</span><br><span class="line">    Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);</span><br><span class="line">    Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">    Serial.print(<span class="string">&quot;接入点模式成功开启&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    Serial.print(<span class="string">&quot;当前接入点的IP地址为： &quot;</span>);</span><br><span class="line">    Serial.println(WiFi.softAPIP());     <span class="comment">//串口打印当前AP点的IP地址</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="softAPmacAddress"><a href="#softAPmacAddress" class="headerlink" title="softAPmacAddress"></a>softAPmacAddress</h4><h5 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h5><p>ESP8266开发板建立WiFi接入点后， 我们可以使用本函数获取ESP8266开发板的mac地址。</p>
<h5 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.softAPmacAddress</code>()<br><code>WiFi.softAPmacAddress</code>(macAddr)</p>
<h5 id="参数-返回值"><a href="#参数-返回值" class="headerlink" title="参数 &#x2F; 返回值"></a>参数 &#x2F; 返回值</h5><p>a.如以下语句所示，如果不输入参数，函数的返回值为ESP8266开发板的mac地址（String类型）。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;MAC地址为 %s\n&quot;</span>, WiFi.softAPmacAddress().c_str());</span><br></pre></td></tr></table></figure>

<p>b.如果输入参数macAddr。那么ESP8266开发板的mac地址将会存储在macAddr中。macAddr必须是一个uint8_t类型的数组，且该数组含有6个元素。如下简例所示：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">uint8_t</span> macAddr[<span class="number">6</span>];</span><br><span class="line">WiFi.softAPmacAddress(macAddr);</span><br><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;MAC地址为  %02x:%02x:%02x:%02x:%02x:%02x\n&quot;</span>, macAddr[<span class="number">0</span>], macAddr[<span class="number">1</span>], macAddr[<span class="number">2</span>], macAddr[<span class="number">3</span>], macAddr[<span class="number">4</span>], macAddr[<span class="number">5</span>]);</span><br></pre></td></tr></table></figure>





<h5 id="示例程序-4"><a href="#示例程序-4" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将以下示例程序上传给ESP8266开发板后，ESP8266将会建立一个WiFi网络。网络名称(SSID)为”TaichiMaker_WIFI”,网络密码为”12345678″ 。在开发板成功建立WiFi网络后，您将通过串口监视器看到ESP8266模块的mac地址。在以下示例程序中，我们使用了两种macAddress函数调用方式来获取设备的IP地址。第一种是有参数的第二种是无参数的。这两种方式所获得的mac地址格式不同。有参数调用时，mac地址保存在数组macAddr中。无参数调用时，mac地址将以字符串形式返回。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : softAPIP获取接入点MAC地址</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">演示softAPIP()函数的用法，获取接入点的MAC地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> flag;</span><br><span class="line"><span class="type">uint8_t</span> macAddr[<span class="number">6</span>]; <span class="comment">// 存储设备mac地址的数组</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result</span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">    Serial.println(WiFi.getMode());</span><br><span class="line">    Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);</span><br><span class="line">    Serial.println(AP_ssid);         <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">    Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);</span><br><span class="line">    Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">    Serial.println(<span class="string">&quot;接入点模式成功开启&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//不输入参数获取MAC地址</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;MAC地址为 %s\n&quot;</span>, WiFi.softAPmacAddress().c_str());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输入参数获取MAC地址</span></span><br><span class="line">    WiFi.softAPmacAddress(macAddr);                                  </span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;MAC地址为  %02x:%02x:%02x:%02x:%02x:%02x\n&quot;</span>, macAddr[<span class="number">0</span>], macAddr[<span class="number">1</span>], macAddr[<span class="number">2</span>], macAddr[<span class="number">3</span>], macAddr[<span class="number">4</span>], macAddr[<span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="softAPSSID"><a href="#softAPSSID" class="headerlink" title="softAPSSID"></a>softAPSSID</h4><h5 id="说明-5"><a href="#说明-5" class="headerlink" title="说明"></a>说明</h5><p>ESP8266开发板建立WiFi接入点后， 我们可以使用本函数获取WiFi名称。</p>
<h5 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.softAPSSID()</code></p>
<h5 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h5><p>返回接入点WiFi名称，数据类型为字符串型。</p>
<h5 id="示例程序-5"><a href="#示例程序-5" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将以下示例程序上传给ESP8266开发板后，ESP8266将会建立一个WiFi网络。网络名称(SSID)为”TaichiMaker_WIFI”,网络密码为”12345678″ 。在开发板成功建立WiFi网络后，您也可以通过串口监视器看到ESP8266建立的WiFi名称。该信息是由以下程序中的WiFi.softAPSSID()所获取的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : softAPSSID获取接入点SSID</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">演示softAPSSID()函数的用法，获取接入点的wifi名称</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>          <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> flag;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result</span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">    Serial.println(WiFi.getMode());</span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);</span><br><span class="line">    Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);</span><br><span class="line">    Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点模式成功开启&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    Serial.print(<span class="string">&quot;softAPSSID()获取接入点SSID为：&quot;</span>);</span><br><span class="line">    Serial.println(WiFi.softAPSSID()); <span class="comment">//输出接入点的wifi名称</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>







<h4 id="softAPPSK"><a href="#softAPPSK" class="headerlink" title="softAPPSK"></a>softAPPSK</h4><h5 id="说明-6"><a href="#说明-6" class="headerlink" title="说明"></a>说明</h5><p>ESP8266开发板建立WiFi接入点后， 我们可以使用本函数获取WiFi密码。</p>
<h5 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.softAPPSK()</code></p>
<h5 id="参数-5"><a href="#参数-5" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-4"><a href="#返回值-4" class="headerlink" title="返回值"></a>返回值</h5><p>返回接入点WiFi密码，数据类型为字符串型</p>
<h5 id="示例程序-6"><a href="#示例程序-6" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将以下示例程序上传给ESP8266开发板后，ESP8266将会建立一个WiFi网络。网络名称(SSID)为”TaichiMaker_WIFI”,网络密码为”12345678″ 。在开发板成功建立WiFi网络后，您也可以通过串口监视器看到ESP8266建立的WiFi名称。该信息是由以下程序中的WiFi.softAPPSK()所获取的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : softAPPSK获取AP的psk</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">演示softAPSSID()函数的用法，获取接入点密码</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>          <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> flag;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result</span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">    Serial.println(WiFi.getMode());</span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);</span><br><span class="line">    Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);</span><br><span class="line">    Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点模式成功开启&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    Serial.print(<span class="string">&quot;softAPPSK()获取接入点密码为：&quot;</span>);</span><br><span class="line">    Serial.println(WiFi.softAPPSK()); <span class="comment">//输出接入点密码</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="softAPGetStationNum"><a href="#softAPGetStationNum" class="headerlink" title="softAPGetStationNum"></a>softAPGetStationNum</h4><h5 id="说明-7"><a href="#说明-7" class="headerlink" title="说明"></a>说明</h5><p>softAPgetStationNum函数可用于获取通过WiFi连接到ESP8266开发板接入点的无线终端数量。</p>
<h5 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.softAPgetStationNum()</code></p>
<h5 id="参数-6"><a href="#参数-6" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-5"><a href="#返回值-5" class="headerlink" title="返回值"></a>返回值</h5><p>连接到ESP8266开发板接入点的无线终端数量，数据类型为int型。</p>
<h5 id="示例程序-7"><a href="#示例程序-7" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将以下示例程序上传给ESP8266开发板后，ESP8266将会建立一个WiFi网络。网络名称(SSID)为”TaichiMaker_WIFI”,网络密码为”12345678″ 。在开发板成功建立WiFi网络后，您也可以通过串口监视器看到连接到该WiFi网络的终端数量。该信息是由以下程序中的WiFi.softAPgetStationNum()所获取的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : 获取连接到接入点的无线终端数量</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">演示softAPSSID()函数的用法，获取连接到接入点的无线终端数量</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>          <span class="comment">//这里改成你的设备当前环境下接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> flag;</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  <span class="comment">//设置为接入点模式</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动AP，并设置账号和密码</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;设置接入点中 ... &quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//启动校验式网络（需要输入账号密码的网络）</span></span><br><span class="line">  WiFi.softAP(AP_ssid, password);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监控状态变量result</span></span><br><span class="line">  flag = WiFi.softAP(AP_ssid, password);</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">    Serial.println(WiFi.getMode());</span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点名字:&quot;</span>);</span><br><span class="line">    Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;接入点密码:&quot;</span>);  </span><br><span class="line">    Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">    Serial.print(<span class="string">&quot;接入点模式成功开启&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//若没有开启成功</span></span><br><span class="line">    Serial.println(<span class="string">&quot;开启失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化结束&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打印出当前连接到此接入点上的无线终端数目</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;连接此接入点上的无线终端数目 = %d\n&quot;</span>, WiFi.softAPgetStationNum());</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ESP8266WiFiSTA库"><a href="#ESP8266WiFiSTA库" class="headerlink" title="ESP8266WiFiSTA库"></a>ESP8266WiFiSTA库</h2><p>ESP8266WiFiSTA库用于ESP8266开发板的无线终端模式（Wireless Station）控制。</p>
<p>ESP8266模块的工作模式一共有三种。分别是：1，接入点端模式（AP）2，无线终端模式（Wireless Station）3，混合模式。</p>
<p>在无线终端模式下，ESP8266开发板可通过WiFi连接无线路由器。这与用您的手机通过WiFi连接无线路由器的模式相同。</p>
<p><img src="/./Image/ESP8266.assets/image-20230525151500136.png" alt="image-20230525151500136"></p>
<p>以下为ESP8266WiFiSTA库的整体结构图。在此图下方有ESP8266WiFiSTA库的函数目录。</p>
<p><img src="/./Image/ESP8266.assets/image-20230525151529405.png" alt="image-20230525151529405"></p>
<h3 id="管理类型-1"><a href="#管理类型-1" class="headerlink" title="管理类型"></a>管理类型</h3><h4 id="begin-–-连接WiFi"><a href="#begin-–-连接WiFi" class="headerlink" title="begin – 连接WiFi"></a>begin – 连接WiFi</h4><h5 id="说明-8"><a href="#说明-8" class="headerlink" title="说明"></a>说明</h5><p>此函数用于启动ESP8266开发板的无线终端工作模式。</p>
<p>在无线终端工作模式下，ESP8266可以通过局域网或者互联网收取物联网信息或者向其它物联网设备发送控制信号。</p>
<p>注：如果ESP8266模块之前被设置为接入点模式(AP)，我们在直接切换为无线终端模式的时候，使用ESP8266WiFiSTA库 – begin函数有可能会切换为接入点+无线终端混合的模式，而不能成功切换为我们想要的无线终端模式。如果调用后不清楚当前的模式状况，或者网络出现异常，我们最好检测一下ESP8266模块当前处于什么模式。(具体请参阅ESP8266WiFiGeneric库中的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifigeneric/8286-2/">mode</a>函数)</p>
<h5 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.begin()</code><br>a. 在不使用任何参数的情况下调用此函数，ESP8266模块将启用无线终端模式，并根据以前保存在闪存中的wifi配置连接到最近一次使用的接入点。</p>
<p><code>WiFi.begin(ssid, password, channel, bssid, connect)</code><br>b.我们也可以再调用begin函数的时候，为函数提供参数。这些参数的具体功能请见下面的“参数”部分介绍。</p>
<h5 id="参数-7"><a href="#参数-7" class="headerlink" title="参数"></a>参数</h5><ul>
<li>ssid – 要连接的wifi接入点的名字，最多可以包含32个字符。(类型：char*)</li>
<li>password – 要连接的 wifi接入点密码，长度至少应为8个字符且不超过64个字符。(类型：char*)</li>
<li>channel – 要连接的wifi接入点信道。(类型：int32_t)</li>
<li>bssid – 要连接的wifi接入点的mac地址。(类型：const uint8_t*)</li>
<li>connect – 连接状态参数。如果connect参数为true，ESP8266开发板会使用闪存中储存的信息尝试连接WiFi。如果connect参数为false，ESP8266开发板不会尝试连接WiFi，而只会将WiFi连接信息保存在闪存中。(类型：bool)</li>
</ul>
<h5 id="返回值-6"><a href="#返回值-6" class="headerlink" title="返回值"></a>返回值</h5><p>返回值数据类型为布尔型。如果ESP8266开发板成功启动无线终端模式，则返回true，否则返回false。</p>
<h5 id="示例程序-8"><a href="#示例程序-8" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的工作模式，即无线终端模式。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.begin()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示建立连接，ESP8266模块切换工作模式为无线终端模式。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;    <span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="config-–-配置网络（如-IP地址，网关IP等）"><a href="#config-–-配置网络（如-IP地址，网关IP等）" class="headerlink" title="config – 配置网络（如,IP地址，网关IP等）"></a>config – 配置网络（如,IP地址，网关IP等）</h4><h5 id="说明-9"><a href="#说明-9" class="headerlink" title="说明"></a>说明</h5><p>config函数可以用来设置ESP8266模块在无线终端模式下的IP配置，并将站接口的IP地址设置为用户定义的值。</p>
<h5 id="语法-9"><a href="#语法-9" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.config()</code><br><code>wiFi.config(local_ip, gateway, subnet, dns1, dns2)</code></p>
<p>用法简例</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">IPAddress <span class="title function_">staticIP</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">1</span>,<span class="number">22</span>)</span>;<span class="comment">//ESP8266的IP地址</span></span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">1</span>,<span class="number">9</span>)</span>; <span class="comment">//网关IP地址</span></span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span>;<span class="comment">//子网掩码</span></span><br><span class="line"></span><br><span class="line">WiFi.config(staticIP, gateway, subnet);<span class="comment">//进行设置</span></span><br></pre></td></tr></table></figure>



<h5 id="参数-8"><a href="#参数-8" class="headerlink" title="参数"></a>参数</h5><ul>
<li>local_ip: 配置ESP8266的固定IP地址。(IPAdress型)</li>
<li>gateway: 网关IP地址。(IPAdress型)</li>
<li>subnet: 子网掩码。(IPAddress型)</li>
<li>dns1，dns2: 这两个参数是可选参数。它们可定义域名服务器（DNS）的ip地址，这些域名服务器会关联一个域名目录，并将它们翻译成ip地址 (IPAddress型)</li>
</ul>
<h5 id="返回值-7"><a href="#返回值-7" class="headerlink" title="返回值"></a>返回值</h5><p>返回值会返回调用函数后是否有设置成功的结果。如果设置成功则返回true。数据类型为布尔型。</p>
<h5 id="示例程序-9"><a href="#示例程序-9" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的网络配置信息。</p>
<p>以下程序中，我们首先使用了以下语句建立用于配置ESP8266模块的IP地址信息。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">IPAddress <span class="title function_">staticIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">22</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">9</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>接下来，我们使用以下语句对开发板进行网络配置。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">WiFi.config(staticIP, gateway, subnet)</span><br></pre></td></tr></table></figure>

<p><strong>在使用以下示例程序时请注意：</strong></p>
<ol>
<li><p>设置了静态IP地址的无线终端在连接WiFi时速度会更快。下面附带的例子用了500ms左右就可以连接上。原因是跳过了获得动态IP配置这一步。在设置固定IP时，要注意不要出现设置的ESP8266开发板IP地址与其它网络设备的IP发生冲突。</p>
</li>
<li><p>由于不同路由所提供的WiFi网络配置是不同的,使用本例程时请根据网络环境设置自己的网关IP、设备IP和子网掩码，否则可能会造成例程无法正常运行</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.config()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示建立连接，ESP8266模块设置无线终端模式下的IP配置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">IPAddress <span class="title function_">staticIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">22</span>)</span>;<span class="comment">//请按照自己的网络环境设置这三个参数</span></span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">9</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>); <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在配置网络&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//无线终端模式下配置IP，并将接口的IP配置设置为用户定义的值</span></span><br><span class="line">  <span class="comment">//如果不设置 则表示使用DHCP下发的信息</span></span><br><span class="line">  WiFi.config(staticIP, gateway, subnet);</span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户连接到的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接到的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;当前无线终端静态IP地址： &quot;</span>);<span class="comment">// 告知用户当前无线终端的IP地址(也就是我们设置的地址)</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">  Serial.print(<span class="string">&quot;当前无线终端网关的IP地址： &quot;</span>);<span class="comment">// 告知用户当前无线终端网关的IP地址</span></span><br><span class="line">  Serial.println(WiFi.gatewayIP());</span><br><span class="line">  Serial.print(<span class="string">&quot;当前无线终端： &quot;</span>);<span class="comment">// 告知用户当前无线终端的子网掩码地址</span></span><br><span class="line">  Serial.println(WiFi.subnetMask());</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="reconnect-–-重新连接WiFi"><a href="#reconnect-–-重新连接WiFi" class="headerlink" title="reconnect – 重新连接WiFi"></a>reconnect – 重新连接WiFi</h4><h5 id="说明-10"><a href="#说明-10" class="headerlink" title="说明"></a>说明</h5><p>调用reconnect函数可以让ESP8266模块断开再重新连接WiFi。</p>
<h5 id="语法-10"><a href="#语法-10" class="headerlink" title="语法"></a>语法</h5><p><code>wifi.reconnect()</code><br>注意：<br>1.如果ESP8266模块没有接入任何WiFi或者不处于无线终端模式，则函数将返回false，且不执行任何操作<br>2.如果函数返回true，则表示ESP8266已成功开始执行重新连接WiFi这一操作。但这里的返回值true并不代表ESP已经成功连接到了WiFi。</p>
<h5 id="参数-9"><a href="#参数-9" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-8"><a href="#返回值-8" class="headerlink" title="返回值"></a>返回值</h5><p>数据类型为布尔型。<br>返回false，则说明ESP8266不处于无线终端模式，或者说在此之前没有连结果任何接入点。返回true，说明已经成功重新启动WiFi连接。</p>
<h5 id="示例程序-10"><a href="#示例程序-10" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，设备会保持连接状态等待10秒钟，然后设备将会使用以下程序中的<code>WiFi.reconnect();</code>语句来实现网络重新连接这一操作。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.reconnect()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示reconnect()重新连接网络</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户连接到的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接到的接入点WiFi密码</span></span><br><span class="line">  Serial.println(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;10秒后断开重连&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;即将重新连接&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;开始重新连接&quot;</span>);</span><br><span class="line">  WiFi.reconnect();<span class="comment">//重新连接</span></span><br><span class="line">  </span><br><span class="line">  i = <span class="number">0</span>;<span class="comment">//重新赋值i以便再次计数</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是重新连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;重新连接成功！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="disconnect-–-断开WiFi连接"><a href="#disconnect-–-断开WiFi连接" class="headerlink" title="disconnect – 断开WiFi连接"></a>disconnect – 断开WiFi连接</h4><h5 id="说明-11"><a href="#说明-11" class="headerlink" title="说明"></a>说明</h5><p>disconnect函数将当前配置给ESP8266模块的SSID和密码设置为空值，使ESP8266与断开WiFi连接。</p>
<h5 id="语法-11"><a href="#语法-11" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.disconnect()</code></p>
<p><code>wiFi.disconnect(wifioff)</code></p>
<p>如果参数wifioff设置为false或者不填参数，SSID和密码将会被设置为空值，同时这一操作还会使ESP8266模块与接入点断开连接。需要注意的是，用这种方法仅仅会断开WiFi连接，ESP8266模块仍然会处于无线终端模式。</p>
<p><code>WiFi.disconnect();//断开连接，但仍然处于无线终端模式，只是清除了SSID和密码</code></p>
<p>当我们设置入参wifioff 为true，那么这样的操作会直接关闭无线终端模式。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> wifioff = <span class="literal">true</span><span class="comment">//设置关闭变量</span></span><br><span class="line">WiFi.disconnect(wifioff);<span class="comment">//断开连接</span></span><br></pre></td></tr></table></figure>





<h5 id="参数-10"><a href="#参数-10" class="headerlink" title="参数"></a>参数</h5><p>wifioff (可选参数)：此参数为bool型。设置为true，那么就会关闭无线终端模式。设置为false，则SSID和密码将会被设置为空值，同时还会使ESP8266模块与接入点断开连接。</p>
<h5 id="返回值-9"><a href="#返回值-9" class="headerlink" title="返回值"></a>返回值</h5><p>返回是否成功设置。成功设置则返回true，否则返回false。返回值数据类型为布尔型。</p>
<h5 id="示例程序-11"><a href="#示例程序-11" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，设备会保持连接状态等待10秒钟，然后设备将会使用以下程序中的 <code>WiFi.disconnect(wifioff)</code> 语句来实现断开网络这一操作。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.disconnect(wifioff)演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示建立连接，ESP8266模块关闭无线终端模式</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> wifioff = <span class="literal">true</span>;<span class="comment">//演示关闭连接所需的参数</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户连接到的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接到的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;10秒后断开连接&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;即将断开连接&quot;</span>);</span><br><span class="line">  delay(<span class="number">500</span>);</span><br><span class="line">  WiFi.disconnect(wifioff);<span class="comment">//断开连接</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;无线终端和接入点的连接已中断&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;未能成功断开连接！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="setAutoConnect-–-设置是否自动连接WiFi"><a href="#setAutoConnect-–-设置是否自动连接WiFi" class="headerlink" title="setAutoConnect – 设置是否自动连接WiFi"></a>setAutoConnect – 设置是否自动连接WiFi</h4><h5 id="说明-12"><a href="#说明-12" class="headerlink" title="说明"></a>说明</h5><p>setAutoConnect函数可以激活ESP8266模块的自动连接模式。模式激活后，ESP8266模块会在通电后自动连接到最近连接过的WiFi接入点。</p>
<p>另外，我们也可以使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifista/getautoconnect/">getAutoConnect</a>函数来获取ESP8266开发板是否激活自动连接模式。</p>
<h5 id="语法-12"><a href="#语法-12" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.setAutoConnect()</code></p>
<p><code>wiFi.setAutoConnect(autoConnect)</code></p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> autoConnect = ture;</span><br><span class="line">...</span><br><span class="line">WiFi.setAutoConnect(autoConnect); <span class="comment">//启用自动连接模式</span></span><br></pre></td></tr></table></figure>



<h5 id="参数-11"><a href="#参数-11" class="headerlink" title="参数"></a>参数</h5><p>autoConnect是一个可选的参数。如果设置为false，则将禁用自动连接功能。如果省略或设置为true，则将启用自动连接模式。（参数类型：布尔型）</p>
<h5 id="返回值-10"><a href="#返回值-10" class="headerlink" title="返回值"></a>返回值</h5><p>返回值的状态可以表明是否设置成功。设置自动连接成功则返回true，否则返回false。数据类型为布尔型。</p>
<h5 id="示例程序-12"><a href="#示例程序-12" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，设备会保持连接状态等待10秒钟，然后设备将会使用以下程序中的 <code>WiFi.setAutoConnect(autoConnect)</code> 语句来实激活自动连接模式。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.setAutoConnect()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下设置上电后自动连接</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> autoConnect = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在配置网络&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置自动连接</span></span><br><span class="line">  WiFi.setAutoConnect(autoConnect);<span class="comment">//启用自动连接。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;已设置自动连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户连接到的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接到的接入点WiFi密码</span></span><br><span class="line">  Serial.println(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="setAutoReconnect-–-设置是否自动重新连接WiFi"><a href="#setAutoReconnect-–-设置是否自动重新连接WiFi" class="headerlink" title="setAutoReconnect – 设置是否自动重新连接WiFi"></a>setAutoReconnect – 设置是否自动重新连接WiFi</h4><h5 id="说明-13"><a href="#说明-13" class="headerlink" title="说明"></a>说明</h5><p>setAutoReconnect函数可以用来设置是否要自动重新连接到最近连接过的接入点。设置后，一旦ESP8266模块出现断开网络连接的状况，ESP8266模块会反复尝试自动重连。</p>
<h5 id="语法-13"><a href="#语法-13" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.setAutoReconnect()</code></p>
<p><code>wiFi.setAutoReconnect(autoReconnect)</code></p>
<h5 id="参数-12"><a href="#参数-12" class="headerlink" title="参数"></a>参数</h5><p>输入参数只要一个autoReconnect，如果参数autoReconnect设置为true，则模块将尝试重新建立与无线终端的丢失连接。如果设置为false则模块将保持断开连接状态。（参数类型：bool）</p>
<h5 id="返回值-11"><a href="#返回值-11" class="headerlink" title="返回值"></a>返回值</h5><p>返回值会返回设置是否成功。如果设置成功则返回true，数据类型为布尔型。</p>
<p>注意：<br>断开网络连接后再调用该函数进行设置是无效的，一定要在断开连接之前就设置好，最好就放在网络初始化的时候进行设置。</p>
<h5 id="示例程序-13"><a href="#示例程序-13" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，设备会保持连接状态等待10秒钟，然后设备将会使用以下程序中的WiFi.setAutoReconnect(autoReconnect); 语句来设置ESP8266模块为自动重新连接网络模式。你可以在模块连接网络成功后，重启WiFi接入点，这时候您将会看到ESP8266模块在WiFi接入点重启后，重新尝试连接该WiFi接入点。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.setAutoReConnect()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下设置自动重新连接</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> autoReconnect = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在配置网络&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置自动连接</span></span><br><span class="line">  WiFi.setAutoReconnect(autoReconnect);<span class="comment">//设置断开连接后重连</span></span><br><span class="line">  Serial.println(<span class="string">&quot;已设置自动重新连接&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户连接到的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接到的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;此时可关闭接入点使网络连接断开，接入点再次打开后ESP8266模块可自动重连&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(WiFi.status() == WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;网络连接正常&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;网络连接断开，模块已设置自动重连，正在等待连接&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="waitForConnectResult-–-等待WiFi连接"><a href="#waitForConnectResult-–-等待WiFi连接" class="headerlink" title="waitForConnectResult – 等待WiFi连接"></a>waitForConnectResult – 等待WiFi连接</h4><h5 id="说明-14"><a href="#说明-14" class="headerlink" title="说明"></a>说明</h5><p>waitForConnectResult用于在无线终端模式或无线终端+接入点混合模式下的ESP8266模块检测当前连接状态。</p>
<h5 id="语法-14"><a href="#语法-14" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.waitForConnectResult()</code></p>
<p><code>wiFi.waitForConnectResult(timeoutLength)</code></p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> timeoutLength = <span class="number">5000</span>;<span class="comment">//设置5000毫秒后无响应就视为网络连接超时</span></span><br><span class="line">...</span><br><span class="line">WiFi.waitForConnectResult(timeoutLength);		</span><br></pre></td></tr></table></figure>

<h5 id="参数-13"><a href="#参数-13" class="headerlink" title="参数"></a>参数</h5><p>ESP8266在尝试连接WiFi时，我们可以通过timeoutLength（毫秒）来设置等待连接的时间。如果ESP8266在timeoutLength设置的时间内仍未成功连接WiFi，则本函数会返回“超时错误”错误码：-1。</p>
<p>关于ESP8266的错误码详情见下面的返回值部分（参数数据类型：unsigned long型）</p>
<h5 id="返回值-12"><a href="#返回值-12" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为uint8_t。以下是返回值数值以及对应的信息：</p>
<ul>
<li>255： WL_NO_SHIELD – 返回值为255说明无扩展板。8266本来带有网络功能，不需要额外的扩展板（sheld），因此一般不会出现这个报错</li>
<li>0：​ WL_IDLE_STATUS – 返回值为0说明正在尝试连接</li>
<li>1​： WL_NO_SSID_AVAIL – 返回值为1说明没有找到设定的SSID的网络</li>
<li>2​： WL_SCAN_COMPLETED – 返回值为2说明网络扫描完毕</li>
<li>3：​ WL_CONNECTED – 返回值为3说明连接成功成功</li>
<li>4： WL_CONNECT_FAILED – 返回值为4说明连接失败</li>
<li>5： WL_CONNECTION_LOST – 返回值为5说明连接丢失</li>
<li>6： WL_DISCONNECTED – 返回值为6说明未连接</li>
<li>-1： WiFi连接超时</li>
</ul>
<h5 id="示例程序-14"><a href="#示例程序-14" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.waitForConnectResult()演示</span></span><br><span class="line"><span class="comment">  日期/Date（YYYYMMDD）     : 20200405</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在Station模式下返回当前网络连接状态。本实例仅展示成功连接状况的返回值</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户连接到的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接到的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//设置5000毫秒后无响应就视为网络连接超时  </span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> timeoutLength = <span class="number">5000</span>; </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//打印当前网络连接状态码</span></span><br><span class="line">  Serial.println(WiFi.waitForConnectResult(timeoutLength));</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="信息类型-1"><a href="#信息类型-1" class="headerlink" title="信息类型"></a>信息类型</h3><h4 id="status-–-获取WiFi连接状态"><a href="#status-–-获取WiFi连接状态" class="headerlink" title="status – 获取WiFi连接状态"></a>status – 获取WiFi连接状态</h4><h5 id="说明-15"><a href="#说明-15" class="headerlink" title="说明"></a>说明</h5><p>status函数可以在无线终端模式下，获取当前的ESP8266模块网络连接状态。</p>
<h5 id="语法-15"><a href="#语法-15" class="headerlink" title="语法"></a>语法</h5><p><code>wifi.status()</code></p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前连接状态: &quot;</span>);</span><br><span class="line">Serial.<span class="built_in">printf</span>(WiFi.status());<span class="comment">//打印当前连接状态</span></span><br></pre></td></tr></table></figure>



<h5 id="参数-14"><a href="#参数-14" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-13"><a href="#返回值-13" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为uint8_t。以下是返回值数值以及对应的信息：</p>
<ul>
<li>255： WL_NO_SHIELD – 返回值为255说明无扩展板。8266本来带有网络功能，不需要额外的扩展板（sheld），因此一般不会出现这个报错</li>
<li>0：​ WL_IDLE_STATUS – 返回值为0说明正在尝试连接</li>
<li>1​： WL_NO_SSID_AVAIL – 返回值为1说明没有找到设定的SSID的网络</li>
<li>2​： WL_SCAN_COMPLETED – 返回值为2说明网络扫描完毕</li>
<li>3：​ WL_CONNECTED – 返回值为3说明连接成功成功</li>
<li>4： WL_CONNECT_FAILED – 返回值为4说明连接失败</li>
<li>5： WL_CONNECTION_LOST – 返回值为5说明连接丢失</li>
<li>6： WL_DISCONNECTED – 返回值为6说明未连接</li>
</ul>
<h5 id="示例程序-15"><a href="#示例程序-15" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的联网状态代码。在以下示例程序中，我们使用了<code>WiFi.status()</code>语句来获取联网状态。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.status()演示</span></span><br><span class="line"><span class="comment">  团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">  作者/Author              : 小黑</span></span><br><span class="line"><span class="comment">  日期/Date（YYYYMMDD）     : 20200405</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式获取当前的网络连接状态</span></span><br><span class="line"><span class="comment">  -----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">  本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">  该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">  http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;此时关闭接入点，可以看到连接状态报告函数 WiFi.status()返回值变化&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;\n当前连接状态: %d\n&quot;</span>, WiFi.status());</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="SSID-–-获取SSID"><a href="#SSID-–-获取SSID" class="headerlink" title="SSID – 获取SSID"></a>SSID – 获取SSID</h4><h5 id="说明-16"><a href="#说明-16" class="headerlink" title="说明"></a>说明</h5><p>利用SSID函数可以获取当前ESP8266模块所连接的网络SSID。</p>
<h5 id="语法-16"><a href="#语法-16" class="headerlink" title="语法"></a>语法</h5><p><code>wifi.SSID()</code></p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;SSID:&quot;</span>);</span><br><span class="line">Serial.<span class="built_in">printf</span>(WiFi.SSID()); <span class="comment">//打印出当前8266模块所连接的网络的SSID</span></span><br></pre></td></tr></table></figure>



<h5 id="参数-15"><a href="#参数-15" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-14"><a href="#返回值-14" class="headerlink" title="返回值"></a>返回值</h5><p>返回SSID，数据类型为string型。</p>
<h5 id="示例程序-16"><a href="#示例程序-16" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块所连接WiFi的SSID。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.SSID()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式获取当前网络的SSID</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;SSID: %s\n&quot;</span>, WiFi.SSID().c_str());<span class="comment">//打印出当前8266模块所连接的网络的SSID.此处用.c_str()来确保打印正常</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="psk-–-获取psk"><a href="#psk-–-获取psk" class="headerlink" title="psk – 获取psk"></a>psk – 获取psk</h4><h5 id="说明-17"><a href="#说明-17" class="headerlink" title="说明"></a>说明</h5><p>无线终端模式下，调用psk()函数就可以获取ESP8266模块连接到当前网络的密码。</p>
<h5 id="语法-17"><a href="#语法-17" class="headerlink" title="语法"></a>语法</h5><p><code>wifi.psk()</code></p>
<h5 id="参数-16"><a href="#参数-16" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-15"><a href="#返回值-15" class="headerlink" title="返回值"></a>返回值</h5><p>返回当前连接的接入点的密码，数据类型为 string型</p>
<h5 id="示例程序-17"><a href="#示例程序-17" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块所连接WiFi的网络密码。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.psk();演示 程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下打印当前接入点密码</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxxxxx&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;psk: %s\n&quot;</span>, WiFi.psk().c_str());<span class="comment">//打印出当前8266模块所连接网络的psk.此处用.c_str()来确保打印正常</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="BSSIDstr-–-获取WiFi接入点的mac地址"><a href="#BSSIDstr-–-获取WiFi接入点的mac地址" class="headerlink" title="BSSIDstr – 获取WiFi接入点的mac地址"></a>BSSIDstr – 获取WiFi接入点的mac地址</h4><h5 id="说明-18"><a href="#说明-18" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板处于无线终端模式下，BSSIDstr函数可用于获取wif接入点设备的MAC地址。</p>
<h5 id="语法-18"><a href="#语法-18" class="headerlink" title="语法"></a>语法</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">wifi.BSSIDstr()</span><br></pre></td></tr></table></figure>

<h5 id="参数-17"><a href="#参数-17" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-16"><a href="#返回值-16" class="headerlink" title="返回值"></a>返回值</h5><p>wif接入点设备的MAC地址，返回值数据类型为string。</p>
<h5 id="示例程序-18"><a href="#示例程序-18" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块所连接WiFi的接入点设备mac地址。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.BSSID();</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下打印当前wifi网络macaddress</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;BSSID为: &quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(WiFi.BSSIDstr().c_str());<span class="comment">//获取wifi接入点的MAC地址，并打印出来</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="localIP-–-获取IP地址"><a href="#localIP-–-获取IP地址" class="headerlink" title="localIP – 获取IP地址"></a>localIP – 获取IP地址</h4><h5 id="说明-19"><a href="#说明-19" class="headerlink" title="说明"></a>说明</h5><p>localIP函数可在无线终端模式下获取当前SEP8266模块的IP地址。</p>
<h5 id="语法-19"><a href="#语法-19" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wifi.localIP()</span><br></pre></td></tr></table></figure>

<h5 id="参数-18"><a href="#参数-18" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-17"><a href="#返回值-17" class="headerlink" title="返回值"></a>返回值</h5><p>返回值为当前无线终端分配的IP地址，数据类型为IPAdress型。</p>
<h5 id="示例程序-19"><a href="#示例程序-19" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的IP地址。在以下示例程序中，我们使用了WiFi.localIP()语句来获取IP地址。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.localIP();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下打印当前无线终端IP地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;无线终端IP地址为: &quot;</span>);</span><br><span class="line">    Serial.println(WiFi.localIP());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="subnetMask-–-获取子网掩码"><a href="#subnetMask-–-获取子网掩码" class="headerlink" title="subnetMask – 获取子网掩码"></a>subnetMask – 获取子网掩码</h4><h5 id="说明-20"><a href="#说明-20" class="headerlink" title="说明"></a>说明</h5><p>利用SSID函数可以获取当前ESP8266模块所连接网络的子网掩码。</p>
<h5 id="语法-20"><a href="#语法-20" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wifi.subnetMask()</span><br></pre></td></tr></table></figure>

<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.print(<span class="string">&quot;子网掩码: &quot;</span>);</span><br><span class="line">Serial.println(WiFi.subnetMask());<span class="comment">//直接打因为字符串获取子网掩码</span></span><br></pre></td></tr></table></figure>



<h5 id="参数-19"><a href="#参数-19" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-18"><a href="#返回值-18" class="headerlink" title="返回值"></a>返回值</h5><p>返回值为ESP8266设备的子网掩码，数据类型为IPAdress。</p>
<h5 id="示例程序-20"><a href="#示例程序-20" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的子网掩码。在以下示例程序中，我们使用了WiFi.subnetMask()语句来获取该信息。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.subnetMask()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下打印子网掩码的IP地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.print(<span class="string">&quot;子网掩码: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.subnetMask());<span class="comment">//直接打因为字符串获取子网掩码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="gatewayIP-–-获取网关地址"><a href="#gatewayIP-–-获取网关地址" class="headerlink" title="gatewayIP – 获取网关地址"></a>gatewayIP – 获取网关地址</h4><h5 id="说明-21"><a href="#说明-21" class="headerlink" title="说明"></a>说明</h5><p>利用gatewayIP函数可以获取当前ESP8266模块所连接网络的网关IP。</p>
<h5 id="语法-21"><a href="#语法-21" class="headerlink" title="语法"></a>语法</h5><p>wifi.gatewayIP()</p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;网关地址: &quot;</span>);</span><br><span class="line">Serial.<span class="built_in">printf</span>(WiFi.gatewayIP());<span class="comment">//把网关地址打印为字符串</span></span><br></pre></td></tr></table></figure>



<h5 id="参数-20"><a href="#参数-20" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-19"><a href="#返回值-19" class="headerlink" title="返回值"></a>返回值</h5><p>返回值直接返回网关IP，数据类型为IPAdress型。</p>
<h5 id="示例程序-21"><a href="#示例程序-21" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的联网状态代码。在以下示例程序中，我们使用了WiFi.gatewayIP()语句来获取网关IP。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.gatewayIP();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下获取网关IP地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;网关地址: %s\n&quot;</span>, WiFi.gatewayIP().toString().c_str());<span class="comment">//打印网关地址。此处使用.toString()和.c_str()确保能够正常打印</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="dnsIP-–-获取DNS地址"><a href="#dnsIP-–-获取DNS地址" class="headerlink" title="dnsIP – 获取DNS地址"></a>dnsIP – 获取DNS地址</h4><h5 id="说明-22"><a href="#说明-22" class="headerlink" title="说明"></a>说明</h5><p>利用dnsIP函数可以获取当前ESP8266模块的dns IP地址。</p>
<h5 id="语法-22"><a href="#语法-22" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.dnsIP()</code></p>
<p><code>WiFi.dnsIP(dns_no)</code></p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.print(<span class="string">&quot;DNS #1IP为: &quot;</span>);<span class="comment">//打印出获取的DNS地址</span></span><br><span class="line">Serial.print(WiFi.dnsIP());</span><br><span class="line">Serial.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">Serial.print(<span class="string">&quot;DNS #2 IP为: &quot;</span>);</span><br><span class="line">Serial.print(WiFi.dnsIP(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>



<h5 id="参数-21"><a href="#参数-21" class="headerlink" title="参数"></a>参数</h5><p>参数dns_no为可选参数。通过输入参数dns_no，我们可以指定所需的域名服务器的IP。此参数允许的值是0或1。如果未提供任何参数或参数为0，函数会返回DNS＃1的IP。如果参数为1，则返回DNS#2的IP。参数数据类型uint8_t型。</p>
<h5 id="返回值-20"><a href="#返回值-20" class="headerlink" title="返回值"></a>返回值</h5><p>DNS服务的IP地址，返回DNS＃1或DNS＃2的IP，数据类型为IPAdress。</p>
<h5 id="示例程序-22"><a href="#示例程序-22" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的DNS IP地址。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.dnsIP();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下获取dns地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//打印出当前网络下的DNSIP</span></span><br><span class="line">  Serial.print(<span class="string">&quot;DNS #1IP为: &quot;</span>);</span><br><span class="line">  Serial.print(WiFi.dnsIP());</span><br><span class="line">  Serial.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;DNS #2 IP为: &quot;</span>);</span><br><span class="line">  Serial.print(WiFi.dnsIP(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="macAddress-–-获取mac地址"><a href="#macAddress-–-获取mac地址" class="headerlink" title="macAddress – 获取mac地址"></a>macAddress – 获取mac地址</h4><h5 id="说明-23"><a href="#说明-23" class="headerlink" title="说明"></a>说明</h5><p>利用gatewayIP函数可以获取ESP8266模块的mac地址</p>
<h5 id="语法-23"><a href="#语法-23" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.macAddress(macAddr)</code></p>
<p><code>WiFi.macAddress()</code></p>
<p>简例：</p>
<p>a. 如果输入参数macAddr，那么ESP8266开发板的mac地址将会存储在macAddr中。macAddr必须是一个uint8_t类型的数组，这个数组含有6个元素。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint8_t</span> macAddr[<span class="number">6</span>];</span><br><span class="line">  WiFi.macAddress(macAddr);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;用转存到数组的方式获取MAC地址: %02x:%02x:%02x:%02x:%02x:%02x\n&quot;</span>, macAddr[<span class="number">0</span>], macAddr[<span class="number">1</span>], macAddr[<span class="number">2</span>], macAddr[<span class="number">3</span>], macAddr[<span class="number">4</span>], macAddr[<span class="number">5</span>]);</span><br><span class="line">  <span class="comment">//MAC地址会储存在这个数组里面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>b.如下示例所示，直接调用WiFi.macAddress()不输入参数，ESP8266的mac地址将以字符串类型返回。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;字符串获取MAC地址: %s\n&quot;</span>, WiFi.macAddress().c_str());</span><br><span class="line"> <span class="comment">//不输入参数直接调用可以直接打印出字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="参数-22"><a href="#参数-22" class="headerlink" title="参数"></a>参数</h5><p>macAddr：此参数为可选参数。该参数为uint8_t类型的数组，这个数组含有6个元素。ESP8266的mac地址将会储存在这个数组中。</p>
<h5 id="返回值-21"><a href="#返回值-21" class="headerlink" title="返回值"></a>返回值</h5><p>若输入参数则会返回储存了MAC地址的数组（uint8_t型）。若没有输入参数则会返回MAC地址字符串（string型）</p>
<h5 id="示例程序-23"><a href="#示例程序-23" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的mac地址。在以下示例程序中，我们使用了两种macAddress函数调用方式来获取设备的IP地址。第一种是有参数的第二种是无参数的。这两种方式所获得的mac地址格式不同。有参数调用时，mac地址保存在数组macAddr中。无参数调用时，mac地址将以字符串形式返回。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.macAddress()演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下打印当前无线终端MAC地址</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxxxxx&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">uint8_t</span> macAddr[<span class="number">6</span>]; <span class="comment">// 建立保存mac地址的数组。用于以下语句</span></span><br><span class="line">    WiFi.macAddress(macAddr);   </span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;通过转存数组获取MAC地址: %02x:%02x:%02x:%02x:%02x:%02x\n&quot;</span>, macAddr[<span class="number">0</span>], macAddr[<span class="number">1</span>], macAddr[<span class="number">2</span>], macAddr[<span class="number">3</span>], macAddr[<span class="number">4</span>], macAddr[<span class="number">5</span>]);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 无参数调用macAddress时，ESP8266的mac地址将以字符串形式返回</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;字符串获取MAC地址: %s\n&quot;</span>, WiFi.macAddress().c_str());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="hostname-–-获取-设置主机名"><a href="#hostname-–-获取-设置主机名" class="headerlink" title="hostname – 获取&#x2F;设置主机名"></a>hostname – 获取&#x2F;设置主机名</h4><h5 id="说明-24"><a href="#说明-24" class="headerlink" title="说明"></a>说明</h5><p>利用hostname函数可以获取WiFi路由器分配给ESP8266模块的主机名，同时也可以输入参数手动给ESP8266模块设置hostname（主机名）。</p>
<h5 id="语法-24"><a href="#语法-24" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.hostname()</code><br><code>WiFi.hostname(hostname)</code></p>
<p>简例：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前的hostname: %s\n&quot;</span>, WiFi.hostname().c_str());<span class="comment">//读取当前的hostname并输出</span></span><br><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;即将修改hostname为Station_Taichi&quot;</span>);</span><br><span class="line">WiFi.hostname(<span class="string">&quot;Station_Taichi&quot;</span>);<span class="comment">//设置新的hostname</span></span><br><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前hostname: %s\n&quot;</span>, WiFi.hostname().c_str());</span><br></pre></td></tr></table></figure>

<h5 id="参数-23"><a href="#参数-23" class="headerlink" title="参数"></a>参数</h5><p>hostname，数据类型可为String型。我们手动设置的主机名的最大长度为32个字符。可以使用大写字母（A-Z），小写字母（a-z），数字（0-9），符号（.）和符号（-）。大小写字母之间没有区别，不允许将空格或者空格字符作为hostname。这里只列举了一部分规则，详细说明请参阅此链接：<a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266WiFi/src/ESP8266WiFiSTA.cpp%E3%80%82%E4%B8%80%E6%97%A6hostname%E8%B6%85%E8%BF%8732%E4%B8%AA%E5%AD%97%E7%AC%A6%E7%9A%84%E9%99%90%E5%88%B6">https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266WiFi/src/ESP8266WiFiSTA.cpp。一旦hostname超过32个字符的限制</a>, 则无法完成主机名设置。</p>
<h5 id="返回值-22"><a href="#返回值-22" class="headerlink" title="返回值"></a>返回值</h5><p>输入参数的情况下，如果设置新的hostname成功，会返回true。如果超过了32个字符的限制，或者设置失败，则函数将返回false而不会分配新的主机名。返回值数据类型为布尔型。</p>
<p>没有输入参数的情况下，会返回当前的hostname，数据类型为string型。</p>
<h5 id="示例程序-24"><a href="#示例程序-24" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块的主机名称。我们是通过以下示例程序中的WiFi.hostname()来获取该主机名的。在程序的后续部分中，我们使用了WiFi.hostname(“Station_Taichi”)来将ESP8266模块的主机名改为Station_Taichi。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.hostname();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下获取hostname并修改</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxxx&quot;</span>         <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前的hostname: %s\n&quot;</span>, WiFi.hostname().c_str());<span class="comment">//读取当前的hostname并输出</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;即将修改hostname为Station_Taichi&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  WiFi.hostname(<span class="string">&quot;Station_Taichi&quot;</span>);<span class="comment">//设置新的hostname</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前hostname: %s\n&quot;</span>, WiFi.hostname().c_str());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="isConnected-–-获取WiFi连接状态"><a href="#isConnected-–-获取WiFi连接状态" class="headerlink" title="isConnected – 获取WiFi连接状态"></a>isConnected – 获取WiFi连接状态</h4><h5 id="说明-25"><a href="#说明-25" class="headerlink" title="说明"></a>说明</h5><p>利用isConnected函数可以获取当前ESP8266模块是否成功连接WiFi。</p>
<h5 id="语法-25"><a href="#语法-25" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.isConnected()</code></p>
<h5 id="参数-24"><a href="#参数-24" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-23"><a href="#返回值-23" class="headerlink" title="返回值"></a>返回值</h5><p>返回值返回是否连接上接入点。若连接上则返回true，没有连接上返回false。数据类型为布尔型。</p>
<h5 id="示例程序-25"><a href="#示例程序-25" class="headerlink" title="示例程序"></a>示例程序</h5><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将通过串口监视器看到ESP8266模块已经成功连接到WiFi。在以下程序中 ，我们是通过调用WiFi.isConnected()来获取当前ESP8266开发板的联网状态的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.isConnected();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在Station模式下判断当前是否连接上接入点</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot; &quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;判断是否连接上接入点&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (WiFi.isConnected() == <span class="literal">true</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;已连接上接入点&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;未连接上接入点&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);         <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (WiFi.isConnected() == <span class="literal">true</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;已连接上接入点&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    Serial.println(<span class="string">&quot;未连接上接入点&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="getAutoConnect-–-获取自动连接WiFi设置"><a href="#getAutoConnect-–-获取自动连接WiFi设置" class="headerlink" title="getAutoConnect – 获取自动连接WiFi设置"></a>getAutoConnect – 获取自动连接WiFi设置</h4><h5 id="说明-26"><a href="#说明-26" class="headerlink" title="说明"></a>说明</h5><p>利用getAutoConnect函数可以获取当前ESP8266模块是否设置为自动连接上次使用的WiFi接入点。我们可以通过<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifista/setautoconnect/">setAutoConnect</a>函数来将ESP8266模块设置为自动连接WiFi。</p>
<h5 id="语法-26"><a href="#语法-26" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.getAutoConnect()</span><br></pre></td></tr></table></figure>

<h5 id="参数-25"><a href="#参数-25" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-24"><a href="#返回值-24" class="headerlink" title="返回值"></a>返回值</h5><p>如果ESP8266模块配置为在开机时自动连接到上次使用的WiFi接入点，它将返回true。如果禁用了自动连接功能，则会返回false。数据类型为布尔型。</p>
<h5 id="示例程序-26"><a href="#示例程序-26" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.getAutoConnect();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下判断当前是否有自动连接</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> autoConnect = <span class="literal">true</span>;<span class="comment">//设置自动连接所需变量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;检查自动连接设置状态&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (WiFi.getAutoConnect() == <span class="literal">true</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;已设置自连接&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    Serial.println(<span class="string">&quot;未设置连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  WiFi.setAutoConnect(autoConnect);<span class="comment">//启用自动连接模式</span></span><br><span class="line">  delay(<span class="number">500</span>);<span class="comment">//启用自动连接后再检查一次，确定设置变化</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;再次检查自动连接设置状态&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (WiFi.getAutoConnect() == <span class="literal">true</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;已设置自连接&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    Serial.println(<span class="string">&quot;未设置连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="RSSI-–-获取WiFi信号强度"><a href="#RSSI-–-获取WiFi信号强度" class="headerlink" title="RSSI – 获取WiFi信号强度"></a>RSSI – 获取WiFi信号强度</h4><h5 id="说明-27"><a href="#说明-27" class="headerlink" title="说明"></a>说明</h5><p>获取当前ESP8266模块连接到接入点的WiFi信号强度,单位为dBm。</p>
<h5 id="语法-27"><a href="#语法-27" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.RSSI()</code></p>
<h5 id="参数-26"><a href="#参数-26" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-25"><a href="#返回值-25" class="headerlink" title="返回值"></a>返回值</h5><p>返回代表ESP8266模块连接的接入点信号强度。返回值数据类型为int32_t，通过串口输出时需要注意这一点。</p>
<h5 id="示例程序-27"><a href="#示例程序-27" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFi.RSSI();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  此程序使用ESP8266WiFiSTA库来演示在无线终端模式下打印当前wifi信号强度</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下要连接的接入点名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下要连接的接入点密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;<span class="comment">//用来判定连接是否超时的累加量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);  <span class="comment">// 启动串口通讯，波特率设置为9600</span></span><br><span class="line">  Serial.println(<span class="string">&quot;开始连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//调用 WiFi.begin()函数，开始连接接入点</span></span><br><span class="line">  WiFi.begin(AP_ssid, password);</span><br><span class="line">  Serial.print(<span class="string">&quot;正在连接到&quot;</span>);</span><br><span class="line">  Serial.print(AP_ssid);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里的循环用来判断是否连接成功的。连接过程中每隔500毫秒会检查一次是否连接成功，，并打一个点表示正在连接中</span></span><br><span class="line">  <span class="comment">//连接成功后会给出提示，但是若60秒后还是没有连接上，则会提示超时</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    i++;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">120</span>) &#123; <span class="comment">//60秒后如果还是连接不上，就判定为连接超时</span></span><br><span class="line">      Serial.print(<span class="string">&quot;连接超时！请检查网络环境&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;网络连接成功&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这一部分用来输出连接网络的基本信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;500&quot;</span>);              <span class="comment">// 延时500毫秒</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前工作模式:&quot;</span>);     <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点名字:&quot;</span>);</span><br><span class="line">  Serial.println(AP_ssid);            <span class="comment">// 告知用户建立的接入点WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;连接到的接入点密码:&quot;</span>);</span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的接入点WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端模式成功开启，网络连接成功&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;RSSI: %d dBm\n&quot;</span>, WiFi.RSSI());</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h2 id="ESP8266-–-ESP8266WiFiGeneric库"><a href="#ESP8266-–-ESP8266WiFiGeneric库" class="headerlink" title="ESP8266 – ESP8266WiFiGeneric库"></a>ESP8266 – ESP8266WiFiGeneric库</h2><p>ESP8266WiFiGeneric库主要包含ESP8266的通用功能，如工作模式设置、WiFi时间类型设置等。</p>
<p>以下为ESP8266WiFiGeneric库的整体结构图。在此图下方是库函数目录。<img src="/./Image/ESP8266.assets/image-20230525200128705.png" alt="image-20230525200128705"></p>
<h3 id="WiFi事件类型"><a href="#WiFi事件类型" class="headerlink" title="WiFi事件类型"></a>WiFi事件类型</h3><h4 id="接入点模式事件类型"><a href="#接入点模式事件类型" class="headerlink" title="接入点模式事件类型"></a>接入点模式事件类型</h4><h5 id="onSoftAPModeStationConnected-–-有无线终端连接到接入点"><a href="#onSoftAPModeStationConnected-–-有无线终端连接到接入点" class="headerlink" title="onSoftAPModeStationConnected – 有无线终端连接到接入点"></a>onSoftAPModeStationConnected – 有无线终端连接到接入点</h5><h6 id="说明-28"><a href="#说明-28" class="headerlink" title="说明"></a>说明</h6><p>ESP8266在接入点模式下有无线终端连接到ESP8266所建立的WiFi网络时，ESP8266会自动调用事件处理回调函数。该事件处理回调函数由onSoftAPModeStationConnected的参数所定义。</p>
<h6 id="语法-28"><a href="#语法-28" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onSoftAPModeStationConnected(onStationConnected);</span><br></pre></td></tr></table></figure>

<h6 id="参数-27"><a href="#参数-27" class="headerlink" title="参数"></a>参数</h6><p>onStationConnected：回调函数名称</p>
<h6 id="返回值-26"><a href="#返回值-26" class="headerlink" title="返回值"></a>返回值</h6><p>WiFiEventHandler对象</p>
<h6 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>onSoftAPModeStationConnected函数使用时有两个重点步骤:</p>
<ol>
<li><p>通过语句<code>WiFiEventHandler stationConnectedHandler;</code><br>建立WiFiEventHandler 实例对象，对象名称为stationConnectedHandler。</p>
</li>
<li><p>通过语句<code>stationConnectedHandler = WiFi.onSoftAPModeStationConnected(onStationConnected);</code><br>对回调函数进行相应的设置。此处onSoftAPModeStationConnected函数的参数“onStationConnected”就是设置了回调函数的名称。</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_AP_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中onSoftAPModeStationConnected函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line">WiFiEventHandler stationConnectedHandler;  <span class="comment">//实例化WIFI事件对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);         <span class="comment">//打开串口</span></span><br><span class="line">  WiFi.softAP(ssid, password);  <span class="comment">// 此语句是重点。WiFi.softAP用于启动NodeMCU的AP接入点模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>); </span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point: &quot;</span>);    <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.println(ssid);              <span class="comment">// 告知用户NodeMCU所建立的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password: &quot;</span>);        </span><br><span class="line">  Serial.println(password);          <span class="comment">// 告知用户NodeMCU所建立的WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);      <span class="comment">// 以及NodeMCU的IP地址</span></span><br><span class="line">  Serial.println(WiFi.softAPIP());   <span class="comment">// 通过调用WiFi.softAPIP()可以得到NodeMCU的IP地址</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// onSoftAPModeStationConnected函数的参数onStationConnected为事件处理回调函数。</span></span><br><span class="line">  <span class="comment">// 也就是说，每当有新的无线终端连接到ESP8266设备建立的WiFi后，设备都会自动调用onStationConnected函数</span></span><br><span class="line">  stationConnectedHandler = WiFi.onSoftAPModeStationConnected(onStationConnected);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">onStationConnected</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeStationConnected&amp; evt)</span> &#123;<span class="comment">//接入点模式下有无线终端设备连接进来时的回调函数</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端设备的mac地址: &quot;</span>);</span><br><span class="line">  Serial.println(macToString(evt.mac));<span class="comment">//调用macToString函数将mac转换成字符串</span></span><br><span class="line">  Serial.print(<span class="string">&quot;无线终端设备的序号: &quot;</span>);</span><br><span class="line">  Serial.println(evt.aid);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">String <span class="title function_">macToString</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* mac)</span> &#123;  <span class="comment">//字符串转换函数</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">20</span>];</span><br><span class="line">  <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%02x:%02x:%02x:%02x:%02x:%02x&quot;</span>,mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>], mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">return</span> String(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="onSoftAPModeStationDisconnected-–-有无线终端断开与接入点的连接"><a href="#onSoftAPModeStationDisconnected-–-有无线终端断开与接入点的连接" class="headerlink" title="onSoftAPModeStationDisconnected – 有无线终端断开与接入点的连接"></a>onSoftAPModeStationDisconnected – 有无线终端断开与接入点的连接</h5><h6 id="说明-29"><a href="#说明-29" class="headerlink" title="说明"></a>说明</h6><p>设备在接入点模式下有无线终端从设备所建立的WiFi网络断开时，设备会自动调用事件处理回调函数。该事件处理回调函数由onSoftAPModeStationDisconnected的参数所定义。</p>
<h6 id="语法-29"><a href="#语法-29" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onSoftAPModeStationDisconnected(onStationDisconnected)</span><br></pre></td></tr></table></figure>

<h6 id="参数-28"><a href="#参数-28" class="headerlink" title="参数"></a>参数</h6><p>onStationDisconnected：回调函数</p>
<h6 id="返回值-27"><a href="#返回值-27" class="headerlink" title="返回值"></a>返回值</h6><p>WiFiEventHandler对象</p>
<h6 id="示例程序-28"><a href="#示例程序-28" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p><strong>onSoftAPModeStationDisconnected函数使用时有两个重点步骤:</strong></p>
<ol>
<li>通过语句<code>WiFiEventHandler stationDisconnectedHandler;</code><br>建立WiFiEventHandler 实例对象，对象名称为stationDisconnectedHandler。</li>
<li>通过语句<code>stationDisconnectedHandler = WiFi.onSoftAPModeStationDisconnected(onStationDisconnected);</code><br>对回调函数进行相应的设置。此处onSoftAPModeStationDisconnected函数的参数“onStationDisconnected”就是设置了回调函数的名称。</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_AP_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中onSoftAPModeStationDisconnected函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>   <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line">WiFiEventHandler stationDisconnectedHandler;  <span class="comment">//实例化WIFI事件对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  WiFi.softAP(ssid, password);  <span class="comment">// 此语句是重点。WiFi.softAP用于启动NodeMCU的AP接入点模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>); </span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point: &quot;</span>);    <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.println(ssid);              <span class="comment">// 告知用户NodeMCU所建立的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password: &quot;</span>);        </span><br><span class="line">  Serial.println(password);          <span class="comment">// 告知用户NodeMCU所建立的WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);      <span class="comment">// 以及NodeMCU的IP地址</span></span><br><span class="line">  Serial.println(WiFi.softAPIP());   <span class="comment">// 通过调用WiFi.softAPIP()可以得到NodeMCU的IP地址</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// onSoftAPModeStationDisconnected函数的参数onStationDisconnected为事件处理回调函数。</span></span><br><span class="line">  <span class="comment">// 也就是说，每当有无线终端从ESP8266设备建立的WiFi连接断开后，设备都会自动调用onStationDisconnected函数</span></span><br><span class="line">  stationDisconnectedHandler = WiFi.onSoftAPModeStationDisconnected(onStationDisconnected);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">onStationDisconnected</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeStationDisconnected&amp; evt)</span> &#123;  <span class="comment">//接入点模式下有无线终端设备断开连接时的回调函数</span></span><br><span class="line">  Serial.print(<span class="string">&quot;断开连接的无线终端是: &quot;</span>);</span><br><span class="line">  Serial.println(macToString(evt.mac));<span class="comment">//调用macToString函数将mac转换成字符串</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">String <span class="title function_">macToString</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* mac)</span> &#123;<span class="comment">//字符串转换函数</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">20</span>];</span><br><span class="line">  <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%02x:%02x:%02x:%02x:%02x:%02x&quot;</span>,mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>], mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">return</span> String(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="onSoftAPModeProbeRequestReceived-–-接入点模式下收到探针请求"><a href="#onSoftAPModeProbeRequestReceived-–-接入点模式下收到探针请求" class="headerlink" title="onSoftAPModeProbeRequestReceived – 接入点模式下收到探针请求"></a>onSoftAPModeProbeRequestReceived – 接入点模式下收到探针请求</h5><h6 id="说明-30"><a href="#说明-30" class="headerlink" title="说明"></a>说明</h6><p>设备在接入点模式下收到无线终端的探针请求时，设备会自动调用事件处理回调函数。该事件处理回调函数由onSoftAPModeProbeRequestReceived 的参数所定义。</p>
<h6 id="语法-30"><a href="#语法-30" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onSoftAPModeProbeRequestReceived(onProbeRequestReceived)</span><br></pre></td></tr></table></figure>

<h6 id="参数-29"><a href="#参数-29" class="headerlink" title="参数"></a>参数</h6><p>onProbeRequestReceived：回调函数</p>
<h6 id="返回值-28"><a href="#返回值-28" class="headerlink" title="返回值"></a>返回值</h6><p>WiFiEventHandler对象</p>
<h6 id="示例程序-29"><a href="#示例程序-29" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>onSoftAPModeProbeRequestReceived函数使用时有两个重点步骤:</p>
<ol>
<li><p>通过语句<br><code>WiFiEventHandler probeRequestReceivedHandler</code><br>建立WiFiEventHandler 实例对象，对象名称为probeRequestReceivedHandler。</p>
</li>
<li><p>通过语句<br><code>probeRequestReceivedHandler = WiFi.onSoftAPModeProbeRequestReceived(onProbeRequestReceived);</code><br>对回调函数进行相应的设置。此处onSoftAPModeProbeRequestReceived函数的参数“onProbeRequestReceived”就是设置了回调函数的名称。</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_AP_3</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中onSoftAPModeProbeRequestReceived 函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line">WiFiEventHandler probeRequestReceivedHandler;<span class="comment">//实例化WIFI事件对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">onProbeRequestReceived</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeProbeRequestReceived&amp; evt)</span>&#123;<span class="comment">//设备在接入点模式下收到无线终端的探针请求时的回调函数</span></span><br><span class="line">  Serial.print(<span class="string">&quot;请求终端的mac地址: &quot;</span>);</span><br><span class="line">  Serial.print(macToString(evt.mac));<span class="comment">//调用macToString函数将mac转换成字符串</span></span><br><span class="line">  Serial.print(<span class="string">&quot;     请求终端的信号强度: &quot;</span>);</span><br><span class="line">  Serial.println(evt.rssi);<span class="comment">//调用macToString函数将mac转换成字符串</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  WiFi.softAP(ssid, password);  <span class="comment">// 此语句是重点。WiFi.softAP用于启动NodeMCU的AP接入点模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>); </span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point: &quot;</span>);    <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.println(ssid);              <span class="comment">// 告知用户NodeMCU所建立的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password: &quot;</span>);        </span><br><span class="line">  Serial.println(password);          <span class="comment">// 告知用户NodeMCU所建立的WiFi密码</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);      <span class="comment">// 以及NodeMCU的IP地址</span></span><br><span class="line">  Serial.println(WiFi.softAPIP());   <span class="comment">// 通过调用WiFi.softAPIP()可以得到NodeMCU的IP地址</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// onSoftAPModeProbeRequestReceived函数的参数onProbeRequestReceived为事件处理回调函数。</span></span><br><span class="line">  <span class="comment">// 也就是说，每当设备在接入点模式下收到无线终端的探针请求时，设备都会自动调用onStationConnected函数</span></span><br><span class="line">  probeRequestReceivedHandler = WiFi.onSoftAPModeProbeRequestReceived(onProbeRequestReceived);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">String <span class="title function_">macToString</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* mac)</span> &#123;<span class="comment">//字符串转换函数</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">20</span>];</span><br><span class="line">  <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%02x:%02x:%02x:%02x:%02x:%02x&quot;</span>,mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>], mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">return</span> String(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="无线终端模式事件类型"><a href="#无线终端模式事件类型" class="headerlink" title="无线终端模式事件类型"></a>无线终端模式事件类型</h4><h5 id="onStationModeConnected-–-无线终端模式连上WiFi"><a href="#onStationModeConnected-–-无线终端模式连上WiFi" class="headerlink" title="onStationModeConnected – 无线终端模式连上WiFi"></a>onStationModeConnected – 无线终端模式连上WiFi</h5><h5 id="说明-31"><a href="#说明-31" class="headerlink" title="说明"></a>说明</h5><p>无线终端模式下连接上WIFI时，设备会自动调用事件处理回调函数。该事件处理回调函数由onStationModeConnected的参数所定义。</p>
<h5 id="语法-31"><a href="#语法-31" class="headerlink" title="语法"></a>语法</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">WiFi.onStationModeConnected(ConnectedHandler)</span><br></pre></td></tr></table></figure>

<h5 id="参数-30"><a href="#参数-30" class="headerlink" title="参数"></a>参数</h5><p>ConnectedHandler：回调函数</p>
<h5 id="返回值-29"><a href="#返回值-29" class="headerlink" title="返回值"></a>返回值</h5><p>WiFiEventHandler对象</p>
<h5 id="示例程序-30"><a href="#示例程序-30" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>通过以下程序，当设备连接到WiFi网络后，将会通过串口监视器输出信息告知用户无线终端设备已经成功连接到网络。即ConnectedHandler函数所实现的程序内容。</p>
<p><strong>onStationModeConnected函数使用时有两个重点步骤:</strong></p>
<ol>
<li><p>通过语句<br><code>WiFiEventHandler STAConnected;</code><br>建立WiFiEventHandler 实例对象，对象名称为STAConnected。</p>
</li>
<li><p>通过语句<br><code>STAConnected = WiFi.onStationModeConnected(ConnectedHandler);</code><br>对回调函数进行相应的设置。此处onStationModeConnected函数的参数“ConnectedHandler”就是设置了回调函数的名称。</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_STA_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中onStationModeConnected函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要连接的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要连接的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要连接的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果连接的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line">WiFiEventHandler STAConnected;      <span class="comment">//实例化WIFI事件对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);    <span class="comment">//打开串口</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// onStationModeConnected函数的参数ConnectedHandler为事件处理回调函数。</span></span><br><span class="line">  <span class="comment">// 也就是说，当无线终端连接到WiFi后，设备都会自动调用ConnectedHandler函数</span></span><br><span class="line">  STAConnected = WiFi.onStationModeConnected(ConnectedHandler);</span><br><span class="line">   </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// 此语句是重点。WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point:&quot;</span>);    </span><br><span class="line">  Serial.println(ssid);            <span class="comment">// 告知用户连接的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接的WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">ConnectedHandler</span><span class="params">(<span class="type">const</span> WiFiEventStationModeConnected &amp;event)</span><span class="comment">//无线终端模式下连接上WIFI时的回调函数</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;无线终端连接到网络&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="onStationModeDisconnected-–-无线终端模式断开WiFi"><a href="#onStationModeDisconnected-–-无线终端模式断开WiFi" class="headerlink" title="onStationModeDisconnected – 无线终端模式断开WiFi"></a>onStationModeDisconnected – 无线终端模式断开WiFi</h5><h6 id="说明-32"><a href="#说明-32" class="headerlink" title="说明"></a>说明</h6><p>无线终端模式下连接上的WIFI断开时，设备会自动调用事件处理回调函数。该事件处理回调函数由onStationModeDisconnected的参数所定义。</p>
<h6 id="语法-32"><a href="#语法-32" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onStationModeDisconnected(DisconnectedHandler)</span><br></pre></td></tr></table></figure>

<h6 id="参数-31"><a href="#参数-31" class="headerlink" title="参数"></a>参数</h6><p>DisconnectedHandler：回调函数</p>
<h6 id="返回值-30"><a href="#返回值-30" class="headerlink" title="返回值"></a>返回值</h6><p>WiFiEventHandler对象</p>
<h6 id="示例程序-31"><a href="#示例程序-31" class="headerlink" title="示例程序"></a>示例程序</h6><p>通过本程序，当设备与WiFi网络断开连接后，将会通过串口监视器输出信息，告知用户无线终端设备已经断开到网络连接。即DisconnectedHandler函数所实现的程序内容。</p>
<p><strong>onStationModeDisconnected函数使用时有两个重点步骤:</strong></p>
<ol>
<li><p>通过语句<br><code>WiFiEventHandler STADisconnected;</code><br>建立WiFiEventHandler 实例对象，对象名称为STADisconnected。</p>
</li>
<li><p>通过语句<br><code>STADisconnected = WiFi.onStationModeDisconnected(DisconnectedHandler);</code><br>对回调函数进行相应的设置。此处onStationModeDisconnected函数的参数“DisconnectedHandler”就是设置了回调函数的名称。</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_STA_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中onStationModeDisconnected函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要连接的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要连接的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要连接的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果连接的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line">WiFiEventHandler STADisconnected;  <span class="comment">//实例化WIFI事件对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// onStationModeDisconnected函数的参数DisconnectedHandler为事件处理回调函数。</span></span><br><span class="line">  <span class="comment">// 也就是说，当无线终端从连接到的WiFi断开后，设备都会自动调用DisconnectedHandler函数</span></span><br><span class="line">  STADisconnected = WiFi.onStationModeDisconnected(DisconnectedHandler);</span><br><span class="line">   </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// 此语句是重点。WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">    </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point:&quot;</span>);    </span><br><span class="line">  Serial.println(ssid);            <span class="comment">// 告知用户连接的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接的WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  delay(<span class="number">5000</span>); <span class="comment">//等待5秒</span></span><br><span class="line">  WiFi.disconnect(); <span class="comment">//断开当前网络连接，以触发onStationModeDisconnected事件</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">DisconnectedHandler</span><span class="params">(<span class="type">const</span> WiFiEventStationModeDisconnected &amp;event)</span><span class="comment">//无线终端从连接到的WiFi断开后，设备都会自动调用</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;无线终端从网络断开&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="onStationModeAuthModeChanged-–-无线终端模式下校验模式改变"><a href="#onStationModeAuthModeChanged-–-无线终端模式下校验模式改变" class="headerlink" title="onStationModeAuthModeChanged – 无线终端模式下校验模式改变"></a>onStationModeAuthModeChanged – 无线终端模式下校验模式改变</h5><h6 id="说明-33"><a href="#说明-33" class="headerlink" title="说明"></a>说明</h6><p>无线终端模式下连接上WIFI并且校验模式改变时，设备会自动调用事件处理回调函数。该事件处理回调函数由onStationModeAuthModeChanged的参数所定义。</p>
<h6 id="语法-33"><a href="#语法-33" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onStationModeAuthModeChanged(ChangedHandler)</span><br></pre></td></tr></table></figure>

<h6 id="参数-32"><a href="#参数-32" class="headerlink" title="参数"></a>参数</h6><p>ChangedHandler：回调函数</p>
<h6 id="返回值-31"><a href="#返回值-31" class="headerlink" title="返回值"></a>返回值</h6><p>WiFiEventHandler对象</p>
<h5 id="onStationModeGotIP-–-无线终端模式下获取到IP地址"><a href="#onStationModeGotIP-–-无线终端模式下获取到IP地址" class="headerlink" title="onStationModeGotIP – 无线终端模式下获取到IP地址"></a>onStationModeGotIP – 无线终端模式下获取到IP地址</h5><h6 id="说明-34"><a href="#说明-34" class="headerlink" title="说明"></a>说明</h6><p>无线终端模式下连接上WIFI并且获得IP地址后，设备会自动调用事件处理回调函数。该事件处理回调函数由onStationModeGotIP的参数所定义。</p>
<h6 id="语法-34"><a href="#语法-34" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onStationModeGotIP(GotIPHandler)</span><br></pre></td></tr></table></figure>

<h6 id="参数-33"><a href="#参数-33" class="headerlink" title="参数"></a>参数</h6><p>GotIPHandler：回调函数</p>
<h6 id="返回值-32"><a href="#返回值-32" class="headerlink" title="返回值"></a>返回值</h6><p>WiFiEventHandler对象</p>
<h6 id="示例程序-32"><a href="#示例程序-32" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>通过本程序，当设备连接到WiFi并且获取到IP地址后，将会通过串口监视器输出设备的IP地址信息。串口输出设备IP地址信息是通过GotIPHandler函数所实现的。</p>
<p><strong>onStationModeGotIP函数使用时有两个重点步骤:</strong></p>
<ol>
<li><p>通过语句<br><code>WiFiEventHandler STAGotIP;</code><br>建立WiFiEventHandler 实例对象，对象名称为STAGotIP。</p>
</li>
<li><p>通过语句<br><code>STAGotIP = WiFi.onStationModeGotIP(GotIPHandler);</code><br>对回调函数进行相应的设置。此处onStationModeGotIP函数的参数“GotIPHandler”就是设置了回调函数的名称。</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_STA_4</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中onStationModeGotIP函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要连接的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要连接的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要连接的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果连接的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line">WiFiEventHandler STAGotIP;   <span class="comment">//实例化WIFI事件对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);   <span class="comment">//打开串口</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// onStationModeGotIP函数的参数GotIPHandler为事件处理回调函数。</span></span><br><span class="line">  <span class="comment">// 也就是说，当无线终端连接到WiFi后，设备都会自动调用GotIPHandler函数</span></span><br><span class="line">  STAGotIP = WiFi.onStationModeGotIP(GotIPHandler);</span><br><span class="line"> </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// 此语句是重点。WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">    </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point:&quot;</span>);    </span><br><span class="line">  Serial.println(ssid);            <span class="comment">// 告知用户连接的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接的WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">GotIPHandler</span><span class="params">(<span class="type">const</span> WiFiEventStationModeGotIP &amp;event)</span><span class="comment">//当无线终端连接到WiFi后，设备都会自动调用</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;模块获得IP：&quot;</span>);</span><br><span class="line">  Serial.print(WiFi.localIP());<span class="comment">//输出NodeMCU的IP地址。这一功能是通过调用</span></span><br><span class="line">                               <span class="comment">//WiFi.localIP()函数来实现的。该函数的返回值即NodeMCU的IP地址。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="onStationModeDHCPTimeout-–-无线终端模式下动态分配IP超时"><a href="#onStationModeDHCPTimeout-–-无线终端模式下动态分配IP超时" class="headerlink" title="onStationModeDHCPTimeout – 无线终端模式下动态分配IP超时"></a>onStationModeDHCPTimeout – 无线终端模式下动态分配IP超时</h5><h6 id="说明-35"><a href="#说明-35" class="headerlink" title="说明"></a>说明</h6><p>无线终端模式下连接上WIFI并且DHCP分配IP超时时，设备会自动调用事件处理回调函数。该事件处理回调函数由onStationModeDHCPTimeout的参数所定义。</p>
<h6 id="语法-35"><a href="#语法-35" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.onStationModeDHCPTimeout(DHCPTimeout)</span><br></pre></td></tr></table></figure>

<h6 id="参数-34"><a href="#参数-34" class="headerlink" title="参数"></a>参数</h6><p>DHCPTimeout：回调函数</p>
<h6 id="返回值-33"><a href="#返回值-33" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h3 id="设置类型"><a href="#设置类型" class="headerlink" title="设置类型"></a>设置类型</h3><h4 id="persistent-–-是否保存WiFi连接信息在闪存中"><a href="#persistent-–-是否保存WiFi连接信息在闪存中" class="headerlink" title="persistent – 是否保存WiFi连接信息在闪存中"></a>persistent – 是否保存WiFi连接信息在闪存中</h4><h5 id="说明-36"><a href="#说明-36" class="headerlink" title="说明"></a>说明</h5><p>此函数用于控制是否将WiFi配置信息保存到开发板的闪存中。默认情况下为true，也就是将WiFi配置信息保存到开发板的闪存中。当我们使用这个函数并设置参数为false时，开发板将不会把WiFi配置写入开发板的闪存中。</p>
<h5 id="语法-36"><a href="#语法-36" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.persistent(val)</span><br></pre></td></tr></table></figure>

<h5 id="参数-35"><a href="#参数-35" class="headerlink" title="参数"></a>参数</h5><p>val：此参数值为true时，WiFi配置信息将保存到开发板的闪存中。<br>参数值为false时，不WiFi配置信息不保存到开发板的闪存中。<br>此参数类型为bool型。</p>
<h5 id="返回值-34"><a href="#返回值-34" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-33"><a href="#示例程序-33" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中persistent函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">    </span><br><span class="line">  WiFi.persistent(<span class="literal">false</span>);       <span class="comment">// 不保存wifi配置到开发板闪存中</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Current Mode:&quot;</span>);   <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point:&quot;</span>);    </span><br><span class="line">  Serial.println(ssid);            <span class="comment">// 告知用户连接的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接的WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="mode-–-设置WiFi工作模式"><a href="#mode-–-设置WiFi工作模式" class="headerlink" title="mode – 设置WiFi工作模式"></a>mode – 设置WiFi工作模式</h4><h5 id="说明-37"><a href="#说明-37" class="headerlink" title="说明"></a>说明</h5><p>此函数用于设置ESP8266开发板设备的WiFi网络工作模式。ESP8266开发板一共有三种工作模式。分别是：接入点模式（AP）、无线终端模式（Station）以及混合模式。</p>
<h5 id="语法-37"><a href="#语法-37" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.mode(val);</code></p>
<p>参数</p>
<p>val：此参数允许使用以下值。</p>
<ul>
<li>WIFI_OFF，（关闭WiFi）</li>
<li>WIFI_STA，（无线终端模式）</li>
<li>WIFI_AP, （接入点模式）</li>
<li>WIFI_AP_STA，（接入点-无线终端双模式）</li>
</ul>
<p>举例来说，如果我们使用<code>WiFi.mode(WIFI_STA)</code>，则意味着我们让ESP8266以无线终端模式进行工作。</p>
<h5 id="返回值-35"><a href="#返回值-35" class="headerlink" title="返回值"></a>返回值</h5><p>此函数的返回值为布尔型。当ESP8266成功设置为指定模式后，将会返回true，否则返回false。</p>
<h5 id="示例程序-34"><a href="#示例程序-34" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。我们使用了<code>WiFi.mode(WIFI_STA);</code>将ESP8266设置为无线终端模式。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_demo_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中mode函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);         <span class="comment">//打开串口</span></span><br><span class="line">  </span><br><span class="line">  WiFi.mode(WIFI_STA);          <span class="comment">//设置设备的工作模式为无线终端模式</span></span><br><span class="line">    </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// 此语句是重点。WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;<span class="comment">//等待WiFi连接</span></span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.print(<span class="string">&quot;当前模式为： &quot;</span>);     <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.println(WiFi.getMode());  <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line"> </span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">//延时便于查看效果</span></span><br><span class="line">  WiFi.mode(WIFI_OFF);             <span class="comment">//设置设备的工作模式为关闭模式</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前模式为： &quot;</span>);       </span><br><span class="line">  Serial.println(WiFi.getMode());  <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="enableSTA-–-设置为终端模式"><a href="#enableSTA-–-设置为终端模式" class="headerlink" title="enableSTA – 设置为终端模式"></a>enableSTA – 设置为终端模式</h4><h5 id="说明-38"><a href="#说明-38" class="headerlink" title="说明"></a>说明</h5><p>本函数用于设置ESP8266开发板的工作模式为无线终端模式。ESP8266开发板一共有三种工作模式。分别是：接入点模式（AP）、无线终端模式（Station）以及混合模式。</p>
<h5 id="语法-38"><a href="#语法-38" class="headerlink" title="语法"></a>语法</h5><p>WiFi.enableSTA(val);</p>
<h5 id="参数-36"><a href="#参数-36" class="headerlink" title="参数"></a>参数</h5><p>val：此参数用于控制ESP8266开发板启动或停止<strong>无线终端模式</strong>。<br>参数值为true时，ESP8266开发板启动<strong>无线终端模式</strong>。<br>参数值为false时，ESP8266开发板停止<strong>无线终端模式</strong>。<br>此参数类型为bool型。</p>
<h5 id="返回值-36"><a href="#返回值-36" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为布尔型。<br>设备成功启动无线终端模式，返回值为true。否则返回值为false。</p>
<h5 id="示例程序-35"><a href="#示例程序-35" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_demo_4</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中enableSTA函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);          <span class="comment">//打开串口</span></span><br><span class="line">  </span><br><span class="line">  WiFi.enableSTA(<span class="literal">true</span>);          <span class="comment">//设置设备的工作模式为无线终端模式。 </span></span><br><span class="line"> </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// 此语句是重点。WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Current Mode:&quot;</span>);   <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point:&quot;</span>);    </span><br><span class="line">  Serial.println(ssid);            <span class="comment">// 告知用户连接的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户连接的WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="enableAP-–-设置为接入点模式"><a href="#enableAP-–-设置为接入点模式" class="headerlink" title="enableAP – 设置为接入点模式"></a>enableAP – 设置为接入点模式</h4><h5 id="说明-39"><a href="#说明-39" class="headerlink" title="说明"></a>说明</h5><p>本函数用于设置ESP8266开发板的工作模式为WiFi接入点模式。ESP8266开发板一共有三种工作模式。分别是：WiFi接入点模式（AP）、无线终端模式（Station）以及混合模式。</p>
<h5 id="语法-39"><a href="#语法-39" class="headerlink" title="语法"></a>语法</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">WiFi.enableAP(val)</span><br></pre></td></tr></table></figure>

<h5 id="参数-37"><a href="#参数-37" class="headerlink" title="参数"></a>参数</h5><p>val：此参数用于控制ESP8266开发板启动或停止<strong>无线接入点模式</strong>。<br>参数值为true时，ESP8266开发板启动<strong>无线接入点模式</strong>。<br>参数值为false时，ESP8266开发板停止<strong>无线接入点模式</strong>。<br>此参数类型为bool型。</p>
<h5 id="返回值-37"><a href="#返回值-37" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为布尔型。<br>设备成功启动无线接入点模式，返回值为true。否则返回值为false。</p>
<h5 id="示例程序-36"><a href="#示例程序-36" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_demo_5</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中enableAP函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);          <span class="comment">//打开串口</span></span><br><span class="line">    </span><br><span class="line">  WiFi.enableAP(<span class="literal">true</span>);           <span class="comment">// 设置设备的工作模式为接入点模式。 </span></span><br><span class="line">    </span><br><span class="line">  WiFi.softAP(ssid, password);   <span class="comment">// WiFi.softAP用于启动NodeMCU的AP模式。</span></span><br><span class="line">                                 <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码</span></span><br><span class="line">                                 <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);              <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Current Mode:&quot;</span>);   <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">  Serial.println(WiFi.getMode());</span><br><span class="line">  Serial.print(<span class="string">&quot;Access Point:&quot;</span>);    </span><br><span class="line">  Serial.println(ssid);            <span class="comment">// 告知用户建立的WiFi名</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Password:&quot;</span>);        </span><br><span class="line">  Serial.println(password);        <span class="comment">// 告知用户建立的WiFi密码</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="setSleepMode-–-设置为休眠模式"><a href="#setSleepMode-–-设置为休眠模式" class="headerlink" title="setSleepMode – 设置为休眠模式"></a>setSleepMode – 设置为休眠模式</h4><h5 id="说明-40"><a href="#说明-40" class="headerlink" title="说明"></a>说明</h5><p>设置ESP8266的睡眠模式,从而使ESP8266降低功耗,达到节能的目的。以下是ESP8266的三种睡眠模式介绍：</p>
<p><strong>WIFI_NONE_SLEEP</strong><br>– 此模式将打开ESP8266所有的功能并将长期处于此状态, 缺点也是不言而喻的增大功耗;<br>– 但是对于ESP8266初学者,这里还是建议使用此模式进行调试和开发,因为在不进行产品开发的前提下,使用此模式不会给您带来丢包和重连等问题;</p>
<p><strong>WIFI_MODEM_SLEEP</strong><br>– 这是ESP8266的默认睡眠方式,但此模式仅在无线终端模式下正常运行,而且只有当您连接到WiFi的时候才生效;<br>– 当您设置了WIFI_MODEM_SLEEP模式并且成功连接WiFi之后,它会在ESP8266与路由器传递消息的间隔内关闭WIFI连接电路来达到节能的目的。ESP8266可以在下一次通讯到来之前自动唤醒WIFI电路来确保其工作;<br>– 如果您使用干电池或者是您的设备不能持久供电的情况下,可以考虑采用此模式</p>
<p><strong>WIFI_LIGHT_SLEEP</strong><br>– 此模式在WIFI_MODEM_SLEEP基础上还会暂停ESP8266的CPU、系统时钟等，从而达到比前者更加节能的目的。</p>
<h5 id="语法-40"><a href="#语法-40" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.setSleepMode(type, listenInterval)`</span><br><span class="line">`WiFi.setSleepMode(type)</span><br></pre></td></tr></table></figure>

<h5 id="参数-38"><a href="#参数-38" class="headerlink" title="参数"></a>参数</h5><p>type： 此参数用于设置睡眠模式。ESP8266开发板一共有以下几种睡眠模式。<br>WIFI_NONE_SLEEP （非睡眠模式）<br>WIFI_LIGHT_SLEEP （轻度睡眠）<br>WIFI_MODEM_SLEEP （深度睡眠）</p>
<p>listenInterval：睡眠间隔时间, 单位毫秒。（参数类型： int）</p>
<h5 id="返回值-38"><a href="#返回值-38" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为布尔型。<br>设备成功进入指定睡眠模式，返回值为true。否则返回值为false。</p>
<h5 id="示例程序-37"><a href="#示例程序-37" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会定时向<a target="_blank" rel="noopener" href="http://www.example.com网站发送http请求,并且将该网站服务器的响应信息显示在串口监视器中./">www.example.com网站发送HTTP请求，并且将该网站服务器的响应信息显示在串口监视器中。</a></p>
<p>请留意在以下示例程序中，我们使用了<code>WiFi.setSleepMode(WIFI_LIGHT_SLEEP); </code>对ESP8266的睡眠模式进行了设置。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : setSleepMode</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求，</span></span><br><span class="line"><span class="comment">并且将网站服务器响应的信息输出在屏幕中。程序中使用了setSleepMode函数来演示如何使用</span></span><br><span class="line"><span class="comment">该函数将ESP8266设置为低功耗工作状态。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置睡眠模式（可选参数：WIFI_NONE_SLEEP、WIFI_LIGHT_SLEEP、WIFI_MODEM_SLEEP ）</span></span><br><span class="line">  WiFi.setSleepMode(WIFI_LIGHT_SLEEP);  </span><br><span class="line">    </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="信息类型-2"><a href="#信息类型-2" class="headerlink" title="信息类型"></a>信息类型</h3><h4 id="getMode-–-获取WiFi工作模式"><a href="#getMode-–-获取WiFi工作模式" class="headerlink" title="getMode – 获取WiFi工作模式"></a>getMode – 获取WiFi工作模式</h4><h5 id="说明-41"><a href="#说明-41" class="headerlink" title="说明"></a>说明</h5><p>获取ESP8266开发板的工作模式。</p>
<p>ESP8266开发板一共有三种工作模式。分别是：接入点模式（AP）、无线终端模式（Station）以及混合模式。</p>
<p>如需了解更多有关ESP8266开发板的工作模式详细内容，请参考本站的<br><a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-iot-basics/">ESP8266-物联网开发基础视频教程</a>。其中“<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/ap/">NodeMCU开发板的接入点模式</a>”部分有更多关于接入点模式的讲解。</p>
<h5 id="语法-41"><a href="#语法-41" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.getMode()</span><br></pre></td></tr></table></figure>

<h5 id="参数-39"><a href="#参数-39" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-39"><a href="#返回值-39" class="headerlink" title="返回值"></a>返回值</h5><p>以下是此函数的返回值以及对应的工作模式说明：<br>0：WiFi关闭模式<br>1：无线终端模式<br>2：接入点模式<br>3：接入点-无线终端混合模式</p>
<h5 id="示例程序-38"><a href="#示例程序-38" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分，该语句通过<code>WiFi.getMode()</code>获取ESP8266开发板的工作模式并且通过串口监视器输出。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiGeneric_demo_3</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiGeneric库中getMode函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid   <span class="string">&quot;TaichiMaker_WIFI&quot;</span>  <span class="comment">// 这里定义将要建立的WiFi名称。此处以&quot;TaichiMaker_WIFI&quot;为示例</span></span></span><br><span class="line">                                   <span class="comment">// 您可以将自己想要建立的WiFi名称填写入此处的双引号中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>        <span class="comment">// 这里定义将要建立的WiFi密码。此处以12345678为示例</span></span></span><br><span class="line">                                    <span class="comment">// 您可以将自己想要使用的WiFi密码放入引号内</span></span><br><span class="line">                                    <span class="comment">// 如果建立的WiFi不要密码，则在双引号内不要填入任何信息</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  Serial.begin(<span class="number">115200</span>);         <span class="comment">//打开串口</span></span><br><span class="line">  </span><br><span class="line">  WiFi.mode(WIFI_STA);          <span class="comment">//设置设备的工作模式为无线终端模式</span></span><br><span class="line">    </span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">// 此语句是重点。WiFi.begin用于启动NodeMCU的无线终端模式。</span></span><br><span class="line">                                <span class="comment">// 括号中有两个参数，ssid是WiFi名。password是WiFi密码。</span></span><br><span class="line">                                <span class="comment">// 这两个参数具体内容在setup函数之前的位置进行定义。</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;<span class="comment">//等待WiFi连接</span></span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.print(<span class="string">&quot;当前模式为： &quot;</span>);     <span class="comment">// 通过串口监视器输出信息</span></span><br><span class="line">  Serial.println(WiFi.getMode());  <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line"> </span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">//延时便于查看效果</span></span><br><span class="line">  WiFi.mode(WIFI_OFF);             <span class="comment">//设置设备的工作模式为关闭模式</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前模式为： &quot;</span>);       </span><br><span class="line">  Serial.println(WiFi.getMode());  <span class="comment">// 告知用户设备当前工作模式</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ESP8266WiFiMulti库"><a href="#ESP8266WiFiMulti库" class="headerlink" title="ESP8266WiFiMulti库"></a>ESP8266WiFiMulti库</h2><p>当我们需要使用ESP8266开发板存储多个WiFi网络连接信息时，可以使用ESP8266WiFiMulti库来实现。</p>
<p>以下为ESP8266WiFiMulti库的整体结构图。</p>
<p><img src="/./Image/ESP8266.assets/image-20230526114832611.png" alt="image-20230526114832611"></p>
<h3 id="设置类型-1"><a href="#设置类型-1" class="headerlink" title="设置类型"></a>设置类型</h3><h4 id="addAp-–-添加-WiFi连接信息"><a href="#addAp-–-添加-WiFi连接信息" class="headerlink" title="addAp – 添加 WiFi连接信息"></a>addAp – 添加 WiFi连接信息</h4><h5 id="说明-42"><a href="#说明-42" class="headerlink" title="说明"></a>说明</h5><p>当我们需要使用ESP8266开发板存储多个WiFi网络连接信息时，可以使用addAp来添加多个联网信息。ESP8266开发板在使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifimulti/run/">run</a>函数尝试联网时，会检查当前WiFi网络环境中有无addAp函数所添加的网络信息。如果找到一个或多个已经添加的网络，则自动连接信号最强的WiFi网络。</p>
<h5 id="语法-42"><a href="#语法-42" class="headerlink" title="语法"></a>语法</h5><p><code>wiFiMulti.addAP(ssid, password)</code></p>
<h5 id="参数-40"><a href="#参数-40" class="headerlink" title="参数"></a>参数</h5><ul>
<li>ssid：需要添加的WiFi网络名称</li>
<li>password：需要添加的WiFi网络密码</li>
</ul>
<h5 id="返回值-40"><a href="#返回值-40" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-39"><a href="#示例程序-39" class="headerlink" title="示例程序"></a>示例程序</h5><p>为模块添加WiFi信息，只要可以连接的wifi出现在环境中，搜索addAP函数所存储的WiFi。将会连接信号最强的那一个WiFi信号。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiMulti_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiMulti库中addAP函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ESP8266WiFiMulti.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti WiFiMulti;<span class="comment">//实例化ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过addAp函数存储  WiFi名称       WiFi密码</span></span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>);  </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker2&quot;</span>, <span class="string">&quot;87654321&quot;</span>); </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker3&quot;</span>, <span class="string">&quot;13572468&quot;</span>); </span><br><span class="line">  <span class="comment">// 这三条语句通过调用函数addAP来记录3个不同的WiFi网络信息。</span></span><br><span class="line">  <span class="comment">// 这3个WiFi网络名称分别是taichi-maker, taichi-maker2, taichi-maker3。</span></span><br><span class="line">  <span class="comment">// 这3个网络的密码分别是123456789，87654321，13572468。</span></span><br><span class="line">  <span class="comment">// 此处WiFi信息只是示例，请在使用时将需要连接的WiFi信息填入相应位置。</span></span><br><span class="line">  <span class="comment">// 另外这里只存储了3个WiFi信息，您可以存储更多的WiFi信息在此处。</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">while</span>(WiFiMulti.run() != WL_CONNECTED) &#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="comment">// 此处的wifiMulti.run()是重点。通过wifiMulti.run()，NodeMCU将会在当前</span></span><br><span class="line">  <span class="comment">// 环境中搜索addAP函数所存储的WiFi。如果搜到多个存储的WiFi那么NodeMCU</span></span><br><span class="line">  <span class="comment">// 将会连接信号最强的那一个WiFi信号。</span></span><br><span class="line">  <span class="comment">// 一旦连接WiFI成功，wifiMulti.run()将会返回“WL_CONNECTED”。这也是</span></span><br><span class="line">  <span class="comment">// 此处while循环判断是否跳出循环的条件。</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&#x27;\n&#x27;</span>);                     <span class="comment">// WiFi连接成功后</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);            <span class="comment">// NodeMCU将通过串口监视器输出。</span></span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// 连接的WiFI名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);            <span class="comment">// 以及</span></span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// NodeMCU的IP地址</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="run-–-连接WiFi"><a href="#run-–-连接WiFi" class="headerlink" title="run – 连接WiFi"></a>run – 连接WiFi</h4><h5 id="说明-43"><a href="#说明-43" class="headerlink" title="说明"></a>说明</h5><p>当我们使用addAP函数为ESP8266开发板存储多个WiFi网络连接信息以后，可以使用run函数尝试联网。在联网过程中，ESP8266开发板会检查当前WiFi网络环境中有无addAp函数所添加的网络信息。如果找到一个或多个已经添加的网络，则自动连接信号最强的WiFi网络。</p>
<h5 id="语法-43"><a href="#语法-43" class="headerlink" title="语法"></a>语法</h5><p><code>wiFiMulti.run()</code></p>
<h5 id="参数-41"><a href="#参数-41" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-41"><a href="#返回值-41" class="headerlink" title="返回值"></a>返回值</h5><p>返回值为整数型,以下是返回值说明。</p>
<ul>
<li>0 : WL_IDLE_STATUS – 当WiFi正在状态之间切换时</li>
<li>1 : WL_NO_SSID_AVAIL – 无法访问配置的SSID</li>
<li>3 : WL_CONNECTED – 成功建立连接</li>
<li>4 : WL_CONNECT_FAILED – 密码不正确</li>
<li>6 : WL_DISCONNECTED – 模块未配置为无线终端模式</li>
</ul>
<h5 id="示例程序-40"><a href="#示例程序-40" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiMulti_demo_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiMulti库中run函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ESP8266WiFiMulti.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti WiFiMulti;<span class="comment">//实例化ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过addAp函数存储  WiFi名称       WiFi密码</span></span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>);  </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker2&quot;</span>, <span class="string">&quot;87654321&quot;</span>); </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker3&quot;</span>, <span class="string">&quot;13572468&quot;</span>); </span><br><span class="line">  <span class="comment">// 这三条语句通过调用函数addAP来记录3个不同的WiFi网络信息。</span></span><br><span class="line">  <span class="comment">// 这3个WiFi网络名称分别是taichi-maker, taichi-maker2, taichi-maker3。</span></span><br><span class="line">  <span class="comment">// 这3个网络的密码分别是123456789，87654321，13572468。</span></span><br><span class="line">  <span class="comment">// 此处WiFi信息只是示例，请在使用时将需要连接的WiFi信息填入相应位置。</span></span><br><span class="line">  <span class="comment">// 另外这里只存储了3个WiFi信息，您可以存储更多的WiFi信息在此处。</span></span><br><span class="line"> </span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(<span class="string">&quot;Wait for WiFi... &quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 此处的wifiMulti.run()是重点。通过wifiMulti.run()，NodeMCU将会在当前</span></span><br><span class="line">  <span class="comment">// 环境中搜索addAP函数所存储的WiFi。如果搜到多个存储的WiFi那么NodeMCU</span></span><br><span class="line">  <span class="comment">// 将会连接信号最强的那一个WiFi信号。</span></span><br><span class="line">  <span class="comment">// 一旦连接WiFI成功，wifiMulti.run()将会返回“WL_CONNECTED”。这也是</span></span><br><span class="line">  <span class="comment">// 此处while循环判断是否跳出循环的条件。</span></span><br><span class="line">  <span class="keyword">while</span>(WiFiMulti.run() != WL_CONNECTED) &#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&#x27;\n&#x27;</span>);                     <span class="comment">// WiFi连接成功后</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);            <span class="comment">// NodeMCU将通过串口监视器输出。</span></span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// 连接的WiFI名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);            <span class="comment">// 以及</span></span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// NodeMCU的IP地址</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="cleanAPlist-–-清除WiFi连接信息"><a href="#cleanAPlist-–-清除WiFi连接信息" class="headerlink" title="cleanAPlist – 清除WiFi连接信息"></a>cleanAPlist – 清除WiFi连接信息</h4><h5 id="说明-44"><a href="#说明-44" class="headerlink" title="说明"></a>说明</h5><p>此函数可以删除ESP8266开发板WiFi连接列表中的WiFi连接信息。</p>
<h5 id="语法-44"><a href="#语法-44" class="headerlink" title="语法"></a>语法</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">WiFiMulti.cleanAPlist()</span><br></pre></td></tr></table></figure>

<h5 id="参数-42"><a href="#参数-42" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-42"><a href="#返回值-42" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-41"><a href="#示例程序-41" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiMulti_demo_3</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiMulti库中cleanAPlist函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ESP8266WiFiMulti.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti WiFiMulti;<span class="comment">//实例化ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过addAp函数存储  WiFi名称       WiFi密码</span></span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>);  </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker2&quot;</span>, <span class="string">&quot;87654321&quot;</span>); </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker3&quot;</span>, <span class="string">&quot;13572468&quot;</span>); </span><br><span class="line">  <span class="comment">// 这三条语句通过调用函数addAP来记录3个不同的WiFi网络信息。</span></span><br><span class="line">  <span class="comment">// 这3个WiFi网络名称分别是taichi-maker, taichi-maker2, taichi-maker3。</span></span><br><span class="line">  <span class="comment">// 这3个网络的密码分别是123456789，87654321，13572468。</span></span><br><span class="line">  <span class="comment">// 此处WiFi信息只是示例，请在使用时将需要连接的WiFi信息填入相应位置。</span></span><br><span class="line">  <span class="comment">// 另外这里只存储了3个WiFi信息，您可以存储更多的WiFi信息在此处。</span></span><br><span class="line">    </span><br><span class="line">  WiFiMulti.cleanAPlist();</span><br><span class="line">  Serial.println(<span class="string">&quot;AP列表已删除&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//查看该接入点是否在接入点列表中</span></span><br><span class="line">  <span class="keyword">if</span>(WiFiMulti.existsAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>))&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;taichi-maker在列表中&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;Serial.println(<span class="string">&quot;taichi-maker不在列表中&quot;</span>);&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(WiFiMulti.existsAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>))&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;taichi-maker2在列表中&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;Serial.println(<span class="string">&quot;taichi-maker2不在列表中&quot;</span>);&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(WiFiMulti.existsAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>))&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;taichi-maker3在列表中&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;Serial.println(<span class="string">&quot;taichi-maker3不在列表中&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容"><a href="#相关内容" class="headerlink" title="相关内容"></a>相关内容</h5><p>– addAp – 添加 WiFi连接信息<br>– run – 连接WiFi</p>
<h3 id="信息类型-3"><a href="#信息类型-3" class="headerlink" title="信息类型"></a>信息类型</h3><h4 id="existsAP-–-检查WiFi连接信息内容"><a href="#existsAP-–-检查WiFi连接信息内容" class="headerlink" title="existsAP – 检查WiFi连接信息内容"></a>existsAP – 检查WiFi连接信息内容</h4><h5 id="说明-45"><a href="#说明-45" class="headerlink" title="说明"></a>说明</h5><p>此函数用于确认某一个接入点信息是否已经通过addAP函数添加到ESP8266开发板的联网信息列表中了。</p>
<h5 id="语法-45"><a href="#语法-45" class="headerlink" title="语法"></a>语法</h5><p><code>wiFiMulti.existsAP(ssid, password)</code></p>
<h5 id="参数-43"><a href="#参数-43" class="headerlink" title="参数"></a>参数</h5><ul>
<li>ssid：需要确认的WiFi网络名称</li>
<li>password：需要确认的WiFi网络密码</li>
</ul>
<h5 id="返回值-43"><a href="#返回值-43" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为布尔型。<br>如果某一个接入点信息已经通过addAP函数添加到ESP8266开发板的联网信息列表中了，则返回值为true，否则返回值为false。</p>
<h5 id="示例程序-42"><a href="#示例程序-42" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiMulti_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiMulti库中existsAP函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ESP8266WiFiMulti.h&quot;</span></span></span><br><span class="line">ESP8266WiFiMulti WiFiMulti;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot; &quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过addAp函数存储  WiFi名称       WiFi密码</span></span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>);  </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker2&quot;</span>, <span class="string">&quot;87654321&quot;</span>); </span><br><span class="line">  WiFiMulti.addAP(<span class="string">&quot;taichi-maker3&quot;</span>, <span class="string">&quot;13572468&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;AP列表添加完毕&quot;</span>);</span><br><span class="line">  <span class="comment">// 这三条语句通过调用函数addAP来记录3个不同的WiFi网络信息。</span></span><br><span class="line">  <span class="comment">// 这3个WiFi网络名称分别是taichi-maker, taichi-maker2, taichi-maker3。</span></span><br><span class="line">  <span class="comment">// 这3个网络的密码分别是123456789，87654321，13572468。</span></span><br><span class="line">  <span class="comment">// 此处WiFi信息只是示例，请在使用时将需要连接的WiFi信息填入相应位置。</span></span><br><span class="line">  <span class="comment">// 另外这里只存储了3个WiFi信息，您可以存储更多的WiFi信息在此处。</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 确认接入点列表中有无&quot;taichi-maker&quot;</span></span><br><span class="line">  <span class="keyword">if</span>(WiFiMulti.existsAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>))&#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;taichi-maker在列表中&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;Serial.println(<span class="string">&quot;taichi-maker不在列表中&quot;</span>);&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 确认接入点列表中有无&quot;测试WiFi&quot;</span></span><br><span class="line">  <span class="keyword">if</span>(WiFiMulti.existsAP(<span class="string">&quot;测试WiFi&quot;</span>, <span class="string">&quot;12345678&quot;</span>))&#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;测试WiFi 在列表中&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;Serial.println(<span class="string">&quot;测试WiFi 不在列表中&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-1"><a href="#相关内容-1" class="headerlink" title="相关内容"></a>相关内容</h5><p>– addAp – 添加 WiFi连接信息<br>– run – 连接WiFi<br>– cleanAPlist – 清除WiFi连接信息</p>
<h2 id="ESP8266-–-ESP8266WiFiScan库"><a href="#ESP8266-–-ESP8266WiFiScan库" class="headerlink" title="ESP8266 – ESP8266WiFiScan库"></a>ESP8266 – ESP8266WiFiScan库</h2><p>ESP8266WiFiScan库用于ESP8266开发板扫描WiFi网络以及分析扫描到的WiFi网络信息。</p>
<p>以下为ESP8266WiFiScan库的整体结构图。</p>
<p><img src="/./Image/ESP8266.assets/image-20230526130913344.png" alt="image-20230526130913344"></p>
<h3 id="设置类型-2"><a href="#设置类型-2" class="headerlink" title="设置类型"></a>设置类型</h3><h4 id="scanNetworks-–-同步扫描WiFi网络"><a href="#scanNetworks-–-同步扫描WiFi网络" class="headerlink" title="scanNetworks – 同步扫描WiFi网络"></a>scanNetworks – 同步扫描WiFi网络</h4><h5 id="说明-46"><a href="#说明-46" class="headerlink" title="说明"></a>说明</h5><p>该函数可以扫描到ESP8266开发板所在环境中的可用WIFI网络，并且将WiFi网络信息保存到内存中。通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifista/ssid/">SSID</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/8747-2/">RSSI</a>等函数，我们还可以得到这些扫描到的WIFI的更多信息。</p>
<p>此函数在扫描WiFi网络时采用同步扫描模式。与其相对应的还有<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>异步扫描WiFi。</p>
<p>所谓同步扫描就是每一次调用本函数时，ESP8266开发板会一次性得到完整的WiFi列表，并且将WiFi列表保存在内存中。</p>
<h5 id="语法-46"><a href="#语法-46" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFi.scanNetworks()</span><br></pre></td></tr></table></figure>

<h5 id="参数-44"><a href="#参数-44" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-44"><a href="#返回值-44" class="headerlink" title="返回值"></a>返回值</h5><p>返回值为扫描到可用的网络数量，数据类型为int8_t型。</p>
<h5 id="示例程序-43"><a href="#示例程序-43" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中scanNetworks函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">1000</span>);           <span class="comment">//延时</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      <span class="comment">//打印该接入点信道</span></span><br><span class="line">      Serial.print(String(<span class="string">&quot;,   WIFI信道:&quot;</span>)+WiFi.channel(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;,   是否隐藏：&quot;</span>);</span><br><span class="line">      <span class="comment">//打印该接入点是否隐藏</span></span><br><span class="line">      Serial.print(WiFi.isHidden(i)?<span class="string">&quot;隐藏&quot;</span>:<span class="string">&quot;显示&quot;</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;,   信号强度：&quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi信号强度</span></span><br><span class="line">      Serial.print(WiFi.RSSI(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;dBm&quot;</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;,   是否加密：&quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi加密方式</span></span><br><span class="line">      Serial.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?<span class="string">&quot;开放&quot;</span>:<span class="string">&quot;加密&quot;</span>);</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-2"><a href="#相关内容-2" class="headerlink" title="相关内容"></a>相关内容</h5><p>– scanDelete<br>– scanNetworksAsync</p>
<h4 id="scanNetworksAsync-–-异步扫描WiFi网络"><a href="#scanNetworksAsync-–-异步扫描WiFi网络" class="headerlink" title="scanNetworksAsync – 异步扫描WiFi网络"></a>scanNetworksAsync – 异步扫描WiFi网络</h4><h5 id="说明-47"><a href="#说明-47" class="headerlink" title="说明"></a>说明</h5><p>该函数可以扫描到ESP8266开发板所在环境中的可用WIFI网络，并且将WiFi网络信息保存到内存中。通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifista/ssid/">SSID</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/8747-2/">RSSI</a>等函数，我们还可以得到这些扫描到的WIFI信息。</p>
<p>此函数在扫描WiFi网络时采用异步扫描模式。与其相对应的还有<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>同步扫描WiFi。</p>
<p>所谓异步扫描是与同步扫描相对应的。在异步扫描模式下，ESP8266开发板每一次扫描到一个WiFi网络，即将该网络信息保存到开发板内存中。</p>
<p>调用本函数时，需要提供一个回调函数作为参数。当所有WiFi网络都扫描完成以后，ESP8266开发板将会调用此回调函数。另外，在调用回调函数时，ESP8266开发板所扫描到的WiFi网络数量还会作为参数传递给该回调函数。</p>
<h5 id="语法-47"><a href="#语法-47" class="headerlink" title="语法"></a>语法</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">wifi.scanNetworksAsync(onComplete)</span><br><span class="line">wifi.scanNetworksAsync(scanResult, showHidden)</span><br></pre></td></tr></table></figure>

<h5 id="参数-45"><a href="#参数-45" class="headerlink" title="参数"></a>参数</h5><p><code>onComplete</code>：WiFi扫描结束后的回调函数（WiFi扫描 结束后将会调用此回调函数）</p>
<p>showHidden：此参数用于控制扫描过程中是否扫描隐藏WiFi网络。设置为true时，ESP8266开发板会扫描隐藏WiFi。默认为false。（参数类型：bool）</p>
<h5 id="返回值-45"><a href="#返回值-45" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-44"><a href="#示例程序-44" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_3</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中scanNetworksAsync 函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">1000</span>);           <span class="comment">//延时1s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;异步扫描开始 ... &quot;</span>);</span><br><span class="line">  WiFi.scanNetworksAsync(onComplete);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//回调函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">onComplete</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;扫描完成，共发现%d个网络\n&quot;</span>, n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">    <span class="comment">//打印wifi账号</span></span><br><span class="line">    Serial.print(WiFi.SSID(i));</span><br><span class="line">    <span class="comment">//打印该接入点信道</span></span><br><span class="line">    Serial.print(String(<span class="string">&quot;,   WIFI信道:&quot;</span>)+WiFi.channel(i));</span><br><span class="line">    Serial.print(<span class="string">&quot;,   是否隐藏：&quot;</span>);</span><br><span class="line">    <span class="comment">//打印该接入点是否隐藏</span></span><br><span class="line">    Serial.print(WiFi.isHidden(i)?<span class="string">&quot;隐藏&quot;</span>:<span class="string">&quot;显示&quot;</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;,   信号强度：&quot;</span>);</span><br><span class="line">    <span class="comment">//打印wifi信号强度</span></span><br><span class="line">    Serial.print(WiFi.RSSI(i));</span><br><span class="line">    Serial.print(<span class="string">&quot;dBm&quot;</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;,   是否加密：&quot;</span>);</span><br><span class="line">    <span class="comment">//打印wifi加密方式</span></span><br><span class="line">    Serial.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?<span class="string">&quot;开放&quot;</span>:<span class="string">&quot;加密&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-3"><a href="#相关内容-3" class="headerlink" title="相关内容"></a>相关内容</h5><p>– scanDelete<br>– scanNetworks</p>
<h4 id="scanDelete-–-删除扫描结果"><a href="#scanDelete-–-删除扫描结果" class="headerlink" title="scanDelete – 删除扫描结果"></a>scanDelete – 删除扫描结果</h4><h5 id="说明-48"><a href="#说明-48" class="headerlink" title="说明"></a>说明</h5><p>此函数将清除掉ESP8266开发板通过扫描后储存在内存中的WiFi扫描结果。</p>
<h5 id="语法-48"><a href="#语法-48" class="headerlink" title="语法"></a>语法</h5><p>wiFi.scanDelete()</p>
<h5 id="参数-46"><a href="#参数-46" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-46"><a href="#返回值-46" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-45"><a href="#示例程序-45" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_4</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中scanDelete函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">long</span> lastScanMillis;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">long</span> currentMillis = millis();<span class="comment">//调用millis函数，获取当前时钟</span></span><br><span class="line">  <span class="keyword">if</span> (currentMillis - lastScanMillis &gt; <span class="number">5000</span>)&#123;<span class="comment">//5s扫描一次</span></span><br><span class="line">    WiFi.scanNetworks(<span class="literal">true</span>);<span class="comment">//开始异步扫描</span></span><br><span class="line">    Serial.println(<span class="string">&quot;异步扫描开始 ... &quot;</span>);</span><br><span class="line">    lastScanMillis = currentMillis;<span class="comment">//保存当前时钟，进入下一次扫描</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//检查异步扫描的结果，将返回值存放在变量n中</span></span><br><span class="line">  <span class="type">int</span> n = WiFi.scanComplete();</span><br><span class="line">  <span class="keyword">if</span>(n &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;发现%d个网络\n&quot;</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.println(WiFi.SSID(i));</span><br><span class="line">    &#125;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    WiFi.scanDelete();<span class="comment">//删除内存中保存结果</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="信息类型-4"><a href="#信息类型-4" class="headerlink" title="信息类型"></a>信息类型</h3><h4 id="getNetworkInfo-–-获取扫描到的WiFi网络信息-网络名称，信号强度等）"><a href="#getNetworkInfo-–-获取扫描到的WiFi网络信息-网络名称，信号强度等）" class="headerlink" title="getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）"></a>getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）</h4><h5 id="说明-49"><a href="#说明-49" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>或者<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过此函数，我们可以获取扫描到的WiFi的网络名称、加密类型、信号强度、MAC地址、网络信道、网络是否隐藏等信息。</p>
<p>注：如需单独获取以上列出的WiFi信息中的某一项，可参考<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/">ESP8266WiFiScan</a>库中信息类型的其它函数内容。</p>
<h5 id="语法-49"><a href="#语法-49" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFi.getNetworkInfo(i, ssid, encryptionType, RSSI, BSSID, channel, isHidden)</span><br></pre></td></tr></table></figure>

<h5 id="参数-47"><a href="#参数-47" class="headerlink" title="参数"></a>参数</h5><p>getNetworkInfo函数会将WiFi网络信息存入参数中。这些参数的具体功能如下。</p>
<ul>
<li>i：扫描到的接入点网络列表的序号（uint8_t型）</li>
<li>ssid：扫描到的接入点网络的网络名称（String型）</li>
<li>encryptionType：扫描到的接入点网络的加密类型（uint8_t型）</li>
<li>RSSI：扫描到的接入点网络的网络信号强度（int32_t型）</li>
<li>BSSID：扫描到的接入点网络的MAC地址(大小为6个元素的uint8数组指针)</li>
<li>channel：扫描到的接入点网络的网络通道(int32_t型)</li>
<li>isHidden：扫描到的接入点网络是否是隐藏网络(bool型)</li>
</ul>
<h5 id="返回值-47"><a href="#返回值-47" class="headerlink" title="返回值"></a>返回值</h5><p>如果成功获取WiFi信息，则返回true，否则返回false。</p>
<h5 id="示例程序-46"><a href="#示例程序-46" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_5</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中encryptionType函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 建立一系列变量，用于存储网络信息</span></span><br><span class="line">    String ssid;            <span class="comment">// 网络名称</span></span><br><span class="line">    <span class="type">uint8_t</span> encryptionType; <span class="comment">// 网络加密类型</span></span><br><span class="line">    <span class="type">int32_t</span> RSSI;           <span class="comment">// 网络信号强度</span></span><br><span class="line">    <span class="type">uint8_t</span>* BSSID;         <span class="comment">// 网络接入点设备mac地址</span></span><br><span class="line">    <span class="type">int32_t</span> channel;        <span class="comment">// 网络信道</span></span><br><span class="line">    <span class="type">bool</span> isHidden;          <span class="comment">// 网络是否隐藏</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="comment">//逐个打印扫描到的接入点信息</span></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment">//获取扫描到的接入点网络信息(网络名称，信号强度等）</span></span><br><span class="line">       WiFi.getNetworkInfo(i, ssid, encryptionType, RSSI, BSSID, channel, isHidden);</span><br><span class="line">       <span class="comment">//打印扫描到的接入点网络信息(网络名称，信号强度等）</span></span><br><span class="line">       Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d: %s, Ch:%d, (%ddBm) %s %s\n&quot;</span>, i + <span class="number">1</span>, ssid.c_str(), channel, RSSI, encryptionType == ENC_TYPE_NONE ? <span class="string">&quot;开放&quot;</span> : <span class="string">&quot;加密&quot;</span>, isHidden ? <span class="string">&quot;隐藏&quot;</span> : <span class="string">&quot;显示&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-4"><a href="#相关内容-4" class="headerlink" title="相关内容"></a>相关内容</h5><p>– SSID – 获取扫描到的WiFi网络名称<br>– RSSI – 获取扫描到的WiFi网络信号强度<br>– encryptionType – 获取扫描到的WiFi网络加密类型<br>– BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址<br>– channel – 获取扫描到的WiFi网络信道号<br>– isHidden – 检查扫描到的WiFi网络是否是隐藏网络<br>– scanComplete – 获取异步扫描结果或状态</p>
<h4 id="SSID-–-获取扫描到的WiFi网络名称"><a href="#SSID-–-获取扫描到的WiFi网络名称" class="headerlink" title="SSID – 获取扫描到的WiFi网络名称"></a>SSID – 获取扫描到的WiFi网络名称</h4><h5 id="说明-50"><a href="#说明-50" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>或者<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过此函数，我们可以获取扫描到的WiFi网络信息中的网络名称(SSID)信息。</p>
<h5 id="语法-50"><a href="#语法-50" class="headerlink" title="语法"></a>语法</h5><p>wiFi.SSID(val)</p>
<h5 id="参数-48"><a href="#参数-48" class="headerlink" title="参数"></a>参数</h5><p>val：扫描到的WiFi网络信息序号（类型：uint8_t ）</p>
<h5 id="返回值-48"><a href="#返回值-48" class="headerlink" title="返回值"></a>返回值</h5><p>扫描到的WiFi网络信息中的网络名称(SSID)信息(类型：String)</p>
<h5 id="示例程序-47"><a href="#示例程序-47" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中SSID函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">1000</span>);           <span class="comment">//延时1s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.println(WiFi.SSID(i));</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="RSSI-–-获取扫描到的WiFi网络信号强度"><a href="#RSSI-–-获取扫描到的WiFi网络信号强度" class="headerlink" title="RSSI – 获取扫描到的WiFi网络信号强度"></a>RSSI – 获取扫描到的WiFi网络信号强度</h4><h5 id="说明-51"><a href="#说明-51" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用scanNetworks或者scanNetworksAsync对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过此函数，我们可以获取扫描到的WiFi网络信息中的网络信号强度。</p>
<h5 id="语法-51"><a href="#语法-51" class="headerlink" title="语法"></a>语法</h5><p><code>wiFi.RSSI(val)</code></p>
<h5 id="参数-49"><a href="#参数-49" class="headerlink" title="参数"></a>参数</h5><p>val：扫描到的WiFi网络信息序号（类型：uint8_t）</p>
<h5 id="返回值-49"><a href="#返回值-49" class="headerlink" title="返回值"></a>返回值</h5><p>扫描到的WiFi网络信息中的网络信号长度(类型：int32_t)</p>
<h5 id="示例程序-48"><a href="#示例程序-48" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中RSSI函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">1000</span>);           <span class="comment">//延时1s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;,   信号强度：&quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi信号强度</span></span><br><span class="line">      Serial.print(WiFi.RSSI(i));</span><br><span class="line">      Serial.println(<span class="string">&quot;dBm&quot;</span>);</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-5"><a href="#相关内容-5" class="headerlink" title="相关内容"></a>相关内容</h5><p>– getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）<br>– SSID – 获取扫描到的WiFi网络名称<br>– encryptionType – 获取扫描到的WiFi网络加密类型<br>– BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址<br>– channel – 获取扫描到的WiFi网络信道号<br>– isHidden – 检查扫描到的WiFi网络是否是隐藏网络<br>– scanComplete – 获取异步扫描结果或状态</p>
<h4 id="encryptionType-–-获取扫描到的WiFi网络加密类型"><a href="#encryptionType-–-获取扫描到的WiFi网络加密类型" class="headerlink" title="encryptionType – 获取扫描到的WiFi网络加密类型"></a>encryptionType – 获取扫描到的WiFi网络加密类型</h4><h5 id="说明-52"><a href="#说明-52" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>或者<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过此函数，我们可以获取扫描到的WiFi网络信息中的网络加密类型。</p>
<h5 id="语法-52"><a href="#语法-52" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFi.encryptionType(val)</span><br></pre></td></tr></table></figure>

<h5 id="参数-50"><a href="#参数-50" class="headerlink" title="参数"></a>参数</h5><p>val：扫描到的WiFi网络信息序号（类型：uint8_t）</p>
<h5 id="返回值-50"><a href="#返回值-50" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为uint8_t，以下是返回值数值以及相应的说明信息。</p>
<p>5：<code>ENC_TYPE_WEP</code>-WEP加密类型</p>
<p>2：<code>ENC_TYPE_TKIP</code>-WPA&#x2F;PSK加密类型</p>
<p>4：<code>ENC_TYPE_CCMP</code>-WPA 2&#x2F;PSK加密类型</p>
<p>7：<code>ENC_TYPE_NONE</code>-开放网络</p>
<p>8：<code>ENC_TYPE_AUTO</code>-WPA&#x2F;WPA 2&#x2F;PSK加密类型</p>
<h5 id="示例程序-49"><a href="#示例程序-49" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_3</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中encryptionType函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">1000</span>);           <span class="comment">//延时1s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;,   是否加密：&quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi加密方式</span></span><br><span class="line">      Serial.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?<span class="string">&quot;开放&quot;</span>:<span class="string">&quot;加密&quot;</span>);</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-6"><a href="#相关内容-6" class="headerlink" title="相关内容"></a>相关内容</h5><p>– getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）<br>– SSID – 获取扫描到的WiFi网络名称<br>– RSSI – 获取扫描到的WiFi网络信号强度<br>– BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址<br>– channel – 获取扫描到的WiFi网络信道号<br>– isHidden – 检查扫描到的WiFi网络是否是隐藏网络<br>– scanComplete – 获取异步扫描结果或状态</p>
<h4 id="BSSID-BSSIDstr-–-获取扫描到的WiFi网络mac地址"><a href="#BSSID-BSSIDstr-–-获取扫描到的WiFi网络mac地址" class="headerlink" title="BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址"></a>BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址</h4><h5 id="说明-53"><a href="#说明-53" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>或者<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过BSSID函数和BSSIDstr函数，我们可以获取扫描到的WiFi网络接入点设备的mac地址。虽然这两个函数功能相同，但是它们的返回值类型是不同的。</p>
<p>BSSIDstr函数以字符串形式将WiFi接入点设备mac地址返回。</p>
<p>BSSID函数的返回值是存储WiFi接入点设备mac地址信息的内存位置，即一个大小为6个元素的uint8数组指针。</p>
<h5 id="语法-53"><a href="#语法-53" class="headerlink" title="语法"></a>语法</h5><p><code>WiFi.BSSID(val)</code><br><code>WiFi.BSSIDstr(val)</code></p>
<h5 id="参数-51"><a href="#参数-51" class="headerlink" title="参数"></a>参数</h5><p>val：扫描到的WiFi网络信息序号（类型：uint8_t ）</p>
<h5 id="返回值-51"><a href="#返回值-51" class="headerlink" title="返回值"></a>返回值</h5><p>BSSIDstr函数以字符串形式将WiFi接入点设备mac地址返回。</p>
<p>BSSID函数的返回值是存储WiFi接入点设备mac地址信息的内存位置，即一个大小为6个元素的uint8数组指针。</p>
<h5 id="示例程序-50"><a href="#示例程序-50" class="headerlink" title="示例程序"></a>示例程序</h5><p><strong>BSSID函数示例</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_4</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中BSSID函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;,   mac地址：&quot;</span>);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;%p&quot;</span>,WiFi.BSSID(i));<span class="comment">//BSSID返回网络的MAC地址。</span></span><br><span class="line">      Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">//延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>BSSIDstr</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_4</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中BSSIDstr函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;,   mac为：&quot;</span>);</span><br><span class="line">      Serial.println(WiFi.BSSIDstr(i));<span class="comment">//BSSIDstr返回网络的MAC地址的字符串。</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">//延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-7"><a href="#相关内容-7" class="headerlink" title="相关内容"></a>相关内容</h5><p>– getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）<br>– SSID – 获取扫描到的WiFi网络名称<br>– RSSI – 获取扫描到的WiFi网络信号强度<br>– encryptionType – 获取扫描到的WiFi网络加密类型<br>– channel – 获取扫描到的WiFi网络信道号<br>– isHidden – 检查扫描到的WiFi网络是否是隐藏网络<br>– scanComplete – 获取异步扫描结果或状态</p>
<h4 id="channel-–-获取扫描到的WiFi网络信道号"><a href="#channel-–-获取扫描到的WiFi网络信道号" class="headerlink" title="channel – 获取扫描到的WiFi网络信道号"></a>channel – 获取扫描到的WiFi网络信道号</h4><h5 id="说明-54"><a href="#说明-54" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>或者<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过此函数，我们可以获取扫描到的WiFi网络信息中的WiFi网络信道号。</p>
<h5 id="语法-54"><a href="#语法-54" class="headerlink" title="语法"></a>语法</h5><p>wiFi.channel(val)</p>
<h5 id="参数-52"><a href="#参数-52" class="headerlink" title="参数"></a>参数</h5><p>val：扫描到的WiFi网络信息序号（类型：uint8_t ）</p>
<h5 id="返回值-52"><a href="#返回值-52" class="headerlink" title="返回值"></a>返回值</h5><p>扫描到的WiFi网络信息中的网络信道号(类型：uint8_t)</p>
<h5 id="示例程序-51"><a href="#示例程序-51" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_3</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中encryptionType函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      Serial.print(String(<span class="string">&quot;,   WIFI信道:&quot;</span>)+WiFi.channel(i));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-8"><a href="#相关内容-8" class="headerlink" title="相关内容"></a>相关内容</h5><p>– getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）<br>– SSID – 获取扫描到的WiFi网络名称<br>– RSSI – 获取扫描到的WiFi网络信号强度<br>– encryptionType – 获取扫描到的WiFi网络加密类型<br>– BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址<br>– isHidden – 检查扫描到的WiFi网络是否是隐藏网络<br>– scanComplete – 获取异步扫描结果或状态</p>
<h4 id="isHidden-–-检查扫描到的WiFi网络是否是隐藏网络"><a href="#isHidden-–-检查扫描到的WiFi网络是否是隐藏网络" class="headerlink" title="isHidden – 检查扫描到的WiFi网络是否是隐藏网络"></a>isHidden – 检查扫描到的WiFi网络是否是隐藏网络</h4><h5 id="说明-55"><a href="#说明-55" class="headerlink" title="说明"></a>说明</h5><p>当ESP8266开发板使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworks/">scanNetworks</a>或者<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>对所处环境的WiFi网络进行扫描后，ESP8266开发板会将扫描到的网络信息保存在内存中。</p>
<p>通过此函数，我们可以获取WiFi网络是否是隐藏WiFi这一状态信息。</p>
<h5 id="语法-55"><a href="#语法-55" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFi.isHidden(val)</span><br></pre></td></tr></table></figure>

<h5 id="参数-53"><a href="#参数-53" class="headerlink" title="参数"></a>参数</h5><p>val：扫描到的WiFi网络信息序号（类型：uint8_t ）</p>
<h5 id="返回值-53"><a href="#返回值-53" class="headerlink" title="返回值"></a>返回值</h5><p>扫描到的WiFi网络是否为隐藏的这一状态信息(类型：bool)</p>
<h5 id="示例程序-52"><a href="#示例程序-52" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_7</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中isHidden函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描开始&quot;</span>);</span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();    <span class="comment">//开始同步扫描，将返回值</span></span><br><span class="line">  Serial.println(<span class="string">&quot;同步扫描结束&quot;</span>);   <span class="comment">//存放在变量n中</span></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;找不到网络&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;发现网络&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;  <span class="comment">//开始逐个打印扫描到的</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);        <span class="comment">//接入点信息</span></span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.print(WiFi.SSID(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;,   是否隐藏：&quot;</span>);</span><br><span class="line">      Serial.println(WiFi.isHidden(i)?<span class="string">&quot;隐藏&quot;</span>:<span class="string">&quot;显示&quot;</span>);</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">// 延时5s之后再次扫描</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="scanComplete-–-获取异步扫描结果或状态"><a href="#scanComplete-–-获取异步扫描结果或状态" class="headerlink" title="scanComplete – 获取异步扫描结果或状态"></a>scanComplete – 获取异步扫描结果或状态</h4><h5 id="说明-56"><a href="#说明-56" class="headerlink" title="说明"></a>说明</h5><p>此函数用于获取扫描中扫描到的WiFi网络数量。</p>
<p>注：如需了解更多异步扫描信息，请参考<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266wifiscan/scannetworksasync/">scanNetworksAsync</a>函数</p>
<h5 id="语法-56"><a href="#语法-56" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFi.scanComplete()</span><br></pre></td></tr></table></figure>

<h5 id="参数-54"><a href="#参数-54" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-54"><a href="#返回值-54" class="headerlink" title="返回值"></a>返回值</h5><p>扫描到的网络数量（int8_t类型）</p>
<h5 id="示例程序-53"><a href="#示例程序-53" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiScan_demo_8</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiScan库中scanComplete函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">long</span> lastScanMillis;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);  <span class="comment">//设置串口波特率，以便打印信息</span></span><br><span class="line">  delay(<span class="number">5000</span>);           <span class="comment">//延时5s</span></span><br><span class="line">  WiFi.mode(WIFI_STA);   <span class="comment">//设置为无线终端模式</span></span><br><span class="line">  WiFi.disconnect();     <span class="comment">//断开，不连接到任何一个接入点</span></span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;STA建立完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">long</span> currentMillis = millis();<span class="comment">//调用millis函数，获取当前时钟</span></span><br><span class="line">  <span class="keyword">if</span> (currentMillis - lastScanMillis &gt; <span class="number">5000</span>)&#123;<span class="comment">//5s扫描一次</span></span><br><span class="line">    WiFi.scanNetworks(<span class="literal">true</span>);<span class="comment">//开始异步扫描</span></span><br><span class="line">    Serial.println(<span class="string">&quot;异步扫描开始 ... &quot;</span>);</span><br><span class="line">    lastScanMillis = currentMillis;<span class="comment">//保存当前时钟，进入下一次扫描</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//检查异步扫描的结果，将返回值存放在变量n中</span></span><br><span class="line">  <span class="type">int</span> n = WiFi.scanComplete();</span><br><span class="line">  <span class="keyword">if</span>(n &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;发现%d个网络\n&quot;</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">      Serial.print(i + <span class="number">1</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//打印wifi账号</span></span><br><span class="line">      Serial.println(WiFi.SSID(i));</span><br><span class="line">    &#125;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    WiFi.scanDelete();<span class="comment">//打印完一次扫描结果之后，删除内存保存结果</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>











<h2 id="ESP8266-–-WiFiClient库"><a href="#ESP8266-–-WiFiClient库" class="headerlink" title="ESP8266 – WiFiClient库"></a>ESP8266 – WiFiClient库</h2><p>WiFiClient库用于ESP8266的TCP协议物联网通讯。通过WiFiClient库，可以使用ESP8266利用互联网或局域网向网络服务器发送请求，从而获取网络信息，实现物联网应用。</p>
<p>ESP8266库中还有一个专门用于HTTP通讯的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/">ESP8266HTTPClient库 </a>。HTTP协议是建立在TCP协议基础之上的，我们也可以使用ESP8266HTTPClient库来通过HTTP协议向网络服务器发送请求。WiFiClient库与<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/">ESP8266HTTPClient库 </a>在功能上形成了互补。</p>
<p>以下为WiFiClient库的整体结构图。在此图下方有WiFiClient库的函数目录。</p>
<p><img src="/./Image/ESP8266.assets/image-20230525093748647.png" alt="image-20230525093748647"></p>
<p><strong>请留意，WiFiServer对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。因此在以下结构图中的“发送数据类型”以及“响应信息操作类型”中有“Stream类”作为这种类型函数的一部分。</strong></p>
<h3 id="连接服务器类型"><a href="#连接服务器类型" class="headerlink" title="连接服务器类型"></a>连接服务器类型</h3><h4 id="设置类型-3"><a href="#设置类型-3" class="headerlink" title="设置类型"></a>设置类型</h4><h5 id="connect-–-连接服务器"><a href="#connect-–-连接服务器" class="headerlink" title="connect – 连接服务器"></a>connect – 连接服务器</h5><h6 id="说明-57"><a href="#说明-57" class="headerlink" title="说明"></a>说明</h6><p>connect函数用于ESP8266开发板通过TCP协议连接网络服务器。</p>
<h6 id="语法-57"><a href="#语法-57" class="headerlink" title="语法"></a>语法</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">client.connect(ip, port);</span><br></pre></td></tr></table></figure>

<h6 id="参数-55"><a href="#参数-55" class="headerlink" title="参数"></a>参数</h6><ul>
<li>ip:所要连接的服务器地址。<br>注：在定义参数ip的时候可使用String、const char。如下所示：<br><code>const char * ip = &quot;47.92.129.18&quot;;</code><br><code>String ip = &quot;www.ranye-iot.com&quot;;</code></li>
<li>port:所要连接的服务器端口号,允许使用int类型。</li>
</ul>
<h6 id="返回值-55"><a href="#返回值-55" class="headerlink" title="返回值"></a>返回值</h6><p>连接失败返回0，连接成功返回1。返回值数据类型是bool型。</p>
<h6 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266随即会尝试连接<a target="_blank" rel="noopener" href="http://www.example.com网站服务器.以下程序使用了client.connect/">www.example.com网站服务器。以下程序使用了client.connect</a>(host, port)来实现这一操作。如果服务器连接成功，则client.connect(host, port)语句将会返回true。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : TCP_Client_connect</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示WiFiClient库中connect函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  WiFi.mode(WIFI_STA);    <span class="comment">// 设置ESP8266为无线终端模式</span></span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="stop-–-停止客户端"><a href="#stop-–-停止客户端" class="headerlink" title="stop – 停止客户端"></a>stop – 停止客户端</h5><h6 id="说明-58"><a href="#说明-58" class="headerlink" title="说明"></a>说明</h6><p>stop函数用于停止ESP8266连接TCP服务器。</p>
<h6 id="语法-58"><a href="#语法-58" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.stop()</span><br></pre></td></tr></table></figure>

<h6 id="参数-56"><a href="#参数-56" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266随即会尝试连接<a target="_blank" rel="noopener" href="http://www.example.com网站服务器.如果服务器连接成功,/">www.example.com网站服务器。如果服务器连接成功，</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : TCP_Client_stop</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : Dapenson</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200317</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示WiFiClient库中connect函数</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">修订历史/Revision History  </span></span><br><span class="line"><span class="comment">日期/Date    作者/Author      参考号/Ref    修订说明/Revision Description</span></span><br><span class="line"><span class="comment">20200410      CYNO朔           001        将服务器响应信息输出过程使用stream类函数实现</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  WiFi.mode(WIFI_STA);    <span class="comment">// 设置ESP8266为无线终端模式</span></span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-9"><a href="#相关内容-9" class="headerlink" title="相关内容"></a>相关内容</h6><p>— connect – 连接服务器<br>— connected – 检查是否成功连接服务器</p>
<h5 id="setNoDelay-停止小包合并发送"><a href="#setNoDelay-停止小包合并发送" class="headerlink" title="setNoDelay- 停止小包合并发送"></a>setNoDelay- 停止小包合并发送</h5><h6 id="说明-59"><a href="#说明-59" class="headerlink" title="说明"></a>说明</h6><p>setNoDelay()用于与TCP服务器通讯时 ，是否禁用 Nagle 算法。Nagle 算法的目的是通过合并一些小的发送消息，然后一次性发送所有的消息来减少通过网络发送的小数据包的tcp&#x2F;ip流量。</p>
<h6 id="语法-59"><a href="#语法-59" class="headerlink" title="语法"></a>语法</h6><p>client.setNoDelay(true);</p>
<h6 id="语法-60"><a href="#语法-60" class="headerlink" title="语法"></a>语法</h6><p>数据类型：bool</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">server.setNoDelay(<span class="literal">true</span>);<span class="comment">//true 表示禁用 Nagle 算法，合并一些小的消息</span></span><br><span class="line">server.setNoDelay(<span class="literal">false</span>);<span class="comment">//false 表示启用 Nagle 算法，消息直接发送</span></span><br></pre></td></tr></table></figure>



<h4 id="信息类型-5"><a href="#信息类型-5" class="headerlink" title="信息类型"></a>信息类型</h4><h5 id="connected-–-检查是否成功连接服务器"><a href="#connected-–-检查是否成功连接服务器" class="headerlink" title="connected – 检查是否成功连接服务器"></a>connected – 检查是否成功连接服务器</h5><h6 id="说明-60"><a href="#说明-60" class="headerlink" title="说明"></a>说明</h6><p>connected 函数用于检查设备是否成功连接服务器。</p>
<h6 id="语法-61"><a href="#语法-61" class="headerlink" title="语法"></a>语法</h6><p><code>client.connected();</code></p>
<h6 id="返回值-56"><a href="#返回值-56" class="headerlink" title="返回值"></a>返回值</h6><p>0:连接失败返回0<br>1:连接成功返回1<br>返回值数据类型：bool</p>
<h6 id="示例代码-3"><a href="#示例代码-3" class="headerlink" title="示例代码"></a>示例代码</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : TCP_Client_connected</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示WiFiClient库中connect函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  WiFi.mode(WIFI_STA);    <span class="comment">// 设置ESP8266为无线终端模式</span></span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="相关内容-10"><a href="#相关内容-10" class="headerlink" title="相关内容"></a>相关内容</h6><p>— connect – 连接服务器<br>— stop – 停止客户端</p>
<h5 id="status-–-获取客户端运行状态"><a href="#status-–-获取客户端运行状态" class="headerlink" title="status – 获取客户端运行状态"></a>status – 获取客户端运行状态</h5><h6 id="说明-61"><a href="#说明-61" class="headerlink" title="说明"></a>说明</h6><p>status函数用于获取设备与服务器的连接状态。</p>
<h6 id="语法-62"><a href="#语法-62" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.status();</span><br></pre></td></tr></table></figure>

<h6 id="返回值-57"><a href="#返回值-57" class="headerlink" title="返回值"></a>返回值</h6><ul>
<li>CLOSED &#x3D; 0</li>
<li>LISTEN &#x3D; 1</li>
<li>SYN_SENT &#x3D; 2</li>
<li>SYN_RCVD &#x3D; 3</li>
<li>ESTABLISHED &#x3D; 4</li>
<li>FIN_WAIT_1 &#x3D; 5</li>
<li>FIN_WAIT_2 &#x3D; 6</li>
<li>CLOSE_WAIT &#x3D; 7</li>
<li>CLOSING &#x3D; 8</li>
<li>LAST_ACK &#x3D; 9</li>
<li>TIME_WAIT &#x3D; 10</li>
</ul>
<h6 id="示例代码-4"><a href="#示例代码-4" class="headerlink" title="示例代码"></a>示例代码</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : TCP_Client_status</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : Dapenson</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200317</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示WiFiClient库中connect函数</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">修订历史/Revision History  </span></span><br><span class="line"><span class="comment">日期/Date    作者/Author      参考号/Ref    修订说明/Revision Description</span></span><br><span class="line"><span class="comment">20200410      CYNO朔           001        将服务器响应信息输出过程使用stream类函数实现</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  WiFi.mode(WIFI_STA);    <span class="comment">// 设置ESP8266为无线终端模式</span></span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;Current Client Status: &quot;</span>);</span><br><span class="line">    Serial.println(client.status());    </span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    Serial.print(<span class="string">&quot;Current Client Status: &quot;</span>);</span><br><span class="line">    Serial.println(client.status());</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-11"><a href="#相关内容-11" class="headerlink" title="相关内容"></a>相关内容</h6><p>— connected – 检查是否成功连接服务器<br>— connect – 连接服务器</p>
<h3 id="发送数据类型"><a href="#发送数据类型" class="headerlink" title="发送数据类型"></a>发送数据类型</h3><h4 id="print-–-发送信息（Stream类）"><a href="#print-–-发送信息（Stream类）" class="headerlink" title="print – 发送信息（Stream类）"></a>print – 发送信息（Stream类）</h4><h5 id="说明-62"><a href="#说明-62" class="headerlink" title="说明"></a>说明</h5><p>print函数用于发送数据到已连接的服务器。print函数与<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/println/">println</a>函数功能十分相似。他们二者的区别是，println函数会在发送的数据结尾增加一个换行符（’\n’），而print函数则不会。</p>
<p><strong>请留意，WiFiClient库对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-63"><a href="#语法-63" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.print(val);</span><br></pre></td></tr></table></figure>

<h5 id="参数-57"><a href="#参数-57" class="headerlink" title="参数"></a>参数</h5><p>val:所要发送的数据，可以是字符串、字符或者数值。</p>
<h5 id="返回值-58"><a href="#返回值-58" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例代码-5"><a href="#示例代码-5" class="headerlink" title="示例代码"></a>示例代码</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : TCP_Client_print</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求。</span></span><br><span class="line"><span class="comment">在发送HTTP请求时使用了print函数，从而演示该函数的使用方法。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-12"><a href="#相关内容-12" class="headerlink" title="相关内容"></a>相关内容</h5><p>— println – 发送信息（Stream类）<br>— write – 发送信息（Stream类）<br>— Stream类</p>
<h4 id="println-–-发送信息（Stream类）"><a href="#println-–-发送信息（Stream类）" class="headerlink" title="println – 发送信息（Stream类）"></a>println – 发送信息（Stream类）</h4><h5 id="说明-63"><a href="#说明-63" class="headerlink" title="说明"></a>说明</h5><p>println函数用于发送数据到已连接的服务器。println函数与<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/print/">print</a>函数功能十分相似。他们二者的区别是，println函数会在发送的数据结尾增加一个换行符（’\n’），而print函数则不会。</p>
<p><strong>请留意，WiFiClient对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-64"><a href="#语法-64" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.println(val);</span><br></pre></td></tr></table></figure>

<h5 id="参数-58"><a href="#参数-58" class="headerlink" title="参数"></a>参数</h5><p>val:所要发送的数据，可以是字符串、字符或者数值。</p>
<h5 id="返回值-59"><a href="#返回值-59" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例代码-6"><a href="#示例代码-6" class="headerlink" title="示例代码"></a>示例代码</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : TCP_Client_print</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : Dapenson</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200317</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求。</span></span><br><span class="line"><span class="comment">在发送HTTP请求时使用了println函数，从而演示该函数的使用方法。</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">修订历史/Revision History  </span></span><br><span class="line"><span class="comment">日期/Date    作者/Author      参考号/Ref    修订说明/Revision Description</span></span><br><span class="line"><span class="comment">20200410      CYNO朔           001        将服务器响应信息输出过程使用stream类函数实现</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_SSID = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  WiFi_Password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(WiFi_SSID, WiFi_Password); </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-13"><a href="#相关内容-13" class="headerlink" title="相关内容"></a>相关内容</h5><p>— print – 发送信息（Stream类）<br>— write – 发送信息（Stream类）<br>— Stream类</p>
<h4 id="write-–-发送信息（Stream类）"><a href="#write-–-发送信息（Stream类）" class="headerlink" title="write – 发送信息（Stream类）"></a>write – 发送信息（Stream类）</h4><h5 id="说明-64"><a href="#说明-64" class="headerlink" title="说明"></a>说明</h5><p>write函数可用于发送数据到已连接的服务器。你可以发送单个字节的信息也可以发送多字节的信息。</p>
<h5 id="语法-65"><a href="#语法-65" class="headerlink" title="语法"></a>语法</h5><p><code>WiFiClient.write(val);</code><br><code>WiFiClient.write(str)</code><br><code>WiFiClient.write(buf, len)</code></p>
<h5 id="参数-59"><a href="#参数-59" class="headerlink" title="参数"></a>参数</h5><ul>
<li>val: 要发送的单字符数据</li>
<li>str: 要发送的多字符数据</li>
<li>buf: 要发送的多字符数组</li>
<li>len: buf的字节长度</li>
</ul>
<h5 id="返回值-60"><a href="#返回值-60" class="headerlink" title="返回值"></a>返回值</h5><p>写入发送缓存的字节数</p>
<h5 id="相关内容-14"><a href="#相关内容-14" class="headerlink" title="相关内容"></a>相关内容</h5><p>— print – 发送信息（Stream类）<br>— println – 发送信息（Stream类）<br>— Stream类</p>
<h6 id=""><a href="#" class="headerlink" title=""></a></h6><h3 id="响应信息操作类型"><a href="#响应信息操作类型" class="headerlink" title="响应信息操作类型"></a>响应信息操作类型</h3><h4 id="readString-–-读取数据并保存为字符串-（Stream类）"><a href="#readString-–-读取数据并保存为字符串-（Stream类）" class="headerlink" title="readString – 读取数据并保存为字符串 （Stream类）"></a>readString – 读取数据并保存为字符串 （Stream类）</h4><h5 id="说明-65"><a href="#说明-65" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于从ESP8266接收到数据中读取数据信息。读取到的信息将以字符串格式返回。</p>
<p><strong>请留意，WiFiClient对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-66"><a href="#语法-66" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.readString()</span><br></pre></td></tr></table></figure>

<h5 id="参数-60"><a href="#参数-60" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-61"><a href="#返回值-61" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串。</p>
<h5 id="示例程序-54"><a href="#示例程序-54" class="headerlink" title="示例程序"></a>示例程序</h5><p>此程序用于演示如何使用esp8266作为互联网客户端向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将网站服务器响应的信息通过readstring函数获取并保存./">www.example.com网站服务器发送http请求，并且将网站服务器响应的信息通过readString函数获取并保存。</a></p>
<p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : 3_5_1_http_request_basic</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求，</span></span><br><span class="line"><span class="comment">并且将网站服务器响应的信息通过readString函数获取并保存。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_1&quot;</span>, <span class="string">&quot;your_password_for_AP_1&quot;</span>); <span class="comment">// 将需要连接的一系列WiFi ID和密码输入这里</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_2&quot;</span>, <span class="string">&quot;your_password_for_AP_2&quot;</span>); <span class="comment">// ESP8266-NodeMCU再启动后会扫描当前网络</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_3&quot;</span>, <span class="string">&quot;your_password_for_AP_3&quot;</span>); <span class="comment">// 环境查找是否有这里列出的WiFi ID。如果有</span></span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">30000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readString();</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-15"><a href="#相关内容-15" class="headerlink" title="相关内容"></a>相关内容</h5><p>— readString – 读取数据并保存为字符串 （Stream类）<br>— readStringUntil – 读取数据直到指定字符并保存为字符串 （Stream类）<br>— find – 在数据中寻找信息（Stream类）<br>— parseInt – 解析数据中的整数（Stream类）</p>
<h4 id="readStringUntil-–-读取数据直到指定字符并保存为字符串-（Stream类）"><a href="#readStringUntil-–-读取数据直到指定字符并保存为字符串-（Stream类）" class="headerlink" title="readStringUntil – 读取数据直到指定字符并保存为字符串 （Stream类）"></a>readStringUntil – 读取数据直到指定字符并保存为字符串 （Stream类）</h4><h5 id="说明-66"><a href="#说明-66" class="headerlink" title="说明"></a>说明</h5><p>readStringUntil函数可用于从设备接收到的数据中读取信息。读取到的数据信息将以字符串形式返回。该函数在满足以下任一条件后都会停止函数执行并返回。</p>
<p>– 读取到指定终止字符<br>– 达到设定时间（可使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/settimeout/">setTimeout</a>来设置）</p>
<p>当函数读取到终止字符后，会立即停止函数执行。此时函数所返回的字符串为”终止字符”前的所有字符信息。</p>
<p><strong>请留意，WiFiClient对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-67"><a href="#语法-67" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.readStringUntil(terminator)</span><br></pre></td></tr></table></figure>

<h5 id="参数-61"><a href="#参数-61" class="headerlink" title="参数"></a>参数</h5><p>terminator: 终止字符。用于设置终止函数执行的字符信息。设备在读取数据时一旦读取到此终止字符，将会结束函数执行。允许使用char类型。</p>
<h5 id="返回值-62"><a href="#返回值-62" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串。</p>
<h5 id="示例程序-55"><a href="#示例程序-55" class="headerlink" title="示例程序"></a>示例程序</h5><p>此程序用于演示如何使用esp8266作为互联网客户端向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将网站服务器响应的信息通过readstringuntil函数获取并且输出在屏幕中./">www.example.com网站服务器发送http请求，并且将网站服务器响应的信息通过readStringUntil函数获取并且输出在屏幕中。</a></p>
<p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : 3_5_1_http_request_basic</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求，并且将网站服务器响应的信息通过readStringUntil函数获取并且输出在屏幕中。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_1&quot;</span>, <span class="string">&quot;your_password_for_AP_1&quot;</span>); <span class="comment">// 将需要连接的一系列WiFi ID和密码输入这里</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_2&quot;</span>, <span class="string">&quot;your_password_for_AP_2&quot;</span>); <span class="comment">// ESP8266-NodeMCU再启动后会扫描当前网络</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_3&quot;</span>, <span class="string">&quot;your_password_for_AP_3&quot;</span>); <span class="comment">// 环境查找是否有这里列出的WiFi ID。如果有</span></span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">30000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        Serial.println(line);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-16"><a href="#相关内容-16" class="headerlink" title="相关内容"></a>相关内容</h5><p>— readString – 读取数据并保存为字符串 （Stream类）<br>— find – 在数据中寻找信息（Stream类）<br>— parseInt – 解析数据中的整数（Stream类）</p>
<h4 id="find-–-在数据中寻找信息（Stream类）"><a href="#find-–-在数据中寻找信息（Stream类）" class="headerlink" title="find – 在数据中寻找信息（Stream类）"></a>find – 在数据中寻找信息（Stream类）</h4><h5 id="说明-67"><a href="#说明-67" class="headerlink" title="说明"></a>说明</h5><p>find函数可用于从设备接收到的数据中寻找指定字符串信息。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<p><strong>请留意，WiFiClient对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-68"><a href="#语法-68" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client.find(target)</span><br></pre></td></tr></table></figure>

<h5 id="参数-62"><a href="#参数-62" class="headerlink" title="参数"></a>参数</h5><p>target: 被查找字符串。允许使用String或char类型。</p>
<h5 id="返回值-63"><a href="#返回值-63" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为bool。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<h5 id="示例程序-56"><a href="#示例程序-56" class="headerlink" title="示例程序"></a>示例程序</h5><p>此程序用于演示如何使用esp8266作为互联网客户端向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且使用find函数在网站服务器响应的信息中寻找“date”字符串.如果找到“date”字符串,则通过串口监视器告知用户开发板已经找到了“date”字符串./">www.example.com网站服务器发送http请求，并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则通过串口监视器告知用户开发板已经找到了“Date”字符串。</a></p>
<p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : wifiClient_find</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : CYNO朔</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200210</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求，</span></span><br><span class="line"><span class="comment">并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则通过</span></span><br><span class="line"><span class="comment">串口监视器告知用户开发板已经找到了“Date”字符串。</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_1&quot;</span>, <span class="string">&quot;your_password_for_AP_1&quot;</span>); <span class="comment">// 将需要连接的一系列WiFi ID和密码输入这里</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_2&quot;</span>, <span class="string">&quot;your_password_for_AP_2&quot;</span>); <span class="comment">// ESP8266-NodeMCU再启动后会扫描当前网络</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_3&quot;</span>, <span class="string">&quot;your_password_for_AP_3&quot;</span>); <span class="comment">// 环境查找是否有这里列出的WiFi ID。如果有</span></span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">30000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        <span class="keyword">if</span> (client.find(<span class="string">&quot;Date&quot;</span>))&#123;</span><br><span class="line">          Serial.println(<span class="string">&quot;Found Date Info in Server Response.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-17"><a href="#相关内容-17" class="headerlink" title="相关内容"></a>相关内容</h5><p>— readString – 读取数据并保存为字符串 （Stream类）<br>— readStringUntil – 读取数据直到指定字符并保存为字符串 （Stream类）<br>— parseInt – 解析数据中的整数（Stream类）<br>— Stream类</p>
<h4 id="parseInt-–-解析数据中的整数（Stream类）"><a href="#parseInt-–-解析数据中的整数（Stream类）" class="headerlink" title="parseInt – 解析数据中的整数（Stream类）"></a>parseInt – 解析数据中的整数（Stream类）</h4><h5 id="说明-68"><a href="#说明-68" class="headerlink" title="说明"></a>说明</h5><p>parseInt函数可用于从设备接收到的数据中寻找整数数值。</p>
<p><strong>请留意，WiFiClient对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-69"><a href="#语法-69" class="headerlink" title="语法"></a>语法</h5><p><code>client.parseInt()</code></p>
<h5 id="参数-63"><a href="#参数-63" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-64"><a href="#返回值-64" class="headerlink" title="返回值"></a>返回值</h5><p>在输入信息中找到的整数数值。类型：long</p>
<h5 id="示例程序-57"><a href="#示例程序-57" class="headerlink" title="示例程序"></a>示例程序</h5><p>此程序用于演示如何使用esp8266作为互联网客户端向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且使用find函数在网站服务器响应的信息中寻找“date”字符串.如果找到“date”字符串,则进一步使用parseint函数来寻找“date”字符串后面的第一个数字.由于标准服务器相应信息中“date”字符串后面的第一个数字信息即是当前服务器的日期信息中的”日”数值.因parseint函数寻找到的数字即是服务器的日期信息中的”日”数值./">www.example.com网站服务器发送http请求，并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则进一步使用parseInt函数来寻找“Date”字符串后面的第一个数字。由于标准服务器相应信息中“Date”字符串后面的第一个数字信息即是当前服务器的日期信息中的”日”数值。因parseInt函数寻找到的数字即是服务器的日期信息中的”日”数值。</a></p>
<p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClient_parseInt</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向www.example.com网站服务器发送http请求，</span></span><br><span class="line"><span class="comment">并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则进一步</span></span><br><span class="line"><span class="comment">使用parseInt函数来寻找“Date”字符串后面的第一个数字。由于标准服务器相应信息中“Date”字符串</span></span><br><span class="line"><span class="comment">后面的第一个数字信息即是当前服务器的日期信息中的&quot;日&quot;数值。因此parseInt函数寻找到的数字即是</span></span><br><span class="line"><span class="comment">服务器的日期信息中的&quot;日&quot;数值。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;           <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;www.example.com&quot;</span>; <span class="comment">// 网络服务器地址</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpPort = <span class="number">80</span>;              <span class="comment">// http端口80</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_1&quot;</span>, <span class="string">&quot;your_password_for_AP_1&quot;</span>); <span class="comment">// 将需要连接的一系列WiFi ID和密码输入这里</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_2&quot;</span>, <span class="string">&quot;your_password_for_AP_2&quot;</span>); <span class="comment">// ESP8266-NodeMCU再启动后会扫描当前网络</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_3&quot;</span>, <span class="string">&quot;your_password_for_AP_3&quot;</span>); <span class="comment">// 环境查找是否有这里列出的WiFi ID。如果有</span></span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; </span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 发送HTTP请求</span></span><br><span class="line">  httpRequest();    </span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">30000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 向服务器发送HTTP请求</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 建立WiFi客户端对象，对象名称client</span></span><br><span class="line">  WiFiClient client;    </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立字符串，用于HTTP请求</span></span><br><span class="line">  String httpRequest =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出连接服务器名称以便查阅连接服务器的网址                      </span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>); </span><br><span class="line">  Serial.print(host); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接网络服务器，以下段落中的示例程序为本程序重点1</span></span><br><span class="line">  <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">  <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">  <span class="keyword">if</span> (client.connect(host, httpPort))&#123; </span><br><span class="line">    Serial.println(<span class="string">&quot; Success!&quot;</span>);        <span class="comment">// 连接成功后串口输出“Success”信息</span></span><br><span class="line">    </span><br><span class="line">    client.print(httpRequest);          <span class="comment">// 向服务器发送合同谈判请求</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Sending request: &quot;</span>);<span class="comment">// 通过串口输出HTTP请求信息内容以便查阅</span></span><br><span class="line">    Serial.println(httpRequest);     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过串口输出网络服务器响应信息， 以下段落中的示例程序为本程序重点2</span></span><br><span class="line">    <span class="comment">// 请参考太极创客网站中关于本程序的讲解页面获取详细说明信息。网址：</span></span><br><span class="line">    <span class="comment">// http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Web Server Response:&quot;</span>);        </span><br><span class="line">    <span class="keyword">while</span> (client.connected() || client.available())&#123; </span><br><span class="line">      <span class="keyword">if</span> (client.available())&#123;</span><br><span class="line">        <span class="keyword">if</span> (client.find(<span class="string">&quot;Date&quot;</span>))&#123;</span><br><span class="line">          Serial.println(<span class="string">&quot;Found Date Info in Server Response.&quot;</span>);</span><br><span class="line">          <span class="type">int</span> day = client.parseInt();       </span><br><span class="line">          Serial.print(<span class="string">&quot;day = &quot;</span>);Serial.println(day);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client.stop();                      <span class="comment">// 断开与服务器的连接</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Disconnected from &quot;</span>); <span class="comment">// 并且通过串口输出断开连接信息</span></span><br><span class="line">    Serial.print(host);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;    <span class="comment">// 如果连接不成功则通过串口输出“连接失败”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot; connection failed!&quot;</span>);</span><br><span class="line">    client.stop();</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-18"><a href="#相关内容-18" class="headerlink" title="相关内容"></a>相关内容</h5><p>— readString – 读取数据并保存为字符串 （Stream类）<br>— readStringUntil – 读取数据直到指定字符并保存为字符串 （Stream类）<br>— find – 在数据中寻找信息（Stream类）<br>— Stream类</p>
<h4 id="备注-以上带有（Stream类）标注的函数说明该函数是Stream类函数。"><a href="#备注-以上带有（Stream类）标注的函数说明该函数是Stream类函数。" class="headerlink" title="备注:以上带有（Stream类）标注的函数说明该函数是Stream类函数。"></a>备注:以上带有（Stream类）标注的函数说明该函数是Stream类函数。</h4><h2 id="Stream类"><a href="#Stream类" class="headerlink" title="Stream类"></a>Stream类</h2><h3 id="说明-69"><a href="#说明-69" class="headerlink" title="说明"></a>说明</h3><p>当我们使用ESP8266开发板或者Arduino开发板来开发项目时，可以使用基于Stream类的库来处理Stream数据。以下列表中的库都是基于Stream类所建立的。</p>
<table>
<thead>
<tr>
<th>库</th>
<th>类</th>
</tr>
</thead>
<tbody><tr>
<td>Serial</td>
<td>Serial</td>
</tr>
<tr>
<td>SoftwareSerial</td>
<td>SoftwareSerial</td>
</tr>
<tr>
<td>Ehternet</td>
<td>EthernetClient</td>
</tr>
<tr>
<td>ESP8266FS</td>
<td>File</td>
</tr>
<tr>
<td>SD</td>
<td>File</td>
</tr>
<tr>
<td>Wire</td>
<td>Wire</td>
</tr>
<tr>
<td>GSM</td>
<td>GSMClient</td>
</tr>
<tr>
<td>WifiClient</td>
<td>WiFiClient</td>
</tr>
<tr>
<td>WiFiServer</td>
<td>WiFiServer</td>
</tr>
<tr>
<td>WiFiUDP</td>
<td>WiFiUDP</td>
</tr>
<tr>
<td>WiFiClientSecure</td>
<td>WiFiClientSecure</td>
</tr>
</tbody></table>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="available"><a href="#available" class="headerlink" title="available"></a>available</h4><h5 id="说明-70"><a href="#说明-70" class="headerlink" title="说明"></a>说明</h5><p>available() 函数可用于检查设备是否接收到数据。该函数将会返回等待读取的数据字节数。</p>
<p>available()函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-70"><a href="#语法-70" class="headerlink" title="语法"></a>语法</h5><p><code>stream.available()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.available()</code><br><code>wifiClient.available()</code></p>
<h5 id="参数-64"><a href="#参数-64" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-65"><a href="#返回值-65" class="headerlink" title="返回值"></a>返回值</h5><p>等待读取的数据字节数。<br>返回值数据类型：int</p>
<h5 id="示例程序-58"><a href="#示例程序-58" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_readString</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用Serial库来演示Stream类中的available()以及</span></span><br><span class="line"><span class="comment">readString()函数的使用方法。</span></span><br><span class="line"><span class="comment">available() 函数可用于检查设备是否接收到数据。该函数将会返回等待读取的数据字节数。</span></span><br><span class="line"><span class="comment">readString() 函数将读取stream中的字符并存储到字符中。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;                      <span class="comment">// 当串口接收到信息后</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Serial Data Available...&quot;</span>); <span class="comment">// 通过串口监视器通知用户</span></span><br><span class="line">    </span><br><span class="line">    String serialData = Serial.readString();    <span class="comment">// 将接收到的信息使用readString()存储于serialData变量</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Received Serial Data: &quot;</span>);     <span class="comment">// 然后通过串口监视器输出serialData变量内容</span></span><br><span class="line">    Serial.println(serialData);                 <span class="comment">// 以便查看serialData变量的信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="read"><a href="#read" class="headerlink" title="read"></a>read</h4><h5 id="说明-71"><a href="#说明-71" class="headerlink" title="说明"></a>说明</h5><p>read() 函数可用于从设备接收到数据中读取一个字节的数据。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-71"><a href="#语法-71" class="headerlink" title="语法"></a>语法</h5><p><code>stream.read()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.read()</code><br><code>wifiClient.read()</code></p>
<h5 id="参数-65"><a href="#参数-65" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-66"><a href="#返回值-66" class="headerlink" title="返回值"></a>返回值</h5><p>设备没有接收到数据时，返回值为-1<br>设备接收到数据时，返回值为接收到的数据流中的1个字符。</p>
<h5 id="示例程序-59"><a href="#示例程序-59" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_read</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用Serial对象来演示Stream类中的read()</span></span><br><span class="line"><span class="comment">read() 函数可用于从设备接收到数据中读取一个字节的数据。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (Serial.available())&#123;           <span class="comment">// 当串口接收到信息后 </span></span><br><span class="line">    <span class="type">char</span> serialData = Serial.read();    <span class="comment">// 将接收到的信息使用read读取</span></span><br><span class="line">    Serial.println((<span class="type">char</span>)serialData);   <span class="comment">// 然后通过串口监视器输出read函数读取的信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="readBytes"><a href="#readBytes" class="headerlink" title="readBytes"></a>readBytes</h4><h5 id="说明-72"><a href="#说明-72" class="headerlink" title="说明"></a>说明</h5><p>readBytes函数可用于从设备接收的数据中读取信息。读取到的数据信息将存放在缓存变量中。该函数在读取到指定字节数的信息或者达到设定时间后都会停止函数执行并返回。该设定时间可使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/settimeout/">setTimeout</a>来设置。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-72"><a href="#语法-72" class="headerlink" title="语法"></a>语法</h5><p><code>stream.readBytes(buffer, length)</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.readBytes(buffer, length)</code><br><code>wifiClient.readBytes(buffer, length)</code></p>
<h5 id="参数-66"><a href="#参数-66" class="headerlink" title="参数"></a>参数</h5><p>buffer: 缓存变量&#x2F;数组。用于存储读取到的信息。允许使用char或者byte类型的变量或数组。<br>length: 读取字节数量。readBytes函数在读取到length所指定的字节数量后就会停止运行。允许使用int类型。</p>
<h5 id="返回值-67"><a href="#返回值-67" class="headerlink" title="返回值"></a>返回值</h5><p>buffer(缓存变量)中存储的字节数。数据类型：size_t</p>
<h5 id="示例程序-60"><a href="#示例程序-60" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_readBytes</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用Serial对象来演示Stream类中的readByte()函数使用方法</span></span><br><span class="line"><span class="comment">readByte()函数在读取到指定字节数的信息或者达到设定时间后都会停止执行。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> bufferLength = <span class="number">10</span>;    <span class="comment">// 定义缓存大小为10个字节</span></span><br><span class="line"><span class="type">char</span> serialBuffer[bufferLength];<span class="comment">// 建立字符数组用于缓存</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;             			<span class="comment">// 当串口接收到信息后  </span></span><br><span class="line">    Serial.println(<span class="string">&quot;Received Serial Data:&quot;</span>);  </span><br><span class="line">    Serial.readBytes(serialBuffer, bufferLength);<span class="comment">// 将接收到的信息使用readBytes读取</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;bufferLength; i++)&#123;  		<span class="comment">// 然后通过串口监视器输出readBytes</span></span><br><span class="line">      Serial.print(serialBuffer[i]);      		<span class="comment">// 函数所读取的信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);  </span><br><span class="line">    Serial.println(<span class="string">&quot;Finished Printing Recevied Data.&quot;</span>);</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="readBytesUntil"><a href="#readBytesUntil" class="headerlink" title="readBytesUntil"></a>readBytesUntil</h4><h5 id="说明-73"><a href="#说明-73" class="headerlink" title="说明"></a>说明</h5><p>readBytesUntil() 函数可用于从设备接收到数据中读取信息。读取到的数据信息将存放在缓存变量中。该函数在满足以下任一条件后都会停止函数执行并且返回。</p>
<p>– 读取到指定终止字符<br>– 读取到指定字节数的信息<br>– 达到设定时间（可使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/settimeout/">setTimeout</a>来设置）</p>
<p>当函数读取到终止字符后，会立即停止函数执行。此时buffer（缓存变量&#x2F;数组）中所存储的信息为设备读取到终止字符前的字符内容。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-73"><a href="#语法-73" class="headerlink" title="语法"></a>语法</h5><p><code>stream.readBytesUntil(character, buffer, length)</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.readBytesUntil(character, buffer, length)</code><br><code>wifiClient.readBytesUntil(character, buffer, length)</code></p>
<h5 id="参数-67"><a href="#参数-67" class="headerlink" title="参数"></a>参数</h5><ul>
<li>character: 终止字符。用于设置终止函数执行的字符信息。设备在读取数据时一旦读取到此终止字符，将会结束函数执行。允许使用char类型。</li>
<li>buffer: 缓存变量&#x2F;数组。用于存储读取到的信息。允许使用char或者byte类型的变量或数组。</li>
<li>length: 读取字节数量。readBytes函数在读取到length所指定的字节数量后就会停止运行。允许使用int类型。&#96;</li>
</ul>
<h5 id="返回值-68"><a href="#返回值-68" class="headerlink" title="返回值"></a>返回值</h5><p>buffer(缓存变量)中存储的字节数。数据类型：size_t</p>
<h5 id="示例程序-61"><a href="#示例程序-61" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_readBytesUntil</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用Serial对象来演示Stream类中的readByteUntil()函数使用方法。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="type">char</span> terminateChar =  <span class="string">&#x27;T&#x27;</span>;      <span class="comment">// 建立终止字符</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> bufferLength = <span class="number">10</span>;    <span class="comment">// 定义缓存大小为10个字节</span></span><br><span class="line"><span class="type">char</span> serialBuffer[bufferLength];<span class="comment">// 建立字符数组用于缓存  </span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;             <span class="comment">// 当串口接收到信息后  </span></span><br><span class="line">    Serial.readBytesUntil(terminateChar, serialBuffer, bufferLength);<span class="comment">// 将接收到的信息使用read读取</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;bufferLength; i++)&#123;  <span class="comment">// 然后通过串口监视器输出readBytesUntil</span></span><br><span class="line">      Serial.print(serialBuffer[i]);    <span class="comment">// 函数所读取的信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);      </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="readString"><a href="#readString" class="headerlink" title="readString"></a>readString</h4><h5 id="说明-74"><a href="#说明-74" class="headerlink" title="说明"></a>说明</h5><p>readString() 函数可用于从设备接收到数据中读取数据信息。读取到的信息将以字符串格式返回。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-74"><a href="#语法-74" class="headerlink" title="语法"></a>语法</h5><p><code>stream.readString()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.readString()</code><br><code>wifiClient.readString()</code></p>
<h5 id="参数-68"><a href="#参数-68" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-69"><a href="#返回值-69" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串。</p>
<h5 id="示例程序-62"><a href="#示例程序-62" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_readString</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用Serial库来演示Stream类中的available()以及</span></span><br><span class="line"><span class="comment">readString()函数的使用方法。</span></span><br><span class="line"><span class="comment">available() 函数将会返回开发板所接收到的stream中等待读取的字节数。</span></span><br><span class="line"><span class="comment">readString() 函数将读取stream中的字符并存储到字符中。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;                      <span class="comment">// 当串口接收到信息后</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Serial Data Available...&quot;</span>); <span class="comment">// 通过串口监视器通知用户</span></span><br><span class="line">    </span><br><span class="line">    String serialData = Serial.readString();    <span class="comment">// 将接收到的信息使用readString()存储于serialData变量</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Received Serial Data: &quot;</span>);     <span class="comment">// 然后通过串口监视器输出serialData变量内容</span></span><br><span class="line">    Serial.println(serialData);                 <span class="comment">// 以便查看serialData变量的信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-19"><a href="#相关内容-19" class="headerlink" title="相关内容"></a>相关内容</h5><p>– available<br>– readStringUntil</p>
<h4 id="readStringUntil"><a href="#readStringUntil" class="headerlink" title="readStringUntil"></a>readStringUntil</h4><h5 id="说明-75"><a href="#说明-75" class="headerlink" title="说明"></a>说明</h5><p>readStringUntil函数可用于从设备接收到的数据中读取信息。读取到的数据信息将以字符串形式返回。该函数在满足以下任一条件后都会停止函数执行并返回。</p>
<p>– 读取到指定终止字符<br>– 达到设定时间（可使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/settimeout/">setTimeout</a>来设置）</p>
<p>当函数读取到终止字符后，会立即停止函数执行。此时函数所返回的字符串为”终止字符”前的所有字符信息。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-75"><a href="#语法-75" class="headerlink" title="语法"></a>语法</h5><p><code>Stream.readStringUntil(terminator)</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.readStringUntil(terminator)</code><br><code>wifiClient.readStringUntil(terminator)</code></p>
<h5 id="参数-69"><a href="#参数-69" class="headerlink" title="参数"></a>参数</h5><p>terminator: 终止字符。用于设置终止函数执行的字符信息。设备在读取数据时一旦读取到此终止字符，将会结束函数执行。允许使用char类型。</p>
<h5 id="返回值-70"><a href="#返回值-70" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串</p>
<h5 id="示例程序-63"><a href="#示例程序-63" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_readStringUntil</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的readString()函数的使用方法。</span></span><br><span class="line"><span class="comment">readStringUntil() 函数可用于从设备接收到数据中读取信息。读取到的数据信息将以字符串形式返回中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="type">char</span> terminatorChar = <span class="string">&#x27;T&#x27;</span>;    <span class="comment">// 定义终止字符为‘T’</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;                      <span class="comment">// 当串口接收到信息后</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Serial Data Available...&quot;</span>); <span class="comment">// 通过串口监视器通知用户</span></span><br><span class="line">    </span><br><span class="line">    String serialData = Serial.readStringUntil(terminatorChar);    <span class="comment">// 将接收到的信息使用readString()存储于serialData变量</span></span><br><span class="line">    Serial.print(<span class="string">&quot;Received Serial Data: &quot;</span>);     <span class="comment">// 然后通过串口监视器输出serialData变量内容</span></span><br><span class="line">    Serial.println(serialData);                 <span class="comment">// 以便查看serialData变量的信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><h5 id="说明-76"><a href="#说明-76" class="headerlink" title="说明"></a>说明</h5><p>find函数可用于从设备接收到的数据中寻找指定字符串信息。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-76"><a href="#语法-76" class="headerlink" title="语法"></a>语法</h5><p><code>Stream.find(target)</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.find(target)</code><br><code>wifiClient.find(target)</code></p>
<h5 id="参数-70"><a href="#参数-70" class="headerlink" title="参数"></a>参数</h5><p>target: 被查找字符串。允许使用String或char类型。</p>
<h5 id="返回值-71"><a href="#返回值-71" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为bool。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<h5 id="示例程序-64"><a href="#示例程序-64" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : find</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的find函数使用方法。</span></span><br><span class="line"><span class="comment">find函数可用于从设备接收到数据中寻找指定信息。当该函数找到了指定信息</span></span><br><span class="line"><span class="comment">后将会立即结束函数执行并且返回“真”。否则该函数将会返回“假”。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123; </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;                      <span class="comment">// 当串口接收到信息后</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Serial Data Available...&quot;</span>); <span class="comment">// 通过串口监视器通知</span></span><br><span class="line">                                                <span class="comment">// 用户系统开始查找指定信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;system is trying to find &quot;</span>); Serial.println(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 执行查找并通过串口监视器输出查找结果</span></span><br><span class="line">    <span class="keyword">if</span>(Serial.find(<span class="string">&quot;^_^&quot;</span>)) &#123;</span><br><span class="line">      Serial.print(<span class="string">&quot;Great! System found &quot;</span>); Serial.println(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.print(<span class="string">&quot;Sorry System can&#x27;t find &quot;</span>); Serial.println(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">    &#125;  </span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-20"><a href="#相关内容-20" class="headerlink" title="相关内容"></a>相关内容</h5><p>– available<br>– findUntil</p>
<h4 id="findUntil"><a href="#findUntil" class="headerlink" title="findUntil"></a>findUntil</h4><h5 id="说明-77"><a href="#说明-77" class="headerlink" title="说明"></a>说明</h5><p>findUntil函数可用于从设备接收到的数据中寻找指定字符串信息。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。该函数在满足以下任一条件后都会停止函数执行</p>
<p>– 读取到指定终止字符串<br>– 找到了指定字符串信息<br>– 达到设定时间（可使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/settimeout/">setTimeout</a>来设置）</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-77"><a href="#语法-77" class="headerlink" title="语法"></a>语法</h5><p><code>Stream.findUntil(target, terminator)</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.findUntil(target, terminator)</code><br><code>wifiClient.findUntil(target, terminator)</code></p>
<h5 id="参数-71"><a href="#参数-71" class="headerlink" title="参数"></a>参数</h5><p>target: 被查找字符串。允许使用String或char类型。</p>
<p>terminator: 终止字符串。用于设置终止函数执行的字符串信息。设备在读取数据时一旦读取到此终止字符串，将会结束函数执行并返回。</p>
<h5 id="返回值-72"><a href="#返回值-72" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为bool。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<h5 id="示例程序-65"><a href="#示例程序-65" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : findUntil</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的findUntil函数使用方法。</span></span><br><span class="line"><span class="comment">findUntil函数可用于从设备接收到数据中寻找指定字符串信息。当函数找到了</span></span><br><span class="line"><span class="comment">指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123; </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;                      <span class="comment">// 当串口接收到信息后</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Serial Data Available...&quot;</span>); <span class="comment">// 通过串口监视器通知</span></span><br><span class="line">                                                <span class="comment">// 用户系统开始查找指定信息</span></span><br><span class="line">    Serial.print(<span class="string">&quot;system is trying to find &quot;</span>); Serial.println(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 执行查找并通过串口监视器输出查找结果</span></span><br><span class="line">    <span class="keyword">if</span>(Serial.findUntil(<span class="string">&quot;^_^&quot;</span>, <span class="string">&quot;STOP&quot;</span>)) &#123;</span><br><span class="line">      Serial.print(<span class="string">&quot;Great! System found &quot;</span>); Serial.println(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.print(<span class="string">&quot;Sorry System can&#x27;t find &quot;</span>); Serial.println(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">    &#125;  </span><br><span class="line">    Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相关内容<br>– available<br>– find</p>
<h4 id="peek"><a href="#peek" class="headerlink" title="peek"></a>peek</h4><h5 id="说明-78"><a href="#说明-78" class="headerlink" title="说明"></a>说明</h5><p>peek函数可用于从设备接收到的数据中读取一个字节的数据。但是与read函数不同的是，使用peek函数读取数据后，被读取的数据不会从数据流中消除。这就导致每一次调用peek函数，只能读取数据流中的第一个字符。然而每一次调用read函数读取数据时，被读取的数据都会从数据流中删除。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-78"><a href="#语法-78" class="headerlink" title="语法"></a>语法</h5><p><code>stream.peek()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.peek()</code><br><code>wifiClient.peek()</code></p>
<h5 id="参数-72"><a href="#参数-72" class="headerlink" title="参数"></a>参数</h5><p>target: 被查找字符串。允许使用String或char类型。</p>
<p>terminator: 终止字符串。用于设置终止函数执行的字符串信息。设备在读取数据时一旦读取到此终止字符串，将会结束函数执行并返回。</p>
<h5 id="返回值-73"><a href="#返回值-73" class="headerlink" title="返回值"></a>返回值</h5><p>设备没有接收到数据时，返回值为-1</p>
<p>设备接收到数据时，返回值为接收到的数据流中的第1个字符。</p>
<h5 id="示例程序-66"><a href="#示例程序-66" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_peek</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的peek()。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> (Serial.available())&#123;             <span class="comment">// 当串口接收到信息后</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span> serialData = Serial.peek();      <span class="comment">// 将接收到的信息使用peek读取</span></span><br><span class="line">    Serial.println((<span class="type">char</span>)serialData);     <span class="comment">// 然后通过串口监视器输出peek函数所读取的信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="flush"><a href="#flush" class="headerlink" title="flush"></a>flush</h4><h5 id="说明-79"><a href="#说明-79" class="headerlink" title="说明"></a>说明</h5><p>flush函数可让开发板在所有待发数据发送完毕前，保持等待状态。</p>
<p>请注意：很多人误认为flush函数具有<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/clear-incoming-buffer/">清除开发板接收缓存区</a>的功能。事实上此函数是没有此功能的。如需了解如何清除开发板接收缓存区内信息的方法，请点击这里进入相应说明页面。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<p>为了更好的理解flush函数的作用，我们在这里用Serial.flush()作为示例讲解。</p>
<p>当我们通过Serial.print或Serial.println来发送数据时，被发送的字符数据将会存储于开发板的“发送缓存”中。这么做的原因是开发板串行通讯速率不是很高，如果发送数据较多，发送时间会比较长。</p>
<p>在没有使用flush函数的情况下，开发板不会等待所有“发送缓存”中数据都发送完毕再执行后续的程序内容。也就是说，开发板是在后台发送缓存中的数据。程序运行不受影响。</p>
<p>相反的，在使用了flush函数的情况下，开发板是会等待所有“发送缓存”中数据都发送完毕以后，再执行后续的程序内容。</p>
<h5 id="语法-79"><a href="#语法-79" class="headerlink" title="语法"></a>语法</h5><p><code>stream.flush()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.flush()</code><br><code>wifiClient.flush()</code></p>
<h5 id="参数-73"><a href="#参数-73" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-74"><a href="#返回值-74" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-67"><a href="#示例程序-67" class="headerlink" title="示例程序"></a>示例程序</h5><p>为了演示flush函数工作效果，一共为您准备了两个示例程序。这两个程序一个使用了flush函数另外一个没有使用flush函数。</p>
<p>通过这两个示例程序的运行结果比较，您可以看到flush函数的工作效果。</p>
<p>示例1：没有使用flush函数的情况下，通过串口监视器显示开发板输出一大串字符的运行效果。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_With_flush</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的flush函数。</span></span><br><span class="line"><span class="comment">flush函数可让开发板在所有发送数据全部发送完毕之前，保持等待状态。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">为了演示flush函数工作效果，一共为您准备了两个示例程序。这两个程序一个使用了flush函数</span></span><br><span class="line"><span class="comment">另外一个没有使用flush函数。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">通过这两个示例程序的运行结果比较，您可以看到flush函数的工作效果。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序为没有使用flush函数的情况下，通过串口监视器显示开发板在输出一大串字符的运行效果。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 记录输出串口信息前的millis时间</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> millisNoFlushStart = millis();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口输出信息</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 记录输出串口信息后的millis时间</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> millisNoFlushStop = millis();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出没有使用flush函数情况下，输出信息前后的时间差。</span></span><br><span class="line">  Serial.print(F(<span class="string">&quot;NO flush: &quot;</span>));</span><br><span class="line">  Serial.print( millisNoFlushStop - millisNoFlushStart);</span><br><span class="line">  Serial.println(F(<span class="string">&quot; milliseconds.&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h4 id="parseInt"><a href="#parseInt" class="headerlink" title="parseInt"></a>parseInt</h4><h5 id="说明-80"><a href="#说明-80" class="headerlink" title="说明"></a>说明</h5><p>parseInt函数可用于从设备接收到的数据中寻找整数数值。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-80"><a href="#语法-80" class="headerlink" title="语法"></a>语法</h5><p><code>stream.parseInt()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.parseInt()</code><br><code>wifiClient.parseInt()</code></p>
<h5 id="参数-74"><a href="#参数-74" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-75"><a href="#返回值-75" class="headerlink" title="返回值"></a>返回值</h5><p>在输入信息中找到的整数数值。类型：long</p>
<h5 id="示例程序-68"><a href="#示例程序-68" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_parseInt</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的parseInt。</span></span><br><span class="line"><span class="comment">parseInt函数可用于从设备接收到的数据中寻找整数数值。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;              <span class="comment">// 当串口接收到信息后   </span></span><br><span class="line">    <span class="type">int</span> serialData = Serial.parseInt(); <span class="comment">// 使用parseInt查找接收到的信息中的整数</span></span><br><span class="line">    Serial.print(<span class="string">&quot;serialData = &quot;</span>);      <span class="comment">// 然后通过串口监视器输出找到的数值</span></span><br><span class="line">    Serial.println(serialData);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-21"><a href="#相关内容-21" class="headerlink" title="相关内容"></a>相关内容</h5><p>– available<br>– parseFloat</p>
<h4 id="parseFloat"><a href="#parseFloat" class="headerlink" title="parseFloat"></a>parseFloat</h4><h5 id="说明-81"><a href="#说明-81" class="headerlink" title="说明"></a>说明</h5><p>parseFloat函数可用于从设备接收到的数据中寻找浮点数值。</p>
<p>本函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-81"><a href="#语法-81" class="headerlink" title="语法"></a>语法</h5><p><code>stream.parseFloat()</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.parseFloat()</code><br><code>wifiClient.parseFloat()</code></p>
<h5 id="参数-75"><a href="#参数-75" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-76"><a href="#返回值-76" class="headerlink" title="返回值"></a>返回值</h5><p>在输入信息中找到浮点数值。类型：float</p>
<h5 id="示例程序-69"><a href="#示例程序-69" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_parseFloat</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的parseFloat。</span></span><br><span class="line"><span class="comment">parseFloat函数可用于从设备接收到的数据中寻找整数数值。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">Stream类用于处理字符数据流或二进制数据流。Stream类是不能被直接调用的。</span></span><br><span class="line"><span class="comment">然而当我们使用基于Stream类的库时，都会调用Stream中的内容。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下Arduino库及相应库中的类都是基于Stream类所实现的。</span></span><br><span class="line"><span class="comment"> 库          类</span></span><br><span class="line"><span class="comment">Core        Serial</span></span><br><span class="line"><span class="comment">Wifi        WiFiClient</span></span><br><span class="line"><span class="comment">Ehternet    EthernetClient</span></span><br><span class="line"><span class="comment">ESP8266FS   File</span></span><br><span class="line"><span class="comment">SD          File</span></span><br><span class="line"><span class="comment">Wire        Wire</span></span><br><span class="line"><span class="comment">GSM         GSMClient</span></span><br><span class="line"><span class="comment">SoftwareSerial  SoftwareSerial</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>); </span><br><span class="line">  Serial.println();</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Serial.available())&#123;              <span class="comment">// 当串口接收到信息后   </span></span><br><span class="line">    <span class="type">float</span> serialData = Serial.parseFloat(); <span class="comment">// 使用parseFloat查找接收到的信息中的整数</span></span><br><span class="line">    Serial.print(<span class="string">&quot;serialData = &quot;</span>);      <span class="comment">// 然后通过串口监视器输出找到的数值</span></span><br><span class="line">    Serial.println(serialData);</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-22"><a href="#相关内容-22" class="headerlink" title="相关内容"></a>相关内容</h5><p>– available<br>– parseInt</p>
<h4 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h4><h5 id="说明-82"><a href="#说明-82" class="headerlink" title="说明"></a>说明</h5><p>setTimeout函数用于设置设备等待数据流的最大时间间隔。</p>
<p>当设备在接收数据时，是以字符作为单位来逐个字符执行接收任务。由于设备无法预判即将接收到的信息包含有多少字符，因此设备会设置一个等待时间。默认情况下，该等待时间是1000毫秒。</p>
<p>举例来说，假设我们要向设备发送一个字符串“ok”。那么设备在接收到第一个字符“o”以后，他会等待第二个字符的到达。假如在1000毫秒内，设备接收到第二个字符“k”，那么设备会重置等待时间，也就是再等待1000毫秒，看一看字符“k”后面还有没有字符到达。我们知道我们发给设备的字符串只有两个字符，后面没有更多字符了。但是设备并不知道这一情况。因此设备在接收到“k”以后，会等待1000毫秒。直到1000毫秒等待时间结束都没有再次接到字符。这时，设备才会很肯定地结束这一次接收工作。这里这个等待的1000毫秒时间就是通过setTimeout函数来设置的。</p>
<p>setTimeout函数属于Stream类。该函数可被Stream类的子类所使用，如（Serial, WiFiClient, File 等）。</p>
<h5 id="语法-82"><a href="#语法-82" class="headerlink" title="语法"></a>语法</h5><p><code>stream.setTimeout(time)</code><br>注：此处stream为概念对象名称。在实际使用过程中，需要根据实际使用的stream子类对象名称进行替换。如：<br><code>Serial.setTimeout(time)</code><br><code>wifiClient.setTimeout(time)</code></p>
<h5 id="参数-76"><a href="#参数-76" class="headerlink" title="参数"></a>参数</h5><p>time: 设置最大等待时间。单位：毫秒。允许类型：long</p>
<h5 id="返回值-77"><a href="#返回值-77" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-70"><a href="#示例程序-70" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_setTimeout</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序使用Serial来演示Stream类中的setTimeout。</span></span><br><span class="line"><span class="comment">setTimeout函数用于设置设备等待数据流的最大时间间隔。</span></span><br><span class="line"><span class="comment">默认情况下，该等待时间是1000毫秒。 </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.setTimeout(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (Serial.available()) &#123;				</span><br><span class="line">    String s = Serial.readString();</span><br><span class="line">    Serial.println(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-23"><a href="#相关内容-23" class="headerlink" title="相关内容"></a>相关内容</h5><p>– available</p>
<h4 id="清除接收缓存"><a href="#清除接收缓存" class="headerlink" title="清除接收缓存"></a>清除接收缓存</h4><h5 id="说明-83"><a href="#说明-83" class="headerlink" title="说明"></a>说明</h5><p>此页面用于演示如何清除开发板的接收缓存。</p>
<p>制作此说明页面是由于很多人误认为stream类中的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/flush/">flush</a>函数具有清除缓存的功能。事实上此函数是没有清除缓存功能的。</p>
<p>为了便于理解，我们在这里用Serial作为示例，演示如何清除串口接收缓存中的信息。</p>
<h5 id="示例程序-71"><a href="#示例程序-71" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : stream_clear_buffer</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : CYNO朔</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200318</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 以下while循环语句将会清除接收缓存内容。</span></span><br><span class="line">  <span class="comment">// 具体工作原理是这样的。每当有数据输入接收缓存后，</span></span><br><span class="line">  <span class="comment">// 我们可以使用Serial.read()来读取接收缓存中的内容。</span></span><br><span class="line">  <span class="comment">// 这时，如果我们对Serial.read()函数的返回值不加以任何利用</span></span><br><span class="line">  <span class="comment">// 那么读取到的数据，也就是Serial.read()函数的返回值将会在</span></span><br><span class="line">  <span class="comment">// 下一次执行Serial.read时所抛弃。利用while循环语句，我们可以</span></span><br><span class="line">  <span class="comment">// 保证在接收缓存中有数据的时候，反复将串口接收缓存中的信息读取并抛弃。</span></span><br><span class="line">  <span class="comment">// 从而达到清除接收缓存的目的。</span></span><br><span class="line">  <span class="keyword">while</span>(Serial.available())&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Clearing Serial Incoming Buffer.&quot;</span>);</span><br><span class="line">    Serial.read();</span><br><span class="line">  &#125; </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当接收缓存为空时，Serial.read返回值为“-1”</span></span><br><span class="line">  <span class="comment">// 通过以下语句我们将看到无论我们是否通过串口监视器</span></span><br><span class="line">  <span class="comment">// 输入信息，开发板的串口监视器会一直输出:</span></span><br><span class="line">  <span class="comment">// &quot;Incoming Buffer is Clear.&quot;</span></span><br><span class="line">  <span class="comment">// 这是因为接收缓存中的信息被以上while语句中的内容给清除掉了。</span></span><br><span class="line">  <span class="keyword">if</span> (Serial.read() == <span class="number">-1</span>)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Incoming Buffer is Clear.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>











<h2 id="ESP8266-–-WiFiServer库"><a href="#ESP8266-–-WiFiServer库" class="headerlink" title="ESP8266 – WiFiServer库"></a>ESP8266 – WiFiServer库</h2><p>WiFiServer库用于ESP8266的TCP协议物联网通讯。TCP协议又称传输控制协议是Transmission Control Protocol的简称。如需了解更多有关TCP协议介绍，请<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/TCP/33012">点击这里查看TCP协议的百度百科介绍页</a>。</p>
<p>通过WiFiServer库，我们可以使用ESP8266开发板建立网络服务器,从而允许其它网络设备以及物联网设备通过TCP协议访问并实现物联网信息交流。</p>
<p>ESP8266库中还有一个专门用于HTTP通讯的<code>ESP8266WebServer</code>库 。</p>
<p>由于HTTP协议是建立在TCP协议基础之上的，我们也可以使用ESP8266WebServer库来实现HTTP通讯。在这一点上，WiFiServer库与ESP8266WebServer库 在功能上形成了互补。</p>
<p><strong>请留意，WiFiServer对象在处理或发送网络数据时，可以通过调用<code>Stream类</code>中的函数来实现。因此在以下结构图中的“响应信息操作类型”中有“Stream类”作为这种类型函数的一部分。</strong></p>
<p>以下为WiFiServer库的整体结构图。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230526202509292.png" alt="image-20230526202509292"></p>
<h3 id="服务器设置类型"><a href="#服务器设置类型" class="headerlink" title="服务器设置类型"></a>服务器设置类型</h3><h4 id="WiFiServer-–-建立新的WiFiServer对象"><a href="#WiFiServer-–-建立新的WiFiServer对象" class="headerlink" title="WiFiServer – 建立新的WiFiServer对象"></a>WiFiServer – 建立新的WiFiServer对象</h4><h5 id="说明-84"><a href="#说明-84" class="headerlink" title="说明"></a>说明</h5><p>此函数用于建立新的WiFiServer对象，以便利用此对象来控制ESP8266建立的物联网服务器。</p>
<h5 id="语法-83"><a href="#语法-83" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFiServer server(port)</span><br></pre></td></tr></table></figure>

<h5 id="参数-77"><a href="#参数-77" class="headerlink" title="参数"></a>参数</h5><p>– port: 此参数用于设置服务端口号。(类型:int)</p>
<h5 id="返回值-78"><a href="#返回值-78" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-72"><a href="#示例程序-72" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>假设您的ESP8266开发板IP地址是192.168.0.110。那么接下来您可以通过浏览器输入该IP地址。</p>
<p>当您在浏览器地址栏中输入Ip后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。在以下的示例程序中，我们使用了语句<code>WiFiServer server(80);</code>来建立了WiFiServer对象以便后续程序中对服务器进行相应的控制。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WIFIServer_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此示例程序演示了如何使用WiFiServer库建立网络服务器。</span></span><br><span class="line"><span class="comment">通过以下网址可以设置板载LED灯的状态</span></span><br><span class="line"><span class="comment">http://server_ip/gpio/0将设置 LED_BUILTIN 引脚设置为低电平，</span></span><br><span class="line"><span class="comment">http://server_ip/gpio/1将设置 LED_BUILTIN 引脚设置为高电平</span></span><br><span class="line"><span class="comment">以上网址链接中的server_ip指的是ESP8266模块的IP地址。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//此处设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;Taichi-Maker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">  Serial.println(req);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//解析请求里是否含有以下指定内容</span></span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/0&quot;</span></span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/1&quot;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">    val = digitalRead(LED_BUILTIN);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">  <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">    client.read();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">  client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">  client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">  client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯  &lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯  &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="相关内容-24"><a href="#相关内容-24" class="headerlink" title="相关内容"></a>相关内容</h5><p>— begin – 服务器启动<br>— stop – 停止服务器<br>— close – 停止服务器</p>
<h4 id="begin-–-服务器启动"><a href="#begin-–-服务器启动" class="headerlink" title="begin – 服务器启动"></a>begin – 服务器启动</h4><h5 id="说明-85"><a href="#说明-85" class="headerlink" title="说明"></a>说明</h5><p>本函数用于启动ESP8266开发板所建立的物联网网络服务器。</p>
<h5 id="语法-84"><a href="#语法-84" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.begin()</span><br></pre></td></tr></table></figure>

<h5 id="参数-78"><a href="#参数-78" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-79"><a href="#返回值-79" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-73"><a href="#示例程序-73" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WIFIServer_demo_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此示例程序演示了如何使用WiFiServer库建立网络服务器。</span></span><br><span class="line"><span class="comment">通过以下网址可以设置板载LED灯的状态</span></span><br><span class="line"><span class="comment">http://server_ip/gpio/0将设置 LED_BUILTIN 引脚设置为低电平，</span></span><br><span class="line"><span class="comment">http://server_ip/gpio/1将设置 LED_BUILTIN 引脚设置为高电平</span></span><br><span class="line"><span class="comment">以上网址链接中的server_ip指的是ESP8266模块的IP地址。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//此处设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;Taichi-Maker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">  Serial.println(req);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//解析请求里是否含有以下指定内容</span></span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/0&quot;</span></span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/1&quot;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">    val = digitalRead(LED_BUILTIN);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">  <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">    client.read();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">  client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">  client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">  client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯  &lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯  &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h4 id="setNoDelay-–-停止小包合并发送"><a href="#setNoDelay-–-停止小包合并发送" class="headerlink" title="setNoDelay – 停止小包合并发送"></a>setNoDelay – 停止小包合并发送</h4><h5 id="说明-86"><a href="#说明-86" class="headerlink" title="说明"></a>说明</h5><p>此函数用于设置ESP8266服务器是否使用Nagle算法来将发送的信息先拆分成小包再发送。</p>
<p>使用Nagle算法来拆包发送的优点是可以将较大的数据信息拆分，从而让信息传输的网络利用率更加优化。但缺点是比起不拆包发送的模式来说，拆包发送的速度要慢一些。</p>
<h5 id="语法-85"><a href="#语法-85" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.setNoDelay(val)</span><br></pre></td></tr></table></figure>

<h5 id="参数-79"><a href="#参数-79" class="headerlink" title="参数"></a>参数</h5><p>val: 此参数类型为bool。以下是参数功能说明。</p>
<ul>
<li>– true: 不使用Nagle算法来将发送的信息先拆分成小包再发送。</li>
<li>– false: 使用Nagle算法来将发送的信息先拆分成小包再发送。</li>
</ul>
<h5 id="返回值-80"><a href="#返回值-80" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-74"><a href="#示例程序-74" class="headerlink" title="示例程序"></a>示例程序</h5><p>在以下的示例程序中，我们使用了语句<code>server.setNoDelay(true);</code>将发送的信息先拆分成小包再发送。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WIFIServer_demo_2</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此示例程序演示了如何使用WiFiServer库建立网络服务器。</span></span><br><span class="line"><span class="comment">  通过以下网址可以设置板载LED灯的状态</span></span><br><span class="line"><span class="comment">  http://server_ip/gpio/0将设置 LED_BUILTIN 引脚设置为低电平，</span></span><br><span class="line"><span class="comment">  http://server_ip/gpio/1将设置 LED_BUILTIN 引脚设置为高电平</span></span><br><span class="line"><span class="comment">  以上网址链接中的server_ip指的是ESP8266模块的IP地址。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//此处设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;z&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;18xxxxxx52&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//停止小包合并发送</span></span><br><span class="line">  server.setNoDelay(<span class="literal">true</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//打印TCP server状态码</span></span><br><span class="line">  Serial.print(F(<span class="string">&quot;server.status :&quot;</span>));</span><br><span class="line">  Serial.println(server.status());</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印TCP server状态码</span></span><br><span class="line">  Serial.print(F(<span class="string">&quot;server.status :&quot;</span>));</span><br><span class="line">  Serial.println(server.status());</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">  Serial.println(req);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//解析请求里是否含有以下指定内容</span></span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/0&quot;</span></span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/1&quot;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">    val = digitalRead(LED_BUILTIN);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">  <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">    client.read();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">  client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">  client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">  client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯  &lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯  &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="stop-–-停止服务器"><a href="#stop-–-停止服务器" class="headerlink" title="stop – 停止服务器"></a>stop – 停止服务器</h4><h5 id="说明-87"><a href="#说明-87" class="headerlink" title="说明"></a>说明</h5><p>本函数用于停止ESP8266开发板所建立的网络服务器。</p>
<p>注: stop函数和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiserver/close/">close</a>函数功能相同。</p>
<h5 id="语法-86"><a href="#语法-86" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.stop()</span><br></pre></td></tr></table></figure>

<h5 id="参数-80"><a href="#参数-80" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-81"><a href="#返回值-81" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-75"><a href="#示例程序-75" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WIFIServer_demo_3_stop</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此示例程序演示了如何使用WiFiServer库建立网络服务器。服务器将根据浏览器请求设置板载LED灯的状态;</span></span><br><span class="line"><span class="comment">http://server_ip/gpio/0将设置 LED_BUILTIN 拉低，http://server_ip/gpio/1将设置 LED_BUILTIN 拉高</span></span><br><span class="line"><span class="comment">以上网址链接中的server_ip是ESP8266模块的IP地址，连接WiFi成功后将自动将ip打印在串口;</span></span><br><span class="line"><span class="comment">在浏览器点击“关闭LED”3次之后关闭tcp server服务器。我们是通过以下程序中的server.stop()实现这一功能的。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;taichimaker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> server_stop_switch = <span class="number">0</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">  Serial.println(req);</span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//通过浏览器请求控制LED</span></span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">    server_stop_switch++;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">    val = digitalRead(LED_BUILTIN);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">  <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">    client.read();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">  client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">  client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">  client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯（关灯3次后将会关闭服务器）&lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯 &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//  如果 server_stop_switch &gt;= 3 时则关闭TCP server</span></span><br><span class="line">  <span class="keyword">if</span> (server_stop_switch &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;TCP server turn off &quot;</span>));</span><br><span class="line">    server.stop();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="close-–-停止服务器"><a href="#close-–-停止服务器" class="headerlink" title="close – 停止服务器"></a>close – 停止服务器</h4><h5 id="说明-88"><a href="#说明-88" class="headerlink" title="说明"></a>说明</h5><p>本函数用于停止ESP8266开发板所建立的网络服务器。</p>
<p>注: close函数和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiserver/stop/">stop</a>函数功能相同。</p>
<h5 id="语法-87"><a href="#语法-87" class="headerlink" title="语法"></a>语法</h5><p><code>server.close()</code></p>
<h5 id="参数-81"><a href="#参数-81" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-82"><a href="#返回值-82" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-76"><a href="#示例程序-76" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WIFIServer_demo_3_close</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此示例程序演示了如何使用WiFiServer库建立网络服务器。服务器将根据浏览器请求设置板载LED灯的状态;</span></span><br><span class="line"><span class="comment">http://server_ip/gpio/0将设置 LED_BUILTIN 拉低，http://server_ip/gpio/1将设置 LED_BUILTIN 拉高</span></span><br><span class="line"><span class="comment">以上网址链接中的server_ip是ESP8266模块的IP地址，连接WiFi成功后将自动将ip打印在串口;</span></span><br><span class="line"><span class="comment">在浏览器点击“关闭LED”3次之后关闭tcp server服务器。我们是通过以下程序中的server.close()实现这一功能的。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;taichimaker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> server_stop_switch = <span class="number">0</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">  Serial.println(req);</span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//通过浏览器请求控制LED</span></span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">    server_stop_switch++;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">    val = digitalRead(LED_BUILTIN);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">  <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">    client.read();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">  client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">  client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">  client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯（关灯3次后将会关闭服务器）&lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯 &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//  如果 server_stop_switch &gt;= 3 时则关闭TCP server</span></span><br><span class="line">  <span class="keyword">if</span> (server_stop_switch &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;TCP server turn off &quot;</span>));</span><br><span class="line">    server.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h3 id="服务器信息类型"><a href="#服务器信息类型" class="headerlink" title="服务器信息类型"></a>服务器信息类型</h3><h4 id="status-–-获取服务器运行状态"><a href="#status-–-获取服务器运行状态" class="headerlink" title="status – 获取服务器运行状态"></a>status – 获取服务器运行状态</h4><h5 id="说明-89"><a href="#说明-89" class="headerlink" title="说明"></a>说明</h5><p>此函数用于获取ESP8266服务器的工作状态。工作状态信息将以”状态值”形式返回。</p>
<p>如需了解具体状态信息内容，请参考本页面的返回值部分。</p>
<h5 id="语法-88"><a href="#语法-88" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.status()</span><br></pre></td></tr></table></figure>

<h5 id="参数-82"><a href="#参数-82" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-83"><a href="#返回值-83" class="headerlink" title="返回值"></a>返回值</h5><p>服务器状态值(类型：uint8_t)。以下是状态值所对应的数值说明。</p>
<ul>
<li>CLOSED &#x3D; 0 （关闭连接）</li>
<li>LISTEN &#x3D; 1 （监听）</li>
<li>SYN_SENT &#x3D; 2</li>
<li>SYN_RCVD &#x3D; 3</li>
<li>ESTABLISHED &#x3D; 4 （建立连接）</li>
<li>FIN_WAIT_1 &#x3D; 5</li>
<li>FIN_WAIT_2 &#x3D; 6</li>
<li>CLOSE_WAIT &#x3D; 7 （关闭连接等待）</li>
<li>CLOSING &#x3D; 8 （关闭连接中）</li>
<li>LAST_ACK &#x3D; 9</li>
<li>TIME_WAIT &#x3D; 10</li>
</ul>
<h5 id="示例程序-77"><a href="#示例程序-77" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WIFIServer_demo_4</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此示例程序演示了如何使用WiFiServer库建立网络服务器。通过以下网址可以设置板载LED灯的状态</span></span><br><span class="line"><span class="comment">  http://server_ip/gpio/0将设置 LED_BUILTIN 引脚设置为低电平，</span></span><br><span class="line"><span class="comment">  http://server_ip/gpio/1将设置 LED_BUILTIN 引脚设置为高电平</span></span><br><span class="line"><span class="comment">  以上网址链接中的server_ip指的是ESP8266模块的IP地址。</span></span><br><span class="line"><span class="comment">  在程序运行中同时会将ESP8266的状态码通过串口监视器显示。我们使用了server.status来获取这一信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//此处设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;taichimaker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印TCP server状态码</span></span><br><span class="line">  Serial.print(F(<span class="string">&quot;server.status :&quot;</span>));</span><br><span class="line">  Serial.println(server.status());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印TCP server状态码</span></span><br><span class="line">  Serial.print(F(<span class="string">&quot;server.status :&quot;</span>));</span><br><span class="line">  Serial.println(server.status());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">  Serial.println(req);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//解析请求里是否含有以下指定内容</span></span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/0&quot;</span></span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/1&quot;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">    val = digitalRead(LED_BUILTIN);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">  <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">    client.read();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">  client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">  client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">  client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯  &lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">  client.print(WiFi.localIP());</span><br><span class="line">  client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯  &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">  Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="hasClient-–-判断是否有客户端访问"><a href="#hasClient-–-判断是否有客户端访问" class="headerlink" title="hasClient – 判断是否有客户端访问"></a>hasClient – 判断是否有客户端访问</h4><h5 id="说明-90"><a href="#说明-90" class="headerlink" title="说明"></a>说明</h5><p>本函数用于检查是否有客户端访问ESP8266开发板所建立的网络服务器。</p>
<h5 id="语法-89"><a href="#语法-89" class="headerlink" title="语法"></a>语法</h5><p><code>server.hasClient()</code></p>
<h5 id="参数-83"><a href="#参数-83" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-84"><a href="#返回值-84" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为bool。当检查到有客户端访问ESP8266开发板所建立的网络服务器，则返回true，否则返回false。</p>
<h5 id="示例程序-78"><a href="#示例程序-78" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WIFIServer_demo_5</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此示例程序演示了如何使用WiFiServer库建立网络服务器。通过以下网址可以设置板载LED灯的状态</span></span><br><span class="line"><span class="comment">  http://server_ip/gpio/0将设置 LED_BUILTIN 引脚设置为低电平，</span></span><br><span class="line"><span class="comment">  http://server_ip/gpio/1将设置 LED_BUILTIN 引脚设置为高电平</span></span><br><span class="line"><span class="comment">  以上网址链接中的server_ip指的是ESP8266模块的IP地址。</span></span><br><span class="line"><span class="comment">  本程序使用了server.hasClient函数来判断是否有客户端与服务器产生连接。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//此处设置您的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;taichimaker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建TCP server对象,并将端口指定为80</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打开串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化板载LED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Connecting to &quot;</span>));</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(F(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;WiFi connected&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动TCP server服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(F(<span class="string">&quot;Server started&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//停止小包合并发送,停止之后,消息会直接发送,不会延时</span></span><br><span class="line">  server.setNoDelay(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印TCP server状态码</span></span><br><span class="line">  Serial.print(F(<span class="string">&quot;server.status :&quot;</span>));</span><br><span class="line">  Serial.println(server.status());</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  <span class="comment">//打印IP地址</span></span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//使用server.hasClient()来确保有效的TCP连接</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasClient()) &#123;</span><br><span class="line">    <span class="comment">//检查客户端是否已连接</span></span><br><span class="line">    WiFiClient client = server.available();</span><br><span class="line">    <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Serial.println(F(<span class="string">&quot;new client&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    client.setTimeout(<span class="number">5000</span>); <span class="comment">//默认为 1000</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//打印TCP server状态码</span></span><br><span class="line">    Serial.print(F(<span class="string">&quot;server.status :&quot;</span>));</span><br><span class="line">    Serial.println(server.status());</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//读取客户端发起的TCP请求</span></span><br><span class="line">    String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">    Serial.println(F(<span class="string">&quot;request: &quot;</span>));</span><br><span class="line">    Serial.println(req);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//解析请求里是否含有以下指定内容</span></span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/0&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/0&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">      val = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//检查发起的请求内容是否包含&quot;/gpio/1&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(F(<span class="string">&quot;/gpio/1&quot;</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">      val = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.println(F(<span class="string">&quot;invalid request&quot;</span>));</span><br><span class="line">      val = digitalRead(LED_BUILTIN);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//根据要求设置板载LED状态</span></span><br><span class="line">    digitalWrite(LED_BUILTIN, val);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//读取剩余的内容,用于清除缓存</span></span><br><span class="line">    <span class="keyword">while</span> (client.available()) &#123;</span><br><span class="line">      client.read();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//将响应体发送到客户端 注:若要使用中文则必须在其中添加&lt;meta charset=\&quot;utf-8\&quot;&gt;声明编码</span></span><br><span class="line">    client.print(F(<span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\n&lt;meta charset=\&quot;utf-8\&quot;&gt;NodeMCU板载LED灯的状态 : &quot;</span>));</span><br><span class="line">    client.print((val) ? F(<span class="string">&quot;关&quot;</span>) : F(<span class="string">&quot;开&quot;</span>));</span><br><span class="line">    client.print(F(<span class="string">&quot;&lt;br&gt;&lt;br&gt; &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">    client.print(WiFi.localIP());</span><br><span class="line">    client.print(F(<span class="string">&quot;/gpio/1&#x27;&gt;  点击关灯  &lt;/a&gt; , 或  &lt;a href=&#x27;http://&quot;</span>));</span><br><span class="line">    client.print(WiFi.localIP());</span><br><span class="line">    client.print(F(<span class="string">&quot;/gpio/0&#x27;&gt;  点击开灯  &lt;/a&gt; &lt;/html&gt;&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//通过浏览器点击按钮之后,TCP连接将会被重置,并且浏览器会发起新的TCP请求到我们的8266服务器,从而去控制LED灯</span></span><br><span class="line">    Serial.println(F(<span class="string">&quot;Disconnecting from client&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ESP8266-–-ESP8266HTTPClient库"><a href="#ESP8266-–-ESP8266HTTPClient库" class="headerlink" title="ESP8266 – ESP8266HTTPClient库"></a>ESP8266 – ESP8266HTTPClient库</h2><p>ESP8266HTTPClient库用于HTTP协议通讯。通过ESP8266HTTPClient库，我们可以使用ESP8266利用互联网或局域网向网络服务器发送HTTP请求，并且分析网络服务器返回的HTTP响应信息，从而实现物联网应用。</p>
<p>ESP8266库中还有一个专门用于TCP通讯的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/">WiFiClient库</a>。由于HTTP协议是建立在TCP协议基础之上的，我们也可以使用WiFiClient库来实现HTTP通讯。在这一点上，ESP8266HTTPClient库与WiFiClient库在功能上形成了互补。</p>
<p>以下为ESP8266HTTPClient库的整体结构图。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230526215740740.png" alt="image-20230526215740740"></p>
<h3 id="请求类型"><a href="#请求类型" class="headerlink" title="请求类型"></a>请求类型</h3><h4 id="请求信息类型"><a href="#请求信息类型" class="headerlink" title="请求信息类型"></a>请求信息类型</h4><h5 id="begin-–-设置请求URL"><a href="#begin-–-设置请求URL" class="headerlink" title="begin – 设置请求URL"></a>begin – 设置请求URL</h5><h6 id="说明-91"><a href="#说明-91" class="headerlink" title="说明"></a>说明</h6><p>物联网应用中，我们经常使用ESP8266通过HTTP协议向网络服务器发送HTTP请求。本函数用于设置ESP8266发送HTTP请求的目标URL。</p>
<h6 id="语法-90"><a href="#语法-90" class="headerlink" title="语法"></a>语法</h6><p><code>httpClient.begin(url)</code><br><code>httpClient.begin(url, port)</code></p>
<h6 id="参数-84"><a href="#参数-84" class="headerlink" title="参数"></a>参数</h6><p>url: HTTP请求网址<br>port: HTTP请求的网络服务器端口 (此参数为可选参数，默认为端口80)</p>
<h6 id="返回值-85"><a href="#返回值-85" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-79"><a href="#示例程序-79" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_begin</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-25"><a href="#相关内容-25" class="headerlink" title="相关内容"></a>相关内容</h6><p>— GET<br>— end – 结束请求</p>
<h5 id="setReuse-–-设置请求头中的keep-alive"><a href="#setReuse-–-设置请求头中的keep-alive" class="headerlink" title="setReuse – 设置请求头中的keep-alive"></a>setReuse – 设置请求头中的keep-alive</h5><h6 id="说明-92"><a href="#说明-92" class="headerlink" title="说明"></a>说明</h6><p>此函数用于设置ESP8266开发板在通过HTTP发送请求时，请求头中的keep-alive是否为”true”。</p>
<p>HTTP keep-alive 也称为 HTTP 长连接。它通过重用一个 TCP 连接来发送&#x2F;接收多个 HTTP请求，来减少创建&#x2F;关闭多个 TCP 连接的开销。</p>
<p>如果设置 keep-alive为true，则服务端在返回 response 后不关闭 TCP 连接；同样的，在接收完响应报文后，客户端也不关闭连接，发送下一个 HTTP 请求时会重用该连接。</p>
<h6 id="语法-91"><a href="#语法-91" class="headerlink" title="语法"></a>语法</h6><p><code>httpClient.setReuse（true）</code><br><code>httpClient.setReuse（false）</code></p>
<h6 id="参数-85"><a href="#参数-85" class="headerlink" title="参数"></a>参数</h6><p>返回值类型为布尔型。返回值的简要说明如下：<br>true: 启用请求头中的keep-alive<br>false: 禁用请求头中的keep-alive</p>
<h6 id="返回值-86"><a href="#返回值-86" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-80"><a href="#示例程序-80" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_setReuse</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">  程序使用了setReuse函数来设置请求头中的keep-alive。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置请求头中的keep-alive</span></span><br><span class="line">  httpClient.setReuse(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-26"><a href="#相关内容-26" class="headerlink" title="相关内容"></a>相关内容</h6><p>— begin – 设置请求URL<br>— setUserAgent – 设置请求头中的User-Agent<br>— setAuthorization – 设置请求头中的Authorization<br>— addHeader – 请求头中添加自定义信息<br>— useHTTP10 – 设置http协议版本</p>
<h5 id="setUserAgent-–-设置请求头中的User-Agent"><a href="#setUserAgent-–-设置请求头中的User-Agent" class="headerlink" title="setUserAgent – 设置请求头中的User-Agent"></a>setUserAgent – 设置请求头中的User-Agent</h5><h6 id="说明-93"><a href="#说明-93" class="headerlink" title="说明"></a>说明</h6><p>ESP8266开发板在通过HTTP发送请求时，我们可以使用此函数设置请求头的User-Agent内容。</p>
<p>User Agent请求头的作用是让服务器能够识别客户端使用的操作系统及版本、客户端设备的CPU类型、浏览器名称和版本、浏览器所用的语言、浏览器所用的插件等。换句话说,就是告诉服务端现在是什么设备在访问服务器。</p>
<h6 id="语法-92"><a href="#语法-92" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.setUserAgent（device_info）</span><br></pre></td></tr></table></figure>

<h6 id="参数-86"><a href="#参数-86" class="headerlink" title="参数"></a>参数</h6><p>– device_info : 用户自定义的客户端标识<br>– 参数类型: 字符串 或 const char *</p>
<h6 id="返回值-87"><a href="#返回值-87" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-81"><a href="#示例程序-81" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: 192.168.0.110</span><br><span class="line">User-Agent: ESP8266</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: identity;q=1,chunked;q=0.1,*;q=0</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure>

<p>其中<code>User-Agent: ESP8266</code>部分即是通过以下程序中的<code>httpClient.setUserAgent(&quot;ESP8266&quot;);</code>来实现的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_setReuse</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">  程序使用了setUserAgent函数来设置请求头中的客户端信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置请求头中的User-Agent</span></span><br><span class="line">  httpClient.setUserAgent(<span class="string">&quot;ESP8266&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-27"><a href="#相关内容-27" class="headerlink" title="相关内容"></a>相关内容</h6><p>— begin – 设置请求URL<br>— setReuse – 设置请求头中的keep-alive<br>— setAuthorization – 设置请求头中的Authorization<br>— addHeader – 请求头中添加自定义信息<br>— useHTTP10 – 设置http协议版本</p>
<h5 id="setAuthorization-–-设置请求头中的Authorization"><a href="#setAuthorization-–-设置请求头中的Authorization" class="headerlink" title="setAuthorization – 设置请求头中的Authorization"></a>setAuthorization – 设置请求头中的Authorization</h5><h6 id="说明-94"><a href="#说明-94" class="headerlink" title="说明"></a>说明</h6><p>此函数用于设置ESP8266开发板在通过HTTP发送请求时，设置请求头中的Authorization部分。</p>
<h6 id="语法-93"><a href="#语法-93" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.setAuthorization(user,password)</span><br></pre></td></tr></table></figure>

<h6 id="参数-87"><a href="#参数-87" class="headerlink" title="参数"></a>参数</h6><p>user: 设备进行访问的用户名请求头信息</p>
<p>password: 设备进行访问的密码请求头信息</p>
<h6 id="返回值-88"><a href="#返回值-88" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-82"><a href="#示例程序-82" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: www.example.com</span><br><span class="line">User-Agent: ESP8266HTTPClient</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: identity;q=1,chunked;q=0.1,*;q=0</span><br><span class="line">Authorization: Basic VGFpY2hpTWFrZXI6MTIzNDU2Nzg=</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure>

<p>其中<code>Authorization: Basic VGFpY2hpTWFrZXI6MTIzNDU2Nzg=</code>部分即是通过以下程序中的<code>httpClient.setUserAgent(“TaichiMaker”, &quot;12345678&quot;);</code>来实现的。(<a target="_blank" rel="noopener" href="http://www.example.com网站不需要认证即可访问,此示例程序仅仅是为了演示如何使用setuseragent./">www.example.com网站不需要认证即可访问，此示例程序仅仅是为了演示如何使用setUserAgent。</a>)</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_setReuse</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">  程序使用了setUserAgent函数来将ESP8266发送的HTTP请求头中Authorization部分</span></span><br><span class="line"><span class="comment">  的user信息设置为&quot;TaichiMaker&quot;，password部分设置为&quot;12345678&quot;。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置请求头中的Authorization信息</span></span><br><span class="line">  httpClient.setAuthorization(<span class="string">&quot;TaichiMaker&quot;</span>, <span class="string">&quot;12345678&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-28"><a href="#相关内容-28" class="headerlink" title="相关内容"></a>相关内容</h6><p>— begin – 设置请求URL<br>— setReuse – 设置请求头中的keep-alive<br>— setUserAgent – 设置请求头中的User-Agent<br>— addHeader – 请求头中添加自定义信息<br>— useHTTP10 – 设置http协议版本</p>
<h5 id="addHeader-–-请求头中添加自定义信息"><a href="#addHeader-–-请求头中添加自定义信息" class="headerlink" title="addHeader – 请求头中添加自定义信息"></a>addHeader – 请求头中添加自定义信息</h5><h6 id="说明-95"><a href="#说明-95" class="headerlink" title="说明"></a>说明</h6><p>使用此函数，我们可以ESP8266开发板发起HTTP请求的时候,添加自定义的请求头信息。</p>
<h6 id="语法-94"><a href="#语法-94" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http.addHeader(name,value)</span><br></pre></td></tr></table></figure>

<h6 id="参数-88"><a href="#参数-88" class="headerlink" title="参数"></a>参数</h6><p>name: 自定义请求头名称 (类型：String 或 const char *)<br>value: 自定义请求头参数值 (类型：String 或 const char *)</p>
<p><strong>注：自定义请求头不能使用Connection、User-Agent、Host、Authorization等标准请求头名称。</strong></p>
<h6 id="返回值-89"><a href="#返回值-89" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-83"><a href="#示例程序-83" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: www.example.com</span><br><span class="line">User-Agent: ESP8266HTTPClient</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: identity;q=<span class="number">1</span>,chunked;q=<span class="number">0.1</span>,*;q=<span class="number">0</span></span><br><span class="line">Device: ESP8266</span><br><span class="line">Content-Length: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>其中<code>Device: ESP8266</code>部分即是通过以下程序中的<code>httpClient.addHeader(&quot;Device&quot;, &quot;ESP8266&quot;);</code>来实现的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_addHeader</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">  程序使用了addHeader函数来将ESP8266发送的HTTP请求头中假如自定义信息</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置请求头中自定义信息</span></span><br><span class="line">  httpClient.addHeader(<span class="string">&quot;Device&quot;</span>, <span class="string">&quot;ESP8266&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-29"><a href="#相关内容-29" class="headerlink" title="相关内容"></a>相关内容</h6><p>— begin – 设置请求URL<br>— setReuse – 设置请求头中的keep-alive<br>— setUserAgent – 设置请求头中的User-Agent<br>— setAuthorization – 设置请求头中的Authorization<br>— useHTTP10 – 设置http协议版本</p>
<h5 id="useHTTP10-–-设置http协议版本"><a href="#useHTTP10-–-设置http协议版本" class="headerlink" title="useHTTP10 – 设置http协议版本"></a>useHTTP10 – 设置http协议版本</h5><h6 id="说明-96"><a href="#说明-96" class="headerlink" title="说明"></a>说明</h6><p>此函数用于设置ESP8266开发板在通过HTTP发送请求时使用的HTTP协议版本。</p>
<h6 id="语法-95"><a href="#语法-95" class="headerlink" title="语法"></a>语法</h6><p><code>http.useHTTP10(val)</code></p>
<h6 id="参数-89"><a href="#参数-89" class="headerlink" title="参数"></a>参数</h6><p>val: 控制HTTTP版本。默认情况下，设备时使用HTTTP 1.1 版本。当此参数为true时，则使用HTTTP 1.0版本。false时，使用HTTTP 1.1版本。（参数类型：bool）</p>
<h6 id="返回值-90"><a href="#返回值-90" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-84"><a href="#示例程序-84" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.0</span></span><br><span class="line">Host: www.example.com</span><br><span class="line">User-Agent: ESP8266HTTPClient</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>其中<code>GET / HTTP/1.0</code>部分即是通过以下程序中的<code>httpClient.useHTTP10(true);</code>来实现的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_http10</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">  程序使用了useHTTP10函数来将ESP8266发送的HTTP请求版本设置为1.0版本</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//使用http1.0</span></span><br><span class="line">  httpClient.useHTTP10(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="请求方法类型"><a href="#请求方法类型" class="headerlink" title="请求方法类型"></a>请求方法类型</h4><h5 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h5><h6 id="说明-97"><a href="#说明-97" class="headerlink" title="说明"></a>说明</h6><p>此函数用于ESP8266使用HTTP协议通过网络向服务器发送GET请求。</p>
<p>客户端与服务器通讯时最常被用到的方法是：GET 和 <a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/post/">POST</a>。<br>– GET – 从指定的资源请求数据。<br>– POST – 向指定的资源提交要被处理的数据</p>
<h6 id="语法-96"><a href="#语法-96" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http.GET()</span><br></pre></td></tr></table></figure>

<h6 id="参数-90"><a href="#参数-90" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-91"><a href="#返回值-91" class="headerlink" title="返回值"></a>返回值</h6><p>服务器状态码（返回值类型：int类型）</p>
<p>以下是常见的HTTP状态码（以下括号中内容为ESP8266HTTPClient库声明定义的HTTP状态码替代文字，具体内容可参考<a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266HTTPClient/src/ESP8266HTTPClient.h">ESP8266库ESP8266HTTPClient.h文件中相应内容</a>）：<br>– 200: 请求成功 （HTTP_CODE_OK）<br>– 301: 资源（网页等）被永久转移到其它URL (HTTP_CODE_MOVED_PERMANENTLY)<br>– 404: 请求的资源（网页等）不存在(HTTP_CODE_NOT_FOUND)<br>– 500: 内部服务器错误(HTTP_CODE_INTERNAL_SERVER_ERROR)</p>
<h6 id="示例程序-85"><a href="#示例程序-85" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Arduino</span><br><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: www.example.com</span><br><span class="line">User-Agent: ESP8266HTTPClient</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: identity;q=<span class="number">1</span>,chunked;q=<span class="number">0.1</span>,*;q=<span class="number">0</span></span><br><span class="line">Content-Length: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>其中HTTP请求方法GET即是通过以下程序中的<code>httpClient.GET();</code>来实现的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_begin</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送GET请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-30"><a href="#相关内容-30" class="headerlink" title="相关内容"></a>相关内容</h6><p>— POST</p>
<h5 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h5><h6 id="说明-98"><a href="#说明-98" class="headerlink" title="说明"></a>说明</h6><p>此函数用于ESP8266备使用HTTP协议通过网络向服务器发送POST请求。</p>
<p>客户端与服务器通讯时最常被用到的方法是：GET 和 POST。<br>– GET – 从指定的资源请求数据。<br>– POST – 向指定的资源提交要被处理的数据</p>
<h6 id="语法-97"><a href="#语法-97" class="headerlink" title="语法"></a>语法</h6><p><code>http.POST(payload)</code></p>
<p><code>http.POST(payload, size)</code></p>
<h6 id="参数-91"><a href="#参数-91" class="headerlink" title="参数"></a>参数</h6><p>payload: 通过POST请求所发送的数据信息（该信息置于请求体中被发送）。该参数可使用字符串类型。<br>size: 通过POST请求所发送的数据字节数(此参数为可选参数，类型：size_t )。</p>
<h6 id="返回值-92"><a href="#返回值-92" class="headerlink" title="返回值"></a>返回值</h6><p>服务器响应状态码（类型：int）</p>
<p>以下是常见的HTTP状态码（以下括号中内容为ESP8266HTTPClient库声明定义的HTTP状态码替代文字，具体内容可参考ESP8266库ESP8266HTTPClient.h文件中相应内容）：</p>
<ul>
<li>– 200: 请求成功 （HTTP_CODE_OK）</li>
<li>– 301: 资源（网页等）被永久转移到其它URL (HTTP_CODE_MOVED_PERMANENTLY)</li>
<li>– 404: 请求的资源（网页等）不存在(HTTP_CODE_NOT_FOUND)</li>
<li>– 500: 内部服务器错误(HTTP_CODE_INTERNAL_SERVER_ERROR)</li>
</ul>
<h6 id="示例程序-86"><a href="#示例程序-86" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://quan.suning.com/getSysTime.do%E5%8F%91%E9%80%81HTTP%E8%AF%B7%E6%B1%82%E5%B9%B6%E9%80%9A%E8%BF%87%E4%B8%B2%E5%8F%A3%E7%9B%91%E8%A7%86%E5%99%A8%E5%B0%86%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E9%80%9A%E8%BF%87%E4%B8%B2%E5%8F%A3%E7%9B%91%E8%A7%86%E5%99%A8%E6%98%BE%E7%A4%BA%E5%87%BA%E6%9D%A5%E3%80%82">http://quan.suning.com/getSysTime.do发送HTTP请求并通过串口监视器将响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /getSysTime.do HTTP/1.1</span><br><span class="line">Host: quan.suning.com</span><br><span class="line">User-Agent: ESP8266HTTPClient</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: identity;q=1,chunked;q=0.1,*;q=0</span><br><span class="line">Content-Length: 9</span><br><span class="line"> </span><br><span class="line">date_test</span><br></pre></td></tr></table></figure>

<p>其中HTTP请求方法POST即是通过以下程序中的<code>http.POST(&quot;date_test&quot;)</code>语句来实现的。另外我们可以看到在以上的请求信息中，请求体部分包含有date_test。该信息即是通过<code>http.POST(&quot;date_test&quot;)</code>语句的参数实现的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_demo_POST</span></span><br><span class="line"><span class="comment">  团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">  作者/Author              : Dapenson</span></span><br><span class="line"><span class="comment">  日期/Date（YYYYMMDD）     : 20200325</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  以苏宁易购的获取时间的公共api为例子,发起HTTP请求,并将获取到的数据信息打印到串口监视器中</span></span><br><span class="line"><span class="comment">  具体HTTP请求可参考自定义函数http_POST()内容</span></span><br><span class="line"><span class="comment">  -----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">  本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">  该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">  http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//以苏宁易购api为例子获取时间数据</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SERVER_IP <span class="string">&quot;http://quan.suning.com/getSysTime.do&quot;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置你的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;taichimaker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(STASSID, STAPSK);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected! IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    http_post();</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">http_post</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 WiFiClient 实例化对象</span></span><br><span class="line">  WiFiClient client;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建http对象</span></span><br><span class="line">  HTTPClient http;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址</span></span><br><span class="line">  http.begin(client, SERVER_IP); <span class="comment">//HTTP请求</span></span><br><span class="line">  Serial.print(<span class="string">&quot;[HTTP] begin...\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP报头和报文</span></span><br><span class="line">  <span class="type">int</span> httpCode = http.POST(<span class="string">&quot; &quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;[HTTP] POST...\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接失败时 httpCode时为负</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//将服务器响应头打印到串口</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] POST... code: %d\n&quot;</span>, httpCode);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//将从服务器获取的数据打印到串口</span></span><br><span class="line">    <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      <span class="type">const</span> String&amp; payload = http.getString();</span><br><span class="line">      Serial.println(<span class="string">&quot;received payload:\n&lt;&lt;&quot;</span>);</span><br><span class="line">      Serial.println(payload);</span><br><span class="line">      Serial.println(<span class="string">&quot;&gt;&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] POST... failed, error: %s\n&quot;</span>, http.errorToString(httpCode).c_str());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//关闭http连接</span></span><br><span class="line">  http.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-31"><a href="#相关内容-31" class="headerlink" title="相关内容"></a>相关内容</h6><p>— GET</p>
<h5 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h5><h6 id="说明-99"><a href="#说明-99" class="headerlink" title="说明"></a>说明</h6><p>此函数用于ESP8266使用HTTP协议通过网络向服务器发送PUT请求。</p>
<h6 id="语法-98"><a href="#语法-98" class="headerlink" title="语法"></a>语法</h6><p><code>http.PUT(payload)</code><br><code>http.PUT(payload, size)</code></p>
<h6 id="参数-92"><a href="#参数-92" class="headerlink" title="参数"></a>参数</h6><p>payload:通过PUT请求所发送的数据信息（该信息置于请求体中被发送）。该参数可使用字符串类型。<br>size: 通过PUT请求所发送的数据字节数(此参数为可选参数，类型：size_t )。</p>
<h6 id="返回值-93"><a href="#返回值-93" class="headerlink" title="返回值"></a>返回值</h6><p>服务器状态码</p>
<p>以下是常见的HTTP状态码（以下括号中内容为ESP8266HTTPClient库声明定义的HTTP状态码替代文字，具体内容可参考<a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266HTTPClient/src/ESP8266HTTPClient.h">ESP8266库ESP8266HTTPClient.h文件中相应内容</a>）：</p>
<ul>
<li>– 200: 请求成功 （HTTP_CODE_OK）</li>
<li>– 301: 资源（网页等）被永久转移到其它URL (HTTP_CODE_MOVED_PERMANENTLY)</li>
<li>– 404: 请求的资源（网页等）不存在(HTTP_CODE_NOT_FOUND)</li>
<li>– 500: 内部服务器错误(HTTP_CODE_INTERNAL_SERVER_ERROR)</li>
</ul>
<h6 id="相关内容-32"><a href="#相关内容-32" class="headerlink" title="相关内容"></a>相关内容</h6><p>— GET<br>— POST</p>
<h5 id="PATCH"><a href="#PATCH" class="headerlink" title="PATCH"></a>PATCH</h5><h6 id="说明-100"><a href="#说明-100" class="headerlink" title="说明"></a>说明</h6><p>此函数用于ESP8266使用HTTP协议通过网络向服务器发送PATCH请求。</p>
<h6 id="语法-99"><a href="#语法-99" class="headerlink" title="语法"></a>语法</h6><p><code>http.PATCH(payload)</code><br><code>http.PATCH(payload, size)</code></p>
<h6 id="参数-93"><a href="#参数-93" class="headerlink" title="参数"></a>参数</h6><p>payload:通过PATCH请求所发送的数据信息（该信息置于请求体中被发送）。该参数可使用字符串类型。<br>size: 通过PATCH请求所发送的数据字节数(此参数为可选参数，类型：size_t )。</p>
<h6 id="返回值-94"><a href="#返回值-94" class="headerlink" title="返回值"></a>返回值</h6><p>服务器响应状态码</p>
<p>以下是常见的HTTP状态码（以下括号中内容为ESP8266HTTPClient库声明定义的HTTP状态码替代文字，具体内容可参考<a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266HTTPClient/src/ESP8266HTTPClient.h">ESP8266库ESP8266HTTPClient.h文件中相应内容</a>）：</p>
<ul>
<li>– 200: 请求成功 （HTTP_CODE_OK）</li>
<li>– 301: 资源（网页等）被永久转移到其它URL (HTTP_CODE_MOVED_PERMANENTLY)</li>
<li>– 404: 请求的资源（网页等）不存在(HTTP_CODE_NOT_FOUND)</li>
<li>– 500: 内部服务器错误(HTTP_CODE_INTERNAL_SERVER_ERROR)</li>
</ul>
<h4 id="发送请求类型"><a href="#发送请求类型" class="headerlink" title="发送请求类型"></a>发送请求类型</h4><h5 id="sendRequest-–-发送请求"><a href="#sendRequest-–-发送请求" class="headerlink" title="sendRequest – 发送请求"></a>sendRequest – 发送请求</h5><h6 id="说明-101"><a href="#说明-101" class="headerlink" title="说明"></a>说明</h6><p>此函数用于ESP8266使用HTTP协议通过网络向服务器发送请求。本函数可以自定义请求方法类型，如 GET、POST等。</p>
<h6 id="语法-100"><a href="#语法-100" class="headerlink" title="语法"></a>语法</h6><p><code>sendRequest(type, payload)</code><br><code>sendRequest(type, payload, size)</code><br><code>sendRequest(type, stream, size)</code></p>
<h6 id="参数-94"><a href="#参数-94" class="headerlink" title="参数"></a>参数</h6><ul>
<li><p>type: 发送请求的类型,可以是”GET”、”POST”等。参数类型: const char *</p>
</li>
<li><p>payload: 请求所发送的数据信息（该信息置于请求体中被发送）。该参数可使用字符串类型。（使用GET作为请求方法时，此参数可以省略）。</p>
</li>
<li><p>size: 请求所发送的数据字节数(此参数为可选参数，类型：size_t )。</p>
</li>
<li><p>stream: 数据流对象</p>
</li>
</ul>
<h6 id="返回值-95"><a href="#返回值-95" class="headerlink" title="返回值"></a>返回值</h6><p>服务器状态码</p>
<p>以下是常见的HTTP状态码：</p>
<ul>
<li>– 200 – 请求成功</li>
<li>– 301 – 资源（网页等）被永久转移到其它URL</li>
<li>– 404 – 请求的资源（网页等）不存在</li>
<li>– 500 – 内部服务器错误</li>
</ul>
<h6 id="示例程序-87"><a href="#示例程序-87" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将以下示例程序的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://quan.suning.com/getSysTime.do%E5%8F%91%E9%80%81HTTP%E8%AF%B7%E6%B1%82%E5%B9%B6%E9%80%9A%E8%BF%87%E4%B8%B2%E5%8F%A3%E7%9B%91%E8%A7%86%E5%99%A8%E5%B0%86%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E9%80%9A%E8%BF%87%E4%B8%B2%E5%8F%A3%E7%9B%91%E8%A7%86%E5%99%A8%E6%98%BE%E7%A4%BA%E5%87%BA%E6%9D%A5%E3%80%82">http://quan.suning.com/getSysTime.do发送HTTP请求并通过串口监视器将响应信息通过串口监视器显示出来。</a></p>
<p>以下是本程序控制下，ESP8266发送的HTTP请求信息：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">POST /getSysTime.<span class="keyword">do</span> HTTP/<span class="number">1.1</span></span><br><span class="line">Host: quan.suning.com</span><br><span class="line">User-Agent: ESP8266HTTPClient</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept-Encoding: identity;q=<span class="number">1</span>,chunked;q=<span class="number">0.1</span>,*;q=<span class="number">0</span></span><br><span class="line">Content-Length: <span class="number">9</span></span><br><span class="line"></span><br><span class="line">date_test</span><br></pre></td></tr></table></figure>

<p>其中HTTP请求方法POST即是通过以下程序中的<code>http.sendRequest(&quot;POST&quot;, &quot;date_test&quot;)</code>语句来实现的。该语句的第一个参数设置了HTTP请求方法为POST。另外我们可以看到在以上的请求信息中，请求体部分包含有date_test。该信息即是通过<code>http.sendRequest(&quot;POST&quot;, &quot;date_test&quot;)</code>语句的第二个参数实现的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_sendRequest</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  以苏宁易购的获取时间的公共api为例子,发起HTTP请求,并将获取到的数据信息打印到串口监视器中</span></span><br><span class="line"><span class="comment">  具体HTTP请求可参考自定义函数http_POST内容</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//以苏宁易购api为例子获取时间数据</span></span><br><span class="line"><span class="comment">//#define URL &quot;http://quan.suning.com/getSysTime.do&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://192.168.0.110&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置你的wifi接入信息</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;taichimaker&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123; </span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(STASSID, STAPSK);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected! IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    http_post();</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">http_post</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建http对象</span></span><br><span class="line">  HTTPClient http;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址</span></span><br><span class="line">  http.begin(URL); <span class="comment">//HTTP请求</span></span><br><span class="line">  Serial.print(<span class="string">&quot;[HTTP] begin...\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求。请求方法：POST。请求体信息：date_test</span></span><br><span class="line">  <span class="type">int</span> httpCode = http.sendRequest(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;date_test&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;[HTTP] POST...\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//连接失败时 httpCode时为负</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//将服务器响应头打印到串口</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] POST... code: %d\n&quot;</span>, httpCode);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//将从服务器获取的数据打印到串口</span></span><br><span class="line">    <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      <span class="type">const</span> String&amp; payload = http.getString();</span><br><span class="line">      Serial.println(<span class="string">&quot;received payload:\n&lt;&lt;&quot;</span>);</span><br><span class="line">      Serial.println(payload);</span><br><span class="line">      Serial.println(<span class="string">&quot;&gt;&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] POST... failed, error: %s\n&quot;</span>, http.errorToString(httpCode).c_str());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//关闭http连接</span></span><br><span class="line">  http.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="相关内容-33"><a href="#相关内容-33" class="headerlink" title="相关内容"></a>相关内容</h6><p>— GET<br>— POST</p>
<h5 id="end-–-结束请求"><a href="#end-–-结束请求" class="headerlink" title="end – 结束请求"></a>end – 结束请求</h5><h6 id="说明-102"><a href="#说明-102" class="headerlink" title="说明"></a>说明</h6><p>当ESP8266发送HTTP请求结束后，我们应该调用此函数来清除ESP8266的接收缓存以便设备再次接收服务器发来的响应信息。</p>
<h6 id="语法-101"><a href="#语法-101" class="headerlink" title="语法"></a>语法</h6><p><code>http.end()</code></p>
<h6 id="参数-95"><a href="#参数-95" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-96"><a href="#返回值-96" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-88"><a href="#示例程序-88" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_end</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266来向www.example.com网站服务器发送HTTP请求并通过串口</span></span><br><span class="line"><span class="comment">  监视器将网站服务器响应信息通过串口监视器显示出来。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="响应类型"><a href="#响应类型" class="headerlink" title="响应类型"></a>响应类型</h3><h4 id="响应头类型"><a href="#响应头类型" class="headerlink" title="响应头类型"></a>响应头类型</h4><h5 id="collectHeaders-–-设置收集响应头内容"><a href="#collectHeaders-–-设置收集响应头内容" class="headerlink" title="collectHeaders – 设置收集响应头内容"></a>collectHeaders – 设置收集响应头内容</h5><h6 id="说明-103"><a href="#说明-103" class="headerlink" title="说明"></a>说明</h6><p>在我们使用ESP8266HTTPClient库中的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/header/">header</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/headers/">headers</a> 、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/headername/">headerName</a> 、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/hasheader/">hasHeader</a> 函数来处理网站服务器响应头以前，需要首先调用本函数来设置ESP8266具体收集哪些响应头信息。</p>
<h6 id="语法-102"><a href="#语法-102" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.collectHeaders(headerKeys, headerKeysCount)</span><br></pre></td></tr></table></figure>

<h6 id="参数-96"><a href="#参数-96" class="headerlink" title="参数"></a>参数</h6><p>– headerKeys: 响应头名数组。此数组中的元素即是需要ESP8266处理或收集的响应头信息。下面我们看一个headerKeys数组的例子：<br><code>const char *headerKeys[] = {&quot;Content-Length&quot;, &quot;Date&quot;};</code><br>此数组共有两个元素，分别是”Content-Length”和”Date”。只有如此建立了数组后，接下来的程序里我们才可以使用其它ESP8266HTTPClient库函数来处理这两个响应头的信息内容。可以把这个数组看作是对ESP8266的提醒，即告诉ESP8266在后续的程序中，我们将要对数组中所包含的响应头信息进行处理。（具体操作方法，请见本函数的示例程序部分。）</p>
<p>– headerKeysCount: 需要获取&#x2F;处理的响应头个数（可选参数，类型：size_t）</p>
<h6 id="返回值-97"><a href="#返回值-97" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-89"><a href="#示例程序-89" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将服务器响应头中的”content-length”和”date”信息通过串口监视器输出.(如下图所示)/">www.example.com网站服务器发送HTTP请求，并且将服务器响应头中的”Content-Length”和”Date”信息通过串口监视器输出。（如下图所示）</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230526223548235.png" alt="image-20230526223548235"></p>
<p>我们通过以下示例程序的<code>const char *headerKeys[] = {&quot;Content-Length&quot;, &quot;Date&quot;};</code>语句建立了headerKeys数组。该数组将被用于接下来程序中的<code>httpClient.collectHeaders(headerKeys, 2);</code>语句。以上操作的目的是为了告知ESP8266我们即将对服务器响应头中的”Content-Length”, “Date”信息进行处理。</p>
<p>在后续的程序中，我们使用了一系列串口输出语句将服务器响应头中的”Content-Length”, “Date”信息通过串口监视器显示，也就是您所看到的上图内容。</p>
<p>值得注意的是，在上图中红色标注的Connection响应头信息是空的。造成这个结果的原因是我们在建立headerKeys数组时，没有在该数组中加入Connection这一元素。那么ESP8266在后续的程序中自然就无法输出Connection信息了。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_collectHeaders</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用collectHeaders函数处理www.example.com网站服务器返回的响应信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要收集的响应头的信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过headerKeys数组设置即将处理的服务器响应头内容</span></span><br><span class="line">  httpClient.collectHeaders(headerKeys, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">      Serial.println(<span class="string">&quot;Collected Server Headers: &quot;</span>);</span><br><span class="line">      </span><br><span class="line">      Serial.print(<span class="string">&quot;Content-Length = &quot;</span>); </span><br><span class="line">      Serial.println(httpClient.header(<span class="string">&quot;Content-Length&quot;</span>));</span><br><span class="line">     </span><br><span class="line">      Serial.print(<span class="string">&quot;Date = &quot;</span>); </span><br><span class="line">      Serial.println(httpClient.header(<span class="string">&quot;Date&quot;</span>));</span><br><span class="line">      </span><br><span class="line">      Serial.print(<span class="string">&quot;Connection = &quot;</span>); </span><br><span class="line">      Serial.println(httpClient.header(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上程序利用collectHeaders函数获取服务器响应头信息，并通过串口监视器将获取到的响应头信息输出，以便我们查阅程序运行结果。</p>
<p>在以上程序中有2条语句很重要。</p>
<ol>
<li><p><code>const char *headerKeys[] = {&quot;Content-Length&quot;, &quot;Date&quot;};</code><br>这条语句建立了用于存储响应头信息的数组。</p>
</li>
<li><p><code>httpClient.collectHeaders(headerKeys, 2);</code><br>这条语句用于设置响应头收集。</p>
</li>
</ol>
<h6 id="相关内容-34"><a href="#相关内容-34" class="headerlink" title="相关内容"></a>相关内容</h6><p>— header – 获取指定响应头参数值<br>— headers – 获取响应头数量<br>— headerName – 获取指定的响应头名<br>— hasHeader – 确认是否存在指定响应头</p>
<h5 id="header-–-获取指定响应头参数值"><a href="#header-–-获取指定响应头参数值" class="headerlink" title="header – 获取指定响应头参数值"></a>header – 获取指定响应头参数值</h5><h6 id="说明-104"><a href="#说明-104" class="headerlink" title="说明"></a>说明</h6><p>通过此函数，ESP8266可以获取服务器响应头的参数值。</p>
<p><strong>注：在使用此函数前，必须使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/collectheaders/">collectHeaders</a>函数来设置响应头处理内容。</strong></p>
<h6 id="语法-103"><a href="#语法-103" class="headerlink" title="语法"></a>语法</h6><p><code>httpClient.header(name)</code><br><code>httpClient.header(index)</code></p>
<h6 id="参数-97"><a href="#参数-97" class="headerlink" title="参数"></a>参数</h6><p>name: 响应头中指定项的参数名(参数类型: const char*)<br>index: 响应头中指定项的序号(参数类型: size_t)</p>
<h6 id="返回值-98"><a href="#返回值-98" class="headerlink" title="返回值"></a>返回值</h6><p>响应头中指定项的参数值 (返回值类型:String)</p>
<h6 id="示例程序-90"><a href="#示例程序-90" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将服务器响应头中的”content-length”和”date”信息通过串口监视器输出.(如下图所示)/">www.example.com网站服务器发送HTTP请求，并且将服务器响应头中的”Content-Length”和”Date”信息通过串口监视器输出。（如下图所示）</a></p>
<p> <img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230526223548235.png" alt="image-20230526223548235"></p>
<p>我们通过以下示例程序的<code>const char *headerKeys[] = {&quot;Content-Length&quot;, &quot;Date&quot;};</code>语句建立了headerKeys数组。该数组将被用于接下来程序中的<code>httpClient.collectHeaders(headerKeys, 2);</code>语句。以上操作的目的是为了告知ESP8266我们即将对服务器响应头中的”Content-Length”, “Date”信息进行处理。</p>
<p>在后续的程序中，我们使用了一系列header函数来获取指定响应头的数值。并且将这些数值通过串口监视器显示，也就是您所看到的上图内容。</p>
<p>值得注意的是，在上图中红色标注的Connection响应头信息是空的。造成这个结果的原因是我们在建立headerKeys数组时，没有在该数组中加入Connection这一元素。那么ESP8266在后续的程序中自然就无法输出Connection信息了。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_header</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用header函数处理www.example.com网站服务器返回的响应信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要收集的响应头的信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过headerKeys数组设置即将处理的服务器响应头内容</span></span><br><span class="line">  httpClient.collectHeaders(headerKeys, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">      Serial.println(<span class="string">&quot;Collected Server Headers: &quot;</span>);</span><br><span class="line">      </span><br><span class="line">      Serial.print(<span class="string">&quot;Content-Length = &quot;</span>); </span><br><span class="line">      Serial.println(httpClient.header(<span class="string">&quot;Content-Length&quot;</span>));</span><br><span class="line">     </span><br><span class="line">      Serial.print(<span class="string">&quot;Date = &quot;</span>); </span><br><span class="line">      Serial.println(httpClient.header(<span class="string">&quot;Date&quot;</span>));</span><br><span class="line">      </span><br><span class="line">      Serial.print(<span class="string">&quot;Connection = &quot;</span>); </span><br><span class="line">      Serial.println(httpClient.header(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-35"><a href="#相关内容-35" class="headerlink" title="相关内容"></a>相关内容</h6><p>— collectHeaders – 设置收集响应头内容<br>— header – 获取指定响应头参数值<br>— headers – 获取响应头数量<br>— headerName – 获取指定的响应头名<br>— hasHeader – 确认是否存在指定响应头</p>
<h5 id="headers-–-获取响应头数量"><a href="#headers-–-获取响应头数量" class="headerlink" title="headers – 获取响应头数量"></a>headers – 获取响应头数量</h5><h6 id="说明-105"><a href="#说明-105" class="headerlink" title="说明"></a>说明</h6><p>当ESP8266开发板通过HTTP协议向服务器发送请求后，服务器将会向ESP8266开发板发送HTTP响应信息。这个响应信息的响应头部分是多个键值对组成的。此函数用于ESP8266获取响应头中键值对的数量。</p>
<p><strong>注：在使用此函数前，必须使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/collectheaders/">collectHeaders</a>函数来设置响应头处理内容。另外此函数所获取的服务器响应头数量并不是服务器****的实际响应头数量，而是collectHeaders函数中设置的“<code>headerKeysCount</code>”参数数值。</strong></p>
<h6 id="语法-104"><a href="#语法-104" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.headers()</span><br></pre></td></tr></table></figure>

<h6 id="参数-98"><a href="#参数-98" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-99"><a href="#返回值-99" class="headerlink" title="返回值"></a>返回值</h6><p>获取的响应头数量（参数类型： int）</p>
<h6 id="示例程序-91"><a href="#示例程序-91" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将esp8266获取的服务器响应头中数量通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求，并且将ESP8266获取的服务器响应头中数量通过串口监视器显示出来。</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_headers</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用headers函数获取www.example.com网站服务器返回的响应头数量。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要收集的响应头的信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过headerKeys数组设置即将处理的服务器响应头内容</span></span><br><span class="line">  httpClient.collectHeaders(headerKeys, <span class="number">3</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line"> </span><br><span class="line">      <span class="type">int</span> headerQuantity = httpClient.headers();</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;Server Header Quantity: &quot;</span>);      </span><br><span class="line">      Serial.println(headerQuantity);</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-36"><a href="#相关内容-36" class="headerlink" title="相关内容"></a>相关内容</h6><p>— collectHeaders – 设置收集响应头内容<br>— header – 获取指定响应头参数值<br>— headerName – 获取指定的响应头名<br>— hasHeader – 确认是否存在指定响应头</p>
<h5 id="headerName-–-获取指定的响应头名"><a href="#headerName-–-获取指定的响应头名" class="headerlink" title="headerName – 获取指定的响应头名"></a>headerName – 获取指定的响应头名</h5><h6 id="说明-106"><a href="#说明-106" class="headerlink" title="说明"></a>说明</h6><p>当ESP8266开发板通过HTTP协议向服务器发送请求后，服务器将会向ESP8266开发板发送HTTP响应信息。这个响应信息的响应头部分是多个键值对组成的。此函数用于获取响应头中指定序号的键名。</p>
<p><strong>注:要使用此函数必须在发起请求之前使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/collectheaders/">collectHeaders</a>函数来设置收集响应头内容。</strong></p>
<h6 id="语法-105"><a href="#语法-105" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.headerName(index)</span><br></pre></td></tr></table></figure>

<h6 id="参数-99"><a href="#参数-99" class="headerlink" title="参数"></a>参数</h6><p>index: 要获取的响应头键名序号(类型：size_t)<br>例：如需获取响应头中首个键的键名，可使用以下语句。<br><code>http.headerName(0)</code></p>
<h6 id="返回值-100"><a href="#返回值-100" class="headerlink" title="返回值"></a>返回值</h6><p>要获取的响应头键名（类型：字符串）</p>
<h6 id="示例程序-92"><a href="#示例程序-92" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将esp8266获取的服务器响应中的第一个响应头名称通过串口监视器显示出来.我们是通过以下示例程序中的语句`httpclient.headername(0);`来获取该信息的./">www.example.com网站服务器发送HTTP请求，并且将ESP8266获取的服务器响应中的第一个响应头名称通过串口监视器显示出来。我们是通过以下示例程序中的语句`httpClient.headerName(0);`来获取该信息的。</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_headerName</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用headers函数获取www.example.com网站服务器返回的响应头数量。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要收集的响应头的信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过headerKeys数组设置即将处理的服务器响应头内容</span></span><br><span class="line">  httpClient.collectHeaders(headerKeys, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      String headerKey = httpClient.headerName(<span class="number">0</span>);</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;Server Header1 Name: &quot;</span>);      </span><br><span class="line">      Serial.println(headerKey);</span><br><span class="line">      Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-37"><a href="#相关内容-37" class="headerlink" title="相关内容"></a>相关内容</h6><p>— collectHeaders – 设置收集响应头内容<br>— header – 获取指定响应头参数值<br>— headers – 获取响应头数量<br>— hasHeader – 确认是否存在指定响应头</p>
<h5 id="hasHeader-–-确认是否存在指定响应头"><a href="#hasHeader-–-确认是否存在指定响应头" class="headerlink" title="hasHeader – 确认是否存在指定响应头"></a>hasHeader – 确认是否存在指定响应头</h5><h6 id="说明-107"><a href="#说明-107" class="headerlink" title="说明"></a>说明</h6><p>此函数用于确认服务器HTTP响应头中是否含有指定响应头信息。</p>
<p><strong>注:要使用此函数必须在发起请求之前使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/collectheaders/">collectHeaders</a>函数来设置收集响应头内容。</strong></p>
<h6 id="语法-106"><a href="#语法-106" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.hasHeader(name)</span><br></pre></td></tr></table></figure>

<h6 id="参数-100"><a href="#参数-100" class="headerlink" title="参数"></a>参数</h6><p>name: 需要确认的响应头键名（类型：const char* ）</p>
<h6 id="返回值-101"><a href="#返回值-101" class="headerlink" title="返回值"></a>返回值</h6><p>返回值类型为bool。如果存在需要确认的响应头键名则返回true，否则返回false。</p>
<h6 id="示例程序-93"><a href="#示例程序-93" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且通过串口监视器输出服务器响应头中包含有”date”信息.我们是通过以下示例程序中的语句`httpclient.hasheader("date")`来获取该信息的./">www.example.com网站服务器发送HTTP请求，并且通过串口监视器输出服务器响应头中包含有”Date”信息。我们是通过以下示例程序中的语句`httpClient.hasHeader(&quot;Date&quot;)`来获取该信息的。</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_hasHeader</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用headers函数获取www.example.com网站服务器返回的响应头数量。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要收集的响应头的信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过headerKeys数组设置即将处理的服务器响应头内容</span></span><br><span class="line">  httpClient.collectHeaders(headerKeys, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      <span class="keyword">if</span>(httpClient.hasHeader(<span class="string">&quot;Date&quot;</span>))&#123;</span><br><span class="line">        Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">        Serial.println(<span class="string">&quot;Server Response has Date Header&quot;</span>);      </span><br><span class="line">        Serial.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-38"><a href="#相关内容-38" class="headerlink" title="相关内容"></a>相关内容</h6><p>— collectHeaders – 设置收集响应头内容<br>— header – 获取指定响应头参数值<br>— headers – 获取响应头数量<br>— headerName – 获取指定的响应头名</p>
<h4 id="响应体类型"><a href="#响应体类型" class="headerlink" title="响应体类型"></a>响应体类型</h4><h5 id="getString-–-获取响应体数据并且以字符串形式返回"><a href="#getString-–-获取响应体数据并且以字符串形式返回" class="headerlink" title="getString – 获取响应体数据并且以字符串形式返回"></a>getString – 获取响应体数据并且以字符串形式返回</h5><h6 id="说明-108"><a href="#说明-108" class="headerlink" title="说明"></a>说明</h6><p>此函数可用于获取服务器响应中的响应体信息。响应体信息将以字符串的形式进行返回。</p>
<h6 id="语法-107"><a href="#语法-107" class="headerlink" title="语法"></a>语法</h6><p>http.getString()</p>
<h6 id="参数-101"><a href="#参数-101" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-102"><a href="#返回值-102" class="headerlink" title="返回值"></a>返回值</h6><p>服务器HTTP响应中的响应体数据。(返回值类型:String)</p>
<h6 id="示例程序-94"><a href="#示例程序-94" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应体信息通过串口监视器显示出来.我们是通过以下示例程序中的`httpclient.getstring()`来获取该信息的./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应体信息通过串口监视器显示出来。我们是通过以下示例程序中的`httpClient.getString()`来获取该信息的。</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_demo_getString</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用getString来获取www.example.com网站服务器返回的响应信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="相关内容-39"><a href="#相关内容-39" class="headerlink" title="相关内容"></a>相关内容</h5><p>— getStream – 获取响应体数据并且以Stream形式返回<br>— writeToStream – 获取响应体数据并且写入其它Stream对象<br>— getSize – 获取响应体数据字节数<br>— errorToString – 获取错误代码并且以字符串形式返回</p>
<h5 id="getStream-–-获取响应体数据并且以Stream形式返回"><a href="#getStream-–-获取响应体数据并且以Stream形式返回" class="headerlink" title="getStream – 获取响应体数据并且以Stream形式返回"></a>getStream – 获取响应体数据并且以Stream形式返回</h5><h6 id="说明-109"><a href="#说明-109" class="headerlink" title="说明"></a>说明</h6><p>此函数可用于获取服务器响应中的响应体信息。响应体信息将以<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">WiFiClient</a>对象返回。</p>
<p>我们可以使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/">WiFiClient库</a>（ TCP客户端库）建立WiFiClient对象，继而使用该对象对本函数所返回的响应体信息进行分析处理。由于WiFiClient对象可以调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream</a>类提里面的诸多功能强大的函数，如 <a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/parseint/">parseInt </a>、 <a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/find/">find </a>、 <a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/readStringuntil/">readStringUntil</a>，使用本函数可以为分析服务器响应信息提供很多便利。</p>
<p>为了更好的了解本函数的用法，建议您首先了解<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/">WiFiClient库</a>（ TCP客户端库）以及是该库中<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream</a>类函数的具体使用方法。</p>
<h6 id="语法-108"><a href="#语法-108" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.getStream()</span><br></pre></td></tr></table></figure>

<h6 id="参数-102"><a href="#参数-102" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-103"><a href="#返回值-103" class="headerlink" title="返回值"></a>返回值</h6><p>以Stream形式返回响应体数据。</p>
<h6 id="示例程序-95"><a href="#示例程序-95" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求并通过串口监视器将网站服务器响应体信息通过串口监视器显示出来./">www.example.com网站服务器发送HTTP请求并通过串口监视器将网站服务器响应体信息通过串口监视器显示出来。</a></p>
<p>在以下示例程序中，首先我们通过语句<code>WiFiClient wifiClient;</code>来创建 WiFiClient 对象。该对象用于处理getStream函数所获取的服务器响应体。</p>
<p>接下来在84-87行程序中，我们利用WiFiClient 对象调用available和readStringUntil这两个<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream</a>类函数，从而将服务器响应体信息先赋值给字符串，再通过监视器显示出来。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_getStream</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用getStream来处理www.example.com网站服务器返回的响应信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//创建 WiFiClient 对象。该对象用于处理getStream函数所获取的服务器响应体</span></span><br><span class="line">  WiFiClient wifiClient;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取服务器响应体Stream并传递给wifiClient</span></span><br><span class="line">    wifiClient = httpClient.getStream();</span><br><span class="line">    </span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response: &quot;</span>);</span><br><span class="line">    <span class="comment">// 以下部分使用了Stream类中的available函数以及readStringUntil函数</span></span><br><span class="line">    <span class="comment">// 对服务器响应体信息进行分析处理。并且通过串口监视器将服务器响应体信息</span></span><br><span class="line">    <span class="comment">// 输出到串口监视器中。</span></span><br><span class="line">    <span class="keyword">while</span> (wifiClient.available())&#123;</span><br><span class="line">      String resonseBodyLine = wifiClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">      Serial.println(resonseBodyLine);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-40"><a href="#相关内容-40" class="headerlink" title="相关内容"></a>相关内容</h6><p>— getString – 获取响应体数据并且以字符串形式返回<br>— writeToStream – 获取响应体数据并且写入其它Stream对象<br>— getSize – 获取响应体数据字节数<br>— errorToString – 获取错误代码并且以字符串形式返回</p>
<h5 id="writeToStream-–-获取响应体数据并且写入其它Stream对象"><a href="#writeToStream-–-获取响应体数据并且写入其它Stream对象" class="headerlink" title="writeToStream – 获取响应体数据并且写入其它Stream对象"></a>writeToStream – 获取响应体数据并且写入其它Stream对象</h5><h6 id="说明-110"><a href="#说明-110" class="headerlink" title="说明"></a>说明</h6><p>此函数用于将获取到的响应数据写入<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream</a>数据流。</p>
<h6 id="语法-109"><a href="#语法-109" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.writeToStream(stream)</span><br></pre></td></tr></table></figure>

<h6 id="参数-103"><a href="#参数-103" class="headerlink" title="参数"></a>参数</h6><p>stream: stream类型指针</p>
<h6 id="返回值-104"><a href="#返回值-104" class="headerlink" title="返回值"></a>返回值</h6><p>返回值类型为int。<br>如果返回值大于零，则返回值数值是写入对象的数据大小（单位：字节）。<br>如果返回值小于零，说明函数执行出错。以下是错误代码说明：</p>
<ul>
<li>-1： HTTPC_ERROR_CONNECTION_REFUSED</li>
<li>-2： HTTPC_ERROR_SEND_HEADER_FAILED</li>
<li>-3： HTTPC_ERROR_SEND_PAYLOAD_FAILED</li>
<li>-4： HTTPC_ERROR_NOT_CONNECTED</li>
<li>-5： HTTPC_ERROR_CONNECTION_LOST</li>
<li>-6： HTTPC_ERROR_NO_STREAM</li>
<li>-7： HTTPC_ERROR_NO_HTTP_SERVER</li>
<li>-8： HTTPC_ERROR_TOO_LESS_RAM</li>
<li>-9： HTTPC_ERROR_ENCODING</li>
<li>-10： HTTPC_ERROR_STREAM_WRITE</li>
<li>-11： HTTPC_ERROR_READ_TIMEOUT</li>
</ul>
<h5 id="getSize-–-获取响应体数据字节数"><a href="#getSize-–-获取响应体数据字节数" class="headerlink" title="getSize – 获取响应体数据字节数"></a>getSize – 获取响应体数据字节数</h5><h6 id="说明-111"><a href="#说明-111" class="headerlink" title="说明"></a>说明</h6><p>此函数可用于获取服务器响应中的响应体大小（单位：字节）。</p>
<h6 id="语法-110"><a href="#语法-110" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.getSize()</span><br></pre></td></tr></table></figure>

<h6 id="参数-104"><a href="#参数-104" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-105"><a href="#返回值-105" class="headerlink" title="返回值"></a>返回值</h6><p>返回值类型为int。<br>服务器响应中的响应体大小（单位：字节）</p>
<h6 id="示例程序-96"><a href="#示例程序-96" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，ESP8266将会向<a target="_blank" rel="noopener" href="http://www.example.com网站服务器发送http请求,并且将esp8266获取的服务器响应头大小通过串口监视器显示出来.我们使用了`httpclient.getsize()`来获取该信息./">www.example.com网站服务器发送HTTP请求，并且将ESP8266获取的服务器响应头大小通过串口监视器显示出来。我们使用了`httpClient.getSize()`来获取该信息。</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_getSize</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用getSize函数来获取www.example.com网站服务器返回的响应信息大小。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 测试HTTP请求用的URL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口设置</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 如果ESP8266连接WiFi则发送HTTP请求</span></span><br><span class="line">  <span class="keyword">if</span> ((WiFi.status() == WL_CONNECTED)) &#123;</span><br><span class="line">    esp8266Http();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">5000</span>);   <span class="comment">// 短暂等待</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">esp8266Http</span><span class="params">()</span>&#123; </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//配置请求地址。此处也可以不使用端口号和PATH而单纯的</span></span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//启动连接并发送HTTP请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//如果服务器响应OK则从服务器获取响应体信息并通过串口输出</span></span><br><span class="line">  <span class="comment">//如果服务器不响应OK则将服务器响应状态码通过串口输出</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    </span><br><span class="line">    Serial.print(<span class="string">&quot;Response Body Size: &quot;</span>);</span><br><span class="line">    Serial.print(httpClient.getSize());</span><br><span class="line">    Serial.println(<span class="string">&quot; Bytes&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-41"><a href="#相关内容-41" class="headerlink" title="相关内容"></a>相关内容</h6><p>— getString – 获取响应体数据并且以字符串形式返回<br>— getStream – 获取响应体数据并且以Stream形式返回<br>— writeToStream – 获取响应体数据并且写入其它Stream对象<br>— errorToString – 获取错误代码并且以字符串形式返回</p>
<h5 id="errorToString-–-获取错误代码并且以字符串形式返回"><a href="#errorToString-–-获取错误代码并且以字符串形式返回" class="headerlink" title="errorToString – 获取错误代码并且以字符串形式返回"></a>errorToString – 获取错误代码并且以字符串形式返回</h5><h6 id="说明-112"><a href="#说明-112" class="headerlink" title="说明"></a>说明</h6><p>此函数可用于将ESP8266的HTTP请求失败代码转换为字符串描述。</p>
<h6 id="语法-111"><a href="#语法-111" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpClient.errorToString(httpCode)</span><br></pre></td></tr></table></figure>

<h6 id="参数-105"><a href="#参数-105" class="headerlink" title="参数"></a>参数</h6><p>httpCode:服务器错误代码。<br>注意，此错误代码非HTTP响应状态码，而是ESP8266库自定义的一系列错误代码。以下是错误代码数值以及该数值所对应的错误信息。</p>
<ul>
<li>-1： HTTPC_ERROR_CONNECTION_REFUSED</li>
<li>-2： HTTPC_ERROR_SEND_HEADER_FAILED</li>
<li>-3： HTTPC_ERROR_SEND_PAYLOAD_FAILED</li>
<li>-4： HTTPC_ERROR_NOT_CONNECTED</li>
<li>-5： HTTPC_ERROR_CONNECTION_LOST</li>
<li>-6： HTTPC_ERROR_NO_STREAM</li>
<li>-7： HTTPC_ERROR_NO_HTTP_SERVER</li>
<li>-8： HTTPC_ERROR_TOO_LESS_RAM</li>
<li>-9： HTTPC_ERROR_ENCODING</li>
<li>-10： HTTPC_ERROR_STREAM_WRITE</li>
<li>-11： HTTPC_ERROR_READ_TIMEOUT</li>
</ul>
<h6 id="返回值-106"><a href="#返回值-106" class="headerlink" title="返回值"></a>返回值</h6><p>服务器响应错误说明（类型：String）</p>
<h6 id="示例程序-97"><a href="#示例程序-97" class="headerlink" title="示例程序"></a>示例程序</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : HTTPClient_errorToString</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用errorToString函数来获取网站服务器请求错误代码。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//创建 HTTPClient 对象</span></span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">-11</span>; i &lt; <span class="number">0</span>; i++)&#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;Response errorToString &quot;</span>);</span><br><span class="line">    Serial.print(i);Serial.print(<span class="string">&quot; - &quot;</span>);</span><br><span class="line">    Serial.println(httpClient.errorToString(i));  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-42"><a href="#相关内容-42" class="headerlink" title="相关内容"></a>相关内容</h6><p>— getString – 获取响应体数据并且以字符串形式返回<br>— getStream – 获取响应体数据并且以Stream形式返回<br>— writeToStream – 获取响应体数据并且写入其它Stream对象<br>— getSize – 获取响应体数据字节数<br>— errorToString – 获取错误代码并且以字符串形式返回</p>
<h2 id="ESP8266-–-ESP8266WebServer库"><a href="#ESP8266-–-ESP8266WebServer库" class="headerlink" title="ESP8266 – ESP8266WebServer库"></a>ESP8266 – ESP8266WebServer库</h2><p>ESP8266WebServer库用于HTTP协议通讯。通过ESP8266WebServer库，我们可以使用ESP8266开发板建立网络服务器,从而允许其它网络设备以及物联网设备通过HTTP协议访问并实现物联网信息交流。</p>
<p>ESP8266库中还有一个专门用于TCP通讯的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiserver/">WiFiServer</a>库 。</p>
<p>由于HTTP协议是建立在TCP协议基础之上的，我们也可以使用WiFiServer库来实现HTTP通讯。在这一点上，WiFiServer库与ESP8266WebServer库 在功能上形成了互补。</p>
<p>以下为ESP8266WebServer库的整体结构图。在此图下方有ESP8266WebServer库的函数目录。您可以通过点击目录项目打开各个函数的说明页面。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527113156373.png" alt="image-20230527113156373"></p>
<h3 id="服务器运行管理分类"><a href="#服务器运行管理分类" class="headerlink" title="服务器运行管理分类"></a>服务器运行管理分类</h3><h4 id="ESP8266WebServer-–-建立新的ESP8266WebServer对象"><a href="#ESP8266WebServer-–-建立新的ESP8266WebServer对象" class="headerlink" title="ESP8266WebServer – 建立新的ESP8266WebServer对象"></a>ESP8266WebServer – 建立新的ESP8266WebServer对象</h4><h5 id="说明-113"><a href="#说明-113" class="headerlink" title="说明"></a>说明</h5><p>此函数用于建立新的ESP8266WebServer对象，以便我们在程序中利用此对象来实现物联网网络服务器。</p>
<h5 id="语法-112"><a href="#语法-112" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ESP8266WebServer server(port)</span><br></pre></td></tr></table></figure>

<h5 id="参数-106"><a href="#参数-106" class="headerlink" title="参数"></a>参数</h5><p>– port: 此参数用于设置服务端口号。如不提供此参数，则默认为80端口。(类型:int)</p>
<h5 id="返回值-107"><a href="#返回值-107" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-98"><a href="#示例程序-98" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>在以下示例程序中，我们通过ESP8266WebServer语句建立了ESP8266WebServer对象，对象名称是server，端口号是server(80)中的数字80。接下来我们就可以通过对象server来实现对ESP8266开发板的物联网服务器的控制。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_server</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义主页访问处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage !&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h4 id="begin-–-服务器启动-1"><a href="#begin-–-服务器启动-1" class="headerlink" title="begin – 服务器启动"></a>begin – 服务器启动</h4><h5 id="说明-114"><a href="#说明-114" class="headerlink" title="说明"></a>说明</h5><p>本函数用于启动ESP8266开发板所建立的网络服务器。</p>
<h5 id="语法-113"><a href="#语法-113" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.begin()</span><br></pre></td></tr></table></figure>

<h5 id="参数-107"><a href="#参数-107" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-108"><a href="#返回值-108" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-99"><a href="#示例程序-99" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>在以下示例程序中，我们通过ESP8266WebServer语句建立了ESP8266WebServer对象，对象名称是server，端口号是server(80)中的数字80。接下来我们就可以通过对象server来实现对ESP8266开发板的物联网服务器的控制。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您在浏览器地址栏中输入IP后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。在以下示例程序中，我们使用了<code>server.begin();</code>来启动ESP8266服务器工作。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_server</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义主页访问处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage !&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="stop-–-停止服务器-1"><a href="#stop-–-停止服务器-1" class="headerlink" title="stop – 停止服务器"></a>stop – 停止服务器</h4><h5 id="说明-115"><a href="#说明-115" class="headerlink" title="说明"></a>说明</h5><p>本函数用于停止ESP8266开发板所建立的网络服务器。</p>
<p>注: stop函数和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/close/">close</a>函数功能相同。</p>
<h5 id="语法-114"><a href="#语法-114" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.stop()</span><br></pre></td></tr></table></figure>

<h5 id="参数-108"><a href="#参数-108" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-109"><a href="#返回值-109" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-100"><a href="#示例程序-100" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您在浏览器地址栏中输入IP后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。当您刷新此页面三次后，ESP8266开发板将会执行server.stop()语句，随即停止物联网服务器功能。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_stop</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  且访问homepage三次之后关停服务器</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置访问次数变量</span></span><br><span class="line"><span class="type">int</span> repeat = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//达到访问次数限制之后停止服务器运行</span></span><br><span class="line">  <span class="keyword">if</span> (++repeat == <span class="number">3</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;服务器停止运行);</span></span><br><span class="line"><span class="string">    server.stop();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">void setup(void) &#123;</span></span><br><span class="line"><span class="string">  //初始化串口</span></span><br><span class="line"><span class="string">  Serial.begin(115200);</span></span><br><span class="line"><span class="string">  Serial.println(&quot;</span><span class="string">&quot;);</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">  //初始化网络</span></span><br><span class="line"><span class="string">  WiFi.mode(WIFI_STA);</span></span><br><span class="line"><span class="string">  WiFi.begin(ssid, password);</span></span><br><span class="line"><span class="string">  while (WiFi.status() != WL_CONNECTED) &#123;</span></span><br><span class="line"><span class="string">    delay(500);</span></span><br><span class="line"><span class="string">    Serial.print(&quot;</span>.<span class="string">&quot;);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  Serial.println(&quot;</span><span class="string">&quot;);</span></span><br><span class="line"><span class="string">  Serial.print(&quot;</span>IP Address: <span class="string">&quot;);</span></span><br><span class="line"><span class="string">  Serial.println(WiFi.localIP());</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">  //初始化WebServer</span></span><br><span class="line"><span class="string">  server.on(&quot;</span>/<span class="string">&quot;, homepage);</span></span><br><span class="line"><span class="string">  server.begin()</span></span><br><span class="line"><span class="string">  Serial.println(&quot;</span>HTTP server started<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">void loop(void) &#123;</span></span><br><span class="line"><span class="string">  //监听客户请求并处理</span></span><br><span class="line"><span class="string">  server.handleClient();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="close-–-停止服务器-1"><a href="#close-–-停止服务器-1" class="headerlink" title="close – 停止服务器"></a>close – 停止服务器</h4><h5 id="说明-116"><a href="#说明-116" class="headerlink" title="说明"></a>说明</h5><p>本函数用于停止ESP8266开发板所建立的网络服务器。</p>
<p>注: close函数和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/stop/">stop</a>函数功能相同。</p>
<h5 id="语法-115"><a href="#语法-115" class="headerlink" title="语法"></a>语法</h5><p>server.close()</p>
<h5 id="参数-109"><a href="#参数-109" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-110"><a href="#返回值-110" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-101"><a href="#示例程序-101" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您在浏览器地址栏中输入IP后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。当您刷新此页面三次后，ESP8266开发板将会执行server.close()语句，随即停止物联网服务器功能。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_close</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  且访问homepage三次之后关停服务器</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置访问次数变量</span></span><br><span class="line"><span class="type">int</span> repeat = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//达到访问次数限制之后停止服务器运行</span></span><br><span class="line">  <span class="keyword">if</span> (++repeat == <span class="number">3</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;服务器停止运行);</span></span><br><span class="line"><span class="string">    server.close();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">void setup(void) &#123;</span></span><br><span class="line"><span class="string">  //初始化串口</span></span><br><span class="line"><span class="string">  Serial.begin(115200);</span></span><br><span class="line"><span class="string">  Serial.println(&quot;</span><span class="string">&quot;);</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">  //初始化网络</span></span><br><span class="line"><span class="string">  WiFi.mode(WIFI_STA);</span></span><br><span class="line"><span class="string">  WiFi.begin(ssid, password);</span></span><br><span class="line"><span class="string">  while (WiFi.status() != WL_CONNECTED) &#123;</span></span><br><span class="line"><span class="string">    delay(500);</span></span><br><span class="line"><span class="string">    Serial.print(&quot;</span>.<span class="string">&quot;);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  Serial.println(&quot;</span><span class="string">&quot;);</span></span><br><span class="line"><span class="string">  Serial.print(&quot;</span>IP Address: <span class="string">&quot;);</span></span><br><span class="line"><span class="string">  Serial.println(WiFi.localIP());</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">  //初始化WebServer</span></span><br><span class="line"><span class="string">  server.on(&quot;</span>/<span class="string">&quot;, homepage);</span></span><br><span class="line"><span class="string">  server.begin();</span></span><br><span class="line"><span class="string">  Serial.println(&quot;</span>HTTP server started<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">void loop(void) &#123;</span></span><br><span class="line"><span class="string">  //监听客户请求并处理</span></span><br><span class="line"><span class="string">  server.handleClient();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="处理客户端HTTP请求分类"><a href="#处理客户端HTTP请求分类" class="headerlink" title="处理客户端HTTP请求分类"></a>处理客户端HTTP请求分类</h3><h4 id="客户端请求处理配置分类"><a href="#客户端请求处理配置分类" class="headerlink" title="客户端请求处理配置分类"></a>客户端请求处理配置分类</h4><h5 id="on-–-可找到资源处理配置"><a href="#on-–-可找到资源处理配置" class="headerlink" title="on – 可找到资源处理配置"></a>on – 可找到资源处理配置</h5><h6 id="说明-117"><a href="#说明-117" class="headerlink" title="说明"></a>说明</h6><p>当ESP8266开发板建立网络服务器以后，每当有客户端向服务器发送HTTP请求时，我们可以利用on函数来设置HTTP请求回调函数。</p>
<p>通过HTTP请求回调函数，我们可以让ESP8266服务器生成响应信息并发送给HTTP请求客户端。</p>
<h6 id="语法-116"><a href="#语法-116" class="headerlink" title="语法"></a>语法</h6><p><code>server.on(uri, uri_handler);</code><br><code>server.on(uri, method, uri_handler);</code></p>
<h6 id="参数-110"><a href="#参数-110" class="headerlink" title="参数"></a>参数</h6><p>– uri: HTTP请求客户端所请求的uri（参数类型:const String*）</p>
<p>– uri_handler: HTTP请求回调函数（参数类型:THandlerFunction）</p>
<p>– method: 此参数用于设置向客户端发送响应信息时所使用的HTTP方法。以下为可供选择的响应方法关键字。</p>
<ul>
<li>HTTP_ANY</li>
<li>HTTP_GET</li>
<li>HTTP_POST</li>
<li>HTTP_PUT</li>
<li>HTTP_PATCH</li>
<li>HTTP_DELETE</li>
<li>HTTP_OPTIONS</li>
</ul>
<h6 id="返回值-111"><a href="#返回值-111" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-102"><a href="#示例程序-102" class="headerlink" title="示例程序"></a>示例程序</h6><p>如需进一步了解本示例程序的详细使用方法，特别是on函数的功能，请参考《<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/">零基础入门学用物联网</a>》免费视频教程中“<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-server/">ESP8266-NodeMCU网络服务器</a>”部分内容。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您在浏览器地址栏中输入IP后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。</p>
<p>在以下示例程序中，我们使用了server.on(“&#x2F;”, homepage);语句来设置浏览器访问网站首页时的回调函数“homepage”。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_on</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage !&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-43"><a href="#相关内容-43" class="headerlink" title="相关内容"></a>相关内容</h6><p>– onNotFound – 未找到资源处理配置<br>– onFileUpload – 文件上传处理配置<br>– addHandler – 设置请求响应回调</p>
<h5 id="onNotFound-–-未找到资源处理配置"><a href="#onNotFound-–-未找到资源处理配置" class="headerlink" title="onNotFound – 未找到资源处理配置"></a>onNotFound – 未找到资源处理配置</h5><h6 id="说明-118"><a href="#说明-118" class="headerlink" title="说明"></a>说明</h6><p>当ESP8266开发板建立网络服务器以后，每当有客户端向服务器发送HTTP请求时，我们可以利用onNotFound函数来设置HTTP请求无效地址的回调函数。</p>
<p>通过无效地址回调函数，我们可以让ESP8266服务器生成响应信息并在客户端请求无效地址时，将404页面信息发送给客户端。</p>
<h6 id="语法-117"><a href="#语法-117" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.onNotFound(function)</span><br></pre></td></tr></table></figure>

<h6 id="参数-111"><a href="#参数-111" class="headerlink" title="参数"></a>参数</h6><p>function – 处理无效地址请求的回调函数(类型: THandlerFunction)</p>
<h6 id="返回值-112"><a href="#返回值-112" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-103"><a href="#示例程序-103" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您在浏览器地址栏中输入IP后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。</p>
<p>在以下示例程序中，我们使用了server.onNotFound(handleNotFound);语句来设置浏览器访问无效地址的回调函数“handleNotFound”。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_onNotFound</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  当访问地址为主页之外的路劲时返回404页面</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置主页</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage !&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);   <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-44"><a href="#相关内容-44" class="headerlink" title="相关内容"></a>相关内容</h6><p>– on – 可找到资源处理配置<br>– onFileUpload – 文件上传处理配置<br>– addHandler – 设置请求响应回调</p>
<h5 id="onFileUpload-–-文件上传处理配置"><a href="#onFileUpload-–-文件上传处理配置" class="headerlink" title="onFileUpload – 文件上传处理配置"></a>onFileUpload – 文件上传处理配置</h5><h6 id="说明-119"><a href="#说明-119" class="headerlink" title="说明"></a>说明</h6><p>当ESP8266建立的网络服务器收到了客户端的文件上传请求时，我们可以利用此函数来配置处理文件上传请求的回调函数。</p>
<h6 id="语法-118"><a href="#语法-118" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.onFileUpload(function)</span><br></pre></td></tr></table></figure>

<h6 id="参数-112"><a href="#参数-112" class="headerlink" title="参数"></a>参数</h6><p>function</p>
<p>– 处理文件上传请求的回调函数(类型: THandlerFunction)</p>
<h6 id="返回值-113"><a href="#返回值-113" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="相关内容-45"><a href="#相关内容-45" class="headerlink" title="相关内容"></a>相关内容</h6><p>– on – 可找到资源处理配置<br>– onNotFound – 未找到资源处理配置<br>– onFileUpload – 文件上传处理配置<br>– addHandler – 设置请求响应回调</p>
<h5 id="addHandler-–-设置请求响应回调"><a href="#addHandler-–-设置请求响应回调" class="headerlink" title="addHandler – 设置请求响应回调"></a>addHandler – 设置请求响应回调</h5><h6 id="说明-120"><a href="#说明-120" class="headerlink" title="说明"></a>说明</h6><p>该函数可自定义请求处理。</p>
<h6 id="语法-119"><a href="#语法-119" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.addHandler(requestHandler)</span><br></pre></td></tr></table></figure>

<h6 id="参数-113"><a href="#参数-113" class="headerlink" title="参数"></a>参数</h6><p>requestHandler: RequestHandler对象</p>
<h6 id="返回值-114"><a href="#返回值-114" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h4 id="处理客户端请求分类"><a href="#处理客户端请求分类" class="headerlink" title="处理客户端请求分类"></a>处理客户端请求分类</h4><h5 id="handleClient-–-处理客户端请求"><a href="#handleClient-–-处理客户端请求" class="headerlink" title="handleClient – 处理客户端请求"></a>handleClient – 处理客户端请求</h5><h6 id="说明-121"><a href="#说明-121" class="headerlink" title="说明"></a>说明</h6><p>此函数主要作用是检查有没有客户端设备通过网络向ESP8266网络服务器发送请求。每一次handleClient&#96;函数被调用时，ESP8266网络服务器都会检查一下是否有客户端发送HTTP请求。因此建议将该函数放在loop函数中，从而确保它能经常被调用。</p>
<p>假如loop函数里有类似delay一类的函数延迟程序运行，那么就一定要注意了。如果handleClient函数长时间得不到调用，ESP8266网络服务器会因为无法经常检查HTTP客户端请求而导致服务器响应变慢，严重的情况下，会导致服务器工作不稳定。</p>
<h6 id="语法-120"><a href="#语法-120" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.handleClient()</span><br></pre></td></tr></table></figure>

<h6 id="参数-114"><a href="#参数-114" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-115"><a href="#返回值-115" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-104"><a href="#示例程序-104" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。<strong>WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址</strong>。此时，ESP8266已经成功建立了网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您在浏览器地址栏中输入IP后并按下回车，这时您将看到浏览器中显示上图所示的网页页面。该页面即是通过ESP8266所建立的。以下示例程序中，我们使用了esp8266_server.handleClient(); 语句来让ESP8266检查浏览器的请求。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : 3_2_1_First_Web_Server</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : 使用NodeMCU建立基本服务器。用户可通过浏览器使用8266的IP地址</span></span><br><span class="line"><span class="comment">                           访问8266所建立的基本网页（Hello from ESP8266）</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span>        <span class="comment">// 本程序使用 ESP8266WiFi库</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span>   <span class="comment">//  ESP8266WiFiMulti库</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span>   <span class="comment">//  ESP8266WebServer库</span></span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;     <span class="comment">// 建立ESP8266WiFiMulti对象,对象名称是&#x27;wifiMulti&#x27;</span></span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">esp8266_server</span><span class="params">(<span class="number">80</span>)</span>;<span class="comment">// 建立ESP8266WebServer对象，对象名称为esp8266_server</span></span><br><span class="line">                                    <span class="comment">// 括号中的数字是网路服务器响应http请求的端口号</span></span><br><span class="line">                                    <span class="comment">// 网络服务器标准http端口号为80，因此这里使用80为端口号</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          <span class="comment">// 启动串口通讯</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">//通过addAp函数存储  WiFi名称       WiFi密码</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;taichi-maker&quot;</span>, <span class="string">&quot;12345678&quot;</span>);  <span class="comment">// 这三条语句通过调用函数addAP来记录3个不同的WiFi网络信息。</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;taichi-maker2&quot;</span>, <span class="string">&quot;87654321&quot;</span>); <span class="comment">// 这3个WiFi网络名称分别是taichi-maker, taichi-maker2, taichi-maker3。</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;taichi-maker3&quot;</span>, <span class="string">&quot;13572468&quot;</span>); <span class="comment">// 这3个网络的密码分别是123456789，87654321，13572468。</span></span><br><span class="line">                                                <span class="comment">// 此处WiFi信息只是示例，请在使用时将需要连接的WiFi信息填入相应位置。</span></span><br><span class="line">                                                <span class="comment">// 另外这里只存储了3个WiFi信息，您可以存储更多的WiFi信息在此处。</span></span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;                                 </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123;  <span class="comment">// 此处的wifiMulti.run()是重点。通过wifiMulti.run()，NodeMCU将会在当前</span></span><br><span class="line">    delay(<span class="number">1000</span>);                             <span class="comment">// 环境中搜索addAP函数所存储的WiFi。如果搜到多个存储的WiFi那么NodeMCU</span></span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);    <span class="comment">// 将会连接信号最强的那一个WiFi信号。</span></span><br><span class="line">  &#125;                                          <span class="comment">// 一旦连接WiFI成功，wifiMulti.run()将会返回“WL_CONNECTED”。这也是</span></span><br><span class="line">                                             <span class="comment">// 此处while循环判断是否跳出循环的条件。</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&#x27;\n&#x27;</span>);                     <span class="comment">// WiFi连接成功后</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);            <span class="comment">// NodeMCU将通过串口监视器输出。</span></span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// 连接的WiFI名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);            <span class="comment">// 以及</span></span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// NodeMCU的IP地址</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//--------&quot;启动网络服务功能&quot;程序部分开始-------- //  此部分为程序为本示例程序重点1</span></span><br><span class="line">  esp8266_server.begin();                   <span class="comment">//  详细讲解请参见太极创客网站《零基础入门学用物联网》</span></span><br><span class="line">  esp8266_server.on(<span class="string">&quot;/&quot;</span>, handleRoot);       <span class="comment">//  第3章-第2节 ESP8266-NodeMCU网络服务器-1</span></span><br><span class="line">  esp8266_server.onNotFound(handleNotFound);        </span><br><span class="line"><span class="comment">//--------&quot;启动网络服务功能&quot;程序部分结束--------</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP esp8266_server started&quot;</span>);<span class="comment">//  告知用户ESP8266网络服务功能已经启动</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 以下函数语句为本示例程序重点3</span></span><br><span class="line"><span class="comment">详细讲解请参见太极创客网站《零基础入门学用物联网》</span></span><br><span class="line"><span class="comment">第3章-第2节 3_2_1_First_Web_Server 的说明讲解*/</span>  </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">  esp8266_server.handleClient();     <span class="comment">// 处理http服务器访问</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 以下两个函数为本示例程序重点2</span></span><br><span class="line"><span class="comment">详细讲解请参见太极创客网站《零基础入门学用物联网》</span></span><br><span class="line"><span class="comment">第3章-第2节 3_2_1_First_Web_Server 的说明讲解*/</span>                                                                            </span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;   <span class="comment">//处理网站根目录“/”的访问请求 </span></span><br><span class="line">  esp8266_server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;Hello from ESP8266&quot;</span>);   <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span>&#123;                                        <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  esp8266_server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);   <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-46"><a href="#相关内容-46" class="headerlink" title="相关内容"></a>相关内容</h6><p>– on – 可找到资源处理配置<br>– onNotFound – 未找到资源处理配置<br>– onFileUpload – 文件上传处理配置<br>– addHandler – 设置请求响应回调</p>
<h4 id="获取客户端请求信息分类"><a href="#获取客户端请求信息分类" class="headerlink" title="获取客户端请求信息分类"></a>获取客户端请求信息分类</h4><p><strong>获取客户端请求行信息分类</strong></p>
<h5 id="uri-–-获取请求路径"><a href="#uri-–-获取请求路径" class="headerlink" title="uri – 获取请求路径"></a>uri – 获取请求路径</h5><h6 id="说明-122"><a href="#说明-122" class="headerlink" title="说明"></a>说明</h6><p>使用该函数可获取客户端发送的HTTP请求行中的请求资源路径信息。</p>
<h6 id="语法-121"><a href="#语法-121" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.uri()</span><br></pre></td></tr></table></figure>

<h6 id="参数-115"><a href="#参数-115" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-116"><a href="#返回值-116" class="headerlink" title="返回值"></a>返回值</h6><p>客户端请求行中的请求资源路径信息。（类型：字符串）</p>
<h6 id="示例程序-105"><a href="#示例程序-105" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过ESP8266开发板串口监视器看到浏览器发送的GET请求路径。我们在以下示例程序中使用了<code>Serial.println(server.uri());</code>语句来实现通过串口监视器输出浏览器请求资源路径。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_uri</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置访问次数变量</span></span><br><span class="line"><span class="type">int</span> repeat = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  Serial.println(server.uri());</span><br><span class="line">  <span class="comment">//达到访问次数限制之后停止服务器运行</span></span><br><span class="line">  <span class="keyword">if</span> (++repeat == <span class="number">50</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">    server.stop();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  Serial.print(<span class="string">&quot;当前请求路径 :&quot;</span>); </span><br><span class="line">  Serial.print(WiFi.localIP()); </span><br><span class="line">  Serial.println(server.uri());  <span class="comment">//串口输出当前客户端的请求路径</span></span><br><span class="line">  </span><br><span class="line">  Serial.print(<span class="string">&quot;当前请求方法 :&quot;</span>); </span><br><span class="line">  Serial.println(server.method());  <span class="comment">//串口输出当前客户端的请求方法</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-47"><a href="#相关内容-47" class="headerlink" title="相关内容"></a>相关内容</h6><p>– uri – 获取请求路径<br>– method – 获取请求方法</p>
<h5 id="method-–-获取请求方法"><a href="#method-–-获取请求方法" class="headerlink" title="method – 获取请求方法"></a>method – 获取请求方法</h5><h6 id="说明-123"><a href="#说明-123" class="headerlink" title="说明"></a>说明</h6><p>此函数用于获取客户端的HTTP请求方法。</p>
<h6 id="语法-122"><a href="#语法-122" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.method()</span><br></pre></td></tr></table></figure>

<h6 id="参数-116"><a href="#参数-116" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-117"><a href="#返回值-117" class="headerlink" title="返回值"></a>返回值</h6><p>HTTP请求方法代表值。（类型: HTTPMethod）</p>
<p>以下为各请求方法及其所对应的代表值。</p>
<ul>
<li>HTTP_ANY   1</li>
<li>HTTP_GET   1</li>
<li>HTTP_POST   3</li>
<li>HTTP_PUT   4</li>
<li>HTTP_PATCH   5</li>
<li>HTTP_DELETE   6</li>
<li>HTTP_OPTIONS   7</li>
</ul>
<h6 id="示例程序-106"><a href="#示例程序-106" class="headerlink" title="示例程序"></a>示例程序</h6><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过ESP8266开发板串口监视器看到浏览器发送的GET请求方法。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_uri</span></span><br><span class="line"><span class="comment">  团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">  作者/Author              : Dapenson</span></span><br><span class="line"><span class="comment">  日期/Date（YYYYMMDD）     : 20200320</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  -----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">  本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">  该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">  http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置访问次数变量</span></span><br><span class="line"><span class="type">int</span> repeat = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  Serial.println(server.method());  <span class="comment">//串口输出当前客户端的请求方法</span></span><br><span class="line">  <span class="comment">//达到访问次数限制之后停止服务器运行</span></span><br><span class="line">  <span class="keyword">if</span> (++repeat == <span class="number">50</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">    server.stop();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  </span><br><span class="line">  Serial.print(<span class="string">&quot;当前请求路径 :&quot;</span>); </span><br><span class="line">  Serial.print(WiFi.localIP()); </span><br><span class="line">  Serial.println(server.uri());  <span class="comment">//串口输出当前客户端的请求路径</span></span><br><span class="line">  </span><br><span class="line">  Serial.print(<span class="string">&quot;当前请求方法 :&quot;</span>); </span><br><span class="line">  Serial.println(server.method());  <span class="comment">//串口输出当前客户端的请求方法</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-48"><a href="#相关内容-48" class="headerlink" title="相关内容"></a>相关内容</h6><p>– uri – 获取请求路径</p>
<p><strong>获取客户端请求头信息分类</strong></p>
<h5 id="collectHeaders-–-设置需要收集哪些请求头信息"><a href="#collectHeaders-–-设置需要收集哪些请求头信息" class="headerlink" title="collectHeaders – 设置需要收集哪些请求头信息"></a>collectHeaders – 设置需要收集哪些请求头信息</h5><h6 id="说明-124"><a href="#说明-124" class="headerlink" title="说明"></a>说明</h6><p>使用ESP8266开发板实现的物联网服务器可以收集客户端发送的请求头信息。我们知道，HTTP客户端发送的请求信息中通常是包含多个HTTP请求头信息的。利用collectHeaders函数，我们可以设置需要获取的HTTP请求头信息，以便我们在后面的程序中加以处理使用。</p>
<p><strong>请注意：在我们使用ESP8266WebServer库中的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/headers/">headers</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/header/">header</a> 、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/headername/">headerName</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/hasheader/">hasHeader</a> 函数来获取浏览器请求头以前，需要首先调用本函数来设置ESP8266具体收集哪些请求头信息。</strong></p>
<h6 id="语法-123"><a href="#语法-123" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.collectHeaders(headerKeys, headerKeysCount)</span><br></pre></td></tr></table></figure>

<h6 id="参数-117"><a href="#参数-117" class="headerlink" title="参数"></a>参数</h6><p>– headerKeys: 请求头名数组。此数组中的元素即是需要ESP8266处理或收集的请求头信息。下面我们看一个headerKeys数组的例子：<br>const char *headerKeys[] &#x3D; {“Content-Length”, “Date”};<br>此数组共有两个元素，分别是”Content-Length”和”Date”。只有如此建立了数组后，接下来的程序里我们才可以使用其它ESP8266WebServer库函数来处理这两个请求头的信息内容。可以把这个数组看作是对ESP8266的提醒，即告诉ESP8266在后续的程序中，我们将要对数组中所包含的请求头信息进行处理。（具体操作方法，请见本函数的示例程序部分。）</p>
<p>– headerKeysCount: 需要获取&#x2F;处理的请求头个数（可选参数，类型：size_t）</p>
<h6 id="返回值-118"><a href="#返回值-118" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-107"><a href="#示例程序-107" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过ESP8266开发板串口监视器看到浏览器发送的请求头信息中的connection以及HOST信息。（如下图所示）</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527120439433.png" alt="image-20230527120439433"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_collectHeaders</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  访问主页将从串口反馈请求头的信息,具体内容请参考自定义函数 echo_headers()</span></span><br><span class="line"><span class="comment">  注:本示例程序为获取客户端请求头信息分类函数中功能较全的版本</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置访问次数变量</span></span><br><span class="line"><span class="type">int</span> repeat = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_headers();</span><br><span class="line">  <span class="comment">//达到访问次数限制之后停止服务器运行</span></span><br><span class="line">  <span class="keyword">if</span> (++repeat == <span class="number">50</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">    server.stop();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">  server.collectHeaders(headerKeys, <span class="keyword">sizeof</span>(headerKeys) / <span class="keyword">sizeof</span>(headerKeys[<span class="number">0</span>]));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_headers</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (server.hasHeader(<span class="string">&quot;Connection&quot;</span>)) &#123;<span class="comment">//判断该请求头是否存在</span></span><br><span class="line">    <span class="comment">//使用示例,打印当前收集的请求头的数量</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前请求所收集的请求头数量:&quot;</span>); Serial.println(server.headers());</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//打印当前请求中所收集的请求头指定项的值</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前请求所收集的请求头Connection:&quot;</span>); Serial.println(server.header(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//打印当前请求中所收集的Host</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前请求所收集的请求头Host :&quot;</span>); Serial.println(server.hostHeader());</span><br><span class="line">    <span class="comment">//分隔空行</span></span><br><span class="line">    Serial.println(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-49"><a href="#相关内容-49" class="headerlink" title="相关内容"></a>相关内容</h6><p>– headers – 获得请求头数量<br>– header – 获得指定请求头所对应的数值<br>– headerName – 获取指定请求头的名称<br>– hasHeader – 确定是否包含指定请求头</p>
<h5 id="headers-–-获得请求头数量"><a href="#headers-–-获得请求头数量" class="headerlink" title="headers – 获得请求头数量"></a>headers – 获得请求头数量</h5><h6 id="说明-125"><a href="#说明-125" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的请求头数量</p>
<p>请注意，使用此函数前必须先使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/collectheaders/">collectHeaders</a>函数来设置具体收集的请求头内容。</p>
<h6 id="语法-124"><a href="#语法-124" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.headers()</span><br></pre></td></tr></table></figure>

<h6 id="参数-118"><a href="#参数-118" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-119"><a href="#返回值-119" class="headerlink" title="返回值"></a>返回值</h6><p>获取的响应头的数量 （返回值类型:int）</p>
<h6 id="示例程序-108"><a href="#示例程序-108" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过串口监视器看到开发板的开发板收集的请求头数量。下图是程序运行结果。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527120604924.png" alt="image-20230527120604924"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_headers</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  访问主页将从串口反馈请求头的信息,具体内容请参考自定义函数 echo_headers()</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置访问次数变量</span></span><br><span class="line"><span class="type">int</span> repeat = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Connection&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">  server.collectHeaders(headerKeys, <span class="keyword">sizeof</span>(headerKeys) / <span class="keyword">sizeof</span>(headerKeys[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_headers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//使用示例,打印当前收集的请求头的数量</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前请求所收集的请求头数量:&quot;</span>); Serial.println(server.headers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-50"><a href="#相关内容-50" class="headerlink" title="相关内容"></a>相关内容</h6><p>– collectHeaders – 设置需要收集哪些请求头信息<br>– header – 获得指定请求头所对应的数值<br>– headerName – 获取指定请求头的名称<br>– hasHeader – 确定是否包含指定请求头</p>
<h5 id="header-–-获得指定请求头所对应的数值"><a href="#header-–-获得指定请求头所对应的数值" class="headerlink" title="header – 获得指定请求头所对应的数值"></a>header – 获得指定请求头所对应的数值</h5><h6 id="说明-126"><a href="#说明-126" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的请求头参数值。</p>
<p>请注意，使用此函数前必须先使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/collectheaders/">collectHeaders</a>函数来设置具体收集的请求头内容。</p>
<h6 id="语法-125"><a href="#语法-125" class="headerlink" title="语法"></a>语法</h6><p><code>server.header(name)</code><br><code>server.header(index)</code></p>
<h6 id="参数-119"><a href="#参数-119" class="headerlink" title="参数"></a>参数</h6><p>– name: 响应头名称(参数类型: String )<br>– index: 响应头序号(参数类型: int)</p>
<h6 id="返回值-120"><a href="#返回值-120" class="headerlink" title="返回值"></a>返回值</h6><p>返回请求头中指定项的值。(类型: String )</p>
<h6 id="示例程序-109"><a href="#示例程序-109" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过串口监视器看到浏览器发送的“connection”请求头信息。</p>
<p>具体实现这一功能是通过以下程序中高亮语句<code>server.header(&quot;Connection&quot;)</code>实现的。该语句中header函数的参数”Connection”即是设置开发板要获取的是客户端请求头信息中的”Connection”参数值。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527120732250.png" alt="image-20230527120732250"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************=</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_header</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  访问主页将从串口反馈请求头的信息,具体内容请参考自定义函数 echo_headers()</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">  server.collectHeaders(headerKeys, <span class="keyword">sizeof</span>(headerKeys) / <span class="keyword">sizeof</span>(headerKeys[<span class="number">0</span>]));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_headers</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打印当前请求中所收集的请求头的值信息,请求头名称+请求头值</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Header \&quot;Connection\&quot;: &quot;</span>); Serial.println(server.header(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-51"><a href="#相关内容-51" class="headerlink" title="相关内容"></a>相关内容</h6><p>– collectHeaders – 设置需要收集哪些请求头信息<br>– headers – 获得请求头数量<br>– headerName – 获取指定请求头的名称<br>– hasHeader – 确定是否包含指定请求头</p>
<h5 id="headerName-–-获取指定请求头的名称"><a href="#headerName-–-获取指定请求头的名称" class="headerlink" title="headerName – 获取指定请求头的名称"></a>headerName – 获取指定请求头的名称</h5><h6 id="说明-127"><a href="#说明-127" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的请求头的名称。</p>
<p>请注意，使用此函数前必须先使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/collectheaders/">collectHeaders</a>函数来设置具体收集的请求头内容。</p>
<h6 id="语法-126"><a href="#语法-126" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.headerName(index)</span><br></pre></td></tr></table></figure>

<h6 id="参数-120"><a href="#参数-120" class="headerlink" title="参数"></a>参数</h6><p>index: 请求头序号。（类型: int）</p>
<h6 id="返回值-121"><a href="#返回值-121" class="headerlink" title="返回值"></a>返回值</h6><p>指定请求头名称（类型: String）</p>
<h6 id="示例程序-110"><a href="#示例程序-110" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过串口监视器看到浏览器发送的请求头名称以及该请求头对应的数值。</p>
<p>以下程序使用了<code>server.headerName(1)</code>获取序号为1的请求头名称，也就是”Connection”。下图是程序运行的结果。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527120930714.png" alt="image-20230527120930714"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_headerName</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  访问主页将从串口反馈请求头的信息,具体内容请参考自定义函数 echo_headers()</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Connection&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">  server.collectHeaders(headerKeys, <span class="keyword">sizeof</span>(headerKeys) / <span class="keyword">sizeof</span>(headerKeys[<span class="number">0</span>]));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_headers</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//打印当前请求中所收集的请求头的值信息,请求头名称+请求头值</span></span><br><span class="line">  Serial.print(server.headerName(<span class="number">1</span>)); </span><br><span class="line">  Serial.print(<span class="string">&quot; = &quot;</span>); </span><br><span class="line">  Serial.println(server.header(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-52"><a href="#相关内容-52" class="headerlink" title="相关内容"></a>相关内容</h6><p>– collectHeaders – 设置需要收集哪些请求头信息<br>– headers – 获得请求头数量<br>– header – 获得指定请求头所对应的数值<br>– hasHeader – 确定是否包含指定请求头</p>
<h5 id="hasHeader-–-确定是否包含指定请求头"><a href="#hasHeader-–-确定是否包含指定请求头" class="headerlink" title="hasHeader – 确定是否包含指定请求头"></a>hasHeader – 确定是否包含指定请求头</h5><h6 id="说明-128"><a href="#说明-128" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的请求头中有无用户指定的请求头信息。</p>
<p>请注意，使用此函数前必须先使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/collectheaders/">collectHeaders</a>函数来设置具体收集的请求头内容。</p>
<h6 id="语法-127"><a href="#语法-127" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.hasHeader(name)</span><br></pre></td></tr></table></figure>

<h6 id="参数-121"><a href="#参数-121" class="headerlink" title="参数"></a>参数</h6><p>name<br>需要确认客户端请求中是否存在的请求头信息名。(参数类型:String)</p>
<h6 id="返回值-122"><a href="#返回值-122" class="headerlink" title="返回值"></a>返回值</h6><p>检查请求头中是否存在指定请求头信息。如果存在则返回真,否则返回假。返回值类型: bool</p>
<h6 id="示例程序-111"><a href="#示例程序-111" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您就可以通过串口监视器看到浏览器发送的请求头中是否存在“Connection”信息。</p>
<p>以下示例程序使用了server.hasHeader(“Connection”)来判断浏览器发送的请求头中是否存在“Connection”信息。以下是该程序运行的结果演示。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527121227250.png" alt="image-20230527121227250"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_hasHeader</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  并从串口反馈请求头的信息,具体内容请参考自定义函数 echo_headers()</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 实例化对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123; <span class="string">&quot;Connection&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">  server.collectHeaders(headerKeys, <span class="keyword">sizeof</span>(headerKeys) / <span class="keyword">sizeof</span>(headerKeys[<span class="number">0</span>]));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_headers</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//判断该请求头是否存在Connection信息</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasHeader(<span class="string">&quot;Connection&quot;</span>)) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;请求信息包含Connection&quot;</span>); </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;请求信息不包含Connection&quot;</span>); </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-53"><a href="#相关内容-53" class="headerlink" title="相关内容"></a>相关内容</h6><p>– collectHeaders – 设置需要收集哪些请求头信息<br>– headers – 获得请求头数量<br>– header – 获得指定请求头所对应的数值<br>– headerName – 获取指定请求头的名称</p>
<h5 id="authenticate-–-请求认证校验"><a href="#authenticate-–-请求认证校验" class="headerlink" title="authenticate – 请求认证校验"></a>authenticate – 请求认证校验</h5><h6 id="说明-129"><a href="#说明-129" class="headerlink" title="说明"></a>说明</h6><p>我们在使用ESP8266开发板实现物联网服务器时，可以通过本函数建立加密网页。也就是说，用户必须正确输入访问用户名和密码方可访问物联网服务器所建立的页面内容。</p>
<p>请注意，与此函数配套使用的是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/requestauthentication/">requestAuthentication</a>函数。requestAuthentication函数用于向客户端发送认证请求，而authenticate函数用于设置与校验客户端请求信息中的用户名和密码。</p>
<h6 id="语法-128"><a href="#语法-128" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">authenticate(username, password)</span><br></pre></td></tr></table></figure>

<h6 id="参数-122"><a href="#参数-122" class="headerlink" title="参数"></a>参数</h6><p>username：客户端访问物联网服务器加密页面时的认证用户名（参数类型:const char*）</p>
<p>password：客户端访问物联网服务器加密页面时的认证密码（参数类型:const char*）</p>
<p>返回值</p>
<p>如果用户密码输入正确则返回真,输入错误则返回假。</p>
<h6 id="示例程序-112"><a href="#示例程序-112" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>接下来浏览器将会弹出对话框，要求用户输入用户名:TaichiMaker和密码:123456。如下图所示。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527121515042.png" alt="image-20230527121515042"></p>
<p>只有当用户正确输入了用户名和密码信息以后，方可打开ESP8266开发板建立的网站页面。（如下图所示）</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527121534407.png" alt="image-20230527121534407"></p>
<p>以下示例程序中的高亮语句<code>server.authenticate(&quot;TaichiMaker&quot;, &quot;123456&quot;)</code>设置了服务器的访问用户名和密码信息。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_authenticate</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  在登录主页时使用认证方式登录,并从串口反馈请求头的信息</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;XXXXXXXX&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//校验用户登录账号和密码,(使用Basic方式),若输入错误则继续返回认证界面</span></span><br><span class="line">  <span class="keyword">if</span> (!server.authenticate(<span class="string">&quot;TaichiMaker&quot;</span>, <span class="string">&quot;123456&quot;</span>)) <span class="keyword">return</span> server.requestAuthentication();</span><br><span class="line"> </span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_headers();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">  <span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line">  server.collectHeaders(headerKeys, <span class="keyword">sizeof</span>(headerKeys) / <span class="keyword">sizeof</span>(headerKeys[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_headers</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (server.hasHeader(<span class="string">&quot;Connection&quot;</span>)) &#123;<span class="comment">//判断该请求头是否存在</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//打印当前请求中所收集的请求头指定项的值</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前请求所收集的请求头Connection:&quot;</span>); Serial.println(server.header(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//打印当前请求中所收集的Host</span></span><br><span class="line">    Serial.print(<span class="string">&quot;当前请求所收集的请求头Host :&quot;</span>); Serial.println(server.hostHeader());</span><br><span class="line">    <span class="comment">//分隔空行</span></span><br><span class="line">    Serial.println(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="相关内容-54"><a href="#相关内容-54" class="headerlink" title="相关内容"></a>相关内容</h6><p>– requestAuthentication</p>
<p><strong>获取客户端请求参数信息分类</strong></p>
<h5 id="args-–-请求包含的参数数量"><a href="#args-–-请求包含的参数数量" class="headerlink" title="args – 请求包含的参数数量"></a>args – 请求包含的参数数量</h5><h6 id="说明-130"><a href="#说明-130" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的请求体中的参数数量。</p>
<h6 id="语法-129"><a href="#语法-129" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.args()</span><br></pre></td></tr></table></figure>

<h6 id="参数-123"><a href="#参数-123" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-123"><a href="#返回值-123" class="headerlink" title="返回值"></a>返回值</h6><p>返回获取的请求体中所包含的参数数量（返回值类型:int）</p>
<h6 id="示例程序-113"><a href="#示例程序-113" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的开发板IP地址为192.168.0.106，那么接下来您可以通过浏览器输入以下地址信息。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.0.106/?a=1&b=2">http://192.168.0.106/?a=1&amp;b=2</a></p>
<p>我们可以看到，以上信息中有两个参数，那么接下来您就可以通过串口监视器查看开发板所接收到的参数数量。如下图所示。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527125607379.png" alt="image-20230527125607379"></p>
<p>在以下的示例程序中，我们通过使用server.args()来获取客户端请求信息中的参数数量。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_args</span></span><br><span class="line"><span class="comment">  团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">  作者/Author              : Dapenson</span></span><br><span class="line"><span class="comment">  日期/Date（YYYYMMDD）     : 20200320</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  并在请求成功后返回请求体的参数数量,具体请参考自定义函数 echo_args()中的内容</span></span><br><span class="line"><span class="comment">  -----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">  本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">  该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">  http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;XXXXXXXX&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建ESP8266WebServer对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义返回请求体信息</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_args</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;当前请求中请求体数量:&quot;</span>); Serial.println(server.args());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-55"><a href="#相关内容-55" class="headerlink" title="相关内容"></a>相关内容</h6><p>– arg – 请求中指定参数的数值<br>– argName – 请求中参数名<br>– hasArg – 判断请求中是否包含某个参数名</p>
<h5 id="arg-–-请求中指定参数的数值"><a href="#arg-–-请求中指定参数的数值" class="headerlink" title="arg – 请求中指定参数的数值"></a>arg – 请求中指定参数的数值</h5><h6 id="说明-131"><a href="#说明-131" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的指定参数的数值。</p>
<h6 id="语法-130"><a href="#语法-130" class="headerlink" title="语法"></a>语法</h6><p><code>server.arg(Name)</code><br><code>server.arg(index)</code></p>
<h6 id="参数-124"><a href="#参数-124" class="headerlink" title="参数"></a>参数</h6><p>– Name<br>请求体中的参数名（参数类型: String）</p>
<p>– index<br>请求体中的参数序列号（参数类型: int）</p>
<h6 id="返回值-124"><a href="#返回值-124" class="headerlink" title="返回值"></a>返回值</h6><p>指定参数的数值（类型：String）</p>
<h6 id="示例程序-114"><a href="#示例程序-114" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的开发板IP地址为192.168.0.106，那么接下来您可以通过浏览器输入以下地址信息。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.0.106/?a=1&b=2&c=3">http://192.168.0.106/?a=1&amp;b=2&amp;c=3</a></p>
<p>我们可以看到，以上信息中有三个参数，这些参数中，a的数值为1，序列号为2的参数数值为3（序列号0的参数为a, 序列号1的参数为b…）。</p>
<p>在以下示例程序中，我们使用<code>server.arg(&quot;a&quot;)</code>来获取参数a的数值。使用<code>server.arg(2)</code>来获取序列号为2的参数数值。以下是串口监视器显示的以上语句所获取的参数数值。 </p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527125824441.png" alt="image-20230527125824441"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_arg</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  并在请求成功后返回请求体的指定请求项的值,具体请参考自定义函数 echo_args()中的内容</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建ESP8266WebServer对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义返回请求体信息</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_args</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;请求体参数a的值:&quot;</span>); Serial.println(server.arg(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">  Serial.print(<span class="string">&quot;请求体第2个参数的值:&quot;</span>); Serial.println(server.arg(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-56"><a href="#相关内容-56" class="headerlink" title="相关内容"></a>相关内容</h6><p>– args – 请求包含的参数数量<br>– argName – 请求中参数名<br>– hasArg – 判断请求中是否包含某个参数名</p>
<h5 id="argName-–-请求中参数名"><a href="#argName-–-请求中参数名" class="headerlink" title="argName – 请求中参数名"></a>argName – 请求中参数名</h5><h6 id="说明-132"><a href="#说明-132" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的指定参数名称。</p>
<h6 id="语法-131"><a href="#语法-131" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.argName(index)</span><br></pre></td></tr></table></figure>

<h6 id="参数-125"><a href="#参数-125" class="headerlink" title="参数"></a>参数</h6><p>– index<br>请求体中的参数序列号（参数类型: int）</p>
<h6 id="返回值-125"><a href="#返回值-125" class="headerlink" title="返回值"></a>返回值</h6><p>请求信息中指定参数的名称 (返回值类型: String)</p>
<h6 id="示例程序-115"><a href="#示例程序-115" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的开发板IP地址为192.168.0.106，那么接下来您可以通过浏览器输入以下地址信息。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.0.106/?a=1&b=2&c=3">http://192.168.0.106/?a=1&amp;b=2&amp;c=3</a></p>
<p>在以下示例程序中，我们使用了<code>server.argName(2)</code>来获取序列号为2的参数名称，也就是c（序列号0的参数为a, 序列号1的参数为b…）。以下是串口监视器显示的以上语句所获取的参数名称。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527125909049.png" alt="image-20230527125909049"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_argName</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  并在请求成功后返回请求体的指定项名称,具体请参考自定义函数 echo_args()中的内容</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建ESP8266WebServer对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义返回请求体信息</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_args</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;当前请求中请求体2的名称:&quot;</span>);</span><br><span class="line">  Serial.println(server.argName(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-57"><a href="#相关内容-57" class="headerlink" title="相关内容"></a>相关内容</h6><p>– args – 请求包含的参数数量<br>– arg – 请求中指定参数的数值<br>– hasArg – 判断请求中是否包含某个参数名</p>
<h5 id="hasArg-–-判断请求中是否包含某个参数名"><a href="#hasArg-–-判断请求中是否包含某个参数名" class="headerlink" title="hasArg – 判断请求中是否包含某个参数名"></a>hasArg – 判断请求中是否包含某个参数名</h5><h6 id="说明-133"><a href="#说明-133" class="headerlink" title="说明"></a>说明</h6><p>使用本函数，我们可以获取客户端向ESP8266物联网服务器发送的请求信息中有无指定的参数。</p>
<h6 id="语法-132"><a href="#语法-132" class="headerlink" title="语法"></a>语法</h6><p><code>server.hasArg(name)</code></p>
<h6 id="参数-126"><a href="#参数-126" class="headerlink" title="参数"></a>参数</h6><p>– Name<br>需要确认的请求体中的参数名（参数类型: String）</p>
<h6 id="返回值-126"><a href="#返回值-126" class="headerlink" title="返回值"></a>返回值</h6><p>返回是否存在指定参数（类型bool）</p>
<h6 id="示例程序-116"><a href="#示例程序-116" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的开发板IP地址为192.168.0.106，那么接下来您可以通过浏览器输入以下地址信息。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.0.106/?token=abc">http://192.168.0.106/?token=abc</a></p>
<p>在以下示例程序中，我们使用了<code>server.hasArg(&quot;token&quot;)</code>来判断请求信息中是否有名称为”token”的参数。如果有此参数，则通过串口监视器输出参数数值。如下图示：</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527130018293.png" alt="image-20230527130018293"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_hasArg</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  在请求成功后判断是否存在该请求体指定项并返回请求体的指定请求项的值</span></span><br><span class="line"><span class="comment">  具体请参考自定义函数 echo_args()中的内容</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建ESP8266WebServer对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义返回请求体信息</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">echo_args</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (server.hasArg(<span class="string">&quot;token&quot;</span>)) &#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;请求中token参数的值:&quot;</span>); </span><br><span class="line">    Serial.println(server.arg(<span class="string">&quot;token&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;当前请求中无法找到指定请求体内容&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">  echo_args();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-58"><a href="#相关内容-58" class="headerlink" title="相关内容"></a>相关内容</h6><p>– args – 请求包含的参数数量<br>– arg – 请求中指定参数的数值<br>– argName – 请求中参数名</p>
<h4 id="响应客户端请求分类"><a href="#响应客户端请求分类" class="headerlink" title="响应客户端请求分类"></a>响应客户端请求分类</h4><h5 id="send-–-发送响应信息"><a href="#send-–-发送响应信息" class="headerlink" title="send – 发送响应信息"></a>send – 发送响应信息</h5><h6 id="说明-134"><a href="#说明-134" class="headerlink" title="说明"></a>说明</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向ESP8266服务器发送HTTP请求，ESP8266服务器可使用本函数向客户端发送响应信息。</p>
<h6 id="语法-133"><a href="#语法-133" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">send(responseCode, contentType, responseContent)</span><br></pre></td></tr></table></figure>

<h6 id="参数-127"><a href="#参数-127" class="headerlink" title="参数"></a>参数</h6><p>– responseCode: 响应状态码（类型：int）<br>– contentType: 响应内容类型，本参数为可选参数，如不使用本参数则默认为空NULL（可使用字符串类型）<br>– responseContent: 响应内容，本参数为可选参数，如不使用本参数则默认为空字符串（可使用字符串类型）</p>
<h6 id="返回值-127"><a href="#返回值-127" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-117"><a href="#示例程序-117" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>浏览器请求发送之后，您将会再浏览器中看到ESP8266物联网服务器发送的网页信息。也就是以下示例程序中<code>server.send(200, &quot;text/plain&quot;, &quot;test homepage !&quot;)</code>语句所实现的内容。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_send</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置您的WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;XXXXXXXX&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//自定义主页访问处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage !&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  server.begin();</span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-59"><a href="#相关内容-59" class="headerlink" title="相关内容"></a>相关内容</h6><p>– sendHeader – 发送响应头<br>– sendContent – 发送响应体<br>– sendContent_P – 发送响应信息<br>– setContentLength – 设置响应体长度</p>
<h5 id="sendHeader-–-发送响应头"><a href="#sendHeader-–-发送响应头" class="headerlink" title="sendHeader – 发送响应头"></a>sendHeader – 发送响应头</h5><h6 id="说明-135"><a href="#说明-135" class="headerlink" title="说明"></a>说明</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向ESP8266服务器发送HTTP请求，ESP8266服务器将会对客户端发送响应信息。本函数可用于向响应头信息中添加自定义键值对。</p>
<h6 id="语法-134"><a href="#语法-134" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sendHeader(headerName, headerValue, first)</span><br></pre></td></tr></table></figure>

<h6 id="参数-128"><a href="#参数-128" class="headerlink" title="参数"></a>参数</h6><p>– headerName<br>自定义的响应头信息的名称，可使用字符串类型。</p>
<p>– headerValue<br>自定义的响应头值，可使用字符串类型。</p>
<p>– first<br>设置该响应头是否需要放在第一行，不填则默认为false。（参数类型: bool）</p>
<h6 id="返回值-128"><a href="#返回值-128" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-118"><a href="#示例程序-118" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>为了演示本实例程序的运行结果，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行示例程序操作演示。</p>
<p>如下图所示，首先请打开Microsoft Edge浏览器。并根据下图中的红色箭头知识一步步打开浏览器的“开发者工具”（Developer Tools）。该工具也可以使用快捷键”Ctrl+Shift+i”打开。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527130407594.png" alt="image-20230527130407594"></p>
<p>假设您的ESP8266开发板IP地址为192.168.0.106，那么请将ESP8266的IP地址输入浏览器地址栏中。</p>
<p>输入IP地址后，接下来请按下回车。如下图中箭头所示，请再点击“开发者工具”中的Network选项卡, 然后点击ESP8266的IP地址即可在右侧的响应信息中看到键值对”device: ESP8266″(下图星标所示)。此信息正是通过以下示例程序中的语句<code>server.sendHeader(&quot;device&quot;, &quot;ESP-8266&quot;)</code>实现的。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527130517231.png" alt="image-20230527130517231"></p>
<p>这一实验说明ESP8266建立的物联网服务器向浏览器客户端发送的响应头中带有“device:ESP8266”信息。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_sendHeader</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  自定义响应体信息并在客户端访问时返回</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 实例对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置自定义响应头内容</span></span><br><span class="line">  server.sendHeader(<span class="string">&quot;device&quot;</span>, <span class="string">&quot;ESP-8266&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//发送响应信息</span></span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-60"><a href="#相关内容-60" class="headerlink" title="相关内容"></a>相关内容</h6><p>– send – 发送响应信息<br>– sendHeader – 发送响应头<br>– sendContent_P – 发送响应信息<br>– setContentLength – 设置响应体长度</p>
<h5 id="sendContent-–-发送响应体信息"><a href="#sendContent-–-发送响应体信息" class="headerlink" title="sendContent – 发送响应体信息"></a>sendContent – 发送响应体信息</h5><h6 id="说明-136"><a href="#说明-136" class="headerlink" title="说明"></a>说明</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向ESP8266服务器发送HTTP请求，ESP8266服务器将会对客户端发送响应信息。本函数可用于向ESP8266服务器响应体中添加自定义信息。</p>
<p>请留意：可以实现此功能的函数共有三个。一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/sendcontent/">sendContent</a>，一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/sendcontent_p/">sendContent_P</a>，还有一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/streamfile/">streamFile</a>。这三个函数虽然功能相同，但是他们所发送的信息存储位置有很大区别。</p>
<p>sendContent: sendContent函数所发送的信息通常是程序中的一个字符串。该函数的优点是直接调用程序内字符串，这个操作比起两外两种方法来说更加简单直接。但是其缺点是，由于存储发送信息的字符串是在程序中的，这会占用开发板的动态内存空间。因此，使用sendContent函数时，发送信息的大小受到了限制。</p>
<p>sendContent_P：当我们使用sendContent_P时，发送的响应信息必须存储在程序存储空间。这一特点大大优化了程序内存占用。因此sendContent_P对于我们在发送较大的响应信息时非常有帮助。但是sendContent_P的信息仍是写在程序中，如果发送的信息需要分为多个文件存储，使用sendContent_P函数是无法胜任的。</p>
<p>streamFile：使用streamFile函数来发送响应信息是最推荐的操作方法。因为streamFile利用了ESP8266开发板的闪存文件系统来存储发送的信息内容。可以说streamFile函数既可以节省程序内存空间，又允许我们将需要发送的信息分为多个文件进行保存。但是使用streamFile时需要我们使用Arduino IDE的闪存文件上传工具预先将文件上传到闪存中。这一操作可能有些朋友不甚了解。不过您可以通过《<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/">零基础入门学用物联网</a>》免费视频教程中的“<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/spiffs/">闪存文件系统</a>”部分，了解具体操作方法。</p>
<h6 id="语法-135"><a href="#语法-135" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sendContent(content)</span><br></pre></td></tr></table></figure>

<h6 id="参数-129"><a href="#参数-129" class="headerlink" title="参数"></a>参数</h6><p>content – 响应体信息，可使用字符串格式。</p>
<h6 id="返回值-129"><a href="#返回值-129" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-119"><a href="#示例程序-119" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>为了演示本实例程序的运行结果，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行示例程序操作演示。</p>
<p>如下图所示，首先请打开Microsoft Edge浏览器。并根据下图中的红色箭头指示一步步打开浏览器的“开发者工具”（Developer Tools）。该工具也可以使用快捷键”Ctrl+Shift+i”打开。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527130407594.png" alt="image-20230527130407594"></p>
<p>假设您的ESP8266开发板IP地址为192.168.0.106，那么请将ESP8266的IP地址输入浏览器地址栏中。</p>
<p>输入IP地址后，接下来请按下回车。如下图中箭头所示，请点击“开发者工具”中的Network选项卡, 然后点击ESP8266的IP地址，再点击Response选项卡，即可在右侧的响应体信息中看到“sendContent_test_OK”(下图星标所示)。此信息正是通过以下示例程序中的语句<code>server.sendContent(&quot;sendContent_test_OK&quot;)</code>实现的。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527130736209.png" alt="image-20230527130736209"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_sendContent</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  自定义响应体信息并在客户端访问时返回,使用浏览器访问主页即可查看响应体内容</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 实例对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置响应体内容以及响应体长度</span></span><br><span class="line">  server.sendContent(<span class="string">&quot;sendContent_test_OK&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-61"><a href="#相关内容-61" class="headerlink" title="相关内容"></a>相关内容</h6><p>– send – 发送响应信息<br>– sendHeader – 发送响应头<br>– sendContent_P – 发送响应信息<br>– setContentLength – 设置响应体长度<br>– streamFile – 发送响应体信息</p>
<h5 id="sendContent-P-–-发送响应体信息"><a href="#sendContent-P-–-发送响应体信息" class="headerlink" title="sendContent_P – 发送响应体信息"></a>sendContent_P – 发送响应体信息</h5><h6 id="说明-137"><a href="#说明-137" class="headerlink" title="说明"></a>说明</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向ESP8266服务器发送HTTP请求，ESP8266服务器将会对客户端发送响应信息。本函数可用于向服务器响应体中添加自定义信息。</p>
<p>请留意：可以实现此功能的函数共有三个。一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/sendcontent/">sendContent</a>，一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/sendcontent_p/">sendContent_P</a>，还有一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/streamfile/">streamFile</a>。这三个函数虽然功能相同，但是他们所发送的信息存储位置有很大区别。</p>
<p>sendContent: sendContent函数所发送的信息通常是程序中的一个字符串。该函数的优点是直接调用程序内字符串，这个操作比起两外两种方法来说更加简单直接。但是其缺点是，由于存储发送信息的字符串是在程序中的，这会占用开发板的动态内存空间。因此，使用sendContent函数时，发送信息的大小受到了限制。</p>
<p>sendContent_P：当我们使用sendContent_P时，发送的响应信息必须存储在程序存储空间。这一特点大大优化了程序内存占用。因此sendContent_P对于我们在发送较大的响应信息时非常有帮助。但是sendContent_P的信息仍是写在程序中，如果发送的信息需要分为多个文件存储，使用sendContent_P函数是无法胜任的。</p>
<p>streamFile：使用streamFile函数来发送响应信息是最推荐的操作方法。因为streamFile利用了ESP8266开发板的闪存文件系统来存储发送的信息内容。可以说streamFile函数既可以节省程序内存空间，又允许我们将需要发送的信息分为多个文件进行保存。但是使用streamFile时需要我们使用Arduino IDE的闪存文件上传工具预先将文件上传到闪存中。</p>
<h6 id="语法-136"><a href="#语法-136" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sendContent_P(responseContent)</span><br></pre></td></tr></table></figure>

<h6 id="参数-130"><a href="#参数-130" class="headerlink" title="参数"></a>参数</h6><p>responseContent: 响应体信息，该信息必须存储在程序存储空间的字符数组。</p>
<h6 id="返回值-130"><a href="#返回值-130" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-120"><a href="#示例程序-120" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的开发板IP地址为192.168.0.106，那么接下来您可以通过浏览器输入以下地址信息。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.0.106/">http://192.168.0.106/</a></p>
<p>如下图示，接下来您将看到浏览器中显示出一行文字信息。这行信息正是通过以下示例程序中的<code>server.sendContent_P(reponseContent)</code>实现的。其中reponseContent参数信息是通过以下语句建立的。我们可以看到，该语句中的数组是保存在ESP8266开发板的程序存储空间中的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const char reponseContent[] PROGMEM = &quot;HELLO FROM ESP8266&quot;;</span><br></pre></td></tr></table></figure>

<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527131239714.png" alt="image-20230527131239714"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_sendContent</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  此程序用于演示如何使用ESP8266开发板所建立的物联网服务器向客户端响应</span></span><br><span class="line"><span class="comment">  储存在程序存储空间中的字符数组信息。使用程序存储空间保存信息可大大节省</span></span><br><span class="line"><span class="comment">  程序内存占用。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  具体操作如下：</span></span><br><span class="line"><span class="comment">  1. 储存在程序存储空间中的字符数组信息</span></span><br><span class="line"><span class="comment">  2. 使用sendContent_P函数将数组信息作为响应返回给客户端。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 实例对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立保存在程序存储空间中的字符串</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> reponseContent[] PROGMEM = <span class="string">&quot;HELLO FROM ESP8266&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置响应体内容</span></span><br><span class="line">  server.sendContent_P(reponseContent);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-62"><a href="#相关内容-62" class="headerlink" title="相关内容"></a>相关内容</h6><p>– send – 发送响应信息<br>– sendHeader – 发送响应头<br>– sendContent – 发送响应体<br>– setContentLength – 设置响应体长度<br>– streamFile – 发送响应体信息</p>
<h5 id="streamFile-–-发送响应体信息"><a href="#streamFile-–-发送响应体信息" class="headerlink" title="streamFile – 发送响应体信息"></a>streamFile – 发送响应体信息</h5><h6 id="说明-138"><a href="#说明-138" class="headerlink" title="说明"></a>说明</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向服务器发送HTTP请求，服务器将会对客户端发送响应信息。本函数可用于向服务器响应体中添加自定义信息。</p>
<p>请留意：可以实现此功能的函数共有三个。一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/sendcontent/">sendContent</a>，一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/sendcontent_p/">sendContent_P</a>，还有一个是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/streamfile/">streamFile</a>。这三个函数虽然功能相同，但是他们所发送的信息存储位置有很大区别。</p>
<p>sendContent: sendContent函数所发送的信息通常是程序中的一个字符串。该函数的优点是直接调用程序内字符串，这个操作比起两外两种方法来说更加简单直接。但是其缺点是，由于存储发送信息的字符串是在程序中的，这会占用开发板的动态内存空间。因此，使用sendContent函数时，发送信息的大小受到了限制。</p>
<p>sendContent_P：当我们使用sendContent_P时，发送的响应信息必须存储在程序存储空间。这一特点大大优化了程序内存占用。因此sendContent_P对于我们在发送较大的响应信息时非常有帮助。但是sendContent_P的信息仍是写在程序中，如果发送的信息需要分为多个文件存储，使用sendContent_P函数是无法胜任的。</p>
<p>streamFile：使用streamFile函数来发送响应信息是最推荐的操作方法。因为streamFile利用了ESP8266开发板的闪存文件系统来存储发送的信息内容。可以说streamFile函数既可以节省程序内存空间，又允许我们将需要发送的信息分为多个文件进行保存。但是使用streamFile时需要我们使用Arduino IDE的闪存文件上传工具预先将文件上传到闪存中。</p>
<h6 id="语法-137"><a href="#语法-137" class="headerlink" title="语法"></a>语法</h6><p>streamFile(file, contentType)</p>
<h6 id="参数-131"><a href="#参数-131" class="headerlink" title="参数"></a>参数</h6><p>file – 存储有响应信息的闪存文件对象<br>contentType（可选参数） – 响应信息系类型 （const String&amp; ）</p>
<h6 id="语法-138"><a href="#语法-138" class="headerlink" title="语法"></a>语法</h6><p>发送的文件大小，类型：size_t</p>
<h6 id="示例程序-121"><a href="#示例程序-121" class="headerlink" title="示例程序"></a>示例程序</h6><p>首先请将以下下载链接中的网页文件上传到ESP8266的闪存文件系统中。</p>
<p>接下来请将示例程序中的WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的开发板IP地址为192.168.0.106，那么接下来您可以通过浏览器输入以下地址信息。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.0.106/">http://192.168.0.106/</a></p>
<p>接下来您将在浏览器中看到以下页面。此页面内容正是ESP8266开发板通过streamFile函数将闪存中的文件内容发送给浏览器的。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : 3_4_1_SPIFFS_File_server</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">当用户访问NodeMCU地址时，NodeMCU将会检查访问地址是否指向SPIFFS系统中的文件，并且</span></span><br><span class="line"><span class="comment">将该文件显示于用户的浏览器中。如果访问地址所指向的文件无法在SPIFFS中找到，NodeMCU将会</span></span><br><span class="line"><span class="comment">向用户发送404信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span>  </span></span><br><span class="line"></span><br><span class="line">ESP8266WiFiMulti wifiMulti;     <span class="comment">// 建立ESP8266WiFiMulti对象</span></span><br><span class="line"></span><br><span class="line">ESP8266WebServer <span class="title function_">esp8266_server</span><span class="params">(<span class="number">80</span>)</span>;    <span class="comment">// 建立网络服务器对象，该对象用于响应HTTP请求。监听端口（80）</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);          <span class="comment">// 启动串口通讯</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_1&quot;</span>, <span class="string">&quot;your_password_for_AP_1&quot;</span>); <span class="comment">// 将需要连接的一系列WiFi ID和密码输入这里</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_2&quot;</span>, <span class="string">&quot;your_password_for_AP_2&quot;</span>); <span class="comment">// ESP8266-NodeMCU再启动后会扫描当前网络</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_3&quot;</span>, <span class="string">&quot;your_password_for_AP_3&quot;</span>); <span class="comment">// 环境查找是否有这里列出的WiFi ID。如果有</span></span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>);                            <span class="comment">// 则尝试使用此处存储的密码进行连接。</span></span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// 通过串口监视器输出连接的WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// 通过串口监视器输出ESP8266-NodeMCU的IP</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(SPIFFS.begin())&#123;                       <span class="comment">// 启动闪存文件系统</span></span><br><span class="line">    Serial.println(<span class="string">&quot;SPIFFS Started.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;SPIFFS Failed to Start.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  esp8266_server.onNotFound(handleUserRequet);      <span class="comment">// 告知系统如何处理用户请求</span></span><br><span class="line"></span><br><span class="line">  esp8266_server.begin();                           <span class="comment">// 启动网站服务</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  esp8266_server.handleClient();                    <span class="comment">// 处理用户请求</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理用户浏览器的HTTP访问</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleUserRequet</span><span class="params">()</span> &#123;         </span><br><span class="line">     </span><br><span class="line">  <span class="comment">// 获取用户请求网址信息</span></span><br><span class="line">  String webAddress = esp8266_server.uri();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过handleFileRead函数处处理用户访问</span></span><br><span class="line">  <span class="type">bool</span> fileReadOK = handleFileRead(webAddress);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果在SPIFFS无法找到用户访问的资源，则回复404 (Not Found)</span></span><br><span class="line">  <span class="keyword">if</span> (!fileReadOK)&#123;                                                 </span><br><span class="line">    esp8266_server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404 Not Found&quot;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">handleFileRead</span><span class="params">(String path)</span> &#123;            <span class="comment">//处理浏览器HTTP访问</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (path.endsWith(<span class="string">&quot;/&quot;</span>)) &#123;                   <span class="comment">// 如果访问地址以&quot;/&quot;为结尾</span></span><br><span class="line">    path = <span class="string">&quot;/index.html&quot;</span>;                     <span class="comment">// 则将访问地址修改为/index.html便于SPIFFS访问</span></span><br><span class="line">  &#125; </span><br><span class="line">  </span><br><span class="line">  String contentType = getContentType(path);  <span class="comment">// 获取文件类型</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (SPIFFS.exists(path)) &#123;                     <span class="comment">// 如果访问的文件可以在SPIFFS中找到</span></span><br><span class="line">    File file = SPIFFS.open(path, <span class="string">&quot;r&quot;</span>);          <span class="comment">// 则尝试打开该文件</span></span><br><span class="line">    esp8266_server.streamFile(file, contentType);<span class="comment">// 并且将该文件返回给浏览器</span></span><br><span class="line">    file.close();                                <span class="comment">// 并且关闭文件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;                                 <span class="comment">// 返回true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;                                  <span class="comment">// 如果文件未找到，则返回false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文件类型</span></span><br><span class="line">String <span class="title function_">getContentType</span><span class="params">(String filename)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.htm&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.html&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.css&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/css&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.js&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/javascript&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.png&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/png&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.gif&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/gif&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.jpg&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/jpeg&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.ico&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/x-icon&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.xml&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/xml&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.pdf&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/x-pdf&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.zip&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/x-zip&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.gz&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/x-gzip&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;text/plain&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/streamfile/">ESP8266 – ESP8266WebServer库 – streamFile – 太极创客 (taichi-maker.com)</a></p>
<h5 id="setContentLength-–-设置响应体长度"><a href="#setContentLength-–-设置响应体长度" class="headerlink" title="setContentLength – 设置响应体长度"></a>setContentLength – 设置响应体长度</h5><h6 id="说明-139"><a href="#说明-139" class="headerlink" title="说明"></a>说明</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向ESP8266服务器发送HTTP请求，ESP8266服务器将会对客户端发送响应信息。本函数可用于设置响应信息中的响应体长度。</p>
<p>假如我们在开发时不确定响应体信息长度，则可以如下所示对setContentLength使用CONTENT_LENGTH_UNKNOWN关键词作为参数来调用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.setContentLength(CONTENT_LENGTH_UNKNOWN)</span><br></pre></td></tr></table></figure>

<h6 id="语法-139"><a href="#语法-139" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setContentLength(contentLength)</span><br></pre></td></tr></table></figure>

<h6 id="参数-132"><a href="#参数-132" class="headerlink" title="参数"></a>参数</h6><p>contentLength<br>响应体的长度(参数类型 : const size_t）</p>
<h6 id="返回值-131"><a href="#返回值-131" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-122"><a href="#示例程序-122" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>假设您的ESP8266开发板IP地址为192.168.0.106，那么请将ESP8266的IP地址输入浏览器地址栏中。接下来您将看到浏览器将会显示ESP8266开发板返回的响应体信息。同时，以下程序中使用了<code>server.setContentLength(CONTENT_LENGTH_UNKNOWN)</code>来演示setContentLength的使用方法。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_sendHeader</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  自定义响应体信息并在客户端访问时返回</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建 ESP8266WebServer 实例对象</span></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">  server.sendContent(<span class="string">&quot;sendContent_test_OK&quot;</span>);</span><br><span class="line">  server.setContentLength(CONTENT_LENGTH_UNKNOWN);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-63"><a href="#相关内容-63" class="headerlink" title="相关内容"></a>相关内容</h6><p>– send – 发送响应信息<br>– sendHeader – 发送响应头<br>– sendContent – 发送响应体<br>– sendContent_P – 发送响应信息</p>
<h5 id="upload-–-处理文件上传"><a href="#upload-–-处理文件上传" class="headerlink" title="upload – 处理文件上传"></a>upload – 处理文件上传</h5><h6 id="语法-140"><a href="#语法-140" class="headerlink" title="语法"></a>语法</h6><p>此函数用于ESP8266开发板所建立的物联网服务器处理客户端的文件上传请求。</p>
<h6 id="参数-133"><a href="#参数-133" class="headerlink" title="参数"></a>参数</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.upload()</span><br></pre></td></tr></table></figure>

<h6 id="返回值-132"><a href="#返回值-132" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-123"><a href="#示例程序-123" class="headerlink" title="示例程序"></a>示例程序</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : 3_4_8_SPIFFS_File_Upload_Server</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : 建立网络服务器，允许用户通过网页将文件上传到SPIFFS</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFiMulti.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span>  </span></span><br><span class="line"> </span><br><span class="line">ESP8266WiFiMulti wifiMulti;     <span class="comment">// 建立ESP8266WiFiMulti对象,对象名称是 &#x27;wifiMulti&#x27;</span></span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">esp8266_server</span><span class="params">(<span class="number">80</span>)</span>;    <span class="comment">// 建立网络服务器对象，该对象用于响应HTTP请求。监听端口（80）      </span></span><br><span class="line"> </span><br><span class="line">File fsUploadFile;              <span class="comment">// 建立文件对象用于闪存文件上传</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);        </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_1&quot;</span>, <span class="string">&quot;your_password_for_AP_1&quot;</span>); <span class="comment">// 将需要连接的一系列WiFi ID和密码输入这里</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_2&quot;</span>, <span class="string">&quot;your_password_for_AP_2&quot;</span>); <span class="comment">// ESP8266-NodeMCU再启动后会扫描当前网络</span></span><br><span class="line">  wifiMulti.addAP(<span class="string">&quot;ssid_from_AP_3&quot;</span>, <span class="string">&quot;your_password_for_AP_3&quot;</span>); <span class="comment">// 环境查找是否有这里列出的WiFi ID。如果有</span></span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting ...&quot;</span>);                            <span class="comment">// 则尝试使用此处存储的密码进行连接。</span></span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  <span class="keyword">while</span> (wifiMulti.run() != WL_CONNECTED) &#123; <span class="comment">// 尝试进行wifi连接。</span></span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(i++); Serial.print(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.println(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.SSID());              <span class="comment">// 通过串口监视器输出连接的WiFi名称</span></span><br><span class="line">  Serial.print(<span class="string">&quot;IP address:\t&quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());           <span class="comment">// 通过串口监视器输出ESP8266-NodeMCU的IP</span></span><br><span class="line">          </span><br><span class="line">  <span class="keyword">if</span>(SPIFFS.begin())&#123;                       <span class="comment">// 启动闪存文件系统</span></span><br><span class="line">    Serial.println(<span class="string">&quot;SPIFFS Started.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;SPIFFS Failed to Start.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  esp8266_server.on(<span class="string">&quot;/upload.html&quot;</span>,   <span class="comment">// 如果客户端通过upload页面</span></span><br><span class="line">                    HTTP_POST,        <span class="comment">// 向服务器发送文件(请求方法POST)</span></span><br><span class="line">                    respondOK,        <span class="comment">// 则回复状态码 200 给客户端</span></span><br><span class="line">                    handleFileUpload);<span class="comment">// 并且运行处理文件上传函数</span></span><br><span class="line"> </span><br><span class="line">  esp8266_server.onNotFound(handleUserRequest);</span><br><span class="line"> </span><br><span class="line">  esp8266_server.begin();                           <span class="comment">// 启动网站服务</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  esp8266_server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 处理上传文件函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleFileUpload</span><span class="params">()</span>&#123;  </span><br><span class="line">  </span><br><span class="line">  HTTPUpload&amp; upload = esp8266_server.upload();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(upload.status == UPLOAD_FILE_START)&#123;                     <span class="comment">// 如果上传状态为UPLOAD_FILE_START</span></span><br><span class="line">    </span><br><span class="line">    String filename = upload.filename;                        <span class="comment">// 建立字符串变量用于存放上传文件名</span></span><br><span class="line">    <span class="keyword">if</span>(!filename.startsWith(<span class="string">&quot;/&quot;</span>)) filename = <span class="string">&quot;/&quot;</span> + filename;  <span class="comment">// 为上传文件名前加上&quot;/&quot;</span></span><br><span class="line">    Serial.println(<span class="string">&quot;File Name: &quot;</span> + filename);                 <span class="comment">// 通过串口监视器输出上传文件的名称</span></span><br><span class="line"> </span><br><span class="line">    fsUploadFile = SPIFFS.open(filename, <span class="string">&quot;w&quot;</span>);            <span class="comment">// 在SPIFFS中建立文件用于写入用户上传的文件数据</span></span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upload.status == UPLOAD_FILE_WRITE)&#123;          <span class="comment">// 如果上传状态为UPLOAD_FILE_WRITE      </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(fsUploadFile)</span><br><span class="line">      fsUploadFile.write(upload.buf, upload.currentSize); <span class="comment">// 向SPIFFS文件写入浏览器发来的文件数据</span></span><br><span class="line">      </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upload.status == UPLOAD_FILE_END)&#123;            <span class="comment">// 如果上传状态为UPLOAD_FILE_END </span></span><br><span class="line">    <span class="keyword">if</span>(fsUploadFile) &#123;                                    <span class="comment">// 如果文件成功建立</span></span><br><span class="line">      fsUploadFile.close();                               <span class="comment">// 将文件关闭</span></span><br><span class="line">      Serial.println(<span class="string">&quot; Size: &quot;</span>+ upload.totalSize);        <span class="comment">// 通过串口监视器输出文件大小</span></span><br><span class="line">      esp8266_server.sendHeader(<span class="string">&quot;Location&quot;</span>,<span class="string">&quot;/success.html&quot;</span>);  <span class="comment">// 将浏览器跳转到/success.html（成功上传页面）</span></span><br><span class="line">      esp8266_server.send(<span class="number">303</span>);                               <span class="comment">// 发送相应代码303（重定向到新页面） </span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;                                              <span class="comment">// 如果文件未能成功建立</span></span><br><span class="line">      Serial.println(<span class="string">&quot;File upload failed&quot;</span>);               <span class="comment">// 通过串口监视器输出报错信息</span></span><br><span class="line">      esp8266_server.send(<span class="number">500</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;500: couldn&#x27;t create file&quot;</span>); <span class="comment">// 向浏览器发送相应代码500（服务器错误）</span></span><br><span class="line">    &#125;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//回复状态码 200 给客户端</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">respondOK</span><span class="params">()</span>&#123;</span><br><span class="line">  esp8266_server.send(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 处理用户浏览器的HTTP访问</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleUserRequest</span><span class="params">()</span>&#123;</span><br><span class="line">                              </span><br><span class="line">  <span class="comment">// 获取用户请求网址信息</span></span><br><span class="line">  String webAddress = esp8266_server.uri();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过handleFileRead函数处处理用户访问</span></span><br><span class="line">  <span class="type">bool</span> fileReadOK = handleFileRead(webAddress);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 如果在SPIFFS无法找到用户访问的资源，则回复404 (Not Found)</span></span><br><span class="line">  <span class="keyword">if</span> (!fileReadOK)&#123;                                                 </span><br><span class="line">    esp8266_server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404 Not Found&quot;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> <span class="title function_">handleFileRead</span><span class="params">(String path)</span> &#123;            <span class="comment">//处理浏览器HTTP访问</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (path.endsWith(<span class="string">&quot;/&quot;</span>)) &#123;                   <span class="comment">// 如果访问地址以&quot;/&quot;为结尾</span></span><br><span class="line">    path = <span class="string">&quot;/index.html&quot;</span>;                     <span class="comment">// 则将访问地址修改为/index.html便于SPIFFS访问</span></span><br><span class="line">  &#125; </span><br><span class="line">  </span><br><span class="line">  String contentType = getContentType(path);  <span class="comment">// 获取文件类型</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (SPIFFS.exists(path)) &#123;                     <span class="comment">// 如果访问的文件可以在SPIFFS中找到</span></span><br><span class="line">    File file = SPIFFS.open(path, <span class="string">&quot;r&quot;</span>);          <span class="comment">// 则尝试打开该文件</span></span><br><span class="line">    esp8266_server.streamFile(file, contentType);<span class="comment">// 并且将该文件返回给浏览器</span></span><br><span class="line">    file.close();                                <span class="comment">// 并且关闭文件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;                                 <span class="comment">// 返回true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;                                  <span class="comment">// 如果文件未找到，则返回false</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取文件类型</span></span><br><span class="line">String <span class="title function_">getContentType</span><span class="params">(String filename)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.htm&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.html&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.css&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/css&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.js&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/javascript&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.png&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/png&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.gif&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/gif&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.jpg&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/jpeg&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.ico&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;image/x-icon&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.xml&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;text/xml&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.pdf&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/x-pdf&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.zip&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/x-zip&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(filename.endsWith(<span class="string">&quot;.gz&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;application/x-gzip&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;text/plain&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="requestAuthentication-–-请求客户端认证"><a href="#requestAuthentication-–-请求客户端认证" class="headerlink" title="requestAuthentication – 请求客户端认证"></a>requestAuthentication – 请求客户端认证</h5><h6 id="语法-141"><a href="#语法-141" class="headerlink" title="语法"></a>语法</h6><p>在ESP8266开发板所建立的物联网服务器在运行过程中，如果有客户端向服务器发送HTTP请求，服务器可使用本函数向客户端发送认证请求,从而建立需要用户名和密码认证的加密网页服务器。只有当客户端请求信息中包含正确的认证请求方可访问网页信息。</p>
<p>请注意，与此函数配套使用的是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266webserver/authenticate/">authenticate</a>函数。authenticate用于设置与校验客户端请求信息中的用户名和密码。而requestAuthentication用于向客户端发送认证请求。</p>
<h6 id="语法-142"><a href="#语法-142" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.requestAuthentication(mode, realm, authFailMsg)`</span><br><span class="line">`server.requestAuthentication()</span><br></pre></td></tr></table></figure>

<h6 id="参数-134"><a href="#参数-134" class="headerlink" title="参数"></a>参数</h6><p>mode (可选参数)<br>– HTTP验证方式<br>– 可选关键词：BASIC_AUTH、 DIGEST_AUTH（不填则默认为BASIC_AUTH）</p>
<p>realm (可选参数)<br>– 认证范围<br>– 参数类型: const char* (不填则默认为空NULL)</p>
<p>authFailMsg (可选参数)<br>– 认证失败提示消息<br>– 参数类型: const String<br>– 不填则默认为空字符串 String(“”)</p>
<h6 id="返回值-133"><a href="#返回值-133" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-124"><a href="#示例程序-124" class="headerlink" title="示例程序"></a>示例程序</h6><p>当您将WiFi连接信息修改后并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP。</p>
<p>接下来您可以通过浏览器地址栏输入ESP8266开发板的IP地址并键入回车（即向ESP8266开发板所建立的物联网服务器发送一个GET请求）。</p>
<p>接下来浏览器将会弹出对话框，要求用户输入用户名:TaichiMaker和密码:123456。如下图所示。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527121515042.png" alt="ESP8266-authenticate-example-result1"></p>
<p>只有当用户正确输入了用户名和密码信息以后，方可打开ESP8266开发板建立的网站页面。（如下图所示）</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527121534407.png" alt="ESP8266-authenticate-example-result2"></p>
<p>以下示例程序中的高亮语句<code>server.requestAuthentication()</code>要求客户端发送打开网页的用户名和密码。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WebServer_demo_requestAuthentication</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment">  使用8266作为WebServer,并用浏览器打开设备IP+80端口进行访问</span></span><br><span class="line"><span class="comment">  在登录主页时使用认证方式登录,登录账户密码分别为(TaichiMaker/123456)</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置WiFi接入信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TaichiMaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置需要收集的请求头信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *headerKeys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Date&quot;</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置主页请求处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">homepage</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//校验用户登录账号和密码,(默认使用Basic方式),若输入错误则继续返回认证界面</span></span><br><span class="line">  <span class="keyword">if</span> (!server.authenticate(<span class="string">&quot;TaichiMaker&quot;</span>, <span class="string">&quot;123456&quot;</span>)) </span><br><span class="line">  <span class="keyword">return</span> server.requestAuthentication();</span><br><span class="line"> </span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;test homepage&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;用户访问了主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置处理404情况的函数&#x27;handleNotFound&#x27;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;                                       <span class="comment">// 当浏览器请求的网络资源无法在服务器找到时，</span></span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;404: Not found&quot;</span>);           <span class="comment">// NodeMCU将调用此函数。</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//设置主页处理函数</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, homepage);</span><br><span class="line">  <span class="comment">//设置404页面</span></span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//串口输出服务器准备完成信息</span></span><br><span class="line">  Serial.println(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">//监听客户请求并处理</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="相关内容-64"><a href="#相关内容-64" class="headerlink" title="相关内容"></a>相关内容</h6><p>– authenticate<br>– on<br>– onNotFound</p>
<h2 id="ESP8266-–-WiFiClientSecure库"><a href="#ESP8266-–-WiFiClientSecure库" class="headerlink" title="ESP8266 – WiFiClientSecure库"></a>ESP8266 – WiFiClientSecure库</h2><p>WiFiClientSecure库用于HTTPS协议通讯。通过WiFiClientSecure库，我们可以使用ESP8266利用HTTPS协议向网络服务器发送请求，并且分析网络服务器返回的响应信息，从而实现更加安全的物联网应用。</p>
<p>HTTPS （全称：Hyper Text Transfer Protocol over SecureSocket Layer），是以安全为目标的互联网协议。HTTPS协议在HTTP的基础上通过SSL或TLS来实现传输加密和身份认证，从而保证了传输过程的安全性。假如您需要进一步了解HTTPS协议的介绍关内容，请参考<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/https/285356">百度百科HTTPS协议页面</a>。</p>
<p>当然，如果您的物联网应用对安全性能并没有很高的要求，那么您也可以使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/esp8266httpclient/">ESP8266HTTPClient库</a>通过HTTP协议来实现ESP8266物联网应用。</p>
<p>以下为WiFiClientSecure库的整体结构图。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527133200513.png" alt="image-20230527133200513"></p>
<h3 id="ESP8266-HTTPS开发实用知识"><a href="#ESP8266-HTTPS开发实用知识" class="headerlink" title="ESP8266-HTTPS开发实用知识"></a>ESP8266-HTTPS开发实用知识</h3><h4 id="查看网站证书指纹"><a href="#查看网站证书指纹" class="headerlink" title="查看网站证书指纹"></a>查看网站证书指纹</h4><p>在我们用HTTPS协议开发物联网项目时，有时需要获取网站服务器的证书指纹信息。我们可以用电脑中的浏览器来获取该信息。</p>
<p>为了演示本操作，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行演示如何获取<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器的证书指纹./">www.howsmyssl.com网站服务器的证书指纹。</a></p>
<p>首先请在服务器地址栏中输入以下网址：</p>
<p><a target="_blank" rel="noopener" href="https://www.howsmyssl.com/">https://www.howsmyssl.com/</a></p>
<p>当浏览器成功打开以上网址的网页后，请如下图所示点击地址栏前面的“小锁”标志。然后在弹出的菜单中点击“证书”（如下图2号红色方框所标识的信息）。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134256246.png" alt="image-20230527134256246"></p>
<p>如下图所示，请在弹出的“证书”窗口中，点击“证书路径”标签(如下图中数字1所标识)，然后用鼠标选中”<a target="_blank" rel="noopener" href="http://www.howsmyssl.com”(如下图中数字1所标识)./">www.howsmyssl.com”（如下图中数字1所标识）。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134314022.png" alt="image-20230527134314022"></p>
<p>如下图所示，请在弹出的“证书”窗口中，点击“详细信息”，然后在窗口信息中找到“指纹”项目。当您用鼠标点击该项目后，即可在窗口下方看到一排英文字符（如下图红色标识）。这串红色标识的字符即是网站的证书指纹信息。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134331830.png" alt="image-20230527134331830"></p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此您所看到的指纹信息可能与以上图片中显示的信息不同。同时，如果您将指纹信息写入程序中，要留意及时更新该信息。否则当网站更新指纹信息后，您的程序将无法用于通过HTTPS协议访问网站信息。</strong></p>
<h4 id="查看网站证书和公钥"><a href="#查看网站证书和公钥" class="headerlink" title="查看网站证书和公钥"></a>查看网站证书和公钥</h4><p>在我们用HTTPS协议开发物联网项目时，有时需要获取网站服务器的证书和公钥。我们可以用电脑中的浏览器来获取该信息。</p>
<p>为了演示本操作，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行演示如何获取必应网站(<a target="_blank" rel="noopener" href="http://www.bing.com)服务器的证书和公钥./">www.bing.com)服务器的证书和公钥。</a></p>
<p>首先请在服务器地址栏中输入以下网址：</p>
<p><a target="_blank" rel="noopener" href="https://www.bing.com/">https://www.bing.com</a></p>
<p>当浏览器成功打开以上网址的网页后，请如下图所示点击地址栏前面的“小锁”标志。然后在弹出的菜单中点击“证书”（如下图红色箭头所标识的信息）。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134515449.png" alt="image-20230527134515449"></p>
<p>如下图所示，请在弹出的“证书”窗口中，点击下图数字1所示的“证书路径”，然后用鼠标选中下图数字2所示的“<a target="_blank" rel="noopener" href="http://www.bing.com”./">www.bing.com”。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134544054.png" alt="image-20230527134544054"></p>
<p>如下图所示，接下来请点击下图数字1所示的“详细信息”标签。此时窗口中显示的都是上一步选中的“<a target="_blank" rel="noopener" href="http://www.bing.com”网站服务器证书的详细信息.然后您/">www.bing.com”网站服务器证书的详细信息。然后您</a> 就可以点击下图中数字2所示的“复制到文件”按钮。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134611162.png" alt="image-20230527134611162"></p>
<p>如下图所示，在弹出的“证书导出向导”中点击 “下一步”按钮。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134629458.png" alt="image-20230527134629458"></p>
<p>如下图所示，接下来您可以根据自己的需要选择证书格式。请选择Base64编码X.509(.CER)选项，然后点击下一步。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134700599.png" alt="image-20230527134700599"></p>
<p>如下图所示，在接下来的步骤里，点击浏览按钮，选择保存证书文件的路径。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134718733.png" alt="image-20230527134718733"></p>
<p>如下图所示，我们完成了网站服务器证书的导出工作。如果您需要从该证书中提取公钥信息，那么请继续看后续的讲解。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527134745341.png" alt="image-20230527134745341"></p>
<p>在接下来的操作中，我们将需要使用OpenSSL工具。如果您使用的是Windows电脑，那么需要使用以下链接将OpenSSL工具下载并安装到电脑中。如果您的电脑中已经安装好git这类集成了OpenSSL的软件，那么您可以不必下载以下工具。简言之，无论您使用什么软件和方法，只要您可以在电脑中使用OpenSSL就可了。</p>
<p><a target="_blank" rel="noopener" href="https://lanzous.com/ibs5aod">Win64 OpenSSL v1.1.1g Light (蓝奏云下载，适用64位Windows)</a></p>
<p><a target="_blank" rel="noopener" href="https://lanzous.com/ibs5ahg">Win32 OpenSSL v1.1.1g Light (蓝奏云下载，适用64位Windows)</a></p>
<p><a target="_blank" rel="noopener" href="https://slproweb.com/products/Win32OpenSSL.html">Shining Light Productions网站下载</a></p>
<p>接下来请启动OpenSSL工具，并进入刚刚下载的证书存放路径，然后输入以下指令，即可从下载的证书中提取公钥信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openssl x509 -pubkey -noout -in bing.cer</span><br></pre></td></tr></table></figure>

<p>注意，以上指令中的“bing.cer”为下载的证书名称，务必确保这一部分内容是准确的。另外在输入以上指令时务必确保您当前的操作路径是证书存放路径。</p>
<p>如下图所示，公钥信息将会显示在屏幕中供您复制粘贴到程序中使用。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527135034147.png" alt="image-20230527135034147"></p>
<h4 id="查看网站根证书"><a href="#查看网站根证书" class="headerlink" title="查看网站根证书"></a>查看网站根证书</h4><p>在我们用HTTPS协议开发物联网项目时，有时需要获取根证书。我们可以用电脑中的浏览器来获取该信息。</p>
<p>为了演示本操作，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行演示如何获取<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器的证书指纹./">www.howsmyssl.com网站服务器的证书指纹。</a></p>
<ol>
<li>请在服务器地址栏中输入以下网址：</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.howsmyssl.com/">https://www.howsmyssl.com/</a></p>
<p>当浏览器成功打开以上网址的网页后，请如下图所示点击地址栏前面的“小锁”标志。然后在弹出的菜单中点击“证书”（如下图2号红色方框所标识的信息）。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141018048.png" alt="image-20230527141018048"></p>
<ol start="2">
<li>如下图所示，请在弹出的“证书”窗口中，点击下图数字1所示的“证书路径”，然后用鼠标选中下图数字2所示的“DST Root CA X3”证书。</li>
</ol>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141029424.png" alt="image-20230527141029424"></p>
<ol start="3">
<li>接下来请点击下图数字1所示的“详细信息”标签。此时窗口中显示的都是上一步选中的“DST Root CA X3”证书的详细信息。然后您 就可以点击下图中数字2所示的“复制到文件”按钮。</li>
</ol>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141038975.png" alt="image-20230527141038975"></p>
<ol start="4">
<li>在弹出的“证书导出向导”中点击 “下一步”按钮。</li>
</ol>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141047916.png" alt="image-20230527141047916"></p>
<ol start="5">
<li>接下来您可以根据自己的需要选择证书格式。</li>
</ol>
<p>假如您需要将本证书应用于本站的ESP8266物联网开发资料页中的示例程序，那么请选择Base64编码X.509(.CER)选项，然后点击下一步。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141104115.png" alt="image-20230527141104115"></p>
<ol start="6">
<li>在接下来的步骤里，点击浏览按钮，选择保存证书文件的路径。</li>
</ol>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141115249.png" alt="image-20230527141115249"></p>
<ol start="7">
<li>点击完成按钮，证书将会到出到您电脑中指定路径。</li>
</ol>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141124524.png" alt="image-20230527141124524"></p>
<ol start="8">
<li><p>请使用Notepade++一类的文本编辑软件打开刚刚导出的证书文件，您就会得到网站证书的详细内容。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141135767.png" alt="image-20230527141135767"></p>
</li>
</ol>
<h3 id="连接认证类型"><a href="#连接认证类型" class="headerlink" title="连接认证类型"></a>连接认证类型</h3><h4 id="连接类型"><a href="#连接类型" class="headerlink" title="连接类型"></a>连接类型</h4><h5 id="WiFiClientSecure-–-建立WiFiClientSecure对象"><a href="#WiFiClientSecure-–-建立WiFiClientSecure对象" class="headerlink" title="WiFiClientSecure – 建立WiFiClientSecure对象"></a>WiFiClientSecure – 建立WiFiClientSecure对象</h5><h6 id="说明-140"><a href="#说明-140" class="headerlink" title="说明"></a>说明</h6><p>通过WiFiClientSecure语句，我们可以建立WiFiClientSecure对象从而实现ESP8266的HTTPS协议物联网通讯。</p>
<h6 id="语法-143"><a href="#语法-143" class="headerlink" title="语法"></a>语法</h6><p><code>WiFiClientSecure httpsClient</code><br>注：请参考本页的示例程序部分获取更多应用说明信息。此函数在示例程序中被高亮标记以便您查阅。</p>
<h6 id="参数-135"><a href="#参数-135" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-134"><a href="#返回值-134" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-125"><a href="#示例程序-125" class="headerlink" title="示例程序"></a>示例程序</h6><p><strong>示例1：ESP8266实现HTTPS通讯（指纹认证）</strong></p>
<p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527141722780.png" alt="image-20230527141722780"></p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。如需了解如何执行这一操作，请参考“查看网站证书指纹”。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的WiFiClientSecure语句来建立</span></span><br><span class="line"><span class="comment">WiFiClientSecure对象。该对象用于控制ESP8266的HTTPS协议通讯。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。如需了解如何执行这一操作，请参考“获取网站证书指纹”</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。如需了解如何执行这一操作，请参考太极创客网站中</span></span><br><span class="line"><span class="comment">//“获取网站证书指纹”页面(网址见下):</span></span><br><span class="line"><span class="comment">//http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>示例2：ESP8266实现HTTPS通讯（证书认证）</strong></p>
<p>本实例所实现的功能与示例1相同。唯一区别是本示例中在ESP8266与服务器的HTTPS通信中，使用证书认证而不是指纹认证。使用本示例中的证书认证可以提高HTTPS通讯安全性。</p>
<p>如需了解本示例程序的操作方法和运行结果，请参考示例1中的相应内容。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。如需了解如何执行这一操作，“查看网站根证书”。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecure_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的WiFiClientSecure语句来建立</span></span><br><span class="line"><span class="comment">WiFiClientSecure对象。该对象用于控制ESP8266的HTTPS协议通讯。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，CA会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的网站根证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。如需了解如何执行这一操作，请参考“获取网站根证书”</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，CA会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的证书</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。如需了解如何执行这一操作，请参考“获取网站证书”</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  BearSSL::X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="connect-–-连接服务器-1"><a href="#connect-–-连接服务器-1" class="headerlink" title="connect – 连接服务器"></a>connect – 连接服务器</h5><h6 id="说明-141"><a href="#说明-141" class="headerlink" title="说明"></a>说明</h6><p>connect函数用于ESP8266开发板通过HTTPS协议连接网络服务器。</p>
<h6 id="语法-144"><a href="#语法-144" class="headerlink" title="语法"></a>语法</h6><p><code>httpsClient.connect(ip, port)</code><br><code>httpsClient.connect(host, port)</code><br>注：请参考本页的示例程序部分获取更多应用说明信息。此函数在示例程序中被高亮标记以便您查阅。</p>
<h6 id="参数-136"><a href="#参数-136" class="headerlink" title="参数"></a>参数</h6><p>ip: 所要连接的服务器的IP地址。类型:IPAddress。<br>host：所要连接的服务器域名,可使用字符串类型。<br>port:所要连接的服务器端口号,允许使用int类型。</p>
<h6 id="返回值-135"><a href="#返回值-135" class="headerlink" title="返回值"></a>返回值</h6><p>连接失败返回0，连接成功返回1。返回值数据类型是bool型。</p>
<h6 id="示例程序-126"><a href="#示例程序-126" class="headerlink" title="示例程序"></a>示例程序</h6><p><strong>示例1：ESP8266实现HTTPS通讯（指纹认证）</strong></p>
<p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527142203319.png" alt="image-20230527142203319"></p>
<p>此程序使用了语句**httpsClient.connect(host, httpsPort)**实现ESP8266与服务器连接。具体操作方法，请见以下示例程序的高亮部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : connect_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的connect函数来控制ESP8266</span></span><br><span class="line"><span class="comment">通过HTTPS协议连接服务器。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>示例2：ESP8266实现HTTPS通讯（证书认证）</strong></p>
<p>本实例所实现的功能与示例1相同。唯一区别是本示例中在ESP8266与服务器的HTTPS通信中，使用证书认证而不是指纹认证。使用本示例中的证书认证可以提高HTTPS通讯安全性。</p>
<p>如需了解本示例程序的操作方法和运行结果，请参考示例1中的相应内容。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : connect_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的connect函数来控制ESP8266</span></span><br><span class="line"><span class="comment">通过HTTPS协议连接服务器。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，CA会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的网站根证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，CA会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的证书</span></span><br><span class="line"><span class="comment">//http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate/</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  BearSSL::X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="stop-–-停止客户端-1"><a href="#stop-–-停止客户端-1" class="headerlink" title="stop – 停止客户端"></a>stop – 停止客户端</h5><h6 id="说明-142"><a href="#说明-142" class="headerlink" title="说明"></a>说明</h6><p>stop函数用于停止ESP8266连接TCP服务器。</p>
<h6 id="语法-145"><a href="#语法-145" class="headerlink" title="语法"></a>语法</h6><p><code>httpsClient.stop()</code><br>注：请参考本页的示例程序部分获取更多应用说明信息。此函数在示例程序中被高亮标记以便您查阅。</p>
<h6 id="参数-137"><a href="#参数-137" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-136"><a href="#返回值-136" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-127"><a href="#示例程序-127" class="headerlink" title="示例程序"></a>示例程序</h6><p><strong>示例1：ESP8266实现HTTPS通讯（指纹认证）</strong></p>
<p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527142930134.png" alt="image-20230527142930134"></p>
<p>此程序使用了语句**httpsClient.stop()**实现ESP8266断开服务器连接。具体操作方法，请见以下示例程序的高亮部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-Stop_1</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : CYNO朔</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200418</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的stop函数来控制ESP8266</span></span><br><span class="line"><span class="comment">断开与服务器的连接。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。如需了解如何执行这一操作，请参考太极创客网站中</span></span><br><span class="line"><span class="comment">“获取网站证书指纹”页面(网址见下):</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。如需了解如何执行这一操作，请参考太极创客网站中</span></span><br><span class="line"><span class="comment">//“获取网站证书指纹”页面(网址见下):</span></span><br><span class="line"><span class="comment">//http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="认证类型"><a href="#认证类型" class="headerlink" title="认证类型"></a>认证类型</h4><h5 id="setFingerprint-–-设置校验指纹"><a href="#setFingerprint-–-设置校验指纹" class="headerlink" title="setFingerprint – 设置校验指纹"></a>setFingerprint – 设置校验指纹</h5><h6 id="说明-143"><a href="#说明-143" class="headerlink" title="说明"></a>说明</h6><p>在使用ESP8266实现HTTPS协议物联网通讯时，我们可以使用服务器证书指纹进行服务器身份认证。setFingerprint函数即是用于设置服务器证书指纹信息以便ESP8266在与服务器进行HTTPS协议物联网通讯时，进行服务器身份认证的。请注意，目前该函数仅支持SHA-1证书指纹。</p>
<h6 id="语法-146"><a href="#语法-146" class="headerlink" title="语法"></a>语法</h6><p>https.setFingerprint(fingerprint)</p>
<h6 id="参数-138"><a href="#参数-138" class="headerlink" title="参数"></a>参数</h6><p>fingerprint: 服务器证书指纹。可以使用const char*类型或者20个uint8_t元素的数组。</p>
<h6 id="返回值-137"><a href="#返回值-137" class="headerlink" title="返回值"></a>返回值</h6><p>成功设置指纹则返回true。否则返回false。</p>
<h6 id="示例程序-128"><a href="#示例程序-128" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527145250946.png" alt="image-20230527145250946"></p>
<p>此程序使用了语句 httpsClient.setFingerprint(fingerprint)来设置服务器证书指纹。具体操作方法，请见以下示例程序的高亮部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setFingerPrint</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的setFingerPrint函数来控制ESP8266</span></span><br><span class="line"><span class="comment">验证服务器身份。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="comment">//以下两行语句为两种不同方法建立fingerprint。他们的作用是相同的。</span></span><br><span class="line"><span class="comment">//const char fingerprint[] PROGMEM = &quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="setTrustAnchors-–-设置信任锚"><a href="#setTrustAnchors-–-设置信任锚" class="headerlink" title="setTrustAnchors – 设置信任锚"></a>setTrustAnchors – 设置信任锚</h5><h6 id="说明-144"><a href="#说明-144" class="headerlink" title="说明"></a>说明</h6><p>在使用ESP8266实现HTTPS协议物联网通讯时，我们可以使用服务器根证书进行服务器身份认证。setTrustAnchors函数用于安装服务器根证书，以便ESP8266进行服务器身份认证。（根证书是CA认证中心给自己颁发的证书,是信任链的起始点。安装根证书意味着对这个证书信任。出于通讯安全考虑，请尽量安装使用知名权CA认证中心颁发的证书。）</p>
<p>请注意：</p>
<ol>
<li>目前该函数仅支持Base64编码X.509证书。</li>
<li>使用本函数前需要先建立X509List对象。并且将该对象作为setTrustAnchors的参数。<br>如需了解具体操作方法，请见本函数页面的示例程序部分。</li>
</ol>
<h6 id="语法-147"><a href="#语法-147" class="headerlink" title="语法"></a>语法</h6><p><code>httpsClient.setTrustAnchors(cert)</code></p>
<h6 id="参数-139"><a href="#参数-139" class="headerlink" title="参数"></a>参数</h6><p>cert: X.509证书对象（类型：X509List* ）</p>
<h6 id="返回值-138"><a href="#返回值-138" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-129"><a href="#示例程序-129" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527145425429.png" alt="image-20230527145425429"></p>
<p>在以下程序中，我们首先使用语句**X509List cert(digicert);<strong>建立X509List对象。该对象将会作为参数应用于语句</strong>httpsClient.setTrustAnchors(&amp;cert);**来实现证书安装。具体操作方法，请见以下示例程序中的高亮部分。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setTrustAnchors</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的stop函数来控制ESP8266</span></span><br><span class="line"><span class="comment">断开与服务器的连接。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，CA会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的网站根证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，CA会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的证书</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。如需了解如何执行这一操作，请参考太极创客网站中</span></span><br><span class="line"><span class="comment">//“获取网站证书”页面(网址见下):</span></span><br><span class="line"><span class="comment">//http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate/</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="setX509Time-–-设置时间以认证x-509数字证书"><a href="#setX509Time-–-设置时间以认证x-509数字证书" class="headerlink" title="setX509Time – 设置时间以认证x.509数字证书"></a>setX509Time – 设置时间以认证x.509数字证书</h5><h6 id="说明-145"><a href="#说明-145" class="headerlink" title="说明"></a>说明</h6><p>setX509Time函数可用于设置ESP8266对服务器证书进行认证时，所使用的时间信息。</p>
<h6 id="语法-148"><a href="#语法-148" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setX509Time(timeInfo)</p>
<h6 id="参数-140"><a href="#参数-140" class="headerlink" title="参数"></a>参数</h6><p>timeInfo: 设置服务器证书认证所使用的时间信息（类型: time_t）</p>
<h6 id="返回值-139"><a href="#返回值-139" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-130"><a href="#示例程序-130" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527145542826.png" alt="image-20230527145542826"></p>
<p>在以下程序中，我们首先使用语句**time_t timeSet &#x3D; 1587218446;<strong>建立time_t变量。该变量用于存储时间信息。接下来我们使用</strong>httpsClient.setX509Time(timeSet)**对认证服务器证书所用的时间进行设置。具体操作方法，请见以下示例程序中的高亮部分。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setX509Time</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的setX509Time函数来设置服务器证书认证使用的</span></span><br><span class="line"><span class="comment">时间。以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">WiFiClientSecure httpsClient;   </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 建立time_t变量用于存储时间信息</span></span><br><span class="line">  <span class="type">time_t</span> timeSet = <span class="number">1587218446</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 对认证证书所用的时间进行设置</span></span><br><span class="line">  httpsClient.setX509Time(timeSet);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过串口监视器输出设置的时间信息以便我们查看</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;timeSet, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;timeSet: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="setInsecure-–-设置不进行身份校验"><a href="#setInsecure-–-设置不进行身份校验" class="headerlink" title="setInsecure – 设置不进行身份校验"></a>setInsecure – 设置不进行身份校验</h5><h6 id="说明-146"><a href="#说明-146" class="headerlink" title="说明"></a>说明</h6><p>使用setInsecure将会让ESP8266不进行服务器身份认证，而直接与服务器进行通讯。<strong>注意：此方法跳过了HTTPS协议中的安全加密措施，因此仅可用于测试使用，而不适合传输需要保密的信息。</strong></p>
<h6 id="语法-149"><a href="#语法-149" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setInsecure()</p>
<h6 id="参数-141"><a href="#参数-141" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-140"><a href="#返回值-140" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-131"><a href="#示例程序-131" class="headerlink" title="示例程序"></a>示例程序</h6><p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯./">www.howsmyssl.com网站服务器进行通讯。</a></p>
<p>由于在以下示例程序中使用了httpsClient.setInsecure()，ESP8266将不会进行任何服务器身份认证而直接与服务器进行通讯，所以此方法不适合传输需要保密的信息。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecure_setInsecure</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的setInsecure来控制ESP8266</span></span><br><span class="line"><span class="comment">的HTTPS协议通讯。使用setInsecure将会让ESP8266不进行服务器身份认证，而直接</span></span><br><span class="line"><span class="comment">与服务器进行通讯，这种方法非常不安全。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Using Insecure&quot;</span>);</span><br><span class="line">  httpsClient.setInsecure();</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;ESP8266 Connected to Server. Now Disconect...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="allowSelfSignedCerts-–-允许自签名证书"><a href="#allowSelfSignedCerts-–-允许自签名证书" class="headerlink" title="allowSelfSignedCerts – 允许自签名证书"></a>allowSelfSignedCerts – 允许自签名证书</h5><h6 id="说明-147"><a href="#说明-147" class="headerlink" title="说明"></a>说明</h6><p>使用allowSelfSignedCerts将会允许ESP8266对使用自签名证书的服务器进行身份认证。</p>
<p>服务器证书需要由权威证书颁发机构签名方可信赖。自签名证书不具安全效力，仅可用于测试使用。</p>
<h6 id="语法-150"><a href="#语法-150" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.allowSelfSignedCerts()</p>
<h6 id="参数-142"><a href="#参数-142" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-141"><a href="#返回值-141" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-132"><a href="#示例程序-132" class="headerlink" title="示例程序"></a>示例程序</h6><p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接WiFi并通过HTTPS协议与badssl.com网站服务器进行通讯。</p>
<p>由于在以下示例程序中使用了httpsClient.allowSelfSignedCerts()，ESP8266对使用自签名证书的服务器进行身份认证，服务器证书需要由权威证书颁发机构签名方可信赖。自签名证书不具安全效力，仅可用于测试使用。所以此方法不适合传输需要保密的信息。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecure_allowSelfSignedCerts</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的allowSelfSignedCerts来控制ESP8266</span></span><br><span class="line"><span class="comment">的HTTPS协议通讯。使用allowSelfSignedCerts将会让ESP8266允许使用自签名证书进行服务器认证。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pass = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 连接服务器</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fetchURL</span><span class="params">(BearSSL::WiFiClientSecure *client, <span class="type">const</span> <span class="type">char</span> *host, <span class="type">const</span> <span class="type">uint16_t</span> port, <span class="type">const</span> <span class="type">char</span> *path)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!path) &#123;</span><br><span class="line">    path = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Trying: %s:443...&quot;</span>, host);</span><br><span class="line">  client-&gt;connect(host, port);</span><br><span class="line">  <span class="keyword">if</span> (!client-&gt;connected()) &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;*** Can&#x27;t connect. ***\n-------\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connected!\n-------\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 向服务器发送请求</span></span><br><span class="line">  client-&gt;write(<span class="string">&quot;GET &quot;</span>);</span><br><span class="line">  client-&gt;write(path);</span><br><span class="line">  client-&gt;write(<span class="string">&quot; HTTP/1.0\r\nHost: &quot;</span>);</span><br><span class="line">  client-&gt;write(host);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;\r\nUser-Agent: ESP8266\r\n&quot;</span>);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  <span class="type">uint32_t</span> to = millis() + <span class="number">5000</span>;</span><br><span class="line">  <span class="keyword">if</span> (client-&gt;connected()) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="type">char</span> tmp[<span class="number">32</span>];</span><br><span class="line">      <span class="built_in">memset</span>(tmp, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">      <span class="type">int</span> rlen = client-&gt;read((<span class="type">uint8_t</span>*)tmp, <span class="keyword">sizeof</span>(tmp) - <span class="number">1</span>);</span><br><span class="line">      yield();</span><br><span class="line">      <span class="keyword">if</span> (rlen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 输出服务器响应状态信息</span></span><br><span class="line">      <span class="type">char</span> *nl = <span class="built_in">strchr</span>(tmp, <span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (nl) &#123;</span><br><span class="line">        *nl = <span class="number">0</span>;</span><br><span class="line">        Serial.print(tmp);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Serial.print(tmp);</span><br><span class="line">    &#125; <span class="keyword">while</span> (millis() &lt; to);</span><br><span class="line">  &#125;</span><br><span class="line">  client-&gt;stop();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 通过允许自签名证书方式连接网站服务器</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fetchSelfSigned</span><span class="params">()</span> &#123;</span><br><span class="line">  BearSSL::WiFiClientSecure client;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 现尝试不开启自签名认证连接服务器（服务器会拒绝连接）</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;First, try and connect to a badssl.com self-signed website (will fail):\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置允许自签名证书</span></span><br><span class="line">  fetchURL(&amp;client, <span class="string">&quot;self-signed.badssl.com&quot;</span>, <span class="number">443</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 开启自签名认证连接服务器（可正常连接服务器）</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Now we&#x27;ll enable self-signed certs (will pass)\n&quot;</span>);</span><br><span class="line">  client.allowSelfSignedCerts();</span><br><span class="line">  fetchURL(&amp;client, <span class="string">&quot;self-signed.badssl.com&quot;</span>, <span class="number">443</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接WiFi</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, pass);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  fetchSelfSigned(); </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>







<h5 id="setKnownKey-–-设置服务器公钥"><a href="#setKnownKey-–-设置服务器公钥" class="headerlink" title="setKnownKey – 设置服务器公钥"></a>setKnownKey – 设置服务器公钥</h5><h6 id="说明-148"><a href="#说明-148" class="headerlink" title="说明"></a>说明</h6><p>在使用ESP8266实现HTTPS协议物联网通讯时，我们可以使用服务器公钥进行服务器身份认证。setKnownKey函数用于安装服务器公钥，以便ESP8266进行服务器身份认证。（公钥是服务器认证的关键。请确保服务器公钥正确，否则您的物联网通讯可能受到安全威胁。）</p>
<p>如需获取网站服务器公钥，可以先使用浏览器将服务器证书下载（注意这里下载的是服务器证书而不是根证书）。</p>
<p>请注意：在使用本函数前需要先建立PublicKey对象。并且将该对象作为setKnownKey的参数。如需了解具体操作方法，请见本函数页面的示例程序部分。</p>
<h6 id="语法-151"><a href="#语法-151" class="headerlink" title="语法"></a>语法</h6><p><code>httpsClient.setKnownKey(key);</code></p>
<h6 id="参数-143"><a href="#参数-143" class="headerlink" title="参数"></a>参数</h6><p>key: 公钥信息（类型：PublicKey*）</p>
<h6 id="返回值-142"><a href="#返回值-142" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-133"><a href="#示例程序-133" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应状态码以及响应头信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与必应网站服务器进行通讯。服务器响应状态码以及响应头信息显示于串口监视器中以便我们查阅。程序运行结果如下图所示。</p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527145946942.png" alt="image-20230527145946942"></p>
<p>通过以上截屏，我们可以看到服务器响应状态码为200 OK。这一信息说明必应网站服务器已经成功地与ESP8266取得连接，另外服务器也已经成功的收到了ESP8266通过HTTPS协议发送的请求信息。</p>
<p>在以下示例程序中，我们使用了语句<code>PublicKey key(pubkey)</code>建立了公钥对象，并且将该对象作为参数应用在 <code>httpsClient.setKnownKey(&amp;key)</code>语句中。具体操作方法请见以下示例程序中高亮语句部分。</p>
<p><strong>注：此程序中的公钥是服务器公钥，而不是CA公钥。如需获取该服务器公钥，可以先使用浏览器将服务器证书下载。假设此处下载的服务器证书名称为“bing.cer”，接下来可以使用OpenSSL工具软件通过以下指令从服务器证书中提取服务器公钥:<br>openssl x509 -pubkey -noout -in bing.cer。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setKnownKey_bing</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。本程序使用了setKnownKey来利用服务器公钥实现服务器身份认证方式。</span></span><br><span class="line"><span class="comment">注：此程序中的公钥是服务器公钥，而不是CA公钥。如需获取该公钥，可以先使用浏览器将服务器</span></span><br><span class="line"><span class="comment">证书下载（假设此处下载的服务器证书名称为www-bing-com.pem）。然后使用openssl通过</span></span><br><span class="line"><span class="comment">以下指令从服务器证书中提取服务器公钥:</span></span><br><span class="line"><span class="comment">openssl x509 -pubkey -noout -in www-bing-com.pem</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新公钥信息。因此本程序</span></span><br><span class="line"><span class="comment">中的公钥可能已经过期。请使用以上方法获取最新的服务器公钥</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用openssl获取网站服务器公钥（具体方法详见程序头部说明信息）</span></span><br><span class="line"><span class="comment">// 并将其复制粘贴到以下数组中。</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> pubkey[] PROGMEM = <span class="string">R&quot;KEY(</span></span><br><span class="line"><span class="string">-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4SJT29Ij+8UZlEnCuN0C</span></span><br><span class="line"><span class="string">Owov5b3zLploURQB3Bc4yAx7O+LKtAfs3vB1uT0ei1kXv3d8keXQvO4ELNKlxorc</span></span><br><span class="line"><span class="string">7D/b1iXKcCldu97ZZ1ohH4GcebbzQhXRzqqGKBy92vM3nfyZBkxHl7pBhF9E3gYA</span></span><br><span class="line"><span class="string">o3FU4+akcSYY5VsbNwHAf6uH+L4t0BvNE20lNlDtJZL4b37O9wtY6ou2bKYmv2LD</span></span><br><span class="line"><span class="string">KnEOl/gDwGfuILio0K+at9rc49hRrSTumZmbjVfVsG99vPdVIcGdw9j6yHJwjZSE</span></span><br><span class="line"><span class="string">NfxWoeopu1XOu6jtsf/vq+4Duz7UfG8ghZxbjVFUMYUiJApI+hbz8XGHn6JNMCdF</span></span><br><span class="line"><span class="string">UQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">)KEY&quot;</span>;</span><br><span class="line"> </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  PublicKey <span class="title function_">key</span><span class="params">(pubkey)</span>;</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using public key&quot;</span>);</span><br><span class="line">  httpsClient.setKnownKey(&amp;key);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    Serial.println(line);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="setCiphers-–-设置加密方式-自定义"><a href="#setCiphers-–-设置加密方式-自定义" class="headerlink" title="setCiphers – 设置加密方式(自定义)"></a>setCiphers – 设置加密方式(自定义)</h5><h6 id="说明-149"><a href="#说明-149" class="headerlink" title="说明"></a>说明</h6><p>setCiphers可用来设置ESP8266的HTTPS通讯加密方式。与使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/settrustanchors/">setTrustAnchors</a>函数来对服务器根证书认证比较，setCiphers安全性能要更低。但是此使用setCiphers可以降低ESP8266的运算工作。因此ESP8266的能耗也会相应降低。如果您的项目使用电池为ESP8266供电且需要降低ESP8266能耗，可以考虑采用此方法实现ESP8266的HTTPS通讯。如需了解更多加密方式，请参考ESP8266库源文件中<a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266WiFi/src/WiFiClientSecureBearSSL.cpp">WiFiClientSecureBearSSL.cpp</a>中相关信息。</p>
<h6 id="语法-152"><a href="#语法-152" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setCiphers(cipherList)</p>
<h6 id="参数-144"><a href="#参数-144" class="headerlink" title="参数"></a>参数</h6><p>cipherList: 加密方式</p>
<h6 id="返回值-143"><a href="#返回值-143" class="headerlink" title="返回值"></a>返回值</h6><p>成功设置加密方式，则返回true。否则返回false。返回值为布尔型。</p>
<h6 id="示例程序-134"><a href="#示例程序-134" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应状态码以及响应头信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与必应网站服务器进行通讯。服务器响应状态码以及响应头信息显示于串口监视器中以便我们查阅。</p>
<p>在以下示例程序中，我们在使用setCiphers前需要首先使用<code>httpsClient.setInsecure()</code>来设置ESP8266。接下来使用 httpsClient.setCiphers(myCustomList)来设置具体加密方式。具体操作方法，请见以下程序中高亮语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setCiphers</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。本程序使用了setCiphers来设置通讯加密方式。此方法与使用</span></span><br><span class="line"><span class="comment">服务器根证书认证方法比较，安全性能要更低。但是此方法可以降低ESP8266的运算工作。</span></span><br><span class="line"><span class="comment">因此ESP8266的能耗也会相应降低。如果您的项目使用电池为ESP8266供电，且需要降低</span></span><br><span class="line"><span class="comment">ESP8266能耗，可以考虑采用此方法实现ESP8266的HTTPS通讯。如需了解更多加密方式，</span></span><br><span class="line"><span class="comment">请参考ESP8266库源文件中WiFiClientSecureBearSSL.cpp中相关信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">   </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;set ciphers...&quot;</span>);</span><br><span class="line">  <span class="comment">// 添加加密方式（如需了解更多加密方式，请参考ESP8266库源文件中WiFiClientSecureBearSSL.cpp中相关信息）</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">uint16_t</span>&gt; myCustomList = &#123; BR_TLS_RSA_WITH_AES_256_CBC_SHA256, BR_TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA, BR_TLS_RSA_WITH_3DES_EDE_CBC_SHA &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 使用setCiphers前需要首先使用setInsecure来设置ESP8266</span></span><br><span class="line">  httpsClient.setInsecure();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 接下来使用setCiphers来设置具体加密方式</span></span><br><span class="line">  httpsClient.setCiphers(myCustomList);</span><br><span class="line">  </span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    Serial.println(line);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="setCiphersLessSecure–-设置加密方式-低级别"><a href="#setCiphersLessSecure–-设置加密方式-低级别" class="headerlink" title="setCiphersLessSecure– 设置加密方式(低级别)"></a>setCiphersLessSecure– 设置加密方式(低级别)</h5><h6 id="说明-150"><a href="#说明-150" class="headerlink" title="说明"></a>说明</h6><p>setCiphersLessSecure可用来设置ESP8266的HTTPS通讯加密方式。与使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/settrustanchors/">setTrustAnchors</a>函数来对服务器根证书认证比较，setCiphersLessSecure安全性能要更低。但是使用setCiphersLessSecure可以降低ESP8266的运算工作。因此ESP8266的能耗也会相应降低。如果您的项目使用电池为ESP8266供电且需要降低ESP8266能耗，可以考虑采用此方法实现ESP8266的HTTPS通讯。</p>
<p>语法</p>
<p>httpsClient.setCiphersLessSecure()</p>
<h6 id="参数-145"><a href="#参数-145" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-144"><a href="#返回值-144" class="headerlink" title="返回值"></a>返回值</h6><p>成功设置加密方式，则返回true。否则返回false。返回值为布尔型。</p>
<h6 id="示例程序-135"><a href="#示例程序-135" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应状态码以及响应头信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与必应网站服务器进行通讯。服务器响应状态码以及响应头信息显示于串口监视器中以便我们查阅。</p>
<p>在以下示例程序中，我们在使用setCiphersLessSecure前需要首先使用<code>httpsClient.setInsecure()</code>来设置ESP8266。接下来使用 httpsClient.setCiphersLessSecure()来设置具体加密方式。具体操作方法，请见以下程序中高亮语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setCiphersLessSecure</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。本程序使用了setCiphersLessSecure来设置通讯加密方式。此方法与使用</span></span><br><span class="line"><span class="comment">服务器根证书认证方法比较，安全性能要更低。但是此方法可以降低ESP8266的运算工作。</span></span><br><span class="line"><span class="comment">因此ESP8266的能耗也会相应降低。如果您的项目使用电池为ESP8266供电，且需要降低</span></span><br><span class="line"><span class="comment">ESP8266能耗，可以考虑采用此方法实现ESP8266的HTTPS通讯。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">   </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;set less secure ciphers ...&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 使用setCiphersLessSecure前需要首先使用setInsecure来设置ESP8266</span></span><br><span class="line">  httpsClient.setInsecure();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 接下来使用setCiphersLessSecure来设置具体加密方式</span></span><br><span class="line">  httpsClient.setCiphersLessSecure();</span><br><span class="line">  </span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    Serial.println(line);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="setClientRSACert-–-设置客户端RSA证书"><a href="#setClientRSACert-–-设置客户端RSA证书" class="headerlink" title="setClientRSACert – 设置客户端RSA证书"></a>setClientRSACert – 设置客户端RSA证书</h5><h6 id="说明-151"><a href="#说明-151" class="headerlink" title="说明"></a>说明</h6><p>setClientRSACert函数可以用来设置客户端私钥以及客户端证书。</p>
<p>注意：使用ESP8266通过HTTPS协议获取网站信息时，网站服务器无需ESP8266提供证书信息即可实现通信。但是在一些MQTT协议物联网应用中，服务器会需要ESP8266提供客户端证书以验证身份。</p>
<h6 id="语法-153"><a href="#语法-153" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setClientRSACert(clientCert, clientPrivateKey)</p>
<h6 id="参数-146"><a href="#参数-146" class="headerlink" title="参数"></a>参数</h6><p>clientCert：客户端证书<br>clientPrivateKey：客户端私钥</p>
<h6 id="返回值-145"><a href="#返回值-145" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-136"><a href="#示例程序-136" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应状态码以及响应头信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与必应网站服务器进行通讯。服务器响应状态码以及响应头信息显示于串口监视器中以便我们查阅。</p>
<p>在以下示例程序中，我们在使用setClientRSACert前需要首先使用<code>X509List clientCert(digicert)</code>来设置ESP8266的客户端证书。接下来使用 <code>PrivateKey clientPrivateKey(key)</code>来设置客户端私钥。具体操作方法，请见以下程序中高亮语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setClientRSACert</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。程序使用WiFiClientSecure库中的setClientRSACert函数来设置客户端</span></span><br><span class="line"><span class="comment">私钥以及客户端证书。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">对于使用HTTPS协议访问网站信息，网站服务器无需客户端提供证书信息。此程序仅仅是为了向您演示</span></span><br><span class="line"><span class="comment">如何来为ESP8266设置客户端私钥以及客户端证书。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：此程序使用网站服务器证书指纹作为服务器身份认证。</span></span><br><span class="line"><span class="comment">出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="comment">//以下两行语句为两种不同类型的fingerprint建立。</span></span><br><span class="line"><span class="comment">//const char fingerprint[] PROGMEM = &quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 客户端证书信息</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( </span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDiDCCAnACAQEwDQYJKoZIhvcNAQELBQAwgYkxCzAJBgNVBAYTAkNOMRAwDgYD</span></span><br><span class="line"><span class="string">VQQIDAdCZWlqaW5nMRAwDgYDVQQHDAdCZWlqaW5nMRUwEwYDVQQKDAxUYWljaGkt</span></span><br><span class="line"><span class="string">TWFrZXIxDDAKBgNVBAsMA0lPVDENMAsGA1UEAwwEQ1lOTzEiMCAGCSqGSIb3DQEJ</span></span><br><span class="line"><span class="string">ARYTdGFpY2hpbWFrZXJAMTYzLmNvbTAeFw0yMDA0MTkwNzU4NDlaFw0yMzAxMTMw</span></span><br><span class="line"><span class="string">NzU4NDlaMIGJMQswCQYDVQQGEwJDTjEQMA4GA1UECAwHQmVpamluZzEQMA4GA1UE</span></span><br><span class="line"><span class="string">BwwHQmVpamluZzEVMBMGA1UECgwMVGFpY2hpLU1ha2VyMQwwCgYDVQQLDANJT1Qx</span></span><br><span class="line"><span class="string">DTALBgNVBAMMBENZTk8xIjAgBgkqhkiG9w0BCQEWE3RhaWNoaW1ha2VyQDE2My5j</span></span><br><span class="line"><span class="string">b20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDC+x7sS+0izluDQ6XJ</span></span><br><span class="line"><span class="string">mLv9Kxh9MYG9zRrgigsTQwyv085hDyDGxaKG58ZVZfa7X+srSQ5IssaKoJqK91qT</span></span><br><span class="line"><span class="string">au28rcYQihBFYkGngJc1gFOyMJujFU0VDPxmSuSBUWCPcXbGg0Z4sy/z1vt2pe19</span></span><br><span class="line"><span class="string">AuqyKVJCDHMCRkMeX/nWbYWHqJTPoAnOZ1CW91urCc2Kf1/eq6L5aFsgjbuuY119</span></span><br><span class="line"><span class="string">3KP7VdumeHhbsSr6JrDwW/URtun3UjB/LjdbjHoq5bMuY94vgCGO0ykSds25jkz5</span></span><br><span class="line"><span class="string">rz+32obSNAreNcR9Mz9IPX6mYEP1Yj6Fv7V6zoJYNxyNiO5UYRxC5w0g9ihhaqmQ</span></span><br><span class="line"><span class="string">VLofAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAGqOfdH56LZt7WO18ymgcMRZZakH</span></span><br><span class="line"><span class="string">629BYu/fsX+t/mgdQ7coPQneGfHD7y2PDB76nIp+wqjlI0mAoVaGmCRny5wWOKpZ</span></span><br><span class="line"><span class="string">bbvW6Kwn42dVab3M+zerM4ExzP3jeG76tsHbXZSHz1fUxASNONjcNjyh/s0HZcQw</span></span><br><span class="line"><span class="string">TgnGkFhpmMKXDkE4kU5T4itxn5j1mkVZjYOwL3d+IS8o3vmzgLCvwa4/BSK70xF3</span></span><br><span class="line"><span class="string">idoY6tl9bdkzU8nH4HKU8q5vjr3dh2HqWg6H7wOLx840BipKnvj4kago6AJILQ5v</span></span><br><span class="line"><span class="string">go3D93eEiK3NRq/jNXJET+7/NC8xPNeKtraxlYc1o+lbQl/AqsJTBojWifs=</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 客户端私钥信息</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> key[] PROGMEM = <span class="string">R&quot;KEY(</span></span><br><span class="line"><span class="string">-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4SJT29Ij+8UZlEnCuN0C</span></span><br><span class="line"><span class="string">Owov5b3zLploURQB3Bc4yAx7O+LKtAfs3vB1uT0ei1kXv3d8keXQvO4ELNKlxorc</span></span><br><span class="line"><span class="string">7D/b1iXKcCldu97ZZ1ohH4GcebbzQhXRzqqGKBy92vM3nfyZBkxHl7pBhF9E3gYA</span></span><br><span class="line"><span class="string">o3FU4+akcSYY5VsbNwHAf6uH+L4t0BvNE20lNlDtJZL4b37O9wtY6ou2bKYmv2LD</span></span><br><span class="line"><span class="string">KnEOl/gDwGfuILio0K+at9rc49hRrSTumZmbjVfVsG99vPdVIcGdw9j6yHJwjZSE</span></span><br><span class="line"><span class="string">NfxWoeopu1XOu6jtsf/vq+4Duz7UfG8ghZxbjVFUMYUiJApI+hbz8XGHn6JNMCdF</span></span><br><span class="line"><span class="string">UQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">)KEY&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;     <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  X509List <span class="title function_">clientCert</span><span class="params">(digicert)</span>;    <span class="comment">//建立X509List对象用于处理客户端证书</span></span><br><span class="line">  PrivateKey <span class="title function_">clientPrivateKey</span><span class="params">(key)</span>; <span class="comment">//建立PrivateKey对象用于处理客户端私钥</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置客户端私钥以及客户端证书</span></span><br><span class="line">  httpsClient.setClientRSACert(&amp;clientCert, &amp;clientPrivateKey);</span><br><span class="line">  </span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    Serial.println(line);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="setSession-–-会话控制"><a href="#setSession-–-会话控制" class="headerlink" title="setSession – 会话控制"></a>setSession – 会话控制</h5><h6 id="说明-152"><a href="#说明-152" class="headerlink" title="说明"></a>说明</h6><p>ESP8266通过HTTPS协议实现物联网通讯时，我们可以使用setSession函数将会话保存在设备内存中以便在有需要的时候恢复会话。</p>
<h6 id="语法-154"><a href="#语法-154" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setSession(session)</p>
<h6 id="参数-147"><a href="#参数-147" class="headerlink" title="参数"></a>参数</h6><p>Session对象</p>
<h6 id="返回值-146"><a href="#返回值-146" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-137"><a href="#示例程序-137" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与必应网站服务器进行通讯。服务器响应状态码以及响应头信息显示于串口监视器中以便我们查阅。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setSessions</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序改编自ESP8266库中BearSSL_Sessions示例程序。以下是原示例程序注释信息</span></span><br><span class="line"><span class="comment">Example of using SSL sessions to speed up SSL connection initiation</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">September 2018 by Earle F. Philhower, III</span></span><br><span class="line"><span class="comment">Released to the public domain</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序将使用setSessions函数将HTTPS对话保存在ESP8266的内存中，以便恢复使用。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pass = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *   host = <span class="string">&quot;cn.bing.com&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">uint16_t</span> port = <span class="number">443</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *   path = <span class="string">&quot;/&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting to %s\n&quot;</span>, ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, pass);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;\nConnected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP Address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 连接网站服务器，通过串口监视器输出服务器响应状态码</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fetchURL</span><span class="params">(BearSSL::WiFiClientSecure *client, <span class="type">const</span> <span class="type">char</span> *host, <span class="type">const</span> <span class="type">uint16_t</span> port, <span class="type">const</span> <span class="type">char</span> *path)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!path) &#123;</span><br><span class="line">    path = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Trying: %s:443...&quot;</span>, host);</span><br><span class="line">  client-&gt;connect(host, port);</span><br><span class="line">  <span class="keyword">if</span> (!client-&gt;connected()) &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;*** Can&#x27;t connect. ***\n-------\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connected!\n-------\n&quot;</span>);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;GET &quot;</span>);</span><br><span class="line">  client-&gt;write(path);</span><br><span class="line">  client-&gt;write(<span class="string">&quot; HTTP/1.0\r\nHost: &quot;</span>);</span><br><span class="line">  client-&gt;write(host);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;\r\nUser-Agent: ESP8266\r\n&quot;</span>);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  <span class="type">uint32_t</span> to = millis() + <span class="number">5000</span>;</span><br><span class="line">  <span class="keyword">if</span> (client-&gt;connected()) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="type">char</span> tmp[<span class="number">32</span>];</span><br><span class="line">      <span class="built_in">memset</span>(tmp, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">      <span class="type">int</span> rlen = client-&gt;read((<span class="type">uint8_t</span>*)tmp, <span class="keyword">sizeof</span>(tmp) - <span class="number">1</span>);</span><br><span class="line">      yield();</span><br><span class="line">      <span class="keyword">if</span> (rlen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">char</span> *nl = <span class="built_in">strchr</span>(tmp, <span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (nl) &#123;</span><br><span class="line">        *nl = <span class="number">0</span>;</span><br><span class="line">        Serial.print(tmp);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Serial.print(tmp);</span><br><span class="line">    &#125; <span class="keyword">while</span> (millis() &lt; to);</span><br><span class="line">  &#125;</span><br><span class="line">  client-&gt;stop();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;\n-------\n\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDdzCCAl+gAwIBAgIEAgAAuTANBgkqhkiG9w0BAQUFADBaMQswCQYDVQQGEwJJ</span></span><br><span class="line"><span class="string">RTESMBAGA1UEChMJQmFsdGltb3JlMRMwEQYDVQQLEwpDeWJlclRydXN0MSIwIAYD</span></span><br><span class="line"><span class="string">VQQDExlCYWx0aW1vcmUgQ3liZXJUcnVzdCBSb290MB4XDTAwMDUxMjE4NDYwMFoX</span></span><br><span class="line"><span class="string">DTI1MDUxMjIzNTkwMFowWjELMAkGA1UEBhMCSUUxEjAQBgNVBAoTCUJhbHRpbW9y</span></span><br><span class="line"><span class="string">ZTETMBEGA1UECxMKQ3liZXJUcnVzdDEiMCAGA1UEAxMZQmFsdGltb3JlIEN5YmVy</span></span><br><span class="line"><span class="string">VHJ1c3QgUm9vdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKMEuyKr</span></span><br><span class="line"><span class="string">mD1X6CZymrV51Cni4eiVgLGw41uOKymaZN+hXe2wCQVt2yguzmKiYv60iNoS6zjr</span></span><br><span class="line"><span class="string">IZ3AQSsBUnuId9Mcj8e6uYi1agnnc+gRQKfRzMpijS3ljwumUNKoUMMo6vWrJYeK</span></span><br><span class="line"><span class="string">mpYcqWe4PwzV9/lSEy/CG9VwcPCPwBLKBsua4dnKM3p31vjsufFoREJIE9LAwqSu</span></span><br><span class="line"><span class="string">XmD+tqYF/LTdB1kC1FkYmGP1pWPgkAx9XbIGevOF6uvUA65ehD5f/xXtabz5OTZy</span></span><br><span class="line"><span class="string">dc93Uk3zyZAsuT3lySNTPx8kmCFcB5kpvcY67Oduhjprl3RjM71oGDHweI12v/ye</span></span><br><span class="line"><span class="string">jl0qhqdNkNwnGjkCAwEAAaNFMEMwHQYDVR0OBBYEFOWdWTCCR1jMrPoIVDaGezq1</span></span><br><span class="line"><span class="string">BE3wMBIGA1UdEwEB/wQIMAYBAf8CAQMwDgYDVR0PAQH/BAQDAgEGMA0GCSqGSIb3</span></span><br><span class="line"><span class="string">DQEBBQUAA4IBAQCFDF2O5G9RaEIFoN27TyclhAO992T9Ldcw46QQF+vaKSm2eT92</span></span><br><span class="line"><span class="string">9hkTI7gQCvlYpNRhcL0EYWoSihfVCr3FvDB81ukMJY2GQE/szKN+OMY3EU/t3Wgx</span></span><br><span class="line"><span class="string">jkzSswF07r51XgdIGn9w/xZchMB5hbgF/X++ZRGjD8ACtPhSNzkE1akxehi/oCr0</span></span><br><span class="line"><span class="string">Epn3o0WC4zxe9Z2etciefC7IpJ5OCBRLbf1wbWsaY71k5h+3zvDyny67G7fyUIhz</span></span><br><span class="line"><span class="string">ksLi4xaNmjICq44Y3ekQEe5+NauQrz4wlHrQMz2nZQ/1/I6eYs9HRCwBXbsdtTLS</span></span><br><span class="line"><span class="string">R9I4LtD+gdwyah617jzV/OeBHRnDJELqYzmp</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  <span class="type">uint32_t</span> start, finish;</span><br><span class="line">  BearSSL::WiFiClientSecure client;</span><br><span class="line">  BearSSL::X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting without sessions...&quot;</span>);</span><br><span class="line">  start = millis();</span><br><span class="line">  client.setTrustAnchors(&amp;cert);</span><br><span class="line">  fetchURL(&amp;client, host, port, path);</span><br><span class="line">  finish = millis();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Total time: %dms\n&quot;</span>, finish - start);</span><br><span class="line">  </span><br><span class="line">  BearSSL::Session session;</span><br><span class="line">  client.setSession(&amp;session);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting with an unitialized session...&quot;</span>);</span><br><span class="line">  start = millis();</span><br><span class="line">  client.setTrustAnchors(&amp;cert);</span><br><span class="line">  fetchURL(&amp;client, host, port, path);</span><br><span class="line">  finish = millis();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Total time: %dms\n&quot;</span>, finish - start);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting with the just initialized session...&quot;</span>);</span><br><span class="line">  start = millis();</span><br><span class="line">  client.setTrustAnchors(&amp;cert);</span><br><span class="line">  fetchURL(&amp;client, host, port, path);</span><br><span class="line">  finish = millis();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Total time: %dms\n&quot;</span>, finish - start);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting again with the initialized session...&quot;</span>);</span><br><span class="line">  start = millis();</span><br><span class="line">  client.setTrustAnchors(&amp;cert);</span><br><span class="line">  fetchURL(&amp;client, host, port, path);</span><br><span class="line">  finish = millis();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Total time: %dms\n&quot;</span>, finish - start);</span><br><span class="line"> </span><br><span class="line">  delay(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h5 id="setBufferSizes-–-设置缓存大小"><a href="#setBufferSizes-–-设置缓存大小" class="headerlink" title="setBufferSizes – 设置缓存大小"></a>setBufferSizes – 设置缓存大小</h5><h6 id="说明-153"><a href="#说明-153" class="headerlink" title="说明"></a>说明</h6><p>setBufferSizes用于设置ESP8266在进行HTTPS协议的物联网通讯时，接收和发送缓存大小。</p>
<h6 id="语法-155"><a href="#语法-155" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setBufferSizes(recv, xmit);</p>
<h6 id="参数-148"><a href="#参数-148" class="headerlink" title="参数"></a>参数</h6><p>recv：接收缓存大小，该数值大小必须介于512和16384之间（单位字节，类型：int）<br>xmit：发送缓存大小，该数值大小必须介于512和16384之间（单位字节，类型：int）</p>
<h6 id="返回值-147"><a href="#返回值-147" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-138"><a href="#示例程序-138" class="headerlink" title="示例程序"></a>示例程序</h6><p>成功设置加密方式，则返回true。否则返回false。返回值为布尔型。</p>
<h6 id="示例程序-139"><a href="#示例程序-139" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应状态码以及响应头信息显示于串口监视器中。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与必应网站服务器进行通讯。服务器响应状态码以及响应头信息显示于串口监视器中以便我们查阅。</p>
<p>在以下示例程序中，我们在使用setBufferSizes来设置接收和发送缓存大小。具体操作方法，请见以下程序中高亮语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setBufferSizes</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的stop函数来控制ESP8266</span></span><br><span class="line"><span class="comment">断开与服务器的连接。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。程序使用了setBufferSizes函数来设置ESP8266的收发信息缓存大小。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="comment">//以下两行语句为两种不同类型的fingerprint建立。</span></span><br><span class="line"><span class="comment">//const char fingerprint[] PROGMEM = &quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(host);</span><br><span class="line">  httpsClient.setBufferSizes(<span class="number">16000</span>, <span class="number">512</span>); </span><br><span class="line">  </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    Serial.println(line);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="setCertStore-–-设置证书储存"><a href="#setCertStore-–-设置证书储存" class="headerlink" title="setCertStore – 设置证书储存"></a>setCertStore – 设置证书储存</h5><h6 id="说明-154"><a href="#说明-154" class="headerlink" title="说明"></a>说明</h6><p>setCertStore函数用于为ESP8266设置CertStore（证书集）。</p>
<p>如果您知道ESP8266要连接哪些服务器，那么您就不需要CertStore。但是，如果您不知道ESP8266将要连接并验证哪些服务器身份， CertStore可以让您从几十个甚至上百个存储在SPIFFS或SD中的证书里选择证书从而进行服务器身份验证。这一过程很像是浏览器在验证网站服务器身份时所使用的方法。</p>
<h6 id="语法-156"><a href="#语法-156" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.setCertStore(certStore)</p>
<h6 id="参数-149"><a href="#参数-149" class="headerlink" title="参数"></a>参数</h6><p>certStore：证书集对象</p>
<h6 id="返回值-148"><a href="#返回值-148" class="headerlink" title="返回值"></a>返回值</h6><p>无</p>
<h6 id="示例程序-140"><a href="#示例程序-140" class="headerlink" title="示例程序"></a>示例程序</h6><p>以下示例程序</p>
<p>在运行程序之前，请先下载<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/wp-content/uploads/2020/04/certs-from-mozilla.zip">certs-from-mozilla.py</a>。然后使用certs-from-mozilla.py下载证书集，接下来请将生成的.AR文件上传到SPIFFS或SD。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-setCertStore</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序是ESP8266库中的BearSSL_CertStore示例程序。仅对程序注释信息做了翻译。</span></span><br><span class="line"><span class="comment">以下是原程序头注释翻译。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">如果您知道ESP8266要连接哪些服务器，那么您就不需要CertStore。但是，如果您不知</span></span><br><span class="line"><span class="comment">道ESP8266将要连接并验证哪些服务器身份， CertStore可以让您从几十个甚至上百个</span></span><br><span class="line"><span class="comment">存储在SPIFFS或SD中的证书里选择证书从而进行服务器身份验证。这一过程很像是浏览器</span></span><br><span class="line"><span class="comment">在验证网站服务器身份时所使用的方法。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">在运行程序之前，必须使用certs-from-mozilla.py下载证书集然后将生成的.AR文件</span></span><br><span class="line"><span class="comment">上传到SPIFFS或SD。您不需要生成“ .IDX”文件，它是CertStore对象生成时自动生成</span></span><br><span class="line"><span class="comment">并且由ESP8266创建并写入SD或SPIFFS。certs-from-mozilla.py可通过以下链接下载：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/wp-content/uploads/2020/04/certs-from-mozilla.zip</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">certs-from-mozilla.py可以从互联网获取Mozilla.org的证书集。但是请不要以此</span></span><br><span class="line"><span class="comment">为认可或要求：用户（您）可以自行决定将要用作信任基础的证书。</span></span><br><span class="line"><span class="comment">2018年3月 作者：Earle F. Philhower, III</span></span><br><span class="line"><span class="comment">Released to the public domain</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;CertStoreBearSSL.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STASSID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STASSID <span class="string">&quot;your-ssid&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STAPSK  <span class="string">&quot;your-password&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = STASSID;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pass = STAPSK;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立CertStore对象。</span></span><br><span class="line">BearSSL::CertStore certStore;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 通过互联网获取时间信息，该信息用于x.509证书验证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 连接服务器</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fetchURL</span><span class="params">(BearSSL::WiFiClientSecure *client, <span class="type">const</span> <span class="type">char</span> *host, <span class="type">const</span> <span class="type">uint16_t</span> port, <span class="type">const</span> <span class="type">char</span> *path)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!path) &#123;</span><br><span class="line">    path = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Trying: %s:443...&quot;</span>, host);</span><br><span class="line">  client-&gt;connect(host, port);</span><br><span class="line">  <span class="keyword">if</span> (!client-&gt;connected()) &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;*** Can&#x27;t connect. ***\n-------\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connected!\n-------\n&quot;</span>);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;GET &quot;</span>);</span><br><span class="line">  client-&gt;write(path);</span><br><span class="line">  client-&gt;write(<span class="string">&quot; HTTP/1.0\r\nHost: &quot;</span>);</span><br><span class="line">  client-&gt;write(host);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;\r\nUser-Agent: ESP8266\r\n&quot;</span>);</span><br><span class="line">  client-&gt;write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  <span class="type">uint32_t</span> to = millis() + <span class="number">5000</span>;</span><br><span class="line">  <span class="keyword">if</span> (client-&gt;connected()) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="type">char</span> tmp[<span class="number">32</span>];</span><br><span class="line">      <span class="built_in">memset</span>(tmp, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">      <span class="type">int</span> rlen = client-&gt;read((<span class="type">uint8_t</span>*)tmp, <span class="keyword">sizeof</span>(tmp) - <span class="number">1</span>);</span><br><span class="line">      yield();</span><br><span class="line">      <span class="keyword">if</span> (rlen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 仅仅输出服务器响应状态码信息</span></span><br><span class="line">      <span class="type">char</span> *nl = <span class="built_in">strchr</span>(tmp, <span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (nl) &#123;</span><br><span class="line">        *nl = <span class="number">0</span>;</span><br><span class="line">        Serial.print(tmp);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Serial.print(tmp);</span><br><span class="line">    &#125; <span class="keyword">while</span> (millis() &lt; to);</span><br><span class="line">  &#125;</span><br><span class="line">  client-&gt;stop();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;\n-------\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  SPIFFS.begin();</span><br><span class="line">  <span class="comment">// 如果使用 SD 卡或者LittleFS库, 请使用::begin </span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接WiFi</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, pass);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  setClock(); <span class="comment">// X.509 认证用对时</span></span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> numCerts = certStore.initCertStore(SPIFFS, PSTR(<span class="string">&quot;/certs.idx&quot;</span>), PSTR(<span class="string">&quot;/certs.ar&quot;</span>));</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Number of CA certs read: %d\n&quot;</span>, numCerts);</span><br><span class="line">  <span class="keyword">if</span> (numCerts == <span class="number">0</span>) &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;No certs found. Did you run certs-from-mozilla.py and upload the SPIFFS directory before running?\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// Can&#x27;t connect to anything w/o certs!</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  BearSSL::WiFiClientSecure *bear = new BearSSL::WiFiClientSecure();</span><br><span class="line">  <span class="comment">// 应用证书集（cert store）</span></span><br><span class="line">  bear-&gt;setCertStore(&amp;certStore);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Attempting to fetch https://www.github.com/...\n&quot;</span>);</span><br><span class="line">  fetchURL(bear, <span class="string">&quot;www.github.com&quot;</span>, <span class="number">443</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">  delete bear;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;\nPlease enter a website address (www.blah.com) to connect to: &quot;</span>);</span><br><span class="line">  String site;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    site = Serial.readString();</span><br><span class="line">  &#125; <span class="keyword">while</span> (site == <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">// Strip newline if present</span></span><br><span class="line">  site.replace(String(<span class="string">&quot;\r&quot;</span>), emptyString);</span><br><span class="line">  site.replace(String(<span class="string">&quot;\n&quot;</span>), emptyString);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;https://%s/\n&quot;</span>, site.c_str());</span><br><span class="line"> </span><br><span class="line">  BearSSL::WiFiClientSecure *bear = new BearSSL::WiFiClientSecure();</span><br><span class="line">  <span class="comment">// Integrate the cert store with this connection</span></span><br><span class="line">  bear-&gt;setCertStore(&amp;certStore);</span><br><span class="line">  fetchURL(bear, site.c_str(), <span class="number">443</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">  delete bear;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="状态信息类型"><a href="#状态信息类型" class="headerlink" title="状态信息类型"></a>状态信息类型</h4><h5 id="connected-–-检查是否成功连接服务器-1"><a href="#connected-–-检查是否成功连接服务器-1" class="headerlink" title="connected – 检查是否成功连接服务器"></a>connected – 检查是否成功连接服务器</h5><h6 id="说明-155"><a href="#说明-155" class="headerlink" title="说明"></a>说明</h6><p>connected函数可以用来检查ESP8266在使用HTTPS协议通讯时，ESP8266与服务器连接的状态。</p>
<h6 id="语法-157"><a href="#语法-157" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.connected()</p>
<h6 id="参数-150"><a href="#参数-150" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-149"><a href="#返回值-149" class="headerlink" title="返回值"></a>返回值</h6><p>ESP8266与服务器连接则返回true，否则返回false。</p>
<h6 id="示例程序-141"><a href="#示例程序-141" class="headerlink" title="示例程序"></a>示例程序</h6><p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527151919397.png" alt="image-20230527151919397"></p>
<p>此程序使用了语句 httpsClient.connected()检查当前ESP8266是否与服务器连接。具体操作方法，请见以下示例程序的高亮部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-connected</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的connected函数来检查ESP8266是否</span></span><br><span class="line"><span class="comment">与服务器连接。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：本程序使用了指纹认证方式。出于安全原因，网站服务器会定期更新证书指纹信息。</span></span><br><span class="line"><span class="comment">因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="comment">//以下两行语句为两种不同类型的fingerprint建立。</span></span><br><span class="line"><span class="comment">//const char fingerprint[] PROGMEM = &quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="getLastSSLError-–-获取SSL错误信息"><a href="#getLastSSLError-–-获取SSL错误信息" class="headerlink" title="getLastSSLError – 获取SSL错误信息"></a>getLastSSLError – 获取SSL错误信息</h5><h6 id="说明-156"><a href="#说明-156" class="headerlink" title="说明"></a>说明</h6><p>ESP8266通过HTTPS协议进行物联网通讯时，我们可以使用getLastSSLError获取通讯报错信息。这些报错信息将以错误代码的形式通过getLastSSLError返回。</p>
<p>如需了解报错代码的详细说明，您可以参考以下两个文件中相应部分。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/tools/sdk/include/bearssl/bearssl_ssl.h">bearssl_ssl.h</a><br><a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/tools/sdk/include/bearssl/bearssl_x509.h">bearssl_x509.h</a></p>
<h6 id="语法-158"><a href="#语法-158" class="headerlink" title="语法"></a>语法</h6><p>httpsClient.getLastSSLError()</p>
<h6 id="参数-151"><a href="#参数-151" class="headerlink" title="参数"></a>参数</h6><p>无</p>
<h6 id="返回值-150"><a href="#返回值-150" class="headerlink" title="返回值"></a>返回值</h6><p>错误代码值，（类型： int）</p>
<h3 id="示例程序-142"><a href="#示例程序-142" class="headerlink" title="示例程序"></a>示例程序</h3><p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议尝试与必应网站服务器进行通讯。由于我们故意将服务器认证的指纹信息改为错误的，连接将会失败，同时程序中使用了<code>httpsClient.getLastSSLError()</code>来获取连接失败的报错信息。具体操作方法，请见以下 示例程序中的高亮代码部分。</p>
<p>如需了解报错代码的详细说明，您可以参考以下两个文件中相应部分。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/tools/sdk/include/bearssl/bearssl_ssl.h">bearssl_ssl.h</a><br><a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino/blob/master/tools/sdk/include/bearssl/bearssl_x509.h">bearssl_x509.h</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-getLastSSLError</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的getLastSSLError函数来获取</span></span><br><span class="line"><span class="comment">连接出错信息。</span></span><br><span class="line"><span class="comment">程序中故意将服务器指纹改为错误的。这么做是为了让getLastSSLError返回出错数据信息。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//const char *fingerprint = &quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;; // 正确指纹</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;62914576dc0afac83c4804bcc2c1b700a69fe123&quot;</span>;<span class="comment">// 错误指纹</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(host);</span><br><span class="line">   </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">     </span><br><span class="line">      Serial.print(<span class="string">&quot;httpsClient.getLastSSLError() = &quot;</span>);</span><br><span class="line">      Serial.println(httpsClient.getLastSSLError());</span><br><span class="line">      </span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="comment">//Serial.println(line);</span></span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="发送数据类型-1"><a href="#发送数据类型-1" class="headerlink" title="发送数据类型"></a>发送数据类型</h3><h4 id="print-–-发送信息（Stream类）-1"><a href="#print-–-发送信息（Stream类）-1" class="headerlink" title="print – 发送信息（Stream类）"></a>print – 发送信息（Stream类）</h4><h5 id="说明-157"><a href="#说明-157" class="headerlink" title="说明"></a>说明</h5><p>print函数用于发送数据到已连接的服务器。print函数与<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/println/">println</a>函数功能十分相似。他们二者的区别是，println函数会在发送的数据结尾增加一个换行符（’\n’），而print函数则不会。</p>
<p><strong>请留意，WiFiClientSecure库对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-159"><a href="#语法-159" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpsClient.print(val);</span><br></pre></td></tr></table></figure>

<h5 id="参数-152"><a href="#参数-152" class="headerlink" title="参数"></a>参数</h5><p>val:所要发送的数据，可以是字符串、字符或者数值。</p>
<h5 id="返回值-151"><a href="#返回值-151" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-143"><a href="#示例程序-143" class="headerlink" title="示例程序"></a>示例程序</h5><h6 id="示例1：ESP8266实现HTTPS通讯（指纹认证）"><a href="#示例1：ESP8266实现HTTPS通讯（指纹认证）" class="headerlink" title="示例1：ESP8266实现HTTPS通讯（指纹认证）"></a>示例1：ESP8266实现HTTPS通讯（指纹认证）</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527152552542.png" alt="image-20230527152552542"></p>
<p>在以下示例程序中，我们使用<code>httpsClient.print(request)</code>通过ESP8266向网站服务器发送请求。具体操作方法，请见以下示例程序的高亮部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_print_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的print函数来控制ESP8266</span></span><br><span class="line"><span class="comment">通过HTTPS协议向接服务器发送请求。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="示例2：ESP8266实现HTTPS通讯（证书认证）"><a href="#示例2：ESP8266实现HTTPS通讯（证书认证）" class="headerlink" title="示例2：ESP8266实现HTTPS通讯（证书认证）"></a>示例2：ESP8266实现HTTPS通讯（证书认证）</h6><p>本示例所实现的功能与示例1相同。唯一区别是本示例在ESP8266与服务器的HTTPS通信中，使用证书认证而不是指纹认证。使用本示例中的证书认证可以提高HTTPS通讯安全性。</p>
<p>如需了解本示例程序的操作方法和运行结果，请参考示例1中的相应内容。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_print_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的print函数来控制ESP8266</span></span><br><span class="line"><span class="comment">通过HTTPS协议向接服务器发送请求。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。如需了解如何执行这一操作，请参考太极创客网站中</span></span><br><span class="line"><span class="comment">//“获取网站证书”页面(网址见下):</span></span><br><span class="line"><span class="comment">//http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate/</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  BearSSL::X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="println-–-发送信息（Stream类）-1"><a href="#println-–-发送信息（Stream类）-1" class="headerlink" title="println – 发送信息（Stream类）"></a>println – 发送信息（Stream类）</h4><h5 id="说明-158"><a href="#说明-158" class="headerlink" title="说明"></a>说明</h5><p>println函数用于发送数据到已连接的服务器。println函数与<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wificlient/print/">print</a>函数功能十分相似。他们二者的区别是，println函数会在发送的数据结尾增加一个换行符（’\n’），而print函数则不会。</p>
<p><strong>请留意，WiFiClient对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-160"><a href="#语法-160" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpsClient.println(val);</span><br></pre></td></tr></table></figure>

<h5 id="参数-153"><a href="#参数-153" class="headerlink" title="参数"></a>参数</h5><p>val:所要发送的数据，可以是字符串、字符或者数值。</p>
<h5 id="返回值-152"><a href="#返回值-152" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-144"><a href="#示例程序-144" class="headerlink" title="示例程序"></a>示例程序</h5><h6 id="示例1：ESP8266实现HTTPS通讯（指纹认证）-1"><a href="#示例1：ESP8266实现HTTPS通讯（指纹认证）-1" class="headerlink" title="示例1：ESP8266实现HTTPS通讯（指纹认证）"></a>示例1：ESP8266实现HTTPS通讯（指纹认证）</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527152812150.png" alt="image-20230527152812150"></p>
<p>在以下示例程序中，我们使用<code>httpsClient.println(request)</code>通过ESP8266向网站服务器发送请求。具体操作方法，请见以下示例程序的高亮部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_println_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的println函数来控制ESP8266</span></span><br><span class="line"><span class="comment">通过HTTPS协议向接服务器发送请求。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.println(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="write-–-发送信息（Stream类）-1"><a href="#write-–-发送信息（Stream类）-1" class="headerlink" title="write – 发送信息（Stream类）"></a>write – 发送信息（Stream类）</h4><h5 id="说明-159"><a href="#说明-159" class="headerlink" title="说明"></a>说明</h5><p>write函数可用于发送数据到已连接的服务器。你可以发送单个字节的信息也可以发送多字节的信息。</p>
<h5 id="语法-161"><a href="#语法-161" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpsClient.write(val);`</span><br><span class="line">`httpsClient.write(str)`</span><br><span class="line">`httpsClient.write(buf, len)</span><br></pre></td></tr></table></figure>

<h5 id="参数-154"><a href="#参数-154" class="headerlink" title="参数"></a>参数</h5><p>val: 要发送的单字符数据<br>str: 要发送的多字符数据<br>buf: 要发送的多字符数组<br>len: buf的字节长度</p>
<h5 id="返回值-153"><a href="#返回值-153" class="headerlink" title="返回值"></a>返回值</h5><p>写入发送缓存的字节数</p>
<h3 id="响应信息类型"><a href="#响应信息类型" class="headerlink" title="响应信息类型"></a>响应信息类型</h3><h4 id="readString-–-读取数据并保存为字符串（Stream类）"><a href="#readString-–-读取数据并保存为字符串（Stream类）" class="headerlink" title="readString – 读取数据并保存为字符串（Stream类）"></a>readString – 读取数据并保存为字符串（Stream类）</h4><h5 id="说明-160"><a href="#说明-160" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于从ESP8266接收到数据中读取数据信息。读取到的信息将以字符串格式返回。</p>
<p><strong>请留意，WiFiClientSecure对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-162"><a href="#语法-162" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpsClient.readString()</span><br></pre></td></tr></table></figure>

<h5 id="参数-155"><a href="#参数-155" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-154"><a href="#返回值-154" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串。</p>
<h5 id="示例程序-145"><a href="#示例程序-145" class="headerlink" title="示例程序"></a>示例程序</h5><h6 id="示例1：ESP8266实现HTTPS通讯（指纹认证）-2"><a href="#示例1：ESP8266实现HTTPS通讯（指纹认证）-2" class="headerlink" title="示例1：ESP8266实现HTTPS通讯（指纹认证）"></a>示例1：ESP8266实现HTTPS通讯（指纹认证）</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527153304309.png" alt="image-20230527153304309"></p>
<p>在以下示例程序中，我们使用<code>httpsClient.readString()</code>从ESP8266接收到数据中读取数据信息。读取到的信息将以字符串格式返回。具体操作方法，请见以下示例程序中的高亮语句部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_readString_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的readString函数来从ESP8266接收到数据中读取</span></span><br><span class="line"><span class="comment">数据信息。读取到的信息将以字符串格式返回。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.println(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readString(); </span><br><span class="line">    Serial.println(line); </span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="示例2：ESP8266实现HTTPS通讯（证书认证）-1"><a href="#示例2：ESP8266实现HTTPS通讯（证书认证）-1" class="headerlink" title="示例2：ESP8266实现HTTPS通讯（证书认证）"></a>示例2：ESP8266实现HTTPS通讯（证书认证）</h6><p>本示例所实现的功能与示例1相同。唯一区别是本示例在ESP8266与服务器的HTTPS通信中，使用证书认证而不是指纹认证。使用本示例中的证书认证可以提高HTTPS通讯安全性。</p>
<p>如需了解本示例程序的操作方法和运行结果，请参考示例1中的相应内容。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_readString_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的readString函数来从ESP8266接收到数据中读取</span></span><br><span class="line"><span class="comment">数据信息。读取到的信息将以字符串格式返回。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。如需了解如何执行这一操作，请参考太极创客网站中</span></span><br><span class="line"><span class="comment">//“获取网站证书”页面(网址见下):</span></span><br><span class="line"><span class="comment">//http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate/</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  BearSSL::X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.println(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readString();  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="readStringUntil-–-读取数据直到指定字符并保存为字符串（Stream类）"><a href="#readStringUntil-–-读取数据直到指定字符并保存为字符串（Stream类）" class="headerlink" title="readStringUntil – 读取数据直到指定字符并保存为字符串（Stream类）"></a>readStringUntil – 读取数据直到指定字符并保存为字符串（Stream类）</h4><h5 id="说明-161"><a href="#说明-161" class="headerlink" title="说明"></a>说明</h5><p>readStringUntil函数可用于从设备接收到的数据中读取信息。读取到的数据信息将以字符串形式返回。该函数在满足以下任一条件后都会停止函数执行并返回。</p>
<p>– 读取到指定终止字符<br>– 达到设定时间（可使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/settimeout/">setTimeout</a>来设置）</p>
<p>当函数读取到终止字符后，会立即停止函数执行。此时函数所返回的字符串为”终止字符”前的所有字符信息。</p>
<p><strong>请留意，WiFiClientSecure对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-163"><a href="#语法-163" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpsClient.readStringUntil(terminator)</span><br></pre></td></tr></table></figure>

<h5 id="参数-156"><a href="#参数-156" class="headerlink" title="参数"></a>参数</h5><p>terminator: 终止字符。用于设置终止函数执行的字符信息。设备在读取数据时一旦读取到此终止字符，将会结束函数执行。允许使用char类型。</p>
<h5 id="返回值-155"><a href="#返回值-155" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串。</p>
<h5 id="示例程序-146"><a href="#示例程序-146" class="headerlink" title="示例程序"></a>示例程序</h5><h6 id="示例1：ESP8266实现HTTPS通讯（指纹认证）-3"><a href="#示例1：ESP8266实现HTTPS通讯（指纹认证）-3" class="headerlink" title="示例1：ESP8266实现HTTPS通讯（指纹认证）"></a>示例1：ESP8266实现HTTPS通讯（指纹认证）</h6><p>以下程序将实现ESP8266建立与网站的HTTPS通讯，并且将网站服务器响应信息显示于串口监视器中。本程序使用了指纹认证方式。比起本页的“示例2：ESP8266实现HTTPS通讯（证书认证）”，示例1所采用的指纹认证不如证书认证安全性高。</p>
<p>请将以下示例程序中的Wifi联网信息进行调整并将程序上传给ESP8266。程序上传完毕后，ESP8266将会自动连接 WiFi并通过HTTPS协议与<a target="_blank" rel="noopener" href="http://www.howsmyssl.com网站服务器进行通讯(该网站专门用于https通讯测试).服务器响应信息将会通过串口监视器显示以便我们查阅.程序运行结果如下图所示./">www.howsmyssl.com网站服务器进行通讯（该网站专门用于HTTPS通讯测试）。服务器响应信息将会通过串口监视器显示以便我们查阅。程序运行结果如下图所示。</a></p>
<p><img src="/./C:/Users/hurri/AppData/Local/Temp/BNZ.6471b5b0e6f9d2./Image/ESP8266.assets/image-20230527153459596.png" alt="image-20230527153459596"></p>
<p>在以下示例程序中，我们使用<code>httpsClient.readStringUntil()</code>从ESP8266接收到数据中读取数据信息。读取到的信息将以字符串格式返回。具体操作方法，请见以下示例程序中的高亮语句部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_readStringUntil_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的readStringUntil函数来从ESP8266接收到数据中读取</span></span><br><span class="line"><span class="comment">数据信息。读取到的信息将以字符串格式返回。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了指纹认证方式。该方式没有证书认证方式安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> fingerprint[] PROGMEM = <span class="string">&quot;c7c1f454fb33ef22191163c50c12dc7d4842694a&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line"> </span><br><span class="line">  Serial.println(host);</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.println(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readString(); </span><br><span class="line">    Serial.println(line); </span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="示例2：ESP8266实现HTTPS通讯（证书认证）-2"><a href="#示例2：ESP8266实现HTTPS通讯（证书认证）-2" class="headerlink" title="示例2：ESP8266实现HTTPS通讯（证书认证）"></a>示例2：ESP8266实现HTTPS通讯（证书认证）</h6><p>本示例所实现的功能与示例1相同。唯一区别是本示例在ESP8266与服务器的HTTPS通信中，使用证书认证而不是指纹认证。使用本示例中的证书认证可以提高HTTPS通讯安全性。</p>
<p>如需了解本示例程序的操作方法和运行结果，请参考示例1中的相应内容。</p>
<p><strong>注意：出于安全原因，CA会定期更新根证书信息。因此本程序中的证书可能已经过期。请使用浏览器获取最新的网站根证书并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiClientSecurre_readStringUntil_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用WiFiClientSecure库中的readStringUntil函数来从ESP8266接收到数据中读取</span></span><br><span class="line"><span class="comment">数据信息。读取到的信息将以字符串格式返回。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下程序将实现ESP8266开发板建立与网站的HTTPS通讯,并且将网站服务器响应信息</span></span><br><span class="line"><span class="comment">显示于串口监视器中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序使用了证书认证方式。该方式比指纹认证方式要更安全。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;www.howsmyssl.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  httpsCom(); <span class="comment">// 实现https通讯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现https通讯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书可能已经过期。请使用浏览器获取最新的服务器证书</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> digicert[] PROGMEM = <span class="string">R&quot;EOF( // 证书信息</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</span></span><br><span class="line"><span class="string">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</span></span><br><span class="line"><span class="string">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</span></span><br><span class="line"><span class="string">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</span></span><br><span class="line"><span class="string">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</span></span><br><span class="line"><span class="string">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</span></span><br><span class="line"><span class="string">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</span></span><br><span class="line"><span class="string">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</span></span><br><span class="line"><span class="string">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</span></span><br><span class="line"><span class="string">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</span></span><br><span class="line"><span class="string">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</span></span><br><span class="line"><span class="string">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</span></span><br><span class="line"><span class="string">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</span></span><br><span class="line"><span class="string">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</span></span><br><span class="line"><span class="string">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</span></span><br><span class="line"><span class="string">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</span></span><br><span class="line"><span class="string">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</span></span><br><span class="line"><span class="string">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  BearSSL::X509List <span class="title function_">cert</span><span class="params">(digicert)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置时间</span></span><br><span class="line">  setClock();</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;Using certificate&quot;</span>);</span><br><span class="line">  httpsClient.setTrustAnchors(&amp;cert);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.println(request);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。一旦查到响应头结束字符，则通过串口监视器</span></span><br><span class="line">  <span class="comment">// 告知用户当前ESP8266已经成功接收服务器响应头信息。</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    String line = httpsClient.readStringUntil(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (line == <span class="string">&quot;\r&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;headers received&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 通过串口监视器输出服务器响应体信息（服务器报文）</span></span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;server response payload:&quot;</span>); </span><br><span class="line">  String line;</span><br><span class="line">  <span class="keyword">while</span>(httpsClient.available())&#123;        </span><br><span class="line">    line = httpsClient.readString();  <span class="comment">//Read Line by Line</span></span><br><span class="line">    Serial.println(line); <span class="comment">//Print response</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span> &#123;</span><br><span class="line">  configTime(<span class="number">3</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bool configTime(int timezone, int daylightOffset, char *server1, char *server2, char *server3, bool enable);</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="find-–-在数据中寻找信息（Stream类）-1"><a href="#find-–-在数据中寻找信息（Stream类）-1" class="headerlink" title="find – 在数据中寻找信息（Stream类）"></a>find – 在数据中寻找信息（Stream类）</h4><h5 id="说明-162"><a href="#说明-162" class="headerlink" title="说明"></a>说明</h5><p>find函数可用于从设备接收到的数据中寻找指定字符串信息。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<p><strong>请留意，WiFiClientSecure对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-164"><a href="#语法-164" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">httpsClient.find(target)</span><br></pre></td></tr></table></figure>

<h5 id="参数-157"><a href="#参数-157" class="headerlink" title="参数"></a>参数</h5><p>target: 被查找字符串。允许使用String或char类型。</p>
<h5 id="返回值-156"><a href="#返回值-156" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为bool。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<h5 id="示例程序-147"><a href="#示例程序-147" class="headerlink" title="示例程序"></a>示例程序</h5><p>此程序用于演示如何使用esp8266作为互联网客户端向网站服务器发送https请求，并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则通过串口监视器告知用户开发板已经找到了“Date”字符串。</p>
<p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p><strong>注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹并复制粘贴到程序中相应位置。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-find</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向网站服务器发送https请求，</span></span><br><span class="line"><span class="comment">并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则通过</span></span><br><span class="line"><span class="comment">串口监视器告知用户开发板已经找到了“Date”字符串。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="comment">//以下两行语句为两种不同类型的fingerprint建立。</span></span><br><span class="line"><span class="comment">//const char fingerprint[] PROGMEM = &quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(host);</span><br><span class="line">  httpsClient.setBufferSizes(<span class="number">16000</span>, <span class="number">512</span>); </span><br><span class="line">  </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (httpsClient.available())&#123;</span><br><span class="line">      <span class="keyword">if</span> (httpsClient.find(<span class="string">&quot;Date&quot;</span>))&#123;</span><br><span class="line">        Serial.println(<span class="string">&quot;Found Date Info in Server Response.&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="parseInt-–-解析数据中的整数（Stream类）-1"><a href="#parseInt-–-解析数据中的整数（Stream类）-1" class="headerlink" title="parseInt – 解析数据中的整数（Stream类）"></a>parseInt – 解析数据中的整数（Stream类）</h4><h5 id="说明-163"><a href="#说明-163" class="headerlink" title="说明"></a>说明</h5><p>parseInt函数可用于从设备接收到的数据中寻找整数数值。</p>
<p><strong>请留意，WiFiClientSecure对象在处理或发送网络数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。本函数即是Stream类中的一员。</strong></p>
<h5 id="语法-165"><a href="#语法-165" class="headerlink" title="语法"></a>语法</h5><p>httpsClient.parseInt()</p>
<h5 id="参数-158"><a href="#参数-158" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-157"><a href="#返回值-157" class="headerlink" title="返回值"></a>返回值</h5><p>在输入信息中找到的整数数值。类型：long</p>
<h5 id="示例程序-148"><a href="#示例程序-148" class="headerlink" title="示例程序"></a>示例程序</h5><p>此程序用于演示如何使用esp8266作为互联网客户端向网站服务器发送https请求，并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则进一步使用parseInt函数来寻找“Date”字符串后面的第一个数字。由于标准服务器相应信息中“Date”字符串后面的第一个数字信息即是当前服务器的日期信息中的”日”数值。因parseInt函数寻找到的数字即是服务器的日期信息中的”日”数值。</p>
<p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266-WiFiClientSecure-parseInt</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用esp8266作为互联网客户端向网站服务器发送https请求，</span></span><br><span class="line"><span class="comment">并且使用find函数在网站服务器响应的信息中寻找“Date”字符串。如果找到“Date”字符串，则进一步</span></span><br><span class="line"><span class="comment">使用parseInt函数来寻找“Date”字符串后面的第一个数字。由于标准服务器相应信息中“Date”字符串</span></span><br><span class="line"><span class="comment">后面的第一个数字信息即是当前服务器的日期信息中的&quot;日&quot;数值。因此parseInt函数寻找到的数字即是</span></span><br><span class="line"><span class="comment">服务器的日期信息中的&quot;日&quot;数值。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">并复制粘贴到程序中相应位置。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecure.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid <span class="string">&quot;taichimaker&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password <span class="string">&quot;12345678&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//测试HTTPS通讯的网站</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *host = <span class="string">&quot;cn.bing.com&quot;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注意：出于安全原因，网站服务器会定期更新证书指纹信息。因此本程序</span></span><br><span class="line"><span class="comment">//中的证书指纹可能已经过期。请使用浏览器获取最新的服务器证书指纹</span></span><br><span class="line"><span class="comment">//并复制粘贴到此处。</span></span><br><span class="line"><span class="comment">//以下两行语句为两种不同类型的fingerprint建立。</span></span><br><span class="line"><span class="comment">//const char fingerprint[] PROGMEM = &quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fingerprint = <span class="string">&quot;62914576dc0afac83c4804bcc2c1b700a61139fe&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  WiFi.begin(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Connecting&quot;</span>); Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP()); </span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 实现HTTPS通讯</span></span><br><span class="line">  httpsCom();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">httpsCom</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFiClientSecure httpsClient;    <span class="comment">//建立WiFiClientSecure对象</span></span><br><span class="line">  </span><br><span class="line">  Serial.println(host);</span><br><span class="line">  httpsClient.setBufferSizes(<span class="number">16000</span>, <span class="number">512</span>); </span><br><span class="line">  </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Using fingerprint &#x27;%s&#x27;\n&quot;</span>, fingerprint);</span><br><span class="line">  httpsClient.setFingerprint(fingerprint);</span><br><span class="line">  httpsClient.setTimeout(<span class="number">15000</span>);  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;HTTPS Connecting&quot;</span>);Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="type">int</span> r=<span class="number">0</span>;  <span class="comment">// 尝试连接服务器并等待</span></span><br><span class="line">  <span class="keyword">while</span>((!httpsClient.connect(host, httpsPort)) &amp;&amp; (r &lt; <span class="number">30</span>))&#123;</span><br><span class="line">      delay(<span class="number">100</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      r++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 连接超时后输出&quot;连接失败&quot;信息并返回</span></span><br><span class="line">  <span class="keyword">if</span>(r==<span class="number">30</span>) &#123; </span><br><span class="line">    Serial.println(<span class="string">&quot;Connection failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 连接成功则输出“连接成功”信息</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Connected...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;requesting: &quot;</span>);</span><br><span class="line">  Serial.println(host);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立HTTPS请求信息字符串</span></span><br><span class="line">  String request =  String(<span class="string">&quot;GET /a/check&quot;</span>) + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Connection: close\r\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  <span class="comment">// 向服务器发送请求                   </span></span><br><span class="line">  httpsClient.print(request);</span><br><span class="line">  </span><br><span class="line">  Serial.println(<span class="string">&quot;request sent&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查服务器响应信息。通过串口监视器输出服务器状态码和响应头信息</span></span><br><span class="line">  <span class="comment">// 从而确定ESP8266已经成功连接服务器</span></span><br><span class="line">  <span class="keyword">while</span> (httpsClient.connected()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (httpsClient.available())&#123;</span><br><span class="line">      <span class="keyword">if</span> (httpsClient.find(<span class="string">&quot;Date&quot;</span>))&#123;</span><br><span class="line">        Serial.println(<span class="string">&quot;Found Date Info in Server Response.&quot;</span>);</span><br><span class="line">        <span class="type">int</span> day = httpsClient.parseInt();       </span><br><span class="line">        Serial.print(<span class="string">&quot;day = &quot;</span>);Serial.println(day);        </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;Now disconect from the server...&quot;</span>); </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//操作结束，断开服务器连接 </span></span><br><span class="line">  httpsClient.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;closing connection&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><strong>备注:以上带有<code>Stream</code>标注的函数说明该函数是Stream类函数。</strong></p>
<h2 id="ESP8266-–-WiFiServerSecure库"><a href="#ESP8266-–-WiFiServerSecure库" class="headerlink" title="ESP8266 – WiFiServerSecure库"></a>ESP8266 – WiFiServerSecure库</h2><p>WiFiServerSecure库用于ESP8266的HTTPS协议物联网通讯。HTTPS （全称：Hyper Text Transfer Protocol over SecureSocket Layer），是以安全为目标的互联网协议。HTTPS协议在HTTP的基础上通过SSL或TLS来实现传输加密和身份认证，从而保证了传输过程的安全性。假如您需要进一步了解HTTPS协议的介绍关内容，请参考<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/https/285356">百度百科HTTPS协议页面</a>。</p>
<p>通过WiFiServerSecure库，我们可以使用ESP8266开发板建立网络服务器,从而允许其它网络设备以及物联网设备通过HTTPS协议访问并实现物联网信息交流。</p>
<h3 id="WiFiServerSecure-–-建立WiFiServerSecure-对象"><a href="#WiFiServerSecure-–-建立WiFiServerSecure-对象" class="headerlink" title="WiFiServerSecure – 建立WiFiServerSecure 对象"></a>WiFiServerSecure – 建立WiFiServerSecure 对象</h3><h4 id="说明-164"><a href="#说明-164" class="headerlink" title="说明"></a>说明</h4><p>通过WiFiServerSecure语句，我们可以建立WiFiServerSecure对象从而使用ESP8266建立支持HTTPS协议的物联网服务器。</p>
<h4 id="语法-166"><a href="#语法-166" class="headerlink" title="语法"></a>语法</h4><p>WiFiServerSecure server(port)</p>
<h4 id="参数-159"><a href="#参数-159" class="headerlink" title="参数"></a>参数</h4><p>– port: 此参数用于设置服务端口号。(类型:uint16_t)</p>
<h4 id="返回值-158"><a href="#返回值-158" class="headerlink" title="返回值"></a>返回值</h4><p>无</p>
<h4 id="示例程序-149"><a href="#示例程序-149" class="headerlink" title="示例程序"></a>示例程序</h4><p>为了演示本实例程序的运行结果，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行示例程序操作演示。</p>
<p>请务必注意：本示例程序所使用的证书和密钥只能用于测试使用。您在自己搭建ESP8266物联网项目时，需要自行建立 证书密钥而不要使用本示例中的证书和密钥。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址。此时，ESP8266已经成功建立了支持HTTPS协议的网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>当您如上图所示输入完IP地址后，接下来 请按下回车键。您将在浏览器中看到如下警告信息 。这很正常，因为ESP8266的服务器证书不是CA颁布的证书，所以浏览器会警告我们，它无法确定ESP8266服务器的身份信息。请忽略这一警告信息，并按照下图所示，点击按钮。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527155303909.png" alt="image-20230527155303909"></p>
<p>接下来您将看到如下图所示的信息。该信息正是详细说明为何无法验证ESP8266服务器身份的原因。我们需要继续忽略 这一警告信息，并按照下图所示，点击链接。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527155330160.png" alt="image-20230527155330160"></p>
<p>如下图所示，您将看到浏览器中出现了“Hello from ESP8266”信息。这一信息是由ESP8266服务器发来的。说明我们的ESP8266服务器已经可以通过HTTPS协议进行数据通讯了。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527155350043.png" alt="image-20230527155350043"></p>
<p>关于如何使用WiFiServerSecure来建立对象这一操作，请见以下程序中的高亮语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiServerSecure</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用建立WiFiServerSecure对象从而使用ESP8266建立支持HTTPS协议的物联网</span></span><br><span class="line"><span class="comment">服务器。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本示例程序借鉴ESP8266库中BearSSL_Server示例程序，该程序作者Earle F. Philhower, III</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">关于本程序的具体使用方法，请参考以下链接：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/web-server-secure/wifiserversecure/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;taichimaker&quot;</span>;<span class="comment">// WiFi名称</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pass = <span class="string">&quot;12345678&quot;</span>;   <span class="comment">// WiFi密码</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立WiFiServerSecure对象</span></span><br><span class="line">WiFiServerSecure <span class="title function_">server</span><span class="params">(<span class="number">443</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立服务器响应信息</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *HTTP_RES =</span><br><span class="line">        <span class="string">&quot;HTTP/1.0 200 OK\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Connection: close\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Length: 62\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;html&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;body&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;p&gt;Hello from ESP8266!&lt;/p&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;/body&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;/html&gt;\r\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//服务器私钥</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> server_private_key[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDhDf/pokuS+FQO</span></span><br><span class="line"><span class="string">MPxiDTPMDZEFQjFoy/uCwiN4MebPg+IcXMVx2o6MSn8x9ofAatwAOq/dYoExhev1</span></span><br><span class="line"><span class="string">HN2C3O4ZjjFACsryL6hYXaKG+qHiNEfvHgPTw0olWsDm9N01CcQs7lJqW2wmM5JM</span></span><br><span class="line"><span class="string">xXP8ZU0rcUU70qWCUUTR+rN8WE4QHTd7BjP6OTvqjN7Al4ibg8//7owXlSECnM1B</span></span><br><span class="line"><span class="string">SKIZQZ6g0QcWLf+rSn6hRrbHPGIkp5RZTIGZ7k9zgUfHQezKKYtRZXRtUhB5JW78</span></span><br><span class="line"><span class="string">ZyGYaphaek5WlkgakL2pbM/Q/DgKew/2k0najKUjmkz+gxtof4vlmZAojSaN2647</span></span><br><span class="line"><span class="string">labAbuydAgMBAAECggEAYHi806zDUpvqhC7RcUKRio3iNWvbfD28cZ/AzpwtgZTa</span></span><br><span class="line"><span class="string">DyhhZt22L0Mb5RH1vTDRX7PIgVDhapYqwGaAOcF0uzWtvPMjbc+qDT8OFWhIjou0</span></span><br><span class="line"><span class="string">rjaik1rqZLrTZ+1dCYhHNK9wWrEX2gRPWWNmxbGy88VZVTyFwCgQJSafW9UKmXLu</span></span><br><span class="line"><span class="string">4KUTILHcyGsEfVBxth8Vr9uWuNWa6nRW/tb/3uNwRn1ATKV6h+HFgBHxgfkSN11G</span></span><br><span class="line"><span class="string">wZfdSRzuov7Y09qGbIHZmeoBYG8iNJ/A4qOhaMJis1Qmt6mjpBzUJRxGriZIHh2E</span></span><br><span class="line"><span class="string">znoM85Uejc8cqSnWH8mA8PPT4xDwCbv2ueT9bT5HYQKBgQD25qFyjx+Bbzsbok2a</span></span><br><span class="line"><span class="string">lF7wQiN5WbzA5zdCusecTO+Fi2HkrKODFSQdaCHxl/kFKcy7NxYZjeIcNZzf6vnC</span></span><br><span class="line"><span class="string">B2Hyrm3B/eeCJ+WoTm/ajfS6dxgt2aO48An+wFAyb7qGdBBrPr+hvn3RG5hbupEM</span></span><br><span class="line"><span class="string">bGJnBhRfpcq0+9+JcqMfcAUkuQKBgQDpWUMtfuukR+hwkHhbs68FyXbGxnHMGYth</span></span><br><span class="line"><span class="string">sLRWmbmK6OVmSKWDU5kRPlMckztqUReJdE+x6fbvBDbW/cIi83mQa0+7KTxLajoj</span></span><br><span class="line"><span class="string">zoCV6CKZz4dATURlisTtfqVCjQP/wHJ4y6E270Ar80CM/0AT8gw+HrWGLeCa+MQN</span></span><br><span class="line"><span class="string">L0Qg/u5dBQKBgDAsUaXbfQcxH7RFl6SofFmeXfOIacatll+jt9ysOjOxPVlzwbeK</span></span><br><span class="line"><span class="string">wXAnaDAOOd0jCbohhmNYBp0AbOpXm4GbFSZXmDy4gJoplKqhGzvmZLCZGhOgGky0</span></span><br><span class="line"><span class="string">MQ8OkNc2a4teS/HQ3Wz+kOfi3XhQT4q//vcg/Yqn+4QSfMwBnQg+QBKpAoGAdUch</span></span><br><span class="line"><span class="string">ljoV4Ikrb3eMpjoWmwf4JEsUYonsHXscB/JW6FPJB7E3TluzsJDsYI427GY5OCI2</span></span><br><span class="line"><span class="string">86otK0+o6EC9U6eez1C/z8cXwKdw9RISWkVDLp640T6EQ6yM8PgXwuzwt5dXcRKW</span></span><br><span class="line"><span class="string">we9ZBz3IkZSv9dZPBOGWRgvEuN6SWjYJPbQixKkCgYA+plfKhE+f+ofA7wWkmfo3</span></span><br><span class="line"><span class="string">1cyJmyBCL9ROwfzRlo1ftttYy1XHOLxpe2ts+hh+pqrftGdura1X0TuY6v7d1mk1</span></span><br><span class="line"><span class="string">snuyj7+E37PjIewk4nr45PU4OWwqW2Pqx4BZAYosU+ki1z12rh3ofZhudBH6B5nN</span></span><br><span class="line"><span class="string">TPhoHwGbAajgSzHYYG8koQ==</span></span><br><span class="line"><span class="string">-----END PRIVATE KEY-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 服务器证书</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> server_cert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIEQzCCAyugAwIBAgIUCUSExaDX4tk9VoMXia7kABA2pewwDQYJKoZIhvcNAQEL</span></span><br><span class="line"><span class="string">BQAwgbAxCzAJBgNVBAYTAkNOMRAwDgYDVQQIDAdCZWlqaW5nMRAwDgYDVQQHDAdC</span></span><br><span class="line"><span class="string">ZWlqaW5nMRUwEwYDVQQKDAxUYWljaGktTWFrZXIxDDAKBgNVBAsMA0lPVDEQMA4G</span></span><br><span class="line"><span class="string">A1UEAwwHRVNQODI2NjFGMEQGCSqGSIb3DQEJARY3dGFpY2hpYW1rZXJAG1tEG1tE</span></span><br><span class="line"><span class="string">G1tEGxtbQxsbW0MbW0MbW0MbdGFpY2hpbWFrZXJAMTYzLmNvbTAeFw0yMDA0MjAx</span></span><br><span class="line"><span class="string">MDQ3MjNaFw0zMTA3MDgxMDQ3MjNaMIGwMQswCQYDVQQGEwJDTjEQMA4GA1UECAwH</span></span><br><span class="line"><span class="string">QmVpamluZzEQMA4GA1UEBwwHQmVpamluZzEVMBMGA1UECgwMVGFpY2hpLU1ha2Vy</span></span><br><span class="line"><span class="string">MQwwCgYDVQQLDANJT1QxEDAOBgNVBAMMB0VTUDgyNjYxRjBEBgkqhkiG9w0BCQEW</span></span><br><span class="line"><span class="string">N3RhaWNoaWFta2VyQBtbRBtbRBtbRBsbW0MbG1tDG1tDG1tDG3RhaWNoaW1ha2Vy</span></span><br><span class="line"><span class="string">QDE2My5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDhDf/pokuS</span></span><br><span class="line"><span class="string">+FQOMPxiDTPMDZEFQjFoy/uCwiN4MebPg+IcXMVx2o6MSn8x9ofAatwAOq/dYoEx</span></span><br><span class="line"><span class="string">hev1HN2C3O4ZjjFACsryL6hYXaKG+qHiNEfvHgPTw0olWsDm9N01CcQs7lJqW2wm</span></span><br><span class="line"><span class="string">M5JMxXP8ZU0rcUU70qWCUUTR+rN8WE4QHTd7BjP6OTvqjN7Al4ibg8//7owXlSEC</span></span><br><span class="line"><span class="string">nM1BSKIZQZ6g0QcWLf+rSn6hRrbHPGIkp5RZTIGZ7k9zgUfHQezKKYtRZXRtUhB5</span></span><br><span class="line"><span class="string">JW78ZyGYaphaek5WlkgakL2pbM/Q/DgKew/2k0najKUjmkz+gxtof4vlmZAojSaN</span></span><br><span class="line"><span class="string">2647labAbuydAgMBAAGjUzBRMB0GA1UdDgQWBBTttMAlJ46XNA1ydxe5J0bVfWA3</span></span><br><span class="line"><span class="string">ujAfBgNVHSMEGDAWgBTttMAlJ46XNA1ydxe5J0bVfWA3ujAPBgNVHRMBAf8EBTAD</span></span><br><span class="line"><span class="string">AQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCSQH9T7rWS11DHLvPXuwRx2F675y5bNZ7L</span></span><br><span class="line"><span class="string">4q0akgdQwH3T4RNRS0yQbcNPqOsiEwypsV45kEjzniBqNcHcfxld1Ik1zcv9wvvK</span></span><br><span class="line"><span class="string">ZE9HfrZbaVRzIR7GPmIzjhdepBK8gPvQoqIHVLM6WTY5/2voGOUPB7NLjDtvVpFN</span></span><br><span class="line"><span class="string">GG3KpNjC6msfywWTCAAB3oNSHeQsy01DD6FSQHGjBZZiXo7P7MOFz/D5+z61OBy0</span></span><br><span class="line"><span class="string">UiCGi08UjVAodMTfTHNxGZW9D2yLzuKLfewbtcbeje2MACiXLDuIS+ed8YgXn7UH</span></span><br><span class="line"><span class="string">2SNfx1DhsSGueWgEMISsqJUMgU02IrTu3VViSE7eXoRQkLEdeiGI</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接 WiFi</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, pass);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立X509List对象用于处理及储存服务器证书</span></span><br><span class="line">  X509List *serverCertList = new BearSSL::X509List(server_cert);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立PrivateKey对象用于处理及储存服务器私钥</span></span><br><span class="line">  PrivateKey *serverPrivKey = new BearSSL::PrivateKey(server_private_key);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置服务器证书和服务器私钥</span></span><br><span class="line">  server.setRSACert(serverCertList, serverPrivKey);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> cnt;</span><br><span class="line">  BearSSL::WiFiClientSecure incoming = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!incoming) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Incoming connection...%d\n&quot;</span>,cnt++);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待客户端发送请求</span></span><br><span class="line">  <span class="type">uint32_t</span> timeout=millis() + <span class="number">1000</span>;</span><br><span class="line">  <span class="type">int</span> lcwn = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((millis() &gt; timeout) || (incoming.available() &amp;&amp; incoming.read(&amp;x, <span class="number">1</span>) &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">      incoming.stop();</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connection error, closed\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!x) &#123;</span><br><span class="line">      yield();</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0x0D</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0x0A</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (lcwn) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      lcwn = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      lcwn = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送响应信息</span></span><br><span class="line">  incoming.write((<span class="type">uint8_t</span>*)HTTP_RES, <span class="built_in">strlen</span>(HTTP_RES));</span><br><span class="line">  incoming.flush();</span><br><span class="line">  incoming.stop();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connection closed.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="setRSACert-–-设置RSA证书"><a href="#setRSACert-–-设置RSA证书" class="headerlink" title="setRSACert – 设置RSA证书"></a>setRSACert – 设置RSA证书</h3><h4 id="说明-165"><a href="#说明-165" class="headerlink" title="说明"></a>说明</h4><p>通过WiFiServerSecure语句，我们可以建立WiFiServerSecure对象从而使用ESP8266建立支持HTTPS协议的物联网服务器。</p>
<h4 id="语法-167"><a href="#语法-167" class="headerlink" title="语法"></a>语法</h4><p>server.setRSACert(cert, privateKey)</p>
<h4 id="参数-160"><a href="#参数-160" class="headerlink" title="参数"></a>参数</h4><p>– cert: 服务器证书<br>– privateKey:服务器私钥</p>
<h4 id="返回值-159"><a href="#返回值-159" class="headerlink" title="返回值"></a>返回值</h4><p>无</p>
<h4 id="示例程序-150"><a href="#示例程序-150" class="headerlink" title="示例程序"></a>示例程序</h4><p>为了演示本实例程序的运行结果，我在这里使用基于<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/index.html">Chrome</a>内核的<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/edge">Microsoft Edge</a>浏览器来进行示例程序操作演示。</p>
<p>请务必注意：本示例程序所使用的证书和密钥只能用于测试使用。您在自己搭建ESP8266物联网项目时，需要自行建立 证书密钥而不要使用本示例中的证书和密钥。</p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址。此时，ESP8266已经成功建立了支持HTTPS协议的网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>假设您的ESP8266开发板IP地址是192.168.0.111。那么接下来您可以通过浏览器输入<strong><a target="_blank" rel="noopener" href="https://192.168.0.111/">https://192.168.0.111</a></strong>。</p>
<p>注意一定要在ESP8266的IP地址前面加上“https&#x2F;&#x2F;”。这一操作将会让浏览器通过https协议访问ESP8266所建立的服务器。如果不输入这一信息，浏览器默认会使用http协议而不是https协议。也就达不到我们想要实现的效果。（如下图所示）</p>
<p><img src="/./Image/ESP8266.assets/image-20230527163646482.png" alt="image-20230527163646482"></p>
<p>当您如上图所示输入完IP地址后，接下来 请按下回车键。您将在浏览器中看到如下警告信息 。这很正常，因为ESP8266的服务器证书不是CA颁布的证书，所以浏览器会警告我们，它无法确定ESP8266服务器的身份信息。请忽略这一警告信息，并按照下图所示，点击按钮。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527163729688.png" alt="image-20230527163729688"></p>
<p>接下来您将看到如下图所示的信息。该信息正是详细说明为何无法验证ESP8266服务器身份的原因。我们需要继续忽略 这一警告信息，并按照下图所示，点击链接。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527163750171.png" alt="image-20230527163750171"></p>
<p>如下图所示，您将看到浏览器中出现了“Hello from ESP8266”信息。这一信息是由ESP8266服务器发来的。说明我们的ESP8266服务器已经可以通过HTTPS协议进行数据通讯了。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527163806556.png" alt="image-20230527163806556"></p>
<p>以下示例程序中我们首先使用语句 <code>X509List *serverCertList = new BearSSL::X509List(server_cert);</code>建立X509List对象用于处理及储存服务器证书。接下来我们使用了语句<code>PrivateKey *serverPrivKey = new BearSSL::PrivateKey(server_private_key);</code>建立PrivateKey对象用于处理及储存服务器私钥。最后我们使用语句<code>server.setRSACert(serverCertList, serverPrivKey);</code>设置服务器证书和服务器私钥。具体使用方法，请见以下程序的高亮部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : WiFiServerSecure_setRSACert</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">此程序用于演示如何使用使用WiFiServerSecure库的setRSACert来为服务器设置证书和私钥。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本示例程序借鉴ESP8266库中BearSSL_Server示例程序，该程序作者Earle F. Philhower, III</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;taichimaker&quot;</span>;<span class="comment">// WiFi名称</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pass = <span class="string">&quot;12345678&quot;</span>;   <span class="comment">// WiFi密码</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立WiFiServerSecure对象</span></span><br><span class="line">WiFiServerSecure <span class="title function_">server</span><span class="params">(<span class="number">443</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立服务器响应信息</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *HTTP_RES =</span><br><span class="line">        <span class="string">&quot;HTTP/1.0 200 OK\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Connection: close\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Length: 62\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;html&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;body&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;p&gt;Hello from ESP8266!&lt;/p&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;/body&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;/html&gt;\r\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//服务器私钥</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> server_private_key[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDhDf/pokuS+FQO</span></span><br><span class="line"><span class="string">MPxiDTPMDZEFQjFoy/uCwiN4MebPg+IcXMVx2o6MSn8x9ofAatwAOq/dYoExhev1</span></span><br><span class="line"><span class="string">HN2C3O4ZjjFACsryL6hYXaKG+qHiNEfvHgPTw0olWsDm9N01CcQs7lJqW2wmM5JM</span></span><br><span class="line"><span class="string">xXP8ZU0rcUU70qWCUUTR+rN8WE4QHTd7BjP6OTvqjN7Al4ibg8//7owXlSECnM1B</span></span><br><span class="line"><span class="string">SKIZQZ6g0QcWLf+rSn6hRrbHPGIkp5RZTIGZ7k9zgUfHQezKKYtRZXRtUhB5JW78</span></span><br><span class="line"><span class="string">ZyGYaphaek5WlkgakL2pbM/Q/DgKew/2k0najKUjmkz+gxtof4vlmZAojSaN2647</span></span><br><span class="line"><span class="string">labAbuydAgMBAAECggEAYHi806zDUpvqhC7RcUKRio3iNWvbfD28cZ/AzpwtgZTa</span></span><br><span class="line"><span class="string">DyhhZt22L0Mb5RH1vTDRX7PIgVDhapYqwGaAOcF0uzWtvPMjbc+qDT8OFWhIjou0</span></span><br><span class="line"><span class="string">rjaik1rqZLrTZ+1dCYhHNK9wWrEX2gRPWWNmxbGy88VZVTyFwCgQJSafW9UKmXLu</span></span><br><span class="line"><span class="string">4KUTILHcyGsEfVBxth8Vr9uWuNWa6nRW/tb/3uNwRn1ATKV6h+HFgBHxgfkSN11G</span></span><br><span class="line"><span class="string">wZfdSRzuov7Y09qGbIHZmeoBYG8iNJ/A4qOhaMJis1Qmt6mjpBzUJRxGriZIHh2E</span></span><br><span class="line"><span class="string">znoM85Uejc8cqSnWH8mA8PPT4xDwCbv2ueT9bT5HYQKBgQD25qFyjx+Bbzsbok2a</span></span><br><span class="line"><span class="string">lF7wQiN5WbzA5zdCusecTO+Fi2HkrKODFSQdaCHxl/kFKcy7NxYZjeIcNZzf6vnC</span></span><br><span class="line"><span class="string">B2Hyrm3B/eeCJ+WoTm/ajfS6dxgt2aO48An+wFAyb7qGdBBrPr+hvn3RG5hbupEM</span></span><br><span class="line"><span class="string">bGJnBhRfpcq0+9+JcqMfcAUkuQKBgQDpWUMtfuukR+hwkHhbs68FyXbGxnHMGYth</span></span><br><span class="line"><span class="string">sLRWmbmK6OVmSKWDU5kRPlMckztqUReJdE+x6fbvBDbW/cIi83mQa0+7KTxLajoj</span></span><br><span class="line"><span class="string">zoCV6CKZz4dATURlisTtfqVCjQP/wHJ4y6E270Ar80CM/0AT8gw+HrWGLeCa+MQN</span></span><br><span class="line"><span class="string">L0Qg/u5dBQKBgDAsUaXbfQcxH7RFl6SofFmeXfOIacatll+jt9ysOjOxPVlzwbeK</span></span><br><span class="line"><span class="string">wXAnaDAOOd0jCbohhmNYBp0AbOpXm4GbFSZXmDy4gJoplKqhGzvmZLCZGhOgGky0</span></span><br><span class="line"><span class="string">MQ8OkNc2a4teS/HQ3Wz+kOfi3XhQT4q//vcg/Yqn+4QSfMwBnQg+QBKpAoGAdUch</span></span><br><span class="line"><span class="string">ljoV4Ikrb3eMpjoWmwf4JEsUYonsHXscB/JW6FPJB7E3TluzsJDsYI427GY5OCI2</span></span><br><span class="line"><span class="string">86otK0+o6EC9U6eez1C/z8cXwKdw9RISWkVDLp640T6EQ6yM8PgXwuzwt5dXcRKW</span></span><br><span class="line"><span class="string">we9ZBz3IkZSv9dZPBOGWRgvEuN6SWjYJPbQixKkCgYA+plfKhE+f+ofA7wWkmfo3</span></span><br><span class="line"><span class="string">1cyJmyBCL9ROwfzRlo1ftttYy1XHOLxpe2ts+hh+pqrftGdura1X0TuY6v7d1mk1</span></span><br><span class="line"><span class="string">snuyj7+E37PjIewk4nr45PU4OWwqW2Pqx4BZAYosU+ki1z12rh3ofZhudBH6B5nN</span></span><br><span class="line"><span class="string">TPhoHwGbAajgSzHYYG8koQ==</span></span><br><span class="line"><span class="string">-----END PRIVATE KEY-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 服务器证书</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> server_cert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIEQzCCAyugAwIBAgIUCUSExaDX4tk9VoMXia7kABA2pewwDQYJKoZIhvcNAQEL</span></span><br><span class="line"><span class="string">BQAwgbAxCzAJBgNVBAYTAkNOMRAwDgYDVQQIDAdCZWlqaW5nMRAwDgYDVQQHDAdC</span></span><br><span class="line"><span class="string">ZWlqaW5nMRUwEwYDVQQKDAxUYWljaGktTWFrZXIxDDAKBgNVBAsMA0lPVDEQMA4G</span></span><br><span class="line"><span class="string">A1UEAwwHRVNQODI2NjFGMEQGCSqGSIb3DQEJARY3dGFpY2hpYW1rZXJAG1tEG1tE</span></span><br><span class="line"><span class="string">G1tEGxtbQxsbW0MbW0MbW0MbdGFpY2hpbWFrZXJAMTYzLmNvbTAeFw0yMDA0MjAx</span></span><br><span class="line"><span class="string">MDQ3MjNaFw0zMTA3MDgxMDQ3MjNaMIGwMQswCQYDVQQGEwJDTjEQMA4GA1UECAwH</span></span><br><span class="line"><span class="string">QmVpamluZzEQMA4GA1UEBwwHQmVpamluZzEVMBMGA1UECgwMVGFpY2hpLU1ha2Vy</span></span><br><span class="line"><span class="string">MQwwCgYDVQQLDANJT1QxEDAOBgNVBAMMB0VTUDgyNjYxRjBEBgkqhkiG9w0BCQEW</span></span><br><span class="line"><span class="string">N3RhaWNoaWFta2VyQBtbRBtbRBtbRBsbW0MbG1tDG1tDG1tDG3RhaWNoaW1ha2Vy</span></span><br><span class="line"><span class="string">QDE2My5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDhDf/pokuS</span></span><br><span class="line"><span class="string">+FQOMPxiDTPMDZEFQjFoy/uCwiN4MebPg+IcXMVx2o6MSn8x9ofAatwAOq/dYoEx</span></span><br><span class="line"><span class="string">hev1HN2C3O4ZjjFACsryL6hYXaKG+qHiNEfvHgPTw0olWsDm9N01CcQs7lJqW2wm</span></span><br><span class="line"><span class="string">M5JMxXP8ZU0rcUU70qWCUUTR+rN8WE4QHTd7BjP6OTvqjN7Al4ibg8//7owXlSEC</span></span><br><span class="line"><span class="string">nM1BSKIZQZ6g0QcWLf+rSn6hRrbHPGIkp5RZTIGZ7k9zgUfHQezKKYtRZXRtUhB5</span></span><br><span class="line"><span class="string">JW78ZyGYaphaek5WlkgakL2pbM/Q/DgKew/2k0najKUjmkz+gxtof4vlmZAojSaN</span></span><br><span class="line"><span class="string">2647labAbuydAgMBAAGjUzBRMB0GA1UdDgQWBBTttMAlJ46XNA1ydxe5J0bVfWA3</span></span><br><span class="line"><span class="string">ujAfBgNVHSMEGDAWgBTttMAlJ46XNA1ydxe5J0bVfWA3ujAPBgNVHRMBAf8EBTAD</span></span><br><span class="line"><span class="string">AQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCSQH9T7rWS11DHLvPXuwRx2F675y5bNZ7L</span></span><br><span class="line"><span class="string">4q0akgdQwH3T4RNRS0yQbcNPqOsiEwypsV45kEjzniBqNcHcfxld1Ik1zcv9wvvK</span></span><br><span class="line"><span class="string">ZE9HfrZbaVRzIR7GPmIzjhdepBK8gPvQoqIHVLM6WTY5/2voGOUPB7NLjDtvVpFN</span></span><br><span class="line"><span class="string">GG3KpNjC6msfywWTCAAB3oNSHeQsy01DD6FSQHGjBZZiXo7P7MOFz/D5+z61OBy0</span></span><br><span class="line"><span class="string">UiCGi08UjVAodMTfTHNxGZW9D2yLzuKLfewbtcbeje2MACiXLDuIS+ed8YgXn7UH</span></span><br><span class="line"><span class="string">2SNfx1DhsSGueWgEMISsqJUMgU02IrTu3VViSE7eXoRQkLEdeiGI</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接 WiFi</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, pass);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立X509List对象用于处理及储存服务器证书</span></span><br><span class="line">  X509List *serverCertList = new BearSSL::X509List(server_cert);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 建立PrivateKey对象用于处理及储存服务器私钥</span></span><br><span class="line">  PrivateKey *serverPrivKey = new BearSSL::PrivateKey(server_private_key);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置服务器证书和服务器私钥</span></span><br><span class="line">  server.setRSACert(serverCertList, serverPrivKey);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> cnt;</span><br><span class="line">  BearSSL::WiFiClientSecure incoming = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!incoming) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Incoming connection...%d\n&quot;</span>,cnt++);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待客户端发送请求</span></span><br><span class="line">  <span class="type">uint32_t</span> timeout=millis() + <span class="number">1000</span>;</span><br><span class="line">  <span class="type">int</span> lcwn = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((millis() &gt; timeout) || (incoming.available() &amp;&amp; incoming.read(&amp;x, <span class="number">1</span>) &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">      incoming.stop();</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connection error, closed\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!x) &#123;</span><br><span class="line">      yield();</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0x0D</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0x0A</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (lcwn) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      lcwn = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      lcwn = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送响应信息</span></span><br><span class="line">  incoming.write((<span class="type">uint8_t</span>*)HTTP_RES, <span class="built_in">strlen</span>(HTTP_RES));</span><br><span class="line">  incoming.flush();</span><br><span class="line">  incoming.stop();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connection closed.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h3 id="setClientTrustAnchor-–-设置信任锚"><a href="#setClientTrustAnchor-–-设置信任锚" class="headerlink" title="setClientTrustAnchor – 设置信任锚"></a>setClientTrustAnchor – 设置信任锚</h3><h4 id="说明-166"><a href="#说明-166" class="headerlink" title="说明"></a>说明</h4><p>ESP8266建立的HTTPS服务器可以要求客户端提供证书以验证客户端身份。如果客户端无法提供证明身份的证书信息，ESP8266服务器会拒绝客户端访问。我们可以使用WiFiServerSecure库的setClientTrustAnchor函数来实现这一操作。</p>
<h4 id="语法-168"><a href="#语法-168" class="headerlink" title="语法"></a>语法</h4><p><code>server.setClientTrustAnchor(cert)</code></p>
<h4 id="参数-161"><a href="#参数-161" class="headerlink" title="参数"></a>参数</h4><p>– cert: CA证书</p>
<h4 id="返回值-160"><a href="#返回值-160" class="headerlink" title="返回值"></a>返回值</h4><p>无</p>
<h4 id="示例程序-151"><a href="#示例程序-151" class="headerlink" title="示例程序"></a>示例程序</h4><p>请务必注意：本示例程序所使用的证书和密钥只能用于测试使用。您在自己搭建ESP8266物联网项目时，需要自行建立 证书密钥而不要使用本示例中的证书和密钥。</p>
<p>测试使用本示例程序需要使用wget指令。建议您在测试本示例程序以前先准备好一台Linux系统电脑。</p>
<p>接下来请点击以下链接，将用于客户端身份认证的证书和密钥文件下载并解压缩到您的Linux电脑中。</p>
<p><a target="_blank" rel="noopener" href="http://www.taichi-maker.com/wp-content/uploads/2020/04/client_files.zip">client_files</a></p>
<p>当您将以下示例程序中的WiFi连接信息修改并且将本示例程序上传ESP8266开发板后，开发板随即会自动连接WiFi。WiFi连接成功后，您将可以从串口监视器获取当前ESP8266开发板的IP地址。此时，ESP8266已经成功建立了支持HTTPS协议的网络服务器。您可以通过ESP8266的IP地址来访问该网络服务器。</p>
<p>假设您的ESP8266开发板IP地址是192.168.0.111。接下来请使用Linux电脑的终端应用输入以下指令：</p>
<p><strong>wget –no-check-certificate –certificate&#x3D;client1_cer.pem –private-key&#x3D;client1_key.pem <a target="_blank" rel="noopener" href="https://192.168.0.111/">https://192.168.0.111</a></strong></p>
<p>以上指令中client1_cer.pem和client1_key.pem 分别是您刚下载的客户端证书文件以及客户端私钥文件。这两个文件分别是客户端证书以及客户端私钥。他们的作用是为ESP8266服务器提供身份验证。</p>
<p>以下截屏是该指令的运行结果。我们可以看到，客户端成功的使用了下载的证书文件和私钥文件实现了与ESP8266服务器的网络通讯。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527163957003.png" alt="image-20230527163957003"></p>
<p>另外，我们从串口监视器可以看到，ESP8266服务器成功的响应了客户端请求。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527164018600.png" alt="image-20230527164018600"></p>
<p>以下示例程序中我们首先使用语句 BearSSL::X509List *serverTrustedCert &#x3D; new BearSSL::X509List(ca_cert);建立X509List对象用于处理及储存受信CA证书。接下来我们使用了语句server.setClientTrustAnchor(serverTrustedCert);设置受信CA证书以验证客户端身份。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : WiFiServerSecure_setClientTrustAnchor</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">  本示例程序借鉴ESP8266库中BearSSL_ServerClientCert示例程序，该程序作者Earle F. Philhower, III。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  ESP8266 建立的HTTPS服务器可以要求客户端提供证书以验证客户端身份。如果客户端无法提供CA签署的证书或者无法</span></span><br><span class="line"><span class="comment">  提供自签名证书，ESP8266服务器会拒绝客户端访问。此示例程序即是演示如何使用WiFiServerSecure库的</span></span><br><span class="line"><span class="comment">  setClientTrustAnchor函数来实现这一操作。</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  如需了解如何使用本示例程序，请参考以下网址：</span></span><br><span class="line"><span class="comment">  http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/web-server-secure/setclienttrustanchor/</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WiFi连接信息</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;taichimaker&quot;</span>;<span class="comment">// WiFi名称</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pass = <span class="string">&quot;12345678&quot;</span>;   <span class="comment">// WiFi密码</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立WiFiServerSecure对象</span></span><br><span class="line">BearSSL::WiFiServerSecure <span class="title function_">server</span><span class="params">(<span class="number">443</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 建立服务器响应信息</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *HTTP_RES =</span><br><span class="line">        <span class="string">&quot;HTTP/1.0 200 OK\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Connection: close\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Length: 59\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;html&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;body&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;p&gt;Hello my friend!&lt;/p&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;/body&gt;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&lt;/html&gt;\r\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 受信任的CA证书</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> ca_cert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIC1TCCAb2gAwIBAgIJAMPt1Ms37+hLMA0GCSqGSIb3DQEBCwUAMCExCzAJBgNV</span></span><br><span class="line"><span class="string">BAYTAlVTMRIwEAYDVQQDDAkxMjcuMC4wLjMwHhcNMTgwMzE0MDQyMTU0WhcNMjkw</span></span><br><span class="line"><span class="string">NTMxMDQyMTU0WjAhMQswCQYDVQQGEwJVUzESMBAGA1UEAwwJMTI3LjAuMC4zMIIB</span></span><br><span class="line"><span class="string">IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxsa4qU/tlzN4YTcnn/I/ffsi</span></span><br><span class="line"><span class="string">jOPc8QRcwClKzasIZNFEye4uThl+LGZWFIFb8X8Dc+xmmBaWlPJbqtphgFKStpar</span></span><br><span class="line"><span class="string">DdduHSW1ud6Y1FVKxljo3UwCMrYm76Q/jNzXJvGs6Z1MDNsVZzGJaoqit2H2Hkvk</span></span><br><span class="line"><span class="string">y+7kk3YbEDlcyVsLOw0zCKL4cd2DSNDyhIZxWo2a8Qn5IdjWAYtsTnW6MvLk/ya4</span></span><br><span class="line"><span class="string">abNeRfSZwi+r37rqi9CIs++NpL5ynqkKKEMrbeLactWgHbWrZeaMyLpuUEL2GF+w</span></span><br><span class="line"><span class="string">MRaAwaj7ERwT5gFJRqYwj6bbfIdx5PC7h7ucbyp272MbrDa6WNBCMwQO222t4wID</span></span><br><span class="line"><span class="string">AQABoxAwDjAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCmXfrC42nW</span></span><br><span class="line"><span class="string">IpL3JDkB8YlB2QUvD9JdMp98xxo33+xE69Gov0e6984F1Gluao0p6sS7KF+q3YLS</span></span><br><span class="line"><span class="string">4hjnzuGzF9GJMimIB7NMQ20yXKfKpmKJ7YugMaKTDWDhHn5679mKVbLSQxHCUMEe</span></span><br><span class="line"><span class="string">tEnMT93/UaDbWBjV6zu876q5vjPMYgDHODqO295ySaA71UkijaCn6UwKUT49286T</span></span><br><span class="line"><span class="string">V9ZtzgabNGHXfklHgUPWoShyze+G3g29I1BR0qABoJI63zaNu8ua42v5g1RldxsW</span></span><br><span class="line"><span class="string">X8yKI14mFOGxuvcygG8L2xxysW7Zq+9g+O7gW0Pm6RDYnUQmIwY83h1KFCtYCJdS</span></span><br><span class="line"><span class="string">2PgozwkkUNyP</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 服务器私钥</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> server_private_key[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEowIBAAKCAQEAsRNVTvqP++YUh8NrbXwE83xVsDqcB3F76xcXNKFDERfVd2P/</span></span><br><span class="line"><span class="string">LvyDovCcoQtT0UCRgPcxRp894EuPH/Ru6Z2Lu85sV//i7ce27tc2WRFSfuhlRxHP</span></span><br><span class="line"><span class="string">LJWHxTl1CEfXp/owkECQ4MB3pw6Ekc16iTEPiezTG+T+mQ/BkiIwcIK6CMlpR9DI</span></span><br><span class="line"><span class="string">eYUTqv0f9NrUfAjdBrqlEO2gpgFvLFrkDEU2ntAIc4aPOP7yDOym/xzfy6TiG8Wo</span></span><br><span class="line"><span class="string">7nlh6M97xTZGfbEPCH9rZDjo5istym1HzF5P+COq+OTSPscjFGXoi978o6hZwa7i</span></span><br><span class="line"><span class="string">zxorg4h5a5lGnshRu2Gl+Ybfa14OwnIrv/yCswIDAQABAoIBAHxwgbsHCriTcEoY</span></span><br><span class="line"><span class="string">Yx6F0VTrQ6ydA5mXfuYvS/eIfIE+pp1IgMScYEXZobjrJPQg1CA1l0NyFSHS97oV</span></span><br><span class="line"><span class="string">JPy34sMQxcLx6KABgeVHCMJ/EeJtnv7a3SUP0GIhhsVS95Lsl8RIG4hWub+EzFVK</span></span><br><span class="line"><span class="string">eZqAB9N9wr4Pp3wZPodbz37B38rb1QPyMFmQOLlHjKTOmoxsXhL2ot+R3+aLYSur</span></span><br><span class="line"><span class="string">oPO1kQo7/d0UAZoy8h9OQN4a2EXvawh4O2EvFGbc5X/yXwAdEQ4NPp9VZhkNIRkV</span></span><br><span class="line"><span class="string">+XZ3FcIqEVOploKtRF/tVBTz3g61/lFz21L9PMmV5y8tvSafr2SpJugGVmp2rrVQ</span></span><br><span class="line"><span class="string">VNyGlIECgYEA10JSI5gmeCU3zK6kvOfBp54hY/5dDrSUpjKkMxpmm7WZQ6Il/k7A</span></span><br><span class="line"><span class="string">hMcLeMzHiriT7WhRIXF8AOr2MoEkHkH3DhVNN4ccieVZx2SE5P5mVkItZGLrrpfU</span></span><br><span class="line"><span class="string">dysR/ARAI1HYegGUiKacZtf9SrRavU0m7fOVOiYwbFRhjyX+MyuteYkCgYEA0pbz</span></span><br><span class="line"><span class="string">4ZosetScP68uZx1sGlTfkcqLl7i15DHk3gnj6jKlfhvC2MjeLMhNDtKeUAuY7rLQ</span></span><br><span class="line"><span class="string">guZ0CCghWAv0Glh5eYdfIiPhgqFfX4P5F3Om4zQHVPYj8xHfHG4ZP7dKQTndrO1Q</span></span><br><span class="line"><span class="string">fLdGDTQLVXabAUSp2YGrijC8J9idSW1pYClvF1sCgYEAjkDn41nzYkbGP1/Swnwu</span></span><br><span class="line"><span class="string">AEWCL4Czoro32jVxScxSrugt5wJLNWp508VukWBTJhugtq3Pn9hNaJXeKbYqVkyl</span></span><br><span class="line"><span class="string">pgrxwpZph7+nuxt0r5hnrO2C7eppcjIoWLB/7BorAKxf8REGReBFT7nBTBMwPBW2</span></span><br><span class="line"><span class="string">el4U6h6+tXh2GJG1Eb/1nnECgYAydVb0THOx7rWNkNUGggc/++why61M6kYy6j2T</span></span><br><span class="line"><span class="string">cj05BW+f2tkCBoctpcTI83BZb53yO8g4RS2yMqNirGKN2XspwmTqEjzbhv0KLt4F</span></span><br><span class="line"><span class="string">X4GyWOoU0nFksXiLIFpOaQWSwWG7KJWrfGJ9kWXR0Xxsfl5QLoDCuNCsn3t4d43T</span></span><br><span class="line"><span class="string">K7phlwKBgHDzF+50+/Wez3YHCy2a/HgSbHCpLQjkknvgwkOh1z7YitYBUm72HP8Z</span></span><br><span class="line"><span class="string">Ge6b4wEfNuBdlZll/y9BQQOZJLFvJTE5t51X9klrkGrOb+Ftwr7eI/H5xgcadI52</span></span><br><span class="line"><span class="string">tPYglR5fjuRF/wnt3oX9JlQ2RtSbs+3naXH8JoherHaqNn8UpH0t</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 服务器证书</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> server_cert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIDTzCCAjcCCQDPXvMRYOpeuDANBgkqhkiG9w0BAQsFADCBpjESMBAGA1UEAwwJ</span></span><br><span class="line"><span class="string">MTI3LjAuMC4xMQswCQYDVQQGEwJVUzElMCMGA1UECgwcTXkgT3duIENlcnRpZmlj</span></span><br><span class="line"><span class="string">YXRlIEF1dGhvcml0eTEUMBIGA1UECAwLQXJkdWlub0xhbmQxFTATBgNVBAcMDEFy</span></span><br><span class="line"><span class="string">ZHVpbm9WaWxsZTEVMBMGA1UECgwMRVNQODI2NlVzZXJzMRgwFgYDVQQLDA9FU1A4</span></span><br><span class="line"><span class="string">MjY2LUFyZHVpbm8wHhcNMTgwMzE0MDQwMDAwWhcNMjkwMjI0MDQwMDAwWjAsMRYw</span></span><br><span class="line"><span class="string">FAYDVQQKDA1NeSBTZXJ2ZXIgT3JnMRIwEAYDVQQDDAkxMjcuMC4wLjMwggEiMA0G</span></span><br><span class="line"><span class="string">CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCxE1VO+o/75hSHw2ttfATzfFWwOpwH</span></span><br><span class="line"><span class="string">cXvrFxc0oUMRF9V3Y/8u/IOi8JyhC1PRQJGA9zFGnz3gS48f9G7pnYu7zmxX/+Lt</span></span><br><span class="line"><span class="string">x7bu1zZZEVJ+6GVHEc8slYfFOXUIR9en+jCQQJDgwHenDoSRzXqJMQ+J7NMb5P6Z</span></span><br><span class="line"><span class="string">D8GSIjBwgroIyWlH0Mh5hROq/R/02tR8CN0GuqUQ7aCmAW8sWuQMRTae0Ahzho84</span></span><br><span class="line"><span class="string">/vIM7Kb/HN/LpOIbxajueWHoz3vFNkZ9sQ8If2tkOOjmKy3KbUfMXk/4I6r45NI+</span></span><br><span class="line"><span class="string">xyMUZeiL3vyjqFnBruLPGiuDiHlrmUaeyFG7YaX5ht9rXg7Cciu//IKzAgMBAAEw</span></span><br><span class="line"><span class="string">DQYJKoZIhvcNAQELBQADggEBAEnG+FNyNCOkBvzHiUpHHpScxZqM2f+XDcewJgeS</span></span><br><span class="line"><span class="string">L6HkYEDIZZDNnd5gduSvkHpdJtWgsvJ7dJZL40w7Ba5sxpZHPIgKJGl9hzMkG+aA</span></span><br><span class="line"><span class="string">z5GMkjys9h2xpQZx9KL3q7G6A+C0bll7ODZlwBtY07CFMykT4Mp2oMRrQKRucMSV</span></span><br><span class="line"><span class="string">AB1mKujLAnMRKJ3NM89RQJH4GYiRps9y/HvM5lh7EIK/J0/nEZeJxY5hJngskPKb</span></span><br><span class="line"><span class="string">oPPdmkR97kaQnll4KNsC3owVlHVU2fMftgYkgQLzyeWgzcNa39AF3B6JlcOzNyQY</span></span><br><span class="line"><span class="string">seoK24dHmt6tWmn/sbxX7Aa6TL/4mVlFoOgcaTJyVaY/BrY=</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setClock</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  configTime(<span class="number">8</span> * <span class="number">3600</span>, <span class="number">0</span>, <span class="string">&quot;ntp.ntsc.ac.cn&quot;</span>,<span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.print(<span class="string">&quot;Waiting for NTP time sync: &quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = time(nullptr);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    now = time(nullptr);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">timeinfo</span>;</span></span><br><span class="line">  gmtime_r(&amp;now, &amp;timeinfo);</span><br><span class="line">  Serial.print(<span class="string">&quot;Current time: &quot;</span>);</span><br><span class="line">  Serial.print(asctime(&amp;timeinfo));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接 WiFi</span></span><br><span class="line">  Serial.print(<span class="string">&quot;Connecting to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, pass);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  setClock(); <span class="comment">// 获取网络时间，该时间信息用于证书认证</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 建立X509List对象用于处理及储存服务器证书</span></span><br><span class="line">  BearSSL::X509List *serverCertList = new BearSSL::X509List(server_cert);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立PrivateKey对象用于处理及储存服务器私钥  </span></span><br><span class="line">  BearSSL::PrivateKey *serverPrivKey = new BearSSL::PrivateKey(server_private_key);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置服务器证书和服务器私钥  </span></span><br><span class="line">  server.setRSACert(serverCertList, serverPrivKey);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立X509List对象用于处理及储存受信CA证书</span></span><br><span class="line">  BearSSL::X509List *serverTrustedCert = new BearSSL::X509List(ca_cert);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置受信CA证书以验证客户端身份</span></span><br><span class="line">  server.setClientTrustAnchor(serverTrustedCert);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动服务器</span></span><br><span class="line">  server.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  BearSSL::WiFiClientSecure incoming = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!incoming) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;Incoming connection...\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待客户端发送请求</span></span><br><span class="line">  <span class="type">uint32_t</span> timeout=millis() + <span class="number">1000</span>;</span><br><span class="line">  <span class="type">int</span> lcwn = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((millis() &gt; timeout) || (incoming.available() &amp;&amp; incoming.read(&amp;x, <span class="number">1</span>) &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">      incoming.stop();</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connection error, closed\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!x) &#123;</span><br><span class="line">      yield();</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0x0D</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0x0A</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (lcwn) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      lcwn = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      lcwn = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送响应信息  </span></span><br><span class="line">  incoming.write((<span class="type">uint8_t</span>*)HTTP_RES, <span class="built_in">strlen</span>(HTTP_RES));</span><br><span class="line">  incoming.flush();</span><br><span class="line">  incoming.stop();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connection closed.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ESP8266-–-WiFiUDP库"><a href="#ESP8266-–-WiFiUDP库" class="headerlink" title="ESP8266 – WiFiUDP库"></a>ESP8266 – WiFiUDP库</h2><p>UDP协议是User Datagram Protocol的简称，中文名是用户数据协议。UDP协议是一种无连接的传输层协议。</p>
<p>WiFiUDP库用于ESP8266开发板的物联网通讯控制以及UDP协议数据包处理。以下为WiFiUDP库的整体结构图。在此图下方有WiFiUDP库的函数目录。您可以通过点击目录项目打开各个函数的说明页面。</p>
<p><strong>请留意，WiFiUDP对象在处理或发送UDP数据时，可以通过调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">Stream类</a>中的函数来实现。因此在以下结构图中的“接收&#x2F;处理UDP数据类型”以及“发送UDP数据类型”中有“Stream类”作为这两种类型函数的一部分。</strong></p>
<p>为了方便您更好的了解ESP8266的WiFiUdp库以及本站资料中WiFiUdp库函数的示例程序操作方法，我们制作了一个较为详细的图文教程。该图文教程说明了如何利用<em>TCP_UDP测试工具软件</em>来测试ESP8266开发板的UDP协议通讯功能。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527164244447.png" alt="image-20230527164244447"></p>
<h3 id="UDP服务控制类型"><a href="#UDP服务控制类型" class="headerlink" title="UDP服务控制类型"></a>UDP服务控制类型</h3><h4 id="begin-–-启动UDP服务"><a href="#begin-–-启动UDP服务" class="headerlink" title="begin – 启动UDP服务"></a>begin – 启动UDP服务</h4><h5 id="说明-167"><a href="#说明-167" class="headerlink" title="说明"></a>说明</h5><p>此函数用于初始化WiFiUDP库和网络设置。执行此函数后，ESP8266将开始监听指定端口以提供UDP协议物联网通讯服务。</p>
<h5 id="语法-169"><a href="#语法-169" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.begin(port)</span><br></pre></td></tr></table></figure>

<h5 id="参数-162"><a href="#参数-162" class="headerlink" title="参数"></a>参数</h5><p>port：为提供UDP物联网服务而监听的端口号（类型：uint16_t）</p>
<h5 id="返回值-161"><a href="#返回值-161" class="headerlink" title="返回值"></a>返回值</h5><p>返回值数据类型为uint8_t 型。以下是返回数值说明：<br>1：ESP8266开发板启动UDP服务成功</p>
<p>0：ESP8266开发板启动UDP服务失败</p>
<h5 id="示例程序-152"><a href="#示例程序-152" class="headerlink" title="示例程序"></a>示例程序</h5><p>以下示例程序演示如何使用ESP8266监听指定端口以提供UDP协议物联网通讯服务。关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_1</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中begin函数。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;                         <span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;    <span class="comment">//自定义本地监听端口</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>); <span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;  <span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的数据转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>为了方便您更好的了解ESP8266的WiFiUdp库以及本站资料中WiFiUdp库函数的示例程序操作方法，我们制作了一个较为详细的图文教程。该图文教程说明了如何利用<em>TCP_UDP测试工具软件</em>来测试ESP8266开发板的UDP协议通讯功能。</p>
<h5 id="相关内容-65"><a href="#相关内容-65" class="headerlink" title="相关内容"></a>相关内容</h5><p>– stop – 停止UDP服务</p>
<h4 id="stop-–-停止UDP服务"><a href="#stop-–-停止UDP服务" class="headerlink" title="stop – 停止UDP服务"></a>stop – 停止UDP服务</h4><h5 id="说明-168"><a href="#说明-168" class="headerlink" title="说明"></a>说明</h5><p>当我们使用WiFiUdp库的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/begin/">begin</a>函数启动ESP8266的UDP物联网通讯服务以后，我们可以使用stop函数来停止该服务。</p>
<h5 id="语法-170"><a href="#语法-170" class="headerlink" title="语法"></a>语法</h5><p>wiFiUDP.stop()</p>
<h5 id="参数-163"><a href="#参数-163" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-162"><a href="#返回值-162" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-153"><a href="#示例程序-153" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_2</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中stop函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">// 这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">// 这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;                         <span class="comment">// 实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;    <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123; <span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的数据转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">  Udp.stop();<span class="comment">//关闭udp监听</span></span><br><span class="line">  Serial.println(<span class="string">&quot;停止监听&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="接收-处理UDP数据类型"><a href="#接收-处理UDP数据类型" class="headerlink" title="接收&#x2F;处理UDP数据类型"></a>接收&#x2F;处理UDP数据类型</h3><h4 id="parsePacket-–-解析数据"><a href="#parsePacket-–-解析数据" class="headerlink" title="parsePacket – 解析数据"></a>parsePacket – 解析数据</h4><h5 id="说明-169"><a href="#说明-169" class="headerlink" title="说明"></a>说明</h5><p>本函数用于检查是否有UDP数据包传入ESP8266开发板。同时，如果我们需要使用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/">stream</a>类中的函数(如<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/read/">read</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/readstring/">readString</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parseint/">parseInt</a>、<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/find/">find</a>等)来处理UDP数据包的话，那么我们需要先使用parsePacket，然后才能使用stream类中的函数对传入ESP8266开发板的UDP数据包进行处理。</p>
<h5 id="语法-171"><a href="#语法-171" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.parsePacket()</span><br></pre></td></tr></table></figure>

<h5 id="参数-164"><a href="#参数-164" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-163"><a href="#返回值-163" class="headerlink" title="返回值"></a>返回值</h5><p>返回值数据类型为整数型，以下是函数返回值含义说明：<br>n：数据包的大小（以字节为单位）<br>0：没有可用的数据包</p>
<h5 id="示例程序-154"><a href="#示例程序-154" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_6</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中parsePacket函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取Udp数据包并存放在incomingPacket</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);<span class="comment">//返回数据包字节数</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123; </span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;<span class="comment">//清空缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向串口打印信息</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP数据包内容为: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下是该程序的运行结果。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527164725405.png" alt="image-20230527164725405"></p>
<h5 id="相关内容-66"><a href="#相关内容-66" class="headerlink" title="相关内容"></a>相关内容</h5><p>– available(Stream类) – 检查是否有数据被接收<br>– read(Stream类) – 读取UDP数据<br>– readString(Stream类) – 读取UDP字符串<br>– parseInt(Stream类) – 解析UDP数据中整数<br>– find(Stream类) – 在UDP数据中查找信息<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="available-Stream类-–-检查是否有数据被接收"><a href="#available-Stream类-–-检查是否有数据被接收" class="headerlink" title="available(Stream类) – 检查是否有数据被接收"></a>available(Stream类) – 检查是否有数据被接收</h4><h5 id="说明-170"><a href="#说明-170" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于检查设备是否接收到数据。函数将会返回等待读取的数据字节数。<strong>请注意，使用本函数以前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数。</strong></p>
<p>WiFiUDP类对象可调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/available/">Stream类</a>函数。available函数就是属于Stream类的。</p>
<h5 id="语法-172"><a href="#语法-172" class="headerlink" title="语法"></a>语法</h5><p>wiFiUDP.available()</p>
<h5 id="参数-165"><a href="#参数-165" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-164"><a href="#返回值-164" class="headerlink" title="返回值"></a>返回值</h5><p>等待读取的数据字节数。<br>返回值数据类型：int</p>
<h5 id="示例程序-155"><a href="#示例程序-155" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_8</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中available函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串  </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前UDP解析包字节数: %d\n&quot;</span>, packetSize);</span><br><span class="line">  <span class="type">int</span> n = Udp.available();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前UDP缓冲区字节数: %d\n&quot;</span>, n);</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./Image/ESP8266.assets/image-20230527164817681.png" alt="image-20230527164817681"></p>
<h5 id="相关内容-67"><a href="#相关内容-67" class="headerlink" title="相关内容"></a>相关内容</h5><p>接收&#x2F;处理UDP数据类型<br>– parsePacket – 解析数据<br>– read(Stream类) – 读取UDP数据<br>– readString(Stream类) – 读取UDP字符串<br>– parseInt(Stream类) – 解析UDP数据中整数<br>– find(Stream类) – 在UDP数据中查找信息<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="read-Stream类-–-读取UDP数据"><a href="#read-Stream类-–-读取UDP数据" class="headerlink" title="read(Stream类) – 读取UDP数据"></a>read(Stream类) – 读取UDP数据</h4><h5 id="说明-171"><a href="#说明-171" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于从设备接收到数据中读取数据。函数将会返回等待读取的数据字节数。<strong>请注意，使用本函数以前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数。</strong></p>
<p>WiFiUDP类对象可调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/available/">Stream类</a>函数。本函数就是属于Stream类的。</p>
<h5 id="语法-173"><a href="#语法-173" class="headerlink" title="语法"></a>语法</h5><p>WiFiUDP.read()<br>WiFiUDP.read(buffer, len)</p>
<h5 id="参数-166"><a href="#参数-166" class="headerlink" title="参数"></a>参数</h5><p>buffer：保存传入数据包的内存指针，数据类型为unsigned char*<br>len：传入数据包的大小（单位是字节），数据类型为size_t</p>
<h5 id="返回值-165"><a href="#返回值-165" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为整数型。</p>
<p>在没有使用任何参数的情况下调用此函数，函数的返回值情况如下所述:<br>设备没有接收到数据时，返回值为-1<br>设备接收到数据时，返回值为接收到的数据包中的第1个字符的<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/ascii-code-table/">ASCII码数值</a>。</p>
<p>在使用了参数buffer和len调用此函数，函数的返回值情况如下所述:<br>设备没有接收到数据时，返回值为-1<br>设备接收到数据时，返回值为接收到的数据包的大小（单位是字节）。</p>
<h5 id="示例程序-156"><a href="#示例程序-156" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_10</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中read函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串   </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;当前UDP解析包字节数: %d\n&quot;</span>, packetSize);</span><br><span class="line">  <span class="keyword">if</span>(Udp.available())&#123;<span class="comment">//判断是否有UDP数据包</span></span><br><span class="line">    <span class="type">char</span> a = Udp.read();<span class="comment">//连续调用read</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;READ: %c\n&quot;</span>, a);</span><br><span class="line">    a = Udp.read();</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;READ: %c\n&quot;</span>, a);</span><br><span class="line">    a = Udp.read();</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;READ: %c\n&quot;</span>, a);</span><br><span class="line">    a = Udp.read();</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;READ: %c\n&quot;</span>, a);</span><br><span class="line">    <span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 存储Udp客户端发过来的数据</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;READ: %s   len：%d\n&quot;</span>, incomingPacket, len);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序运行结果：</p>
<p><img src="/./Image/ESP8266.assets/image-20230527165035499.png" alt="image-20230527165035499"></p>
<h5 id="相关内容-68"><a href="#相关内容-68" class="headerlink" title="相关内容"></a>相关内容</h5><p>接收&#x2F;处理UDP数据类型<br>– parsePacket – 解析数据<br>– available(Stream类) – 检查是否有数据被接收<br>– readString(Stream类) – 读取UDP字符串<br>– parseInt(Stream类) – 解析UDP数据中整数<br>– find(Stream类) – 在UDP数据中查找信息<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="readString-Stream类-–-读取UDP字符串"><a href="#readString-Stream类-–-读取UDP字符串" class="headerlink" title="readString(Stream类) – 读取UDP字符串"></a>readString(Stream类) – 读取UDP字符串</h4><h5 id="说明-172"><a href="#说明-172" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于从设备接收到数据中读取数据信息。读取到的信息将以字符串格式返回。<strong>请注意，使用本函数以前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数。</strong></p>
<p>WiFiUDP类对象可调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/available/">Stream类</a>函数。本函数就是属于Stream类的。</p>
<h5 id="语法-174"><a href="#语法-174" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.readString()</span><br></pre></td></tr></table></figure>

<h5 id="参数-167"><a href="#参数-167" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-166"><a href="#返回值-166" class="headerlink" title="返回值"></a>返回值</h5><p>接收到的数据，类型为字符串。</p>
<h5 id="示例程序-157"><a href="#示例程序-157" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_10</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中readString函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">// 这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">// 这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串   </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 解析UDP数据包中的所以数据，以字符串格式返回</span></span><br><span class="line">    String udpStringVal = Udp.readString(); </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后向串口打印返回的字符串</span></span><br><span class="line">    Serial.print(<span class="string">&quot;开发板接收到UDP数据中的字符串 &quot;</span>); Serial.println(udpStringVal);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-69"><a href="#相关内容-69" class="headerlink" title="相关内容"></a>相关内容</h5><p>接收&#x2F;处理UDP数据类型<br>– parsePacket – 解析数据<br>– available(Stream类) – 检查是否有数据被接收<br>– read(Stream类) – 读取UDP数据<br>– parseInt(Stream类) – 解析UDP数据中整数<br>– find(Stream类) – 在UDP数据中查找信息<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="parseInt-Stream类-–-解析UDP数据中整数"><a href="#parseInt-Stream类-–-解析UDP数据中整数" class="headerlink" title="parseInt(Stream类) – 解析UDP数据中整数"></a>parseInt(Stream类) – 解析UDP数据中整数</h4><h5 id="说明-173"><a href="#说明-173" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于从设备接收到的数据中寻找整数数值。读取到的信息将以字符串格式返回。<strong>请注意，使用本函数以前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数。</strong></p>
<p>WiFiUDP类对象可调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/available/">Stream类</a>函数。本函数就是属于Stream类的。</p>
<h5 id="语法-175"><a href="#语法-175" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WiFiUDP.parseInt()</span><br></pre></td></tr></table></figure>

<h5 id="参数-168"><a href="#参数-168" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-167"><a href="#返回值-167" class="headerlink" title="返回值"></a>返回值</h5><p>在接收信息中找到的整数数值。类型：long</p>
<h5 id="示例程序-158"><a href="#示例程序-158" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_10</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中parseInt函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 解析UDP数据包中的整数</span></span><br><span class="line">    <span class="type">int</span> udpIntVal = Udp.parseInt(); </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后向串口打印UDP数据包中的整数</span></span><br><span class="line">    Serial.print(<span class="string">&quot;开发板接收到UDP数据中的整数数值&quot;</span>); Serial.println(udpIntVal);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="相关内容-70"><a href="#相关内容-70" class="headerlink" title="相关内容"></a>相关内容</h5><p>接收&#x2F;处理UDP数据类型<br>– parsePacket – 解析数据<br>– available(Stream类) – 检查是否有数据被接收<br>– read(Stream类) – 读取UDP数据<br>– readString(Stream类) – 读取UDP字符串<br>– find(Stream类) – 在UDP数据中查找信息<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="find-Stream类-–-在UDP数据中查找信息"><a href="#find-Stream类-–-在UDP数据中查找信息" class="headerlink" title="find(Stream类) – 在UDP数据中查找信息"></a>find(Stream类) – 在UDP数据中查找信息</h4><h5 id="说明-174"><a href="#说明-174" class="headerlink" title="说明"></a>说明</h5><p>本函数可用于从设备接收到的数据中寻找指定字符串信息。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。<strong>请注意，使用本函数以前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数。</strong></p>
<p>WiFiUDP类对象可调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-code-reference/stream/available/">Stream类</a>函数。本函数就是属于Stream类的。</p>
<h5 id="语法-176"><a href="#语法-176" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.find(target)</span><br></pre></td></tr></table></figure>

<h5 id="参数-169"><a href="#参数-169" class="headerlink" title="参数"></a>参数</h5><p>target: 被查找字符串。允许使用String或char类型。</p>
<h5 id="返回值-168"><a href="#返回值-168" class="headerlink" title="返回值"></a>返回值</h5><p>返回值类型为bool。当函数找到了指定字符串信息后将会立即结束函数执行并且返回“真”。否则将会返回“假”。</p>
<h5 id="示例程序-159"><a href="#示例程序-159" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_10</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : 小凯</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200319</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中find函数</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 使用find函数来查看用户输入信息中是否包含^_^</span></span><br><span class="line">    <span class="keyword">if</span>(Udp.find(<span class="string">&quot;^_^&quot;</span>)) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;用户输入信息中含有 ^_^&quot;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;用户输入信息中不含有 ^_^&quot;</span>); </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-71"><a href="#相关内容-71" class="headerlink" title="相关内容"></a>相关内容</h5><p>接收&#x2F;处理UDP数据类型<br>– parsePacket – 解析数据<br>– available(Stream类) – 检查是否有数据被接收<br>– read(Stream类) – 读取UDP数据<br>– readString(Stream类) – 读取UDP字符串<br>– parseInt(Stream类) – 解析UDP数据中整数<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h3 id="发送UDP数据类型"><a href="#发送UDP数据类型" class="headerlink" title="发送UDP数据类型"></a>发送UDP数据类型</h3><h4 id="beginPacket-–-配置UDP数据包接收设备的IP和端口"><a href="#beginPacket-–-配置UDP数据包接收设备的IP和端口" class="headerlink" title="beginPacket – 配置UDP数据包接收设备的IP和端口"></a>beginPacket – 配置UDP数据包接收设备的IP和端口</h4><h5 id="说明-175"><a href="#说明-175" class="headerlink" title="说明"></a>说明</h5><p>此函数用于ESP8266开发板的UDP数据发送准备。其具体功能是设置UDP数据接收设备的IP地址和端口号。</p>
<h5 id="语法-177"><a href="#语法-177" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.beginPacket(ip,port)</span><br></pre></td></tr></table></figure>

<h5 id="参数-170"><a href="#参数-170" class="headerlink" title="参数"></a>参数</h5><p>ip：UDP数据接收设备的IP地址（IPAddress类型）<br>port：UDP数据接收设备的IP地址监听端口号（uint16_t类型）</p>
<h5 id="返回值-169"><a href="#返回值-169" class="headerlink" title="返回值"></a>返回值</h5><p>返回值数据类型为整数型<br>1：配置数据接收设备的IP地址和监听端口号成功<br>0：配置数据接收设备的IP地址和监听端口号失败</p>
<h5 id="示例程序-160"><a href="#示例程序-160" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_6</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中beginPacket函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取Udp数据包并存放在incomingPacket</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);<span class="comment">//返回数据包字节数</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123; </span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;<span class="comment">//清空缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向串口打印信息</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP数据包内容为: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-72"><a href="#相关内容-72" class="headerlink" title="相关内容"></a>相关内容</h5><p>– endPacket – 发送UDP数据包<br>– write – 向UDP数据包写入信息<br>– print &#x2F; println (Stream类) – 发送UDP数据<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="endPacket-–-发送UDP数据包"><a href="#endPacket-–-发送UDP数据包" class="headerlink" title="endPacket – 发送UDP数据包"></a>endPacket – 发送UDP数据包</h4><h5 id="说明-176"><a href="#说明-176" class="headerlink" title="说明"></a>说明</h5><p>此函数用于发送UDP数据包。</p>
<h5 id="语法-178"><a href="#语法-178" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.endPacket()</span><br></pre></td></tr></table></figure>

<h5 id="参数-171"><a href="#参数-171" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-170"><a href="#返回值-170" class="headerlink" title="返回值"></a>返回值</h5><p>返回值数据类型为整数型<br>1：数据发送成功<br>0：数据发送失败</p>
<h5 id="示例程序-161"><a href="#示例程序-161" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_6</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中endPacket函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取Udp数据包并存放在incomingPacket</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);<span class="comment">//返回数据包字节数</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123; </span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;<span class="comment">//清空缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向串口打印信息</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP数据包内容为: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="相关内容-73"><a href="#相关内容-73" class="headerlink" title="相关内容"></a>相关内容</h5><p>发送UDP数据类型<br>– endPacket – 发送UDP数据包<br>– write – 向UDP数据包写入信息<br>– print &#x2F; println (Stream类) – 发送UDP数据<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="write-–-向UDP数据包写入信息"><a href="#write-–-向UDP数据包写入信息" class="headerlink" title="write – 向UDP数据包写入信息"></a>write – 向UDP数据包写入信息</h4><h5 id="说明-177"><a href="#说明-177" class="headerlink" title="说明"></a>说明</h5><p>将即将通过UDP协议发送的数据写入发送缓冲区。此函数必须置于<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/beginpacket/">beginPacket</a>和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/endpacket/">endPacket</a>之间。</p>
<p>请注意：此函数仅仅将数据写入发送缓冲区，但是数据不会发送。实施数据发送的函数是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/endpacket/">endPacket</a>函数。</p>
<h5 id="语法-179"><a href="#语法-179" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.write(udp_data)</span><br></pre></td></tr></table></figure>

<h5 id="参数-172"><a href="#参数-172" class="headerlink" title="参数"></a>参数</h5><p>udp_data：此参数为写入发送缓冲区的数据，可使用字符串类型。</p>
<h5 id="返回值-171"><a href="#返回值-171" class="headerlink" title="返回值"></a>返回值</h5><p>写入发送缓冲区的数据大小（单位：字节）。<br>返回值类型：size_t</p>
<h5 id="示例程序-162"><a href="#示例程序-162" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_6</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中write函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串   </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取Udp数据包并存放在incomingPacket</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);<span class="comment">//返回数据包字节数</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123; </span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;<span class="comment">//清空缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向串口打印信息</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP数据包内容为: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发送UDP数据类型-1"><a href="#发送UDP数据类型-1" class="headerlink" title="发送UDP数据类型"></a>发送UDP数据类型</h5><p>– beginPacket – 配置UDP数据包接收设备的IP和端口<br>– print &#x2F; println (Stream类) – 发送UDP数据<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h4 id="print-println-Stream类-–-发送UDP数据"><a href="#print-println-Stream类-–-发送UDP数据" class="headerlink" title="print &#x2F; println (Stream类) – 发送UDP数据"></a>print &#x2F; println (Stream类) – 发送UDP数据</h4><h5 id="说明-178"><a href="#说明-178" class="headerlink" title="说明"></a>说明</h5><p>ESP8266开发板通过UDP协议发送UDP数据时，可以采用 print 或者 println 函数将UDP数据写入发送缓冲区。</p>
<p>print与println的功能十分相近。他们的区别是println会在写入数据的末尾添加换行符。</p>
<p>此函数必须置于<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/beginpacket/">beginPacket</a>和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/endpacket/">endPacket</a>之间。</p>
<p>请注意：此函数仅仅将数据写入发送缓冲区，但是数据不会发送。实施数据发送的函数是<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/endpacket/">endPacket</a>函数。</p>
<h5 id="语法-180"><a href="#语法-180" class="headerlink" title="语法"></a>语法</h5><p><code>wiFiUDP.print(udp_data)</code><br><code>wiFiUDP.println(udp_data)</code></p>
<h5 id="参数-173"><a href="#参数-173" class="headerlink" title="参数"></a>参数</h5><p>udp_data：此参数为写入发送缓冲区的数据，可使用字符串类型。</p>
<h5 id="返回值-172"><a href="#返回值-172" class="headerlink" title="返回值"></a>返回值</h5><p>无</p>
<h5 id="示例程序-163"><a href="#示例程序-163" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<h6 id="print函数示例"><a href="#print函数示例" class="headerlink" title="print函数示例"></a>print函数示例</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_12</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中print函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串   </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//向udp工具发送消息</span></span><br><span class="line">  Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">  Udp.print(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">  Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  Serial.println(<span class="string">&quot;UDP数据发送成功&quot;</span>);</span><br><span class="line">  delay(<span class="number">3000</span>);<span class="comment">//延时3秒</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="println函数示例"><a href="#println函数示例" class="headerlink" title="println函数示例"></a>println函数示例</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_13</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中println函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;xxxxxxx&quot;</span>          <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串   </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//向udp工具发送消息</span></span><br><span class="line">  Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">  Udp.println(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">  Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  Serial.println(<span class="string">&quot;UDP数据发送成功&quot;</span>);</span><br><span class="line">  delay(<span class="number">3000</span>);<span class="comment">//延时3秒</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发送UDP数据类型-2"><a href="#发送UDP数据类型-2" class="headerlink" title="发送UDP数据类型"></a>发送UDP数据类型</h5><p>– beginPacket – 配置UDP数据包接收设备的IP和端口<br>– endPacket – 发送UDP数据包<br>– write – 向UDP数据包写入信息<br>– Stream类 – 以上带有(Stream类)标注的函数属于Stream类函数。</p>
<h3 id="获取发送UDP数据设备信息类型"><a href="#获取发送UDP数据设备信息类型" class="headerlink" title="获取发送UDP数据设备信息类型"></a>获取发送UDP数据设备信息类型</h3><h4 id="remoteIP-–-获取发送UDP数据包的设备IP"><a href="#remoteIP-–-获取发送UDP数据包的设备IP" class="headerlink" title="remoteIP – 获取发送UDP数据包的设备IP"></a>remoteIP – 获取发送UDP数据包的设备IP</h4><h5 id="说明-179"><a href="#说明-179" class="headerlink" title="说明"></a>说明</h5><p>此函数用于获取向ESP8266开发板发送UDP数据包设备的IP地址。<br>注：在调用 此函数前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数让ESP8266开发板对接收到的UDP数据进行初始检查。</p>
<h5 id="语法-181"><a href="#语法-181" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.remoteIP()</span><br></pre></td></tr></table></figure>

<h5 id="参数-174"><a href="#参数-174" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-173"><a href="#返回值-173" class="headerlink" title="返回值"></a>返回值</h5><p>此函数的返回值是向ESP8266开发板发送UDP数据包设备的IP地址。数据类型是IPAddress。</p>
<h5 id="示例程序-164"><a href="#示例程序-164" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_6</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中remoteIP函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取Udp数据包并存放在incomingPacket</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);<span class="comment">//返回数据包字节数</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123; </span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;<span class="comment">//清空缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向串口打印信息</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP数据包内容为: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="remotePort-–-获取发送UDP数据包的设备的端口"><a href="#remotePort-–-获取发送UDP数据包的设备的端口" class="headerlink" title="remotePort – 获取发送UDP数据包的设备的端口"></a>remotePort – 获取发送UDP数据包的设备的端口</h4><h5 id="说明-180"><a href="#说明-180" class="headerlink" title="说明"></a>说明</h5><p>此函数用于获取向ESP8266开发板发送UDP数据包设备的端口。<br>注：在调用 此函数前需要先调用<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/wifiudp/parsepacket/">parsePacket</a>函数让ESP8266开发板对接收到的UDP数据进行初始检查。</p>
<h5 id="语法-182"><a href="#语法-182" class="headerlink" title="语法"></a>语法</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wiFiUDP.remotePort()</span><br></pre></td></tr></table></figure>

<h5 id="参数-175"><a href="#参数-175" class="headerlink" title="参数"></a>参数</h5><p>无</p>
<h5 id="返回值-174"><a href="#返回值-174" class="headerlink" title="返回值"></a>返回值</h5><p>此函数的返回值是向ESP8266开发板发送UDP数据包设备的端口。数据类型是uint16_t。</p>
<h5 id="示例程序-165"><a href="#示例程序-165" class="headerlink" title="示例程序"></a>示例程序</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : ESP8266WiFiUdp_6</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">用于演示ESP8266WiFiUdp库中remotePort函数</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ssid      <span class="string">&quot;TaichiMaker_WIFI&quot;</span> <span class="comment">//这里改成你的设备当前环境下WIFI名字</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> password  <span class="string">&quot;12345678&quot;</span>         <span class="comment">//这里改成你的设备当前环境下WIFI密码</span></span></span><br><span class="line"> </span><br><span class="line">WiFiUDP Udp;<span class="comment">//实例化WiFiUDP对象</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;  <span class="comment">// 自定义本地监听端口</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> remoteUdpPort = <span class="number">4321</span>;  <span class="comment">// 自定义远程监听端口</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// 保存Udp工具发过来的消息</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi, this is esp8266\n&quot;</span>;  <span class="comment">//发送的消息,仅支持英文</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//打开串口</span></span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;正在连接 %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);<span class="comment">//连接到wifi</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)<span class="comment">//等待连接</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(Udp.begin(localUdpPort))&#123;<span class="comment">//启动Udp监听服务</span></span><br><span class="line">    Serial.println(<span class="string">&quot;监听成功&quot;</span>);</span><br><span class="line">    <span class="comment">//打印本地的ip地址，在UDP工具中会使用到</span></span><br><span class="line">    <span class="comment">//WiFi.localIP().toString().c_str()用于将获取的本地IP地址转化为字符串    </span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;现在收听IP：%s, UDP端口：%d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;监听失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//解析Udp数据包</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();<span class="comment">//获得解析包</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)<span class="comment">//解析包不为空</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//收到Udp数据包</span></span><br><span class="line">    <span class="comment">//Udp.remoteIP().toString().c_str()用于将获取的远端IP地址转化为字符串</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;收到来自远程IP：%s（远程端口：%d）的数据包字节数：%d\n&quot;</span>, Udp.remoteIP().toString().c_str(), Udp.remotePort(), packetSize);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取Udp数据包并存放在incomingPacket</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);<span class="comment">//返回数据包字节数</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123; </span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;<span class="comment">//清空缓存</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//向串口打印信息</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP数据包内容为: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//向udp工具发送消息</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), remoteUdpPort);<span class="comment">//配置远端ip地址和端口</span></span><br><span class="line">    Udp.write(replyPacket);<span class="comment">//把数据写入发送缓冲区</span></span><br><span class="line">    Udp.endPacket();<span class="comment">//发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ESP8266-–-DNSServer库"><a href="#ESP8266-–-DNSServer库" class="headerlink" title="ESP8266 – DNSServer库"></a>ESP8266 – DNSServer库</h2><p>DNS（Domain Name Server，域名服务器）是进行域名（如<a target="_blank" rel="noopener" href="https://arduino-esp8266.readthedocs.io/">arduino-esp8266.readthedocs.io</a>）和与之相对应的IP地址转换的服务器。如需了解更多有关DNS服务器的信息，可前往百度百科的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8">域名服务器介绍页面</a>获取更多介绍信息。</p>
<p>通过DNSServer库，我们可以使用ESP8266模块建立简易版的域名服务器。以下为DNSServer库的整体结构图。在此图下方有DNSServer库的函数目录。您可以通过点击目录项目打开各个函数的说明页面。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527170327287.png" alt="image-20230527170327287"></p>
<h3 id="start-–-启动DNS服务"><a href="#start-–-启动DNS服务" class="headerlink" title="start – 启动DNS服务"></a>start – 启动DNS服务</h3><h4 id="说明-181"><a href="#说明-181" class="headerlink" title="说明"></a>说明</h4><p>当ESP8266模块以无线终端模式工作时，调用本函数可以启动ESP8266模块的DNS服务。</p>
<h4 id="语法-183"><a href="#语法-183" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dnsServer.start(port, domainName, domainIp)</span><br></pre></td></tr></table></figure>

<h4 id="参数-176"><a href="#参数-176" class="headerlink" title="参数"></a>参数</h4><p>port: DNS服务端口号。默认情况下设置为53（uint16_t型）</p>
<p>domainName: 映射的域名，也就是开启服务后可以直接访问的用于代替IP地址的域名（可使用字符串型）</p>
<p>domainIp: 映射的IP地址（IPAdress型）</p>
<h4 id="返回值-175"><a href="#返回值-175" class="headerlink" title="返回值"></a>返回值</h4><p>返回值为是否成功开启DNS服务，若开启则返回true。数据类型为布尔型</p>
<h4 id="示例程序-166"><a href="#示例程序-166" class="headerlink" title="示例程序"></a>示例程序</h4><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<h5 id="示例程序操作说明"><a href="#示例程序操作说明" class="headerlink" title="示例程序操作说明"></a><strong>示例程序操作说明</strong></h5><p>当您将以下程序编译并且上传给ESP8266开发板以后，接下来您可以使用手机连接ESP8266开发板所建立的WiFi网络。该WiFi网络名称是DNSServer example（连接此网络无需密码）。</p>
<p>请打开手机的浏览器，并且在浏览器地址栏中输入“<a target="_blank" rel="noopener" href="http://www.example.com”./">www.example.com”。</a></p>
<p>输入地址后，再按下确认键。浏览器将会打开下图所示的页面。该页面正是由ESP8266开发板所建立的。</p>
<p>接下来，我将对此示例程序的基本工作流程给您做一个简单的介绍。请留意，在以下示例程序的控制下，ESP8266服务器将会扮演两个角色。第一个角色是DNS服务器，也就是本页面所要讲解的重点。第二个是网络服务器，也就是响应客户端的HTTP访问请求。</p>
<p>在以下示例程序中，我们使用了<code>dnsServer.start(DNS_PORT, &quot;www.example.com&quot;, apIP)</code>启动了DNS服务。当我们通过浏览器输入了<a target="_blank" rel="noopener" href="http://www.example.com这一网址信息并按下确认键后,浏览器将会向esp8266所建立的dns服务器发送dns服务请求./">www.example.com这一网址信息并按下确认键后，浏览器将会向ESP8266所建立的DNS服务器发送DNS服务请求。</a></p>
<p>ESP8266服务器在收到此请求后，将会通过服务器内的检索信息获取到<a target="_blank" rel="noopener" href="http://www.example.com这一网址所对应的ip地址正是esp8266服务器的ip地址.于是esp8266dns服务器将会把这一检索结果响应给浏览器./">www.example.com这一网址所对应的IP地址正是ESP8266服务器的IP地址。于是ESP8266DNS服务器将会把这一检索结果响应给浏览器。</a></p>
<p>浏览器得到了DNS服务器响应，也就是<a target="_blank" rel="noopener" href="http://www.example.com网址所对应的ip正是esp8266服务器的ip,于是浏览器将会再次向esp8266的ip地址发送http请求./">www.example.com网址所对应的IP正是ESP8266服务器的IP，于是浏览器将会再次向ESP8266的IP地址发送HTTP请求。</a></p>
<p>当ESP8266接收到浏览器客户端的HTTP访问请求后，ESP8266的网页服务器功能将会生成HTTP响应信息，并且返回给手机浏览器客户端。浏览器于是便显示出以下图片所显示的信息内容。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527202419055.png" alt="image-20230527202419055"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : dnsServer.processNextRequest()演示</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用DNSServer库来演示持续处理DNS请求服务</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>;<span class="comment">//默认设置端口为53</span></span><br><span class="line"> </span><br><span class="line">IPAddress <span class="title function_">apIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer example&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动特定域名的DNS服务器</span></span><br><span class="line">  dnsServer.start(DNS_PORT, <span class="string">&quot;www.example.com&quot;</span>, apIP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 利用简单的HTTP服务器以查看DNS服务器是否正常运行</span></span><br><span class="line">  webServer.onNotFound([]() &#123;</span><br><span class="line">    String message = <span class="string">&quot;Hello World!\n\n&quot;</span>;</span><br><span class="line">    message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">    message += webServer.uri();</span><br><span class="line"> </span><br><span class="line">    webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line">  webServer.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  dnsServer.processNextRequest();<span class="comment">//处理DNS请求服务</span></span><br><span class="line">  webServer.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="相关内容-74"><a href="#相关内容-74" class="headerlink" title="相关内容"></a>相关内容</h4><p>– stop – 停止DNS服务<br>– processNextRequest – 处理DNS请求<br>– setErrorReplyCode – 设置错误响应码<br>– setTTL – 设置TTL</p>
<h3 id="stop-–-停止DNS服务"><a href="#stop-–-停止DNS服务" class="headerlink" title="stop – 停止DNS服务"></a>stop – 停止DNS服务</h3><h4 id="说明-182"><a href="#说明-182" class="headerlink" title="说明"></a>说明</h4><p>当ESP8266模块以无线终端模式工作时，调用本函数可以关闭ESP8266模块的DNS服务。</p>
<h4 id="语法-184"><a href="#语法-184" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dnsServer.stop()</span><br></pre></td></tr></table></figure>

<h4 id="参数-177"><a href="#参数-177" class="headerlink" title="参数"></a>参数</h4><p>无</p>
<h4 id="返回值-176"><a href="#返回值-176" class="headerlink" title="返回值"></a>返回值</h4><p>返回是否成功关闭DNS服务。关闭成功返回true。返回值数据类型为布尔型</p>
<h4 id="示例程序-167"><a href="#示例程序-167" class="headerlink" title="示例程序"></a>示例程序</h4><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<h5 id="相关内容-75"><a href="#相关内容-75" class="headerlink" title="相关内容"></a>相关内容</h5><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p><strong>注意: 以下示例程序使用了softAPConfig函数对ESP8266模块进行网络配置。由于不同的WiFi路由设备的网络配置是不同的，请根据您的WiFi网络配置参数对以下示例程序中的local_IP、gateway、subnet配置进行相应修改。详情请查阅ESP8266WiFiAP库的softAPConfig页面</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">  程序名称/Program name     : dnsServer.stop();演示</span></span><br><span class="line"><span class="comment">  程序目的/Purpose          :</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">  此程序使用ESP8266DNSServer库来演示在接入点模式下关闭建立的DNS服务</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">IPAddress <span class="title function_">local_IP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">4</span>, <span class="number">1</span>)</span>; <span class="comment">//设置IP地址</span></span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">4</span>, <span class="number">1</span>)</span>; <span class="comment">//设置网关地址</span></span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>)</span>; <span class="comment">//设置子网掩码</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>; <span class="comment">//DNS服务端口号，一般为53</span></span><br><span class="line"> </span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;</span><br><span class="line">  webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;这是主页&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNext</span><span class="params">()</span> &#123;</span><br><span class="line">  webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;这是另一个页面&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//初始化串口</span></span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  <span class="comment">//初始化网络</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(local_IP, gateway, subnet);</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer example&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化DNSServer</span></span><br><span class="line">  dnsServer.start(DNS_PORT, <span class="string">&quot;dnsexample&quot;</span>, local_IP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//初始化WebServer</span></span><br><span class="line">  webServer.on(<span class="string">&quot;/&quot;</span>, handleRoot);</span><br><span class="line">  webServer.on(<span class="string">&quot;/next&quot;</span>, handleNext);</span><br><span class="line">  webServer.begin();</span><br><span class="line">  Serial.println(<span class="string">&quot;初始化测试完毕，20秒后关闭DNS服务&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;即将关闭DNS服务&quot;</span>);</span><br><span class="line">  dnsServer.stop();</span><br><span class="line">  Serial.println(<span class="string">&quot;DNS服务已关闭！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="相关内容-76"><a href="#相关内容-76" class="headerlink" title="相关内容"></a>相关内容</h4><p>– start – 启动DNS服务<br>– processNextRequest – 处理DNS请求<br>– setErrorReplyCode – 设置错误响应码<br>– setTTL – 设置TTL</p>
<h3 id="processNextRequest-–-处理DNS请求"><a href="#processNextRequest-–-处理DNS请求" class="headerlink" title="processNextRequest – 处理DNS请求"></a>processNextRequest – 处理DNS请求</h3><h4 id="说明-183"><a href="#说明-183" class="headerlink" title="说明"></a>说明</h4><p>processNextRequest函数用于处理DNS请求。当ESP8266模块收到UDP请求后，它将判断该请求是否查找域名映射的IP地址。如果是，则返回IP地址。若有错误则会返回<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/dnsserver/seterrorreplycode/">setErrorReplyCode</a>设定好的错误码。</p>
<h4 id="语法-185"><a href="#语法-185" class="headerlink" title="语法"></a>语法</h4><p>dnsServer.processNextRequest()</p>
<h4 id="参数-178"><a href="#参数-178" class="headerlink" title="参数"></a>参数</h4><p>无</p>
<h4 id="返回值-177"><a href="#返回值-177" class="headerlink" title="返回值"></a>返回值</h4><p>无</p>
<h4 id="示例程序-168"><a href="#示例程序-168" class="headerlink" title="示例程序"></a>示例程序</h4><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p><strong>示例程序操作说明</strong><br>当您将以下程序编译并且上传给ESP8266开发板以后，接下来您可以使用手机连接ESP8266开发板所建立的WiFi网络。该WiFi网络名称是DNSServer example（连接此网络无需密码）。</p>
<p>请打开手机的浏览器，并且在浏览器地址栏中输入“<a target="_blank" rel="noopener" href="http://www.example.com”./">www.example.com”。</a></p>
<p>输入地址后，再按下确认键。浏览器将会打开下图所示的页面。该页面正是由ESP8266开发板所建立的。</p>
<p>接下来，我将对此示例程序的基本工作流程给您做一个简单的介绍。请留意，在以下示例程序的控制下，ESP8266服务器将会扮演两个角色。第一个角色是DNS服务器，也就是本页面所要讲解的重点。第二个是网络服务器，也就是响应客户端的HTTP访问请求。</p>
<p>在以下示例程序中，我们使用了<code>dnsServer.start(DNS_PORT, &quot;www.example.com&quot;, apIP)</code>启动了DNS服务。当我们通过浏览器输入了<a target="_blank" rel="noopener" href="http://www.example.com这一网址信息并按下确认键后,浏览器将会向esp8266所建立的dns服务器发送dns服务请求./">www.example.com这一网址信息并按下确认键后，浏览器将会向ESP8266所建立的DNS服务器发送DNS服务请求。</a></p>
<p>ESP8266服务器在收到此请求后，将会通过服务器内的检索信息获取到<a target="_blank" rel="noopener" href="http://www.example.com这一网址所对应的ip地址正是esp8266服务器的ip地址.于是esp8266dns服务器将会把这一检索结果响应给浏览器./">www.example.com这一网址所对应的IP地址正是ESP8266服务器的IP地址。于是ESP8266DNS服务器将会把这一检索结果响应给浏览器。</a></p>
<p>浏览器得到了DNS服务器响应，也就是<a target="_blank" rel="noopener" href="http://www.example.com网址所对应的ip正是esp8266服务器的ip,于是浏览器将会再次向esp8266的ip地址发送http请求./">www.example.com网址所对应的IP正是ESP8266服务器的IP，于是浏览器将会再次向ESP8266的IP地址发送HTTP请求。</a></p>
<p>当ESP8266接收到浏览器客户端的HTTP访问请求后，ESP8266的网页服务器功能将会生成HTTP响应信息，并且返回给手机浏览器客户端。浏览器于是便显示出以下图片所显示的信息内容。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527202419055.png" alt="image-20230527202419055"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : dnsServer.processNextRequest()演示</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用DNSServer库来演示持续处理DNS请求服务</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>;<span class="comment">//默认设置端口为53</span></span><br><span class="line"> </span><br><span class="line">IPAddress <span class="title function_">apIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer example&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动特定域名的DNS服务器</span></span><br><span class="line">  dnsServer.start(DNS_PORT, <span class="string">&quot;www.example.com&quot;</span>, apIP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 利用简单的HTTP服务器以查看DNS服务器是否正常运行</span></span><br><span class="line">  webServer.onNotFound([]() &#123;</span><br><span class="line">    String message = <span class="string">&quot;Hello World!\n\n&quot;</span>;</span><br><span class="line">    message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">    message += webServer.uri();</span><br><span class="line"> </span><br><span class="line">    webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line">  webServer.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  dnsServer.processNextRequest();<span class="comment">//处理DNS请求服务</span></span><br><span class="line">  webServer.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="相关内容-77"><a href="#相关内容-77" class="headerlink" title="相关内容"></a>相关内容</h4><p>– stop – 停止DNS服务<br>– processNextRequest – 处理DNS请求<br>– setErrorReplyCode – 设置错误响应码<br>– setTTL – 设置TTL</p>
<h3 id="setErrorReplyCode-–-设置错误响应码"><a href="#setErrorReplyCode-–-设置错误响应码" class="headerlink" title="setErrorReplyCode – 设置错误响应码"></a>setErrorReplyCode – 设置错误响应码</h3><h4 id="说明-184"><a href="#说明-184" class="headerlink" title="说明"></a>说明</h4><p>当客户端发送的查询域名不在ESP8266模块建立的DNS服务器检索中，则返回setErrorReplyCode函数设置的错误代码。</p>
<h4 id="语法-186"><a href="#语法-186" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dnsServer.setErrorReplyCode(replyCode)</span><br></pre></td></tr></table></figure>

<h4 id="参数-179"><a href="#参数-179" class="headerlink" title="参数"></a>参数</h4><p>replyCode：此参数为DNS响应错误码。类型为DNSReplyCode。</p>
<p>ESP8266 – DNSServer库默认的DNS响应错误码如下</p>
<ul>
<li>NoError &#x3D; 0,&#x2F;&#x2F;DNS查询成功完成</li>
<li>FormError &#x3D; 1,&#x2F;&#x2F;DNS查询格式错误</li>
<li>ServerFailure &#x3D; 2, &#x2F;&#x2F;服务器无法完成DNS请求</li>
<li>NonExistentDomain &#x3D; 3,&#x2F;&#x2F;域名不存在</li>
<li>NotImplemented &#x3D; 4,&#x2F;&#x2F;未定义</li>
<li>Refused &#x3D; 5,&#x2F;&#x2F;服务器拒绝回答查询</li>
<li>YXDomain &#x3D; 6,&#x2F;&#x2F;名称不应该存在，但该名称确实存在</li>
<li>YXRRSet &#x3D; 7,&#x2F;&#x2F;资源记录集不存在</li>
<li>NXRRSet &#x3D; 8&#x2F;&#x2F;服务器对该区域无权</li>
</ul>
<h3 id="返回值-178"><a href="#返回值-178" class="headerlink" title="返回值"></a>返回值</h3><p>无</p>
<h3 id="示例程序-169"><a href="#示例程序-169" class="headerlink" title="示例程序"></a>示例程序</h3><p><strong>示例程序操作说明</strong><br>当您将以下程序编译并且上传给ESP8266开发板以后，接下来您可以使用手机连接ESP8266开发板所建立的WiFi网络。该WiFi网络名称是DNSServer example（连接此网络无需密码）。</p>
<p>请打开手机的浏览器，并且在浏览器地址栏中输入“<a target="_blank" rel="noopener" href="http://www.example.com”./">www.example.com”。</a></p>
<p>输入地址后，再按下确认键。浏览器将会打开下图所示的页面。该页面正是由ESP8266开发板所建立的。</p>
<p>接下来，我将对此示例程序的基本工作流程给您做一个简单的介绍。请留意，在以下示例程序的控制下，ESP8266服务器将会扮演两个角色。第一个角色是DNS服务器，也就是本页面所要讲解的重点。第二个是网络服务器，也就是响应客户端的HTTP访问请求。</p>
<p>在以下示例程序中，我们使用了<code>dnsServer.start(DNS_PORT, &quot;www.example.com&quot;, apIP)</code>启动了DNS服务。当我们通过浏览器输入了<a target="_blank" rel="noopener" href="http://www.example.com这一网址信息并按下确认键后,浏览器将会向esp8266所建立的dns服务器发送dns服务请求./">www.example.com这一网址信息并按下确认键后，浏览器将会向ESP8266所建立的DNS服务器发送DNS服务请求。</a></p>
<p>ESP8266服务器在收到此请求后，将会通过服务器内的检索信息获取到<a target="_blank" rel="noopener" href="http://www.example.com这一网址所对应的ip地址正是esp8266服务器的ip地址.于是esp8266dns服务器将会把这一检索结果响应给浏览器./">www.example.com这一网址所对应的IP地址正是ESP8266服务器的IP地址。于是ESP8266DNS服务器将会把这一检索结果响应给浏览器。</a></p>
<p>浏览器得到了DNS服务器响应，也就是<a target="_blank" rel="noopener" href="http://www.example.com网址所对应的ip正是esp8266服务器的ip,于是浏览器将会再次向esp8266的ip地址发送http请求./">www.example.com网址所对应的IP正是ESP8266服务器的IP，于是浏览器将会再次向ESP8266的IP地址发送HTTP请求。</a></p>
<p>当ESP8266接收到浏览器客户端的HTTP访问请求后，ESP8266的网页服务器功能将会生成HTTP响应信息，并且返回给手机浏览器客户端。浏览器于是便显示出以下图片所显示的信息内容。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527202419055.png" alt="image-20230527202419055"></p>
<p><strong>在以下示例程序中：当客户端发送的查询域名不在DNS服务器检索中，则返回以下语句所设置的错误代码。<code>dnsServer.setErrorReplyCode(DNSReplyCode::ServerFailure);</code>。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : dnsServer.setErrorReplyCode();演示</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用DNSServer库来演示设置错误响应码</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>;<span class="comment">//默认设置端口为53</span></span><br><span class="line">IPAddress <span class="title function_">apIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer example&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置TTL值（单位：秒）</span></span><br><span class="line">  dnsServer.setTTL(<span class="number">300</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//当客户端发送的查询域名不在DNS服务器检索中，则返回以下语句所设置的错误代码。</span></span><br><span class="line">  dnsServer.setErrorReplyCode(DNSReplyCode::ServerFailure);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动特定域名的DNS服务器</span></span><br><span class="line">  dnsServer.start(DNS_PORT, <span class="string">&quot;www.example.com&quot;</span>, apIP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 利用简单的HTTP服务器以查看DNS服务器是否正常运行</span></span><br><span class="line">  webServer.onNotFound([]() &#123;</span><br><span class="line">    String message = <span class="string">&quot;Hello World!\n\n&quot;</span>;</span><br><span class="line">    message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">    message += webServer.uri();</span><br><span class="line"> </span><br><span class="line">    webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line">  webServer.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  dnsServer.processNextRequest();<span class="comment">//持续监听</span></span><br><span class="line">  webServer.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="相关内容-78"><a href="#相关内容-78" class="headerlink" title="相关内容"></a>相关内容</h4><p>– start – 启动DNS服务<br>– stop – 停止DNS服务<br>– processNextRequest – 处理DNS请求<br>– setTTL – 设置TTL</p>
<h3 id="setTTL-–-设置TTL"><a href="#setTTL-–-设置TTL" class="headerlink" title="setTTL – 设置TTL"></a>setTTL – 设置TTL</h3><h4 id="说明-185"><a href="#说明-185" class="headerlink" title="说明"></a>说明</h4><p>此函数用于设置ESP8266模块DNS服务的TTL值。</p>
<p>通过增大TTL值，可以减少DNS递归查询过程，达到提升域名解析速度的效果。反之，通过缩小 TTL 值，以减少更换空间IP地址时造成的不可访问时间，减小空间IP地址造成的访问空窗期。根据不同应用场景和网络需求可以选择合适的TTL值达成更好的访问体验</p>
<h4 id="语法-187"><a href="#语法-187" class="headerlink" title="语法"></a>语法</h4><p>setTTL(TTLval)</p>
<h4 id="参数-180"><a href="#参数-180" class="headerlink" title="参数"></a>参数</h4><p>TTLval: 设置TTL数值(单位：秒)</p>
<h4 id="返回值-179"><a href="#返回值-179" class="headerlink" title="返回值"></a>返回值</h4><p>无</p>
<h4 id="示例程序-170"><a href="#示例程序-170" class="headerlink" title="示例程序"></a>示例程序</h4><p>关于本函数的具体使用方法，请参考以下代码，尤其是代码中高亮的语句部分。</p>
<p><strong>示例程序操作说明</strong><br>当您将以下程序编译并且上传给ESP8266开发板以后，接下来您可以使用手机连接ESP8266开发板所建立的WiFi网络。该WiFi网络名称是DNSServer example（连接此网络无需密码）。</p>
<p>请打开手机的浏览器，并且在浏览器地址栏中输入“<a target="_blank" rel="noopener" href="http://www.example.com”./">www.example.com”。</a></p>
<p>输入地址后，再按下确认键。浏览器将会打开下图所示的页面。该页面正是由ESP8266开发板所建立的。</p>
<p>接下来，我将对此示例程序的基本工作流程给您做一个简单的介绍。请留意，在以下示例程序的控制下，ESP8266服务器将会扮演两个角色。第一个角色是DNS服务器，也就是本页面所要讲解的重点。第二个是网络服务器，也就是响应客户端的HTTP访问请求。</p>
<p>在以下示例程序中，我们使用了<code>dnsServer.start(DNS_PORT, &quot;www.example.com&quot;, apIP)</code>启动了DNS服务。当我们通过浏览器输入了<a target="_blank" rel="noopener" href="http://www.example.com这一网址信息并按下确认键后,浏览器将会向esp8266所建立的dns服务器发送dns服务请求./">www.example.com这一网址信息并按下确认键后，浏览器将会向ESP8266所建立的DNS服务器发送DNS服务请求。</a></p>
<p>ESP8266服务器在收到此请求后，将会通过服务器内的检索信息获取到<a target="_blank" rel="noopener" href="http://www.example.com这一网址所对应的ip地址正是esp8266服务器的ip地址.于是esp8266dns服务器将会把这一检索结果响应给浏览器./">www.example.com这一网址所对应的IP地址正是ESP8266服务器的IP地址。于是ESP8266DNS服务器将会把这一检索结果响应给浏览器。</a></p>
<p>浏览器得到了DNS服务器响应，也就是<a target="_blank" rel="noopener" href="http://www.example.com网址所对应的ip正是esp8266服务器的ip,于是浏览器将会再次向esp8266的ip地址发送http请求./">www.example.com网址所对应的IP正是ESP8266服务器的IP，于是浏览器将会再次向ESP8266的IP地址发送HTTP请求。</a></p>
<p>当ESP8266接收到浏览器客户端的HTTP访问请求后，ESP8266的网页服务器功能将会生成HTTP响应信息，并且返回给手机浏览器客户端。浏览器于是便显示出以下图片所显示的信息内容。</p>
<p><img src="/./Image/ESP8266.assets/image-20230527202419055.png" alt="image-20230527202419055"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : dnsServer.setErrorReplyCode();演示</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">此程序使用DNSServer库来演示设置错误响应码</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>;<span class="comment">//默认设置端口为53</span></span><br><span class="line">IPAddress <span class="title function_">apIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer example&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 设置DNS服务的TTL数值为300</span></span><br><span class="line">  dnsServer.setTTL(<span class="number">300</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动特定域名的DNS服务器</span></span><br><span class="line">  dnsServer.start(DNS_PORT, <span class="string">&quot;www.example.com&quot;</span>, apIP);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 利用简单的HTTP服务器以查看DNS服务器是否正常运行</span></span><br><span class="line">  webServer.onNotFound([]() &#123;</span><br><span class="line">    String message = <span class="string">&quot;Hello World!\n\n&quot;</span>;</span><br><span class="line">    message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">    message += webServer.uri();</span><br><span class="line"> </span><br><span class="line">    webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line">  webServer.begin();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  dnsServer.processNextRequest();<span class="comment">//持续监听</span></span><br><span class="line">  webServer.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="相关内容-79"><a href="#相关内容-79" class="headerlink" title="相关内容"></a>相关内容</h4><p>– start – 启动DNS服务<br>– stop – 停止DNS服务<br>– processNextRequest – 处理DNS请求<br>– setErrorReplyCode – 设置错误响应码</p>
<h2 id="ESP8266多任务处理-–-Ticker库使用说明"><a href="#ESP8266多任务处理-–-Ticker库使用说明" class="headerlink" title="ESP8266多任务处理 – Ticker库使用说明"></a>ESP8266多任务处理 – Ticker库使用说明</h2><p>ESP8266在运行过程中，只能一条线式的依次执行任务。但是我们在开发物联网项目时，可能需要ESP8266在执行某一任务的过程中，还能处理其它任务。比如，我们使用ESP8266来控制电机运行的同时，还需要定时检查某一个引脚上连接按钮有没有被用户按下。</p>
<p>为了解决以上问题，我们可以使用Ticker库来解决这一问题。下面我们来通过一系列示例程序向您讲解Ticker库的使用方法。</p>
<h3 id="示例1-Ticker库基本操作"><a href="#示例1-Ticker库基本操作" class="headerlink" title="示例1. Ticker库基本操作"></a>示例1. Ticker库基本操作</h3><p>利用Ticker库，我们可以让ESP8266定时调用某一个函数。通过以下示例程序我们可以看到，ESP8266将会每隔一秒钟通过串口监视器输出一次信息。我们是通过语句<code>ticker.attach(1, sayHi)</code>来实现这一操作的。</p>
<p>该语句中的attach函数有两个参数。第一个参数可控制调用函数的时间间隔，单位是秒。这里的数字1说明ESP8266将会每隔一秒钟调用一次函数。那么具体调用哪一个函数呢？这个函数名称正是是通过第二个参数来限定的。也就是名称为sayHi的函数。该函数将会让ESP8266定时通过串口监视器输出一次信息。信息内容是“Hi”后面跟一个数值。这个数值是为了标注sayHi函数被调用了多少次。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : a_basic_tinker</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序旨在演示如何使用Ticker库来定时执行操作。 </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">Ticker ticker;<span class="comment">// 建立Ticker用于实现定时功能</span></span><br><span class="line"><span class="type">int</span> count;    <span class="comment">// 计数用变量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 每隔一秒钟调用sayHi函数一次，attach函数的第一个参数</span></span><br><span class="line">  <span class="comment">// 是控制定时间隔的变量。该参数的单位为秒。第二个参数是</span></span><br><span class="line">  <span class="comment">// 定时执行的函数名称。</span></span><br><span class="line">  ticker.attach(<span class="number">1</span>, sayHi);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 用LED呼吸灯效果来演示在Tinker对象控制下，ESP8266可以定时</span></span><br><span class="line">  <span class="comment">// 执行其它任务</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">0</span> ; fadeValue &lt;= <span class="number">1023</span>; fadeValue += <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">1023</span> ; fadeValue &gt;= <span class="number">0</span>; fadeValue -= <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 在Tinker对象控制下，此函数将会定时执行。</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sayHi</span><span class="params">()</span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">  Serial.print(<span class="string">&quot;Hi &quot;</span>);</span><br><span class="line">  Serial.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="示例2-停止定时执行函数"><a href="#示例2-停止定时执行函数" class="headerlink" title="示例2. 停止定时执行函数"></a>示例2. 停止定时执行函数</h3><p>当Ticker定时调用某一函数执行到一定次数后，我们可以使用detach函数来停止定时调用函数。以下示例程序中的语句<code>ticker.detach()</code>将会让ticker对象停止调用函数。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : b_detach</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序旨在演示如何停止Ticker库定时调用函数。</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">Ticker ticker;<span class="comment">// 建立Ticker用于实现定时功能</span></span><br><span class="line"><span class="type">int</span> count;    <span class="comment">// 计数用变量</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 每隔一秒钟调用sayHi函数一次</span></span><br><span class="line">  ticker.attach(<span class="number">1</span>, sayHi);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// 用LED呼吸灯效果来演示在Tinker对象控制下，ESP8266可以定时</span></span><br><span class="line">  <span class="comment">// 执行其它任务  </span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">0</span> ; fadeValue &lt;= <span class="number">1023</span>; fadeValue += <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">1023</span> ; fadeValue &gt;= <span class="number">0</span>; fadeValue -= <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 在Tinker对象控制下，此函数将会定时执行。</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sayHi</span><span class="params">()</span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">  Serial.print(<span class="string">&quot;Hi &quot;</span>);</span><br><span class="line">  Serial.println(count);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当定时调用了6次后，停止定时调用函数</span></span><br><span class="line">  <span class="keyword">if</span> (count &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">    ticker.detach();  <span class="comment">// 使用detach来停止ticker对象定时调用函数</span></span><br><span class="line">    Serial.print(<span class="string">&quot;ticker.detach()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="示例3-向定时调用函数传递参数"><a href="#示例3-向定时调用函数传递参数" class="headerlink" title="示例3. 向定时调用函数传递参数"></a>示例3. 向定时调用函数传递参数</h3><p>我们可以向Ticker库定时调用的函数来传递参数。不过要注意的是，传递参数的数量只能时一个。如下示例程序所示，语句<code>ticker.attach(1, sayHi, 8)</code>有3个参数。其中第三个参数就是向定时调用的sayHi函数所传递的参数。</p>
<p><strong>请注意：attach函数所能传递的参数最多只有一个。另外该参数仅能是以下类型中的一种：char, short, int, float, void*, char*。</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : c_parameter</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序旨在演示如何向Ticker库定时调用函数来传递参数。</span></span><br><span class="line"><span class="comment">请注意：attach函数所能传递的参数最多只有一个。</span></span><br><span class="line"><span class="comment">另外该参数仅能是这些类型中的一种：char, short, int, float, void*, char*</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">Ticker ticker;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  </span><br><span class="line">  ticker.attach(<span class="number">1</span>, sayHi, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">0</span> ; fadeValue &lt;= <span class="number">1023</span>; fadeValue += <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">1023</span> ; fadeValue &gt;= <span class="number">0</span>; fadeValue -= <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">sayHi</span><span class="params">(<span class="type">int</span> hiTimes)</span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">  Serial.print(<span class="string">&quot;Hi &quot;</span>);</span><br><span class="line">  Serial.println(count);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (count &gt;= hiTimes) &#123;</span><br><span class="line">    ticker.detach();</span><br><span class="line">    Serial.print(<span class="string">&quot;ticker.detach();&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="示例4-利用多个Ticker对象让ESP8266处理多任务"><a href="#示例4-利用多个Ticker对象让ESP8266处理多任务" class="headerlink" title="示例4. 利用多个Ticker对象让ESP8266处理多任务"></a>示例4. 利用多个Ticker对象让ESP8266处理多任务</h3><p>我们可以建立多个Ticker对象。让多个Ticker对象来实现ESP8266的多任务处理。如下实例程序所示，我们通过语句<code>Ticker buttonTicker;</code>来建立第二个Ticker对象。</p>
<p>接下来我们使用<code>buttonTicker.attach_ms(100, buttonCheck)</code>来实现第二个Ticker对象的任务处理。这里我们使用了attach_ms函数，该函数与attach函数功能相似，唯一区别是。attach函数的时间单位是秒，而attach_ms的时间单位是毫秒。也就是说，这条语句将会让ESP8266每隔100毫秒执行一次buttonCheck函数。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">程序名称/Program name     : d_multi_ms</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序旨在演示如何使用多个Ticker对象来让ESP8266处理多个任务。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">Ticker ticker;</span><br><span class="line">Ticker buttonTicker;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  pinMode(D3, INPUT_PULLUP);</span><br><span class="line">  </span><br><span class="line">  ticker.attach(<span class="number">1</span>, sayHi, <span class="number">60</span>);</span><br><span class="line">  buttonTicker.attach_ms(<span class="number">100</span>, buttonCheck);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">0</span> ; fadeValue &lt;= <span class="number">1023</span>; fadeValue += <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> fadeValue = <span class="number">1023</span> ; fadeValue &gt;= <span class="number">0</span>; fadeValue -= <span class="number">5</span>) &#123;</span><br><span class="line">    analogWrite(LED_BUILTIN, fadeValue);</span><br><span class="line">    delay(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">sayHi</span><span class="params">(<span class="type">int</span> hiTimes)</span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">  Serial.print(<span class="string">&quot;Hi &quot;</span>);</span><br><span class="line">  Serial.println(count);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (count &gt;= hiTimes) &#123;</span><br><span class="line">    ticker.detach();</span><br><span class="line">    Serial.print(<span class="string">&quot;ticker.detach();&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">buttonCheck</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (digitalRead(D3) == LOW)&#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;D3 Button Pushed...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="示例5-使用”计数器”来控制ESP8266定时执行较复杂的函数"><a href="#示例5-使用”计数器”来控制ESP8266定时执行较复杂的函数" class="headerlink" title="示例5. 使用”计数器”来控制ESP8266定时执行较复杂的函数"></a>示例5. 使用”计数器”来控制ESP8266定时执行较复杂的函数</h3><p>Ticker定时调用的函数必须要“短小精悍”。比如以上一系列的示例程序中，我们仅仅让Ticker定时调用函数执行简单的串口数据输出，以及很基本的运算。事实上，在使用Ticker库时，定时调用函数必须要很快的执行完毕。否则会产生难以预料的问题。</p>
<p>这就产生了一个问题。假如我们需要ESP8266定时执行的操作较为复杂，这该如何是好呢？</p>
<p>假设我们让ESP8266定时向example.com网站服务器发送一个http请求，并且将服务器响应通过串口监视器显示出来。（如您对这一操作尚不了解，<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/">请参考《零基础入门学用物联网教程》第3-4-1节中的示例1</a>。）</p>
<p>这个问题的答案就在以下示例程序中。在这段示例程序里，我们建立了一个计数变量count。在程序的第55到第59行中，Ticker定时调用的函数tickerCount仅仅对count变量进行自加。</p>
<p>当计数变量count达到我们需要的数值后，则让ESP8266执行较为复杂的函数。这一点是通过程序的第49到52行逻辑判断语句所实现的。</p>
<p>请注意，在每一次执行完操作后，我们都需要对count变量进行清零。否则程序将无法定时通过互联网向服务器发送请求。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : e_timer_http</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : CYNO朔</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200703</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序旨在演示如何使用计数器来控制ESP8266定时执行较复杂的函数。Ticker定时调用的函数必须要“短小精悍”。</span></span><br><span class="line"><span class="comment">而不能是复杂且占用时间较长的函数。对于较为复杂的函数，我们可以使用计数器的方法来实现。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">本程序将会定时让ESP8266向example网络服务器发送请求，并且将服务器响应信息显示在屏幕中。</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">如需了解本程序的详细说明，请参考以下函数：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-tips/tinker/</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">其它说明 / Other Description：</span></span><br><span class="line"><span class="comment">本程序为太极创客团队制作的免费视频教程《零基础入门学用物联网 》中一部分。该教程系统的</span></span><br><span class="line"><span class="comment">向您讲述ESP8266的物联网应用相关的软件和硬件知识。以下是该教程目录页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/                    </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> URL <span class="string">&quot;http://www.example.com&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichimaker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"> </span><br><span class="line">Ticker ticker;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//连接WiFi</span></span><br><span class="line">  connectWifi();</span><br><span class="line"> </span><br><span class="line">  ticker.attach(<span class="number">1</span>, tickerCount);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;  </span><br><span class="line">  <span class="keyword">if</span> (count &gt;= <span class="number">5</span>)&#123;   </span><br><span class="line">    httpRequest();</span><br><span class="line">    count = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">tickerCount</span><span class="params">()</span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">  Serial.print(<span class="string">&quot;count = &quot;</span>);</span><br><span class="line">  Serial.println(count);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发送HTTP请求并且将服务器响应通过串口输出</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">httpRequest</span><span class="params">()</span>&#123;</span><br><span class="line">  HTTPClient httpClient;</span><br><span class="line"> </span><br><span class="line">  httpClient.begin(URL); </span><br><span class="line">  Serial.print(<span class="string">&quot;URL: &quot;</span>); Serial.println(URL);</span><br><span class="line"> </span><br><span class="line">  <span class="type">int</span> httpCode = httpClient.GET();</span><br><span class="line">  Serial.print(<span class="string">&quot;Send GET request to URL: &quot;</span>);</span><br><span class="line">  Serial.println(URL);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    <span class="comment">// 使用getString函数获取服务器响应体内容</span></span><br><span class="line">    String responsePayload = httpClient.getString();</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Response Payload: &quot;</span>);</span><br><span class="line">    Serial.println(responsePayload);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Server Respose Code：&quot;</span>);</span><br><span class="line">    Serial.println(httpCode);</span><br><span class="line">  &#125;</span><br><span class="line">  httpClient.end();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">connectWifi</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//开始连接wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,连接成功打印IP</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">1000</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;WiFi Connected!&quot;</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://chaoqijiang.github.io">棨</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://chaoqijiang.github.io/2023/06/07/ESP8266%E5%BC%80%E5%8F%91%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99_%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">https://chaoqijiang.github.io/2023/06/07/ESP8266开发参考资料_第三方库使用说明/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://chaoqijiang.github.io" target="_blank">柊</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/protected/">protected</a><a class="post-meta__tags" href="/tags/ESP8266/">ESP8266</a></div><div class="post-share"><div class="social-share" data-image="/Image/avatar.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/06/07/ESP8266%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99/" title="ESP8266相关资料"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">ESP8266相关资料</div></div><div class="info-2"><div class="info-item-1">ESP8266相关资料</div></div></div></a><a class="pagination-related" href="/2023/06/18/%E9%AB%98%E9%80%9A410%E9%9A%8F%E8%BA%ABwifi%E5%88%B7%E6%9C%BA%E6%95%99%E7%A8%8B/" title="高通410随身wifi刷机教程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">高通410随身wifi刷机教程</div></div><div class="info-2"><div class="info-item-1">高通410随身wifi刷机教程，适用于基于高通410的cpu随身wifi。(部分教程已经过期，仅供参考)</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/06/07/ESP8266%E5%BC%95%E8%84%9A%E8%AF%B4%E6%98%8E/" title="ESP8266引脚说明"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-07</div><div class="info-item-2">ESP8266引脚说明</div></div><div class="info-2"><div class="info-item-1">ESP8266引脚说明</div></div></div></a><a class="pagination-related" href="/2023/06/07/ESP8266%E7%9B%B8%E5%85%B3%E6%A1%88%E4%BE%8B%E7%AC%94%E8%AE%B0/" title="ESP8266相关案例笔记"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-07</div><div class="info-item-2">ESP8266相关案例笔记</div></div><div class="info-2"><div class="info-item-1">ESP8266相关案例笔记</div></div></div></a><a class="pagination-related" href="/2023/06/07/ESP8266%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99/" title="ESP8266相关资料"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-07</div><div class="info-item-2">ESP8266相关资料</div></div><div class="info-2"><div class="info-item-1">ESP8266相关资料</div></div></div></a><a class="pagination-related" href="/2023/11/26/MC010%E6%99%BA%E8%83%BD%E6%8F%92%E5%BA%A7%E6%A0%B8%E5%BF%83%E6%8E%A7%E5%88%B6%E6%9D%BF%E5%BC%95%E8%84%9A%E5%AE%9A%E4%B9%89/" title="MC010智能插座核心控制板引脚定义"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="info-item-2">MC010智能插座核心控制板引脚定义</div></div><div class="info-2"><div class="info-item-1">MC010智能插座核心控制板引脚定义</div></div></div></a><a class="pagination-related" href="/2024/03/29/WiFiDuck_%E4%BF%AE%E6%94%B9%E6%88%90%E4%B8%BA%E8%BF%9E%E6%8E%A5%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9A%84WiFi/" title="WiFiDuck_修改成为连接到指定的WiFi"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-29</div><div class="info-item-2">WiFiDuck_修改成为连接到指定的WiFi</div></div><div class="info-2"><div class="info-item-1">WiFiDuck_修改成为连接到指定的WiFi</div></div></div></a><a class="pagination-related" href="/2023/12/11/%E9%A1%B9%E7%9B%AE%E6%80%9D%E8%B7%AF_%E8%BF%9C%E7%A8%8B%E9%94%AE%E7%9B%98/" title="项目思路_远程（WIFI）键盘"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-11</div><div class="info-item-2">项目思路_远程（WIFI）键盘</div></div><div class="info-2"><div class="info-item-1">AI提示词，用于根据提示信息生成对应的试题，帮助学习者检验理解深度。</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/Image/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">棨</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">58</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:chaoqijiang@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.</span> <span class="toc-text">开发参考资料</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-Arduino%E5%BA%93-%E6%80%BB%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">ESP8266-Arduino库 总览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.1.</span> <span class="toc-text">网络功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">工作模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%BD%91"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">联网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E8%81%94%E7%BD%91%E9%80%9A%E8%AE%AF"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">物联网通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#TCP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.3.1.</span> <span class="toc-text">TCP协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.3.2.</span> <span class="toc-text">HTTP协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTPS%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.3.3.</span> <span class="toc-text">HTTPS协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UDP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.3.4.</span> <span class="toc-text">UDP协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DNS%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.3.5.</span> <span class="toc-text">DNS协议</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">其它部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ESP8266%E5%BA%93%E7%BD%91%E7%BB%9C%E5%8A%9F%E8%83%BD%E5%85%B6%E5%AE%83%E9%83%A8%E5%88%86%E5%90%84%E5%BA%93%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">ESP8266库网络功能其它部分各库简介</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%BD%91%E7%BB%9C%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.2.</span> <span class="toc-text">非网络功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E6%8E%A7%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">时控部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">哈希部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%82%A8%E5%AD%98%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">数据储存部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%AE%AF%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">通讯部分</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SPI"><span class="toc-number">1.1.2.4.1.</span> <span class="toc-text">SPI</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#I2C"><span class="toc-number">1.1.2.4.2.</span> <span class="toc-text">I2C</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%B2%E8%A1%8C%E9%80%9A%E8%AE%AF"><span class="toc-number">1.1.2.4.3.</span> <span class="toc-text">串行通讯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%B5%E6%9C%BA%E6%8E%A7%E5%88%B6%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.4.4.</span> <span class="toc-text">电机控制部分</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%B1%8F%E6%8E%A7%E5%88%B6%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.4.5.</span> <span class="toc-text">显示屏控制部分</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E9%83%A8%E5%88%86-1"><span class="toc-number">1.1.2.4.6.</span> <span class="toc-text">其它部分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTA%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.3.</span> <span class="toc-text">OTA功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266WiFiAP%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">ESP8266WiFiAP库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">管理类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#softAP"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">softAP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.2.1.1.4.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPConfig"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">softAPConfig</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-1"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-1"><span class="toc-number">1.2.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">1.2.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-1"><span class="toc-number">1.2.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPDisconnect"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">softAPDisconnect</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-2"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-2"><span class="toc-number">1.2.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-1"><span class="toc-number">1.2.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-2"><span class="toc-number">1.2.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPIP"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">softAPIP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-3"><span class="toc-number">1.2.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-3"><span class="toc-number">1.2.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-3"><span class="toc-number">1.2.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-2"><span class="toc-number">1.2.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-3"><span class="toc-number">1.2.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPmacAddress"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">softAPmacAddress</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-4"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-4"><span class="toc-number">1.2.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">1.2.2.2.3.</span> <span class="toc-text">参数 &#x2F; 返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-4"><span class="toc-number">1.2.2.2.4.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPSSID"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">softAPSSID</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-5"><span class="toc-number">1.2.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-5"><span class="toc-number">1.2.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-4"><span class="toc-number">1.2.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-3"><span class="toc-number">1.2.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-5"><span class="toc-number">1.2.2.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPPSK"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">softAPPSK</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-6"><span class="toc-number">1.2.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-6"><span class="toc-number">1.2.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-5"><span class="toc-number">1.2.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-4"><span class="toc-number">1.2.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-6"><span class="toc-number">1.2.2.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#softAPGetStationNum"><span class="toc-number">1.2.2.5.</span> <span class="toc-text">softAPGetStationNum</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-7"><span class="toc-number">1.2.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-7"><span class="toc-number">1.2.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-6"><span class="toc-number">1.2.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-5"><span class="toc-number">1.2.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-7"><span class="toc-number">1.2.2.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266WiFiSTA%E5%BA%93"><span class="toc-number">1.3.</span> <span class="toc-text">ESP8266WiFiSTA库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">管理类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#begin-%E2%80%93-%E8%BF%9E%E6%8E%A5WiFi"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">begin – 连接WiFi</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-8"><span class="toc-number">1.3.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-8"><span class="toc-number">1.3.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-7"><span class="toc-number">1.3.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-6"><span class="toc-number">1.3.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-8"><span class="toc-number">1.3.1.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config-%E2%80%93-%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%EF%BC%88%E5%A6%82-IP%E5%9C%B0%E5%9D%80%EF%BC%8C%E7%BD%91%E5%85%B3IP%E7%AD%89%EF%BC%89"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">config – 配置网络（如,IP地址，网关IP等）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-9"><span class="toc-number">1.3.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-9"><span class="toc-number">1.3.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-8"><span class="toc-number">1.3.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-7"><span class="toc-number">1.3.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-9"><span class="toc-number">1.3.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reconnect-%E2%80%93-%E9%87%8D%E6%96%B0%E8%BF%9E%E6%8E%A5WiFi"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">reconnect – 重新连接WiFi</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-10"><span class="toc-number">1.3.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-10"><span class="toc-number">1.3.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-9"><span class="toc-number">1.3.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-8"><span class="toc-number">1.3.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-10"><span class="toc-number">1.3.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disconnect-%E2%80%93-%E6%96%AD%E5%BC%80WiFi%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">disconnect – 断开WiFi连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-11"><span class="toc-number">1.3.1.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-11"><span class="toc-number">1.3.1.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-10"><span class="toc-number">1.3.1.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-9"><span class="toc-number">1.3.1.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-11"><span class="toc-number">1.3.1.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setAutoConnect-%E2%80%93-%E8%AE%BE%E7%BD%AE%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5WiFi"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">setAutoConnect – 设置是否自动连接WiFi</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-12"><span class="toc-number">1.3.1.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-12"><span class="toc-number">1.3.1.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-11"><span class="toc-number">1.3.1.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-10"><span class="toc-number">1.3.1.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-12"><span class="toc-number">1.3.1.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setAutoReconnect-%E2%80%93-%E8%AE%BE%E7%BD%AE%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E9%87%8D%E6%96%B0%E8%BF%9E%E6%8E%A5WiFi"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">setAutoReconnect – 设置是否自动重新连接WiFi</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-13"><span class="toc-number">1.3.1.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-13"><span class="toc-number">1.3.1.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-12"><span class="toc-number">1.3.1.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-11"><span class="toc-number">1.3.1.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-13"><span class="toc-number">1.3.1.6.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#waitForConnectResult-%E2%80%93-%E7%AD%89%E5%BE%85WiFi%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.1.7.</span> <span class="toc-text">waitForConnectResult – 等待WiFi连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-14"><span class="toc-number">1.3.1.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-14"><span class="toc-number">1.3.1.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-13"><span class="toc-number">1.3.1.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-12"><span class="toc-number">1.3.1.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-14"><span class="toc-number">1.3.1.7.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#status-%E2%80%93-%E8%8E%B7%E5%8F%96WiFi%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">status – 获取WiFi连接状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-15"><span class="toc-number">1.3.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-15"><span class="toc-number">1.3.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-14"><span class="toc-number">1.3.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-13"><span class="toc-number">1.3.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-15"><span class="toc-number">1.3.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSID-%E2%80%93-%E8%8E%B7%E5%8F%96SSID"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">SSID – 获取SSID</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-16"><span class="toc-number">1.3.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-16"><span class="toc-number">1.3.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-15"><span class="toc-number">1.3.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-14"><span class="toc-number">1.3.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-16"><span class="toc-number">1.3.2.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#psk-%E2%80%93-%E8%8E%B7%E5%8F%96psk"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">psk – 获取psk</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-17"><span class="toc-number">1.3.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-17"><span class="toc-number">1.3.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-16"><span class="toc-number">1.3.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-15"><span class="toc-number">1.3.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-17"><span class="toc-number">1.3.2.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BSSIDstr-%E2%80%93-%E8%8E%B7%E5%8F%96WiFi%E6%8E%A5%E5%85%A5%E7%82%B9%E7%9A%84mac%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">BSSIDstr – 获取WiFi接入点的mac地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-18"><span class="toc-number">1.3.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-18"><span class="toc-number">1.3.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-17"><span class="toc-number">1.3.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-16"><span class="toc-number">1.3.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-18"><span class="toc-number">1.3.2.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#localIP-%E2%80%93-%E8%8E%B7%E5%8F%96IP%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">localIP – 获取IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-19"><span class="toc-number">1.3.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-19"><span class="toc-number">1.3.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-18"><span class="toc-number">1.3.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-17"><span class="toc-number">1.3.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-19"><span class="toc-number">1.3.2.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#subnetMask-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">subnetMask – 获取子网掩码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-20"><span class="toc-number">1.3.2.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-20"><span class="toc-number">1.3.2.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-19"><span class="toc-number">1.3.2.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-18"><span class="toc-number">1.3.2.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-20"><span class="toc-number">1.3.2.6.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gatewayIP-%E2%80%93-%E8%8E%B7%E5%8F%96%E7%BD%91%E5%85%B3%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">gatewayIP – 获取网关地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-21"><span class="toc-number">1.3.2.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-21"><span class="toc-number">1.3.2.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-20"><span class="toc-number">1.3.2.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-19"><span class="toc-number">1.3.2.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-21"><span class="toc-number">1.3.2.7.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dnsIP-%E2%80%93-%E8%8E%B7%E5%8F%96DNS%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.2.8.</span> <span class="toc-text">dnsIP – 获取DNS地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-22"><span class="toc-number">1.3.2.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-22"><span class="toc-number">1.3.2.8.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-21"><span class="toc-number">1.3.2.8.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-20"><span class="toc-number">1.3.2.8.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-22"><span class="toc-number">1.3.2.8.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#macAddress-%E2%80%93-%E8%8E%B7%E5%8F%96mac%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.2.9.</span> <span class="toc-text">macAddress – 获取mac地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-23"><span class="toc-number">1.3.2.9.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-23"><span class="toc-number">1.3.2.9.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-22"><span class="toc-number">1.3.2.9.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-21"><span class="toc-number">1.3.2.9.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-23"><span class="toc-number">1.3.2.9.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hostname-%E2%80%93-%E8%8E%B7%E5%8F%96-%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">1.3.2.10.</span> <span class="toc-text">hostname – 获取&#x2F;设置主机名</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-24"><span class="toc-number">1.3.2.10.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-24"><span class="toc-number">1.3.2.10.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-23"><span class="toc-number">1.3.2.10.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-22"><span class="toc-number">1.3.2.10.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-24"><span class="toc-number">1.3.2.10.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#isConnected-%E2%80%93-%E8%8E%B7%E5%8F%96WiFi%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.2.11.</span> <span class="toc-text">isConnected – 获取WiFi连接状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-25"><span class="toc-number">1.3.2.11.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-25"><span class="toc-number">1.3.2.11.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-24"><span class="toc-number">1.3.2.11.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-23"><span class="toc-number">1.3.2.11.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-25"><span class="toc-number">1.3.2.11.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getAutoConnect-%E2%80%93-%E8%8E%B7%E5%8F%96%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5WiFi%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.3.2.12.</span> <span class="toc-text">getAutoConnect – 获取自动连接WiFi设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-26"><span class="toc-number">1.3.2.12.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-26"><span class="toc-number">1.3.2.12.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-25"><span class="toc-number">1.3.2.12.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-24"><span class="toc-number">1.3.2.12.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-26"><span class="toc-number">1.3.2.12.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RSSI-%E2%80%93-%E8%8E%B7%E5%8F%96WiFi%E4%BF%A1%E5%8F%B7%E5%BC%BA%E5%BA%A6"><span class="toc-number">1.3.2.13.</span> <span class="toc-text">RSSI – 获取WiFi信号强度</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-27"><span class="toc-number">1.3.2.13.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-27"><span class="toc-number">1.3.2.13.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-26"><span class="toc-number">1.3.2.13.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-25"><span class="toc-number">1.3.2.13.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-27"><span class="toc-number">1.3.2.13.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-ESP8266WiFiGeneric%E5%BA%93"><span class="toc-number">1.4.</span> <span class="toc-text">ESP8266 – ESP8266WiFiGeneric库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WiFi%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">WiFi事件类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%85%A5%E7%82%B9%E6%A8%A1%E5%BC%8F%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">接入点模式事件类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#onSoftAPModeStationConnected-%E2%80%93-%E6%9C%89%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%88%B0%E6%8E%A5%E5%85%A5%E7%82%B9"><span class="toc-number">1.4.1.1.1.</span> <span class="toc-text">onSoftAPModeStationConnected – 有无线终端连接到接入点</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-28"><span class="toc-number">1.4.1.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-28"><span class="toc-number">1.4.1.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-27"><span class="toc-number">1.4.1.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-26"><span class="toc-number">1.4.1.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.1.1.1.5.</span> <span class="toc-text">示例代码</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onSoftAPModeStationDisconnected-%E2%80%93-%E6%9C%89%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%96%AD%E5%BC%80%E4%B8%8E%E6%8E%A5%E5%85%A5%E7%82%B9%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.1.1.2.</span> <span class="toc-text">onSoftAPModeStationDisconnected – 有无线终端断开与接入点的连接</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-29"><span class="toc-number">1.4.1.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-29"><span class="toc-number">1.4.1.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-28"><span class="toc-number">1.4.1.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-27"><span class="toc-number">1.4.1.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-28"><span class="toc-number">1.4.1.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onSoftAPModeProbeRequestReceived-%E2%80%93-%E6%8E%A5%E5%85%A5%E7%82%B9%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%94%B6%E5%88%B0%E6%8E%A2%E9%92%88%E8%AF%B7%E6%B1%82"><span class="toc-number">1.4.1.1.3.</span> <span class="toc-text">onSoftAPModeProbeRequestReceived – 接入点模式下收到探针请求</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-30"><span class="toc-number">1.4.1.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-30"><span class="toc-number">1.4.1.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-29"><span class="toc-number">1.4.1.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-28"><span class="toc-number">1.4.1.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-29"><span class="toc-number">1.4.1.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">无线终端模式事件类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#onStationModeConnected-%E2%80%93-%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F%E8%BF%9E%E4%B8%8AWiFi"><span class="toc-number">1.4.1.2.1.</span> <span class="toc-text">onStationModeConnected – 无线终端模式连上WiFi</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-31"><span class="toc-number">1.4.1.2.2.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-31"><span class="toc-number">1.4.1.2.3.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-30"><span class="toc-number">1.4.1.2.4.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-29"><span class="toc-number">1.4.1.2.5.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-30"><span class="toc-number">1.4.1.2.6.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onStationModeDisconnected-%E2%80%93-%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F%E6%96%AD%E5%BC%80WiFi"><span class="toc-number">1.4.1.2.7.</span> <span class="toc-text">onStationModeDisconnected – 无线终端模式断开WiFi</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-32"><span class="toc-number">1.4.1.2.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-32"><span class="toc-number">1.4.1.2.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-31"><span class="toc-number">1.4.1.2.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-30"><span class="toc-number">1.4.1.2.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-31"><span class="toc-number">1.4.1.2.7.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onStationModeAuthModeChanged-%E2%80%93-%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%A0%A1%E9%AA%8C%E6%A8%A1%E5%BC%8F%E6%94%B9%E5%8F%98"><span class="toc-number">1.4.1.2.8.</span> <span class="toc-text">onStationModeAuthModeChanged – 无线终端模式下校验模式改变</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-33"><span class="toc-number">1.4.1.2.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-33"><span class="toc-number">1.4.1.2.8.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-32"><span class="toc-number">1.4.1.2.8.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-31"><span class="toc-number">1.4.1.2.8.4.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onStationModeGotIP-%E2%80%93-%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F%E4%B8%8B%E8%8E%B7%E5%8F%96%E5%88%B0IP%E5%9C%B0%E5%9D%80"><span class="toc-number">1.4.1.2.9.</span> <span class="toc-text">onStationModeGotIP – 无线终端模式下获取到IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-34"><span class="toc-number">1.4.1.2.9.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-34"><span class="toc-number">1.4.1.2.9.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-33"><span class="toc-number">1.4.1.2.9.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-32"><span class="toc-number">1.4.1.2.9.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-32"><span class="toc-number">1.4.1.2.9.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onStationModeDHCPTimeout-%E2%80%93-%E6%97%A0%E7%BA%BF%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%8A%A8%E6%80%81%E5%88%86%E9%85%8DIP%E8%B6%85%E6%97%B6"><span class="toc-number">1.4.1.2.10.</span> <span class="toc-text">onStationModeDHCPTimeout – 无线终端模式下动态分配IP超时</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-35"><span class="toc-number">1.4.1.2.10.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-35"><span class="toc-number">1.4.1.2.10.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-34"><span class="toc-number">1.4.1.2.10.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-33"><span class="toc-number">1.4.1.2.10.4.</span> <span class="toc-text">返回值</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">设置类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#persistent-%E2%80%93-%E6%98%AF%E5%90%A6%E4%BF%9D%E5%AD%98WiFi%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF%E5%9C%A8%E9%97%AA%E5%AD%98%E4%B8%AD"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">persistent – 是否保存WiFi连接信息在闪存中</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-36"><span class="toc-number">1.4.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-36"><span class="toc-number">1.4.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-35"><span class="toc-number">1.4.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-34"><span class="toc-number">1.4.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-33"><span class="toc-number">1.4.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mode-%E2%80%93-%E8%AE%BE%E7%BD%AEWiFi%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">mode – 设置WiFi工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-37"><span class="toc-number">1.4.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-37"><span class="toc-number">1.4.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-35"><span class="toc-number">1.4.2.2.3.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-34"><span class="toc-number">1.4.2.2.4.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enableSTA-%E2%80%93-%E8%AE%BE%E7%BD%AE%E4%B8%BA%E7%BB%88%E7%AB%AF%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">enableSTA – 设置为终端模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-38"><span class="toc-number">1.4.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-38"><span class="toc-number">1.4.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-36"><span class="toc-number">1.4.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-36"><span class="toc-number">1.4.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-35"><span class="toc-number">1.4.2.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enableAP-%E2%80%93-%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%8E%A5%E5%85%A5%E7%82%B9%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">enableAP – 设置为接入点模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-39"><span class="toc-number">1.4.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-39"><span class="toc-number">1.4.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-37"><span class="toc-number">1.4.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-37"><span class="toc-number">1.4.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-36"><span class="toc-number">1.4.2.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setSleepMode-%E2%80%93-%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%BC%91%E7%9C%A0%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">setSleepMode – 设置为休眠模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-40"><span class="toc-number">1.4.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-40"><span class="toc-number">1.4.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-38"><span class="toc-number">1.4.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-38"><span class="toc-number">1.4.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-37"><span class="toc-number">1.4.2.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B-2"><span class="toc-number">1.4.3.</span> <span class="toc-text">信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getMode-%E2%80%93-%E8%8E%B7%E5%8F%96WiFi%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">getMode – 获取WiFi工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-41"><span class="toc-number">1.4.3.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-41"><span class="toc-number">1.4.3.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-39"><span class="toc-number">1.4.3.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-39"><span class="toc-number">1.4.3.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-38"><span class="toc-number">1.4.3.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266WiFiMulti%E5%BA%93"><span class="toc-number">1.5.</span> <span class="toc-text">ESP8266WiFiMulti库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.5.1.</span> <span class="toc-text">设置类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#addAp-%E2%80%93-%E6%B7%BB%E5%8A%A0-WiFi%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">addAp – 添加 WiFi连接信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-42"><span class="toc-number">1.5.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-42"><span class="toc-number">1.5.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-40"><span class="toc-number">1.5.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-40"><span class="toc-number">1.5.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-39"><span class="toc-number">1.5.1.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#run-%E2%80%93-%E8%BF%9E%E6%8E%A5WiFi"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">run – 连接WiFi</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-43"><span class="toc-number">1.5.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-43"><span class="toc-number">1.5.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-41"><span class="toc-number">1.5.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-41"><span class="toc-number">1.5.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-40"><span class="toc-number">1.5.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cleanAPlist-%E2%80%93-%E6%B8%85%E9%99%A4WiFi%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">cleanAPlist – 清除WiFi连接信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-44"><span class="toc-number">1.5.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-44"><span class="toc-number">1.5.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-42"><span class="toc-number">1.5.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-42"><span class="toc-number">1.5.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-41"><span class="toc-number">1.5.1.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9"><span class="toc-number">1.5.1.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B-3"><span class="toc-number">1.5.2.</span> <span class="toc-text">信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#existsAP-%E2%80%93-%E6%A3%80%E6%9F%A5WiFi%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF%E5%86%85%E5%AE%B9"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">existsAP – 检查WiFi连接信息内容</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-45"><span class="toc-number">1.5.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-45"><span class="toc-number">1.5.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-43"><span class="toc-number">1.5.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-43"><span class="toc-number">1.5.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-42"><span class="toc-number">1.5.2.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-1"><span class="toc-number">1.5.2.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-ESP8266WiFiScan%E5%BA%93"><span class="toc-number">1.6.</span> <span class="toc-text">ESP8266 – ESP8266WiFiScan库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B-2"><span class="toc-number">1.6.1.</span> <span class="toc-text">设置类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scanNetworks-%E2%80%93-%E5%90%8C%E6%AD%A5%E6%89%AB%E6%8F%8FWiFi%E7%BD%91%E7%BB%9C"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">scanNetworks – 同步扫描WiFi网络</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-46"><span class="toc-number">1.6.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-46"><span class="toc-number">1.6.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-44"><span class="toc-number">1.6.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-44"><span class="toc-number">1.6.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-43"><span class="toc-number">1.6.1.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-2"><span class="toc-number">1.6.1.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scanNetworksAsync-%E2%80%93-%E5%BC%82%E6%AD%A5%E6%89%AB%E6%8F%8FWiFi%E7%BD%91%E7%BB%9C"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">scanNetworksAsync – 异步扫描WiFi网络</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-47"><span class="toc-number">1.6.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-47"><span class="toc-number">1.6.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-45"><span class="toc-number">1.6.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-45"><span class="toc-number">1.6.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-44"><span class="toc-number">1.6.1.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-3"><span class="toc-number">1.6.1.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scanDelete-%E2%80%93-%E5%88%A0%E9%99%A4%E6%89%AB%E6%8F%8F%E7%BB%93%E6%9E%9C"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">scanDelete – 删除扫描结果</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-48"><span class="toc-number">1.6.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-48"><span class="toc-number">1.6.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-46"><span class="toc-number">1.6.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-46"><span class="toc-number">1.6.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-45"><span class="toc-number">1.6.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B-4"><span class="toc-number">1.6.2.</span> <span class="toc-text">信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getNetworkInfo-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF-%E7%BD%91%E7%BB%9C%E5%90%8D%E7%A7%B0%EF%BC%8C%E4%BF%A1%E5%8F%B7%E5%BC%BA%E5%BA%A6%E7%AD%89%EF%BC%89"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">getNetworkInfo – 获取扫描到的WiFi网络信息(网络名称，信号强度等）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-49"><span class="toc-number">1.6.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-49"><span class="toc-number">1.6.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-47"><span class="toc-number">1.6.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-47"><span class="toc-number">1.6.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-46"><span class="toc-number">1.6.2.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-4"><span class="toc-number">1.6.2.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSID-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9C%E5%90%8D%E7%A7%B0"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">SSID – 获取扫描到的WiFi网络名称</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-50"><span class="toc-number">1.6.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-50"><span class="toc-number">1.6.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-48"><span class="toc-number">1.6.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-48"><span class="toc-number">1.6.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-47"><span class="toc-number">1.6.2.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RSSI-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9C%E4%BF%A1%E5%8F%B7%E5%BC%BA%E5%BA%A6"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">RSSI – 获取扫描到的WiFi网络信号强度</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-51"><span class="toc-number">1.6.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-51"><span class="toc-number">1.6.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-49"><span class="toc-number">1.6.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-49"><span class="toc-number">1.6.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-48"><span class="toc-number">1.6.2.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-5"><span class="toc-number">1.6.2.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#encryptionType-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9C%E5%8A%A0%E5%AF%86%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">encryptionType – 获取扫描到的WiFi网络加密类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-52"><span class="toc-number">1.6.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-52"><span class="toc-number">1.6.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-50"><span class="toc-number">1.6.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-50"><span class="toc-number">1.6.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-49"><span class="toc-number">1.6.2.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-6"><span class="toc-number">1.6.2.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BSSID-BSSIDstr-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9Cmac%E5%9C%B0%E5%9D%80"><span class="toc-number">1.6.2.5.</span> <span class="toc-text">BSSID &#x2F; BSSIDstr – 获取扫描到的WiFi网络mac地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-53"><span class="toc-number">1.6.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-53"><span class="toc-number">1.6.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-51"><span class="toc-number">1.6.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-51"><span class="toc-number">1.6.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-50"><span class="toc-number">1.6.2.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-7"><span class="toc-number">1.6.2.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#channel-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9C%E4%BF%A1%E9%81%93%E5%8F%B7"><span class="toc-number">1.6.2.6.</span> <span class="toc-text">channel – 获取扫描到的WiFi网络信道号</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-54"><span class="toc-number">1.6.2.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-54"><span class="toc-number">1.6.2.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-52"><span class="toc-number">1.6.2.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-52"><span class="toc-number">1.6.2.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-51"><span class="toc-number">1.6.2.6.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-8"><span class="toc-number">1.6.2.6.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#isHidden-%E2%80%93-%E6%A3%80%E6%9F%A5%E6%89%AB%E6%8F%8F%E5%88%B0%E7%9A%84WiFi%E7%BD%91%E7%BB%9C%E6%98%AF%E5%90%A6%E6%98%AF%E9%9A%90%E8%97%8F%E7%BD%91%E7%BB%9C"><span class="toc-number">1.6.2.7.</span> <span class="toc-text">isHidden – 检查扫描到的WiFi网络是否是隐藏网络</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-55"><span class="toc-number">1.6.2.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-55"><span class="toc-number">1.6.2.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-53"><span class="toc-number">1.6.2.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-53"><span class="toc-number">1.6.2.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-52"><span class="toc-number">1.6.2.7.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scanComplete-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%BC%82%E6%AD%A5%E6%89%AB%E6%8F%8F%E7%BB%93%E6%9E%9C%E6%88%96%E7%8A%B6%E6%80%81"><span class="toc-number">1.6.2.8.</span> <span class="toc-text">scanComplete – 获取异步扫描结果或状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-56"><span class="toc-number">1.6.2.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-56"><span class="toc-number">1.6.2.8.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-54"><span class="toc-number">1.6.2.8.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-54"><span class="toc-number">1.6.2.8.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-53"><span class="toc-number">1.6.2.8.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-WiFiClient%E5%BA%93"><span class="toc-number">1.7.</span> <span class="toc-text">ESP8266 – WiFiClient库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.1.</span> <span class="toc-text">连接服务器类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B-3"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">设置类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#connect-%E2%80%93-%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.7.1.1.1.</span> <span class="toc-text">connect – 连接服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-57"><span class="toc-number">1.7.1.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-57"><span class="toc-number">1.7.1.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-55"><span class="toc-number">1.7.1.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-55"><span class="toc-number">1.7.1.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.7.1.1.1.5.</span> <span class="toc-text">示例代码</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#stop-%E2%80%93-%E5%81%9C%E6%AD%A2%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.7.1.1.2.</span> <span class="toc-text">stop – 停止客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-58"><span class="toc-number">1.7.1.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-58"><span class="toc-number">1.7.1.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-56"><span class="toc-number">1.7.1.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-2"><span class="toc-number">1.7.1.1.2.4.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-9"><span class="toc-number">1.7.1.1.2.5.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setNoDelay-%E5%81%9C%E6%AD%A2%E5%B0%8F%E5%8C%85%E5%90%88%E5%B9%B6%E5%8F%91%E9%80%81"><span class="toc-number">1.7.1.1.3.</span> <span class="toc-text">setNoDelay- 停止小包合并发送</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-59"><span class="toc-number">1.7.1.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-59"><span class="toc-number">1.7.1.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-60"><span class="toc-number">1.7.1.1.3.3.</span> <span class="toc-text">语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B-5"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#connected-%E2%80%93-%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.7.1.2.1.</span> <span class="toc-text">connected – 检查是否成功连接服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-60"><span class="toc-number">1.7.1.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-61"><span class="toc-number">1.7.1.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-56"><span class="toc-number">1.7.1.2.1.3.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-3"><span class="toc-number">1.7.1.2.1.4.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-10"><span class="toc-number">1.7.1.2.1.5.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#status-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81"><span class="toc-number">1.7.1.2.2.</span> <span class="toc-text">status – 获取客户端运行状态</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-61"><span class="toc-number">1.7.1.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-62"><span class="toc-number">1.7.1.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-57"><span class="toc-number">1.7.1.2.2.3.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-4"><span class="toc-number">1.7.1.2.2.4.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-11"><span class="toc-number">1.7.1.2.2.5.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">发送数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#print-%E2%80%93-%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">print – 发送信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-62"><span class="toc-number">1.7.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-63"><span class="toc-number">1.7.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-57"><span class="toc-number">1.7.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-58"><span class="toc-number">1.7.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-5"><span class="toc-number">1.7.2.1.5.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-12"><span class="toc-number">1.7.2.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#println-%E2%80%93-%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">println – 发送信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-63"><span class="toc-number">1.7.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-64"><span class="toc-number">1.7.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-58"><span class="toc-number">1.7.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-59"><span class="toc-number">1.7.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-6"><span class="toc-number">1.7.2.2.5.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-13"><span class="toc-number">1.7.2.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#write-%E2%80%93-%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">write – 发送信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-64"><span class="toc-number">1.7.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-65"><span class="toc-number">1.7.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-59"><span class="toc-number">1.7.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-60"><span class="toc-number">1.7.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-14"><span class="toc-number">1.7.2.3.5.</span> <span class="toc-text">相关内容</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link"><span class="toc-number">1.7.2.3.5.1.</span> <span class="toc-text"></span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.3.</span> <span class="toc-text">响应信息操作类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#readString-%E2%80%93-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%BF%9D%E5%AD%98%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2-%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">readString – 读取数据并保存为字符串 （Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-65"><span class="toc-number">1.7.3.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-66"><span class="toc-number">1.7.3.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-60"><span class="toc-number">1.7.3.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-61"><span class="toc-number">1.7.3.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-54"><span class="toc-number">1.7.3.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-15"><span class="toc-number">1.7.3.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readStringUntil-%E2%80%93-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9B%B4%E5%88%B0%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E5%B9%B6%E4%BF%9D%E5%AD%98%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2-%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">readStringUntil – 读取数据直到指定字符并保存为字符串 （Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-66"><span class="toc-number">1.7.3.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-67"><span class="toc-number">1.7.3.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-61"><span class="toc-number">1.7.3.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-62"><span class="toc-number">1.7.3.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-55"><span class="toc-number">1.7.3.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-16"><span class="toc-number">1.7.3.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#find-%E2%80%93-%E5%9C%A8%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%AF%BB%E6%89%BE%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">find – 在数据中寻找信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-67"><span class="toc-number">1.7.3.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-68"><span class="toc-number">1.7.3.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-62"><span class="toc-number">1.7.3.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-63"><span class="toc-number">1.7.3.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-56"><span class="toc-number">1.7.3.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-17"><span class="toc-number">1.7.3.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parseInt-%E2%80%93-%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E6%95%B4%E6%95%B0%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">parseInt – 解析数据中的整数（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-68"><span class="toc-number">1.7.3.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-69"><span class="toc-number">1.7.3.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-63"><span class="toc-number">1.7.3.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-64"><span class="toc-number">1.7.3.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-57"><span class="toc-number">1.7.3.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-18"><span class="toc-number">1.7.3.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8-%E4%BB%A5%E4%B8%8A%E5%B8%A6%E6%9C%89%EF%BC%88Stream%E7%B1%BB%EF%BC%89%E6%A0%87%E6%B3%A8%E7%9A%84%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E%E8%AF%A5%E5%87%BD%E6%95%B0%E6%98%AFStream%E7%B1%BB%E5%87%BD%E6%95%B0%E3%80%82"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">备注:以上带有（Stream类）标注的函数说明该函数是Stream类函数。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stream%E7%B1%BB"><span class="toc-number">1.8.</span> <span class="toc-text">Stream类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-69"><span class="toc-number">1.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.2.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#available"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">available</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-70"><span class="toc-number">1.8.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-70"><span class="toc-number">1.8.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-64"><span class="toc-number">1.8.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-65"><span class="toc-number">1.8.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-58"><span class="toc-number">1.8.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#read"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">read</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-71"><span class="toc-number">1.8.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-71"><span class="toc-number">1.8.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-65"><span class="toc-number">1.8.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-66"><span class="toc-number">1.8.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-59"><span class="toc-number">1.8.2.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readBytes"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">readBytes</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-72"><span class="toc-number">1.8.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-72"><span class="toc-number">1.8.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-66"><span class="toc-number">1.8.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-67"><span class="toc-number">1.8.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-60"><span class="toc-number">1.8.2.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readBytesUntil"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">readBytesUntil</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-73"><span class="toc-number">1.8.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-73"><span class="toc-number">1.8.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-67"><span class="toc-number">1.8.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-68"><span class="toc-number">1.8.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-61"><span class="toc-number">1.8.2.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readString"><span class="toc-number">1.8.2.5.</span> <span class="toc-text">readString</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-74"><span class="toc-number">1.8.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-74"><span class="toc-number">1.8.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-68"><span class="toc-number">1.8.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-69"><span class="toc-number">1.8.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-62"><span class="toc-number">1.8.2.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-19"><span class="toc-number">1.8.2.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readStringUntil"><span class="toc-number">1.8.2.6.</span> <span class="toc-text">readStringUntil</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-75"><span class="toc-number">1.8.2.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-75"><span class="toc-number">1.8.2.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-69"><span class="toc-number">1.8.2.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-70"><span class="toc-number">1.8.2.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-63"><span class="toc-number">1.8.2.6.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#find"><span class="toc-number">1.8.2.7.</span> <span class="toc-text">find</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-76"><span class="toc-number">1.8.2.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-76"><span class="toc-number">1.8.2.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-70"><span class="toc-number">1.8.2.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-71"><span class="toc-number">1.8.2.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-64"><span class="toc-number">1.8.2.7.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-20"><span class="toc-number">1.8.2.7.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findUntil"><span class="toc-number">1.8.2.8.</span> <span class="toc-text">findUntil</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-77"><span class="toc-number">1.8.2.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-77"><span class="toc-number">1.8.2.8.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-71"><span class="toc-number">1.8.2.8.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-72"><span class="toc-number">1.8.2.8.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-65"><span class="toc-number">1.8.2.8.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#peek"><span class="toc-number">1.8.2.9.</span> <span class="toc-text">peek</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-78"><span class="toc-number">1.8.2.9.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-78"><span class="toc-number">1.8.2.9.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-72"><span class="toc-number">1.8.2.9.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-73"><span class="toc-number">1.8.2.9.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-66"><span class="toc-number">1.8.2.9.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flush"><span class="toc-number">1.8.2.10.</span> <span class="toc-text">flush</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-79"><span class="toc-number">1.8.2.10.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-79"><span class="toc-number">1.8.2.10.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-73"><span class="toc-number">1.8.2.10.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-74"><span class="toc-number">1.8.2.10.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-67"><span class="toc-number">1.8.2.10.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parseInt"><span class="toc-number">1.8.2.11.</span> <span class="toc-text">parseInt</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-80"><span class="toc-number">1.8.2.11.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-80"><span class="toc-number">1.8.2.11.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-74"><span class="toc-number">1.8.2.11.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-75"><span class="toc-number">1.8.2.11.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-68"><span class="toc-number">1.8.2.11.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-21"><span class="toc-number">1.8.2.11.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parseFloat"><span class="toc-number">1.8.2.12.</span> <span class="toc-text">parseFloat</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-81"><span class="toc-number">1.8.2.12.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-81"><span class="toc-number">1.8.2.12.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-75"><span class="toc-number">1.8.2.12.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-76"><span class="toc-number">1.8.2.12.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-69"><span class="toc-number">1.8.2.12.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-22"><span class="toc-number">1.8.2.12.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setTimeout"><span class="toc-number">1.8.2.13.</span> <span class="toc-text">setTimeout</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-82"><span class="toc-number">1.8.2.13.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-82"><span class="toc-number">1.8.2.13.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-76"><span class="toc-number">1.8.2.13.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-77"><span class="toc-number">1.8.2.13.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-70"><span class="toc-number">1.8.2.13.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-23"><span class="toc-number">1.8.2.13.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E6%8E%A5%E6%94%B6%E7%BC%93%E5%AD%98"><span class="toc-number">1.8.2.14.</span> <span class="toc-text">清除接收缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-83"><span class="toc-number">1.8.2.14.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-71"><span class="toc-number">1.8.2.14.2.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-WiFiServer%E5%BA%93"><span class="toc-number">1.9.</span> <span class="toc-text">ESP8266 – WiFiServer库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.9.1.</span> <span class="toc-text">服务器设置类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WiFiServer-%E2%80%93-%E5%BB%BA%E7%AB%8B%E6%96%B0%E7%9A%84WiFiServer%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">WiFiServer – 建立新的WiFiServer对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-84"><span class="toc-number">1.9.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-83"><span class="toc-number">1.9.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-77"><span class="toc-number">1.9.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-78"><span class="toc-number">1.9.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-72"><span class="toc-number">1.9.1.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-24"><span class="toc-number">1.9.1.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#begin-%E2%80%93-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%8A%A8"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">begin – 服务器启动</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-85"><span class="toc-number">1.9.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-84"><span class="toc-number">1.9.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-78"><span class="toc-number">1.9.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-79"><span class="toc-number">1.9.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-73"><span class="toc-number">1.9.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setNoDelay-%E2%80%93-%E5%81%9C%E6%AD%A2%E5%B0%8F%E5%8C%85%E5%90%88%E5%B9%B6%E5%8F%91%E9%80%81"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">setNoDelay – 停止小包合并发送</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-86"><span class="toc-number">1.9.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-85"><span class="toc-number">1.9.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-79"><span class="toc-number">1.9.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-80"><span class="toc-number">1.9.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-74"><span class="toc-number">1.9.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stop-%E2%80%93-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.9.1.4.</span> <span class="toc-text">stop – 停止服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-87"><span class="toc-number">1.9.1.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-86"><span class="toc-number">1.9.1.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-80"><span class="toc-number">1.9.1.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-81"><span class="toc-number">1.9.1.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-75"><span class="toc-number">1.9.1.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#close-%E2%80%93-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.9.1.5.</span> <span class="toc-text">close – 停止服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-88"><span class="toc-number">1.9.1.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-87"><span class="toc-number">1.9.1.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-81"><span class="toc-number">1.9.1.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-82"><span class="toc-number">1.9.1.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-76"><span class="toc-number">1.9.1.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.9.2.</span> <span class="toc-text">服务器信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#status-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">status – 获取服务器运行状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-89"><span class="toc-number">1.9.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-88"><span class="toc-number">1.9.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-82"><span class="toc-number">1.9.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-83"><span class="toc-number">1.9.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-77"><span class="toc-number">1.9.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hasClient-%E2%80%93-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%89%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">hasClient – 判断是否有客户端访问</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-90"><span class="toc-number">1.9.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-89"><span class="toc-number">1.9.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-83"><span class="toc-number">1.9.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-84"><span class="toc-number">1.9.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-78"><span class="toc-number">1.9.2.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-ESP8266HTTPClient%E5%BA%93"><span class="toc-number">1.10.</span> <span class="toc-text">ESP8266 – ESP8266HTTPClient库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.1.</span> <span class="toc-text">请求类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">请求信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#begin-%E2%80%93-%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82URL"><span class="toc-number">1.10.1.1.1.</span> <span class="toc-text">begin – 设置请求URL</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-91"><span class="toc-number">1.10.1.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-90"><span class="toc-number">1.10.1.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-84"><span class="toc-number">1.10.1.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-85"><span class="toc-number">1.10.1.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-79"><span class="toc-number">1.10.1.1.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-25"><span class="toc-number">1.10.1.1.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setReuse-%E2%80%93-%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%AD%E7%9A%84keep-alive"><span class="toc-number">1.10.1.1.2.</span> <span class="toc-text">setReuse – 设置请求头中的keep-alive</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-92"><span class="toc-number">1.10.1.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-91"><span class="toc-number">1.10.1.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-85"><span class="toc-number">1.10.1.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-86"><span class="toc-number">1.10.1.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-80"><span class="toc-number">1.10.1.1.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-26"><span class="toc-number">1.10.1.1.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setUserAgent-%E2%80%93-%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%AD%E7%9A%84User-Agent"><span class="toc-number">1.10.1.1.3.</span> <span class="toc-text">setUserAgent – 设置请求头中的User-Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-93"><span class="toc-number">1.10.1.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-92"><span class="toc-number">1.10.1.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-86"><span class="toc-number">1.10.1.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-87"><span class="toc-number">1.10.1.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-81"><span class="toc-number">1.10.1.1.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-27"><span class="toc-number">1.10.1.1.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setAuthorization-%E2%80%93-%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%AD%E7%9A%84Authorization"><span class="toc-number">1.10.1.1.4.</span> <span class="toc-text">setAuthorization – 设置请求头中的Authorization</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-94"><span class="toc-number">1.10.1.1.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-93"><span class="toc-number">1.10.1.1.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-87"><span class="toc-number">1.10.1.1.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-88"><span class="toc-number">1.10.1.1.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-82"><span class="toc-number">1.10.1.1.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-28"><span class="toc-number">1.10.1.1.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#addHeader-%E2%80%93-%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%A1%E6%81%AF"><span class="toc-number">1.10.1.1.5.</span> <span class="toc-text">addHeader – 请求头中添加自定义信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-95"><span class="toc-number">1.10.1.1.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-94"><span class="toc-number">1.10.1.1.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-88"><span class="toc-number">1.10.1.1.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-89"><span class="toc-number">1.10.1.1.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-83"><span class="toc-number">1.10.1.1.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-29"><span class="toc-number">1.10.1.1.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#useHTTP10-%E2%80%93-%E8%AE%BE%E7%BD%AEhttp%E5%8D%8F%E8%AE%AE%E7%89%88%E6%9C%AC"><span class="toc-number">1.10.1.1.6.</span> <span class="toc-text">useHTTP10 – 设置http协议版本</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-96"><span class="toc-number">1.10.1.1.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-95"><span class="toc-number">1.10.1.1.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-89"><span class="toc-number">1.10.1.1.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-90"><span class="toc-number">1.10.1.1.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-84"><span class="toc-number">1.10.1.1.6.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">请求方法类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#GET"><span class="toc-number">1.10.1.2.1.</span> <span class="toc-text">GET</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-97"><span class="toc-number">1.10.1.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-96"><span class="toc-number">1.10.1.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-90"><span class="toc-number">1.10.1.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-91"><span class="toc-number">1.10.1.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-85"><span class="toc-number">1.10.1.2.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-30"><span class="toc-number">1.10.1.2.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POST"><span class="toc-number">1.10.1.2.2.</span> <span class="toc-text">POST</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-98"><span class="toc-number">1.10.1.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-97"><span class="toc-number">1.10.1.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-91"><span class="toc-number">1.10.1.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-92"><span class="toc-number">1.10.1.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-86"><span class="toc-number">1.10.1.2.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-31"><span class="toc-number">1.10.1.2.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PUT"><span class="toc-number">1.10.1.2.3.</span> <span class="toc-text">PUT</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-99"><span class="toc-number">1.10.1.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-98"><span class="toc-number">1.10.1.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-92"><span class="toc-number">1.10.1.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-93"><span class="toc-number">1.10.1.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-32"><span class="toc-number">1.10.1.2.3.5.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PATCH"><span class="toc-number">1.10.1.2.4.</span> <span class="toc-text">PATCH</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-100"><span class="toc-number">1.10.1.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-99"><span class="toc-number">1.10.1.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-93"><span class="toc-number">1.10.1.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-94"><span class="toc-number">1.10.1.2.4.4.</span> <span class="toc-text">返回值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.1.3.</span> <span class="toc-text">发送请求类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sendRequest-%E2%80%93-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">1.10.1.3.1.</span> <span class="toc-text">sendRequest – 发送请求</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-101"><span class="toc-number">1.10.1.3.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-100"><span class="toc-number">1.10.1.3.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-94"><span class="toc-number">1.10.1.3.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-95"><span class="toc-number">1.10.1.3.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-87"><span class="toc-number">1.10.1.3.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-33"><span class="toc-number">1.10.1.3.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#end-%E2%80%93-%E7%BB%93%E6%9D%9F%E8%AF%B7%E6%B1%82"><span class="toc-number">1.10.1.3.2.</span> <span class="toc-text">end – 结束请求</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-102"><span class="toc-number">1.10.1.3.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-101"><span class="toc-number">1.10.1.3.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-95"><span class="toc-number">1.10.1.3.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-96"><span class="toc-number">1.10.1.3.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-88"><span class="toc-number">1.10.1.3.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.2.</span> <span class="toc-text">响应类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">响应头类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#collectHeaders-%E2%80%93-%E8%AE%BE%E7%BD%AE%E6%94%B6%E9%9B%86%E5%93%8D%E5%BA%94%E5%A4%B4%E5%86%85%E5%AE%B9"><span class="toc-number">1.10.2.1.1.</span> <span class="toc-text">collectHeaders – 设置收集响应头内容</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-103"><span class="toc-number">1.10.2.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-102"><span class="toc-number">1.10.2.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-96"><span class="toc-number">1.10.2.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-97"><span class="toc-number">1.10.2.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-89"><span class="toc-number">1.10.2.1.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-34"><span class="toc-number">1.10.2.1.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#header-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%93%8D%E5%BA%94%E5%A4%B4%E5%8F%82%E6%95%B0%E5%80%BC"><span class="toc-number">1.10.2.1.2.</span> <span class="toc-text">header – 获取指定响应头参数值</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-104"><span class="toc-number">1.10.2.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-103"><span class="toc-number">1.10.2.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-97"><span class="toc-number">1.10.2.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-98"><span class="toc-number">1.10.2.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-90"><span class="toc-number">1.10.2.1.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-35"><span class="toc-number">1.10.2.1.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#headers-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E5%A4%B4%E6%95%B0%E9%87%8F"><span class="toc-number">1.10.2.1.3.</span> <span class="toc-text">headers – 获取响应头数量</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-105"><span class="toc-number">1.10.2.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-104"><span class="toc-number">1.10.2.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-98"><span class="toc-number">1.10.2.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-99"><span class="toc-number">1.10.2.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-91"><span class="toc-number">1.10.2.1.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-36"><span class="toc-number">1.10.2.1.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#headerName-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E7%9A%84%E5%93%8D%E5%BA%94%E5%A4%B4%E5%90%8D"><span class="toc-number">1.10.2.1.4.</span> <span class="toc-text">headerName – 获取指定的响应头名</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-106"><span class="toc-number">1.10.2.1.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-105"><span class="toc-number">1.10.2.1.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-99"><span class="toc-number">1.10.2.1.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-100"><span class="toc-number">1.10.2.1.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-92"><span class="toc-number">1.10.2.1.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-37"><span class="toc-number">1.10.2.1.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hasHeader-%E2%80%93-%E7%A1%AE%E8%AE%A4%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%8C%87%E5%AE%9A%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">1.10.2.1.5.</span> <span class="toc-text">hasHeader – 确认是否存在指定响应头</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-107"><span class="toc-number">1.10.2.1.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-106"><span class="toc-number">1.10.2.1.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-100"><span class="toc-number">1.10.2.1.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-101"><span class="toc-number">1.10.2.1.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-93"><span class="toc-number">1.10.2.1.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-38"><span class="toc-number">1.10.2.1.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">响应体类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getString-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E4%BD%93%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%B8%94%E4%BB%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E"><span class="toc-number">1.10.2.2.1.</span> <span class="toc-text">getString – 获取响应体数据并且以字符串形式返回</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-108"><span class="toc-number">1.10.2.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-107"><span class="toc-number">1.10.2.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-101"><span class="toc-number">1.10.2.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-102"><span class="toc-number">1.10.2.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-94"><span class="toc-number">1.10.2.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-39"><span class="toc-number">1.10.2.2.2.</span> <span class="toc-text">相关内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getStream-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E4%BD%93%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%B8%94%E4%BB%A5Stream%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E"><span class="toc-number">1.10.2.2.3.</span> <span class="toc-text">getStream – 获取响应体数据并且以Stream形式返回</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-109"><span class="toc-number">1.10.2.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-108"><span class="toc-number">1.10.2.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-102"><span class="toc-number">1.10.2.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-103"><span class="toc-number">1.10.2.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-95"><span class="toc-number">1.10.2.2.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-40"><span class="toc-number">1.10.2.2.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#writeToStream-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E4%BD%93%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%B8%94%E5%86%99%E5%85%A5%E5%85%B6%E5%AE%83Stream%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.10.2.2.4.</span> <span class="toc-text">writeToStream – 获取响应体数据并且写入其它Stream对象</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-110"><span class="toc-number">1.10.2.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-109"><span class="toc-number">1.10.2.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-103"><span class="toc-number">1.10.2.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-104"><span class="toc-number">1.10.2.2.4.4.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getSize-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E4%BD%93%E6%95%B0%E6%8D%AE%E5%AD%97%E8%8A%82%E6%95%B0"><span class="toc-number">1.10.2.2.5.</span> <span class="toc-text">getSize – 获取响应体数据字节数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-111"><span class="toc-number">1.10.2.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-110"><span class="toc-number">1.10.2.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-104"><span class="toc-number">1.10.2.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-105"><span class="toc-number">1.10.2.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-96"><span class="toc-number">1.10.2.2.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-41"><span class="toc-number">1.10.2.2.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#errorToString-%E2%80%93-%E8%8E%B7%E5%8F%96%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81%E5%B9%B6%E4%B8%94%E4%BB%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E"><span class="toc-number">1.10.2.2.6.</span> <span class="toc-text">errorToString – 获取错误代码并且以字符串形式返回</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-112"><span class="toc-number">1.10.2.2.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-111"><span class="toc-number">1.10.2.2.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-105"><span class="toc-number">1.10.2.2.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-106"><span class="toc-number">1.10.2.2.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-97"><span class="toc-number">1.10.2.2.6.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-42"><span class="toc-number">1.10.2.2.6.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-ESP8266WebServer%E5%BA%93"><span class="toc-number">1.11.</span> <span class="toc-text">ESP8266 – ESP8266WebServer库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86%E5%88%86%E7%B1%BB"><span class="toc-number">1.11.1.</span> <span class="toc-text">服务器运行管理分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ESP8266WebServer-%E2%80%93-%E5%BB%BA%E7%AB%8B%E6%96%B0%E7%9A%84ESP8266WebServer%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">ESP8266WebServer – 建立新的ESP8266WebServer对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-113"><span class="toc-number">1.11.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-112"><span class="toc-number">1.11.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-106"><span class="toc-number">1.11.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-107"><span class="toc-number">1.11.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-98"><span class="toc-number">1.11.1.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#begin-%E2%80%93-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%8A%A8-1"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">begin – 服务器启动</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-114"><span class="toc-number">1.11.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-113"><span class="toc-number">1.11.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-107"><span class="toc-number">1.11.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-108"><span class="toc-number">1.11.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-99"><span class="toc-number">1.11.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stop-%E2%80%93-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">1.11.1.3.</span> <span class="toc-text">stop – 停止服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-115"><span class="toc-number">1.11.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-114"><span class="toc-number">1.11.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-108"><span class="toc-number">1.11.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-109"><span class="toc-number">1.11.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-100"><span class="toc-number">1.11.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#close-%E2%80%93-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">1.11.1.4.</span> <span class="toc-text">close – 停止服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-116"><span class="toc-number">1.11.1.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-115"><span class="toc-number">1.11.1.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-109"><span class="toc-number">1.11.1.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-110"><span class="toc-number">1.11.1.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-101"><span class="toc-number">1.11.1.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AFHTTP%E8%AF%B7%E6%B1%82%E5%88%86%E7%B1%BB"><span class="toc-number">1.11.2.</span> <span class="toc-text">处理客户端HTTP请求分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E9%85%8D%E7%BD%AE%E5%88%86%E7%B1%BB"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">客户端请求处理配置分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#on-%E2%80%93-%E5%8F%AF%E6%89%BE%E5%88%B0%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.11.2.1.1.</span> <span class="toc-text">on – 可找到资源处理配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-117"><span class="toc-number">1.11.2.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-116"><span class="toc-number">1.11.2.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-110"><span class="toc-number">1.11.2.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-111"><span class="toc-number">1.11.2.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-102"><span class="toc-number">1.11.2.1.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-43"><span class="toc-number">1.11.2.1.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onNotFound-%E2%80%93-%E6%9C%AA%E6%89%BE%E5%88%B0%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.11.2.1.2.</span> <span class="toc-text">onNotFound – 未找到资源处理配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-118"><span class="toc-number">1.11.2.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-117"><span class="toc-number">1.11.2.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-111"><span class="toc-number">1.11.2.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-112"><span class="toc-number">1.11.2.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-103"><span class="toc-number">1.11.2.1.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-44"><span class="toc-number">1.11.2.1.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#onFileUpload-%E2%80%93-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%84%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.11.2.1.3.</span> <span class="toc-text">onFileUpload – 文件上传处理配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-119"><span class="toc-number">1.11.2.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-118"><span class="toc-number">1.11.2.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-112"><span class="toc-number">1.11.2.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-113"><span class="toc-number">1.11.2.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-45"><span class="toc-number">1.11.2.1.3.5.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#addHandler-%E2%80%93-%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%9B%9E%E8%B0%83"><span class="toc-number">1.11.2.1.4.</span> <span class="toc-text">addHandler – 设置请求响应回调</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-120"><span class="toc-number">1.11.2.1.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-119"><span class="toc-number">1.11.2.1.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-113"><span class="toc-number">1.11.2.1.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-114"><span class="toc-number">1.11.2.1.4.4.</span> <span class="toc-text">返回值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%E5%88%86%E7%B1%BB"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">处理客户端请求分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#handleClient-%E2%80%93-%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82"><span class="toc-number">1.11.2.2.1.</span> <span class="toc-text">handleClient – 处理客户端请求</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-121"><span class="toc-number">1.11.2.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-120"><span class="toc-number">1.11.2.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-114"><span class="toc-number">1.11.2.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-115"><span class="toc-number">1.11.2.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-104"><span class="toc-number">1.11.2.2.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-46"><span class="toc-number">1.11.2.2.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF%E5%88%86%E7%B1%BB"><span class="toc-number">1.11.2.3.</span> <span class="toc-text">获取客户端请求信息分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#uri-%E2%80%93-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84"><span class="toc-number">1.11.2.3.1.</span> <span class="toc-text">uri – 获取请求路径</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-122"><span class="toc-number">1.11.2.3.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-121"><span class="toc-number">1.11.2.3.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-115"><span class="toc-number">1.11.2.3.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-116"><span class="toc-number">1.11.2.3.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-105"><span class="toc-number">1.11.2.3.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-47"><span class="toc-number">1.11.2.3.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#method-%E2%80%93-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">1.11.2.3.2.</span> <span class="toc-text">method – 获取请求方法</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-123"><span class="toc-number">1.11.2.3.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-122"><span class="toc-number">1.11.2.3.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-116"><span class="toc-number">1.11.2.3.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-117"><span class="toc-number">1.11.2.3.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-106"><span class="toc-number">1.11.2.3.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-48"><span class="toc-number">1.11.2.3.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#collectHeaders-%E2%80%93-%E8%AE%BE%E7%BD%AE%E9%9C%80%E8%A6%81%E6%94%B6%E9%9B%86%E5%93%AA%E4%BA%9B%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.2.3.3.</span> <span class="toc-text">collectHeaders – 设置需要收集哪些请求头信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-124"><span class="toc-number">1.11.2.3.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-123"><span class="toc-number">1.11.2.3.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-117"><span class="toc-number">1.11.2.3.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-118"><span class="toc-number">1.11.2.3.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-107"><span class="toc-number">1.11.2.3.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-49"><span class="toc-number">1.11.2.3.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#headers-%E2%80%93-%E8%8E%B7%E5%BE%97%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%95%B0%E9%87%8F"><span class="toc-number">1.11.2.3.4.</span> <span class="toc-text">headers – 获得请求头数量</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-125"><span class="toc-number">1.11.2.3.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-124"><span class="toc-number">1.11.2.3.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-118"><span class="toc-number">1.11.2.3.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-119"><span class="toc-number">1.11.2.3.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-108"><span class="toc-number">1.11.2.3.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-50"><span class="toc-number">1.11.2.3.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#header-%E2%80%93-%E8%8E%B7%E5%BE%97%E6%8C%87%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E5%80%BC"><span class="toc-number">1.11.2.3.5.</span> <span class="toc-text">header – 获得指定请求头所对应的数值</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-126"><span class="toc-number">1.11.2.3.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-125"><span class="toc-number">1.11.2.3.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-119"><span class="toc-number">1.11.2.3.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-120"><span class="toc-number">1.11.2.3.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-109"><span class="toc-number">1.11.2.3.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-51"><span class="toc-number">1.11.2.3.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#headerName-%E2%80%93-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%A4%B4%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-number">1.11.2.3.6.</span> <span class="toc-text">headerName – 获取指定请求头的名称</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-127"><span class="toc-number">1.11.2.3.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-126"><span class="toc-number">1.11.2.3.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-120"><span class="toc-number">1.11.2.3.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-121"><span class="toc-number">1.11.2.3.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-110"><span class="toc-number">1.11.2.3.6.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-52"><span class="toc-number">1.11.2.3.6.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hasHeader-%E2%80%93-%E7%A1%AE%E5%AE%9A%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E6%8C%87%E5%AE%9A%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">1.11.2.3.7.</span> <span class="toc-text">hasHeader – 确定是否包含指定请求头</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-128"><span class="toc-number">1.11.2.3.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-127"><span class="toc-number">1.11.2.3.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-121"><span class="toc-number">1.11.2.3.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-122"><span class="toc-number">1.11.2.3.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-111"><span class="toc-number">1.11.2.3.7.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-53"><span class="toc-number">1.11.2.3.7.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#authenticate-%E2%80%93-%E8%AF%B7%E6%B1%82%E8%AE%A4%E8%AF%81%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.11.2.3.8.</span> <span class="toc-text">authenticate – 请求认证校验</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-129"><span class="toc-number">1.11.2.3.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-128"><span class="toc-number">1.11.2.3.8.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-122"><span class="toc-number">1.11.2.3.8.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-112"><span class="toc-number">1.11.2.3.8.4.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-54"><span class="toc-number">1.11.2.3.8.5.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#args-%E2%80%93-%E8%AF%B7%E6%B1%82%E5%8C%85%E5%90%AB%E7%9A%84%E5%8F%82%E6%95%B0%E6%95%B0%E9%87%8F"><span class="toc-number">1.11.2.3.9.</span> <span class="toc-text">args – 请求包含的参数数量</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-130"><span class="toc-number">1.11.2.3.9.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-129"><span class="toc-number">1.11.2.3.9.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-123"><span class="toc-number">1.11.2.3.9.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-123"><span class="toc-number">1.11.2.3.9.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-113"><span class="toc-number">1.11.2.3.9.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-55"><span class="toc-number">1.11.2.3.9.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#arg-%E2%80%93-%E8%AF%B7%E6%B1%82%E4%B8%AD%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%E7%9A%84%E6%95%B0%E5%80%BC"><span class="toc-number">1.11.2.3.10.</span> <span class="toc-text">arg – 请求中指定参数的数值</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-131"><span class="toc-number">1.11.2.3.10.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-130"><span class="toc-number">1.11.2.3.10.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-124"><span class="toc-number">1.11.2.3.10.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-124"><span class="toc-number">1.11.2.3.10.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-114"><span class="toc-number">1.11.2.3.10.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-56"><span class="toc-number">1.11.2.3.10.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#argName-%E2%80%93-%E8%AF%B7%E6%B1%82%E4%B8%AD%E5%8F%82%E6%95%B0%E5%90%8D"><span class="toc-number">1.11.2.3.11.</span> <span class="toc-text">argName – 请求中参数名</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-132"><span class="toc-number">1.11.2.3.11.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-131"><span class="toc-number">1.11.2.3.11.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-125"><span class="toc-number">1.11.2.3.11.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-125"><span class="toc-number">1.11.2.3.11.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-115"><span class="toc-number">1.11.2.3.11.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-57"><span class="toc-number">1.11.2.3.11.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hasArg-%E2%80%93-%E5%88%A4%E6%96%AD%E8%AF%B7%E6%B1%82%E4%B8%AD%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E6%9F%90%E4%B8%AA%E5%8F%82%E6%95%B0%E5%90%8D"><span class="toc-number">1.11.2.3.12.</span> <span class="toc-text">hasArg – 判断请求中是否包含某个参数名</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-133"><span class="toc-number">1.11.2.3.12.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-132"><span class="toc-number">1.11.2.3.12.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-126"><span class="toc-number">1.11.2.3.12.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-126"><span class="toc-number">1.11.2.3.12.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-116"><span class="toc-number">1.11.2.3.12.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-58"><span class="toc-number">1.11.2.3.12.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%E5%88%86%E7%B1%BB"><span class="toc-number">1.11.2.4.</span> <span class="toc-text">响应客户端请求分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#send-%E2%80%93-%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.2.4.1.</span> <span class="toc-text">send – 发送响应信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-134"><span class="toc-number">1.11.2.4.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-133"><span class="toc-number">1.11.2.4.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-127"><span class="toc-number">1.11.2.4.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-127"><span class="toc-number">1.11.2.4.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-117"><span class="toc-number">1.11.2.4.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-59"><span class="toc-number">1.11.2.4.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sendHeader-%E2%80%93-%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">1.11.2.4.2.</span> <span class="toc-text">sendHeader – 发送响应头</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-135"><span class="toc-number">1.11.2.4.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-134"><span class="toc-number">1.11.2.4.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-128"><span class="toc-number">1.11.2.4.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-128"><span class="toc-number">1.11.2.4.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-118"><span class="toc-number">1.11.2.4.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-60"><span class="toc-number">1.11.2.4.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sendContent-%E2%80%93-%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94%E4%BD%93%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.2.4.3.</span> <span class="toc-text">sendContent – 发送响应体信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-136"><span class="toc-number">1.11.2.4.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-135"><span class="toc-number">1.11.2.4.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-129"><span class="toc-number">1.11.2.4.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-129"><span class="toc-number">1.11.2.4.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-119"><span class="toc-number">1.11.2.4.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-61"><span class="toc-number">1.11.2.4.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sendContent-P-%E2%80%93-%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94%E4%BD%93%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.2.4.4.</span> <span class="toc-text">sendContent_P – 发送响应体信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-137"><span class="toc-number">1.11.2.4.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-136"><span class="toc-number">1.11.2.4.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-130"><span class="toc-number">1.11.2.4.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-130"><span class="toc-number">1.11.2.4.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-120"><span class="toc-number">1.11.2.4.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-62"><span class="toc-number">1.11.2.4.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#streamFile-%E2%80%93-%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94%E4%BD%93%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.2.4.5.</span> <span class="toc-text">streamFile – 发送响应体信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-138"><span class="toc-number">1.11.2.4.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-137"><span class="toc-number">1.11.2.4.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-131"><span class="toc-number">1.11.2.4.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-138"><span class="toc-number">1.11.2.4.5.4.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-121"><span class="toc-number">1.11.2.4.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setContentLength-%E2%80%93-%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E4%BD%93%E9%95%BF%E5%BA%A6"><span class="toc-number">1.11.2.4.6.</span> <span class="toc-text">setContentLength – 设置响应体长度</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-139"><span class="toc-number">1.11.2.4.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-139"><span class="toc-number">1.11.2.4.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-132"><span class="toc-number">1.11.2.4.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-131"><span class="toc-number">1.11.2.4.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-122"><span class="toc-number">1.11.2.4.6.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-63"><span class="toc-number">1.11.2.4.6.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#upload-%E2%80%93-%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.11.2.4.7.</span> <span class="toc-text">upload – 处理文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-140"><span class="toc-number">1.11.2.4.7.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-133"><span class="toc-number">1.11.2.4.7.2.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-132"><span class="toc-number">1.11.2.4.7.3.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-123"><span class="toc-number">1.11.2.4.7.4.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#requestAuthentication-%E2%80%93-%E8%AF%B7%E6%B1%82%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%A4%E8%AF%81"><span class="toc-number">1.11.2.4.8.</span> <span class="toc-text">requestAuthentication – 请求客户端认证</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-141"><span class="toc-number">1.11.2.4.8.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-142"><span class="toc-number">1.11.2.4.8.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-134"><span class="toc-number">1.11.2.4.8.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-133"><span class="toc-number">1.11.2.4.8.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-124"><span class="toc-number">1.11.2.4.8.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-64"><span class="toc-number">1.11.2.4.8.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-WiFiClientSecure%E5%BA%93"><span class="toc-number">1.12.</span> <span class="toc-text">ESP8266 – WiFiClientSecure库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ESP8266-HTTPS%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%9F%A5%E8%AF%86"><span class="toc-number">1.12.1.</span> <span class="toc-text">ESP8266-HTTPS开发实用知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%AB%99%E8%AF%81%E4%B9%A6%E6%8C%87%E7%BA%B9"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">查看网站证书指纹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%AB%99%E8%AF%81%E4%B9%A6%E5%92%8C%E5%85%AC%E9%92%A5"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">查看网站证书和公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%AB%99%E6%A0%B9%E8%AF%81%E4%B9%A6"><span class="toc-number">1.12.1.3.</span> <span class="toc-text">查看网站根证书</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%AE%A4%E8%AF%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.12.2.</span> <span class="toc-text">连接认证类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">连接类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#WiFiClientSecure-%E2%80%93-%E5%BB%BA%E7%AB%8BWiFiClientSecure%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.12.2.1.1.</span> <span class="toc-text">WiFiClientSecure – 建立WiFiClientSecure对象</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-140"><span class="toc-number">1.12.2.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-143"><span class="toc-number">1.12.2.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-135"><span class="toc-number">1.12.2.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-134"><span class="toc-number">1.12.2.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-125"><span class="toc-number">1.12.2.1.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#connect-%E2%80%93-%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">1.12.2.1.2.</span> <span class="toc-text">connect – 连接服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-141"><span class="toc-number">1.12.2.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-144"><span class="toc-number">1.12.2.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-136"><span class="toc-number">1.12.2.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-135"><span class="toc-number">1.12.2.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-126"><span class="toc-number">1.12.2.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#stop-%E2%80%93-%E5%81%9C%E6%AD%A2%E5%AE%A2%E6%88%B7%E7%AB%AF-1"><span class="toc-number">1.12.2.1.3.</span> <span class="toc-text">stop – 停止客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-142"><span class="toc-number">1.12.2.1.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-145"><span class="toc-number">1.12.2.1.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-137"><span class="toc-number">1.12.2.1.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-136"><span class="toc-number">1.12.2.1.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-127"><span class="toc-number">1.12.2.1.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.12.2.2.</span> <span class="toc-text">认证类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#setFingerprint-%E2%80%93-%E8%AE%BE%E7%BD%AE%E6%A0%A1%E9%AA%8C%E6%8C%87%E7%BA%B9"><span class="toc-number">1.12.2.2.1.</span> <span class="toc-text">setFingerprint – 设置校验指纹</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-143"><span class="toc-number">1.12.2.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-146"><span class="toc-number">1.12.2.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-138"><span class="toc-number">1.12.2.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-137"><span class="toc-number">1.12.2.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-128"><span class="toc-number">1.12.2.2.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setTrustAnchors-%E2%80%93-%E8%AE%BE%E7%BD%AE%E4%BF%A1%E4%BB%BB%E9%94%9A"><span class="toc-number">1.12.2.2.2.</span> <span class="toc-text">setTrustAnchors – 设置信任锚</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-144"><span class="toc-number">1.12.2.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-147"><span class="toc-number">1.12.2.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-139"><span class="toc-number">1.12.2.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-138"><span class="toc-number">1.12.2.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-129"><span class="toc-number">1.12.2.2.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setX509Time-%E2%80%93-%E8%AE%BE%E7%BD%AE%E6%97%B6%E9%97%B4%E4%BB%A5%E8%AE%A4%E8%AF%81x-509%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6"><span class="toc-number">1.12.2.2.3.</span> <span class="toc-text">setX509Time – 设置时间以认证x.509数字证书</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-145"><span class="toc-number">1.12.2.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-148"><span class="toc-number">1.12.2.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-140"><span class="toc-number">1.12.2.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-139"><span class="toc-number">1.12.2.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-130"><span class="toc-number">1.12.2.2.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setInsecure-%E2%80%93-%E8%AE%BE%E7%BD%AE%E4%B8%8D%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.12.2.2.4.</span> <span class="toc-text">setInsecure – 设置不进行身份校验</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-146"><span class="toc-number">1.12.2.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-149"><span class="toc-number">1.12.2.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-141"><span class="toc-number">1.12.2.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-140"><span class="toc-number">1.12.2.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-131"><span class="toc-number">1.12.2.2.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#allowSelfSignedCerts-%E2%80%93-%E5%85%81%E8%AE%B8%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="toc-number">1.12.2.2.5.</span> <span class="toc-text">allowSelfSignedCerts – 允许自签名证书</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-147"><span class="toc-number">1.12.2.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-150"><span class="toc-number">1.12.2.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-142"><span class="toc-number">1.12.2.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-141"><span class="toc-number">1.12.2.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-132"><span class="toc-number">1.12.2.2.5.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setKnownKey-%E2%80%93-%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%AC%E9%92%A5"><span class="toc-number">1.12.2.2.6.</span> <span class="toc-text">setKnownKey – 设置服务器公钥</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-148"><span class="toc-number">1.12.2.2.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-151"><span class="toc-number">1.12.2.2.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-143"><span class="toc-number">1.12.2.2.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-142"><span class="toc-number">1.12.2.2.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-133"><span class="toc-number">1.12.2.2.6.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setCiphers-%E2%80%93-%E8%AE%BE%E7%BD%AE%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F-%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-number">1.12.2.2.7.</span> <span class="toc-text">setCiphers – 设置加密方式(自定义)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-149"><span class="toc-number">1.12.2.2.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-152"><span class="toc-number">1.12.2.2.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-144"><span class="toc-number">1.12.2.2.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-143"><span class="toc-number">1.12.2.2.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-134"><span class="toc-number">1.12.2.2.7.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setCiphersLessSecure%E2%80%93-%E8%AE%BE%E7%BD%AE%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F-%E4%BD%8E%E7%BA%A7%E5%88%AB"><span class="toc-number">1.12.2.2.8.</span> <span class="toc-text">setCiphersLessSecure– 设置加密方式(低级别)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-150"><span class="toc-number">1.12.2.2.8.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-145"><span class="toc-number">1.12.2.2.8.2.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-144"><span class="toc-number">1.12.2.2.8.3.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-135"><span class="toc-number">1.12.2.2.8.4.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setClientRSACert-%E2%80%93-%E8%AE%BE%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AFRSA%E8%AF%81%E4%B9%A6"><span class="toc-number">1.12.2.2.9.</span> <span class="toc-text">setClientRSACert – 设置客户端RSA证书</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-151"><span class="toc-number">1.12.2.2.9.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-153"><span class="toc-number">1.12.2.2.9.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-146"><span class="toc-number">1.12.2.2.9.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-145"><span class="toc-number">1.12.2.2.9.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-136"><span class="toc-number">1.12.2.2.9.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setSession-%E2%80%93-%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6"><span class="toc-number">1.12.2.2.10.</span> <span class="toc-text">setSession – 会话控制</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-152"><span class="toc-number">1.12.2.2.10.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-154"><span class="toc-number">1.12.2.2.10.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-147"><span class="toc-number">1.12.2.2.10.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-146"><span class="toc-number">1.12.2.2.10.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-137"><span class="toc-number">1.12.2.2.10.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setBufferSizes-%E2%80%93-%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%AD%98%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.12.2.2.11.</span> <span class="toc-text">setBufferSizes – 设置缓存大小</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-153"><span class="toc-number">1.12.2.2.11.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-155"><span class="toc-number">1.12.2.2.11.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-148"><span class="toc-number">1.12.2.2.11.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-147"><span class="toc-number">1.12.2.2.11.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-138"><span class="toc-number">1.12.2.2.11.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-139"><span class="toc-number">1.12.2.2.11.6.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#setCertStore-%E2%80%93-%E8%AE%BE%E7%BD%AE%E8%AF%81%E4%B9%A6%E5%82%A8%E5%AD%98"><span class="toc-number">1.12.2.2.12.</span> <span class="toc-text">setCertStore – 设置证书储存</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-154"><span class="toc-number">1.12.2.2.12.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-156"><span class="toc-number">1.12.2.2.12.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-149"><span class="toc-number">1.12.2.2.12.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-148"><span class="toc-number">1.12.2.2.12.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-140"><span class="toc-number">1.12.2.2.12.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.12.2.3.</span> <span class="toc-text">状态信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#connected-%E2%80%93-%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">1.12.2.3.1.</span> <span class="toc-text">connected – 检查是否成功连接服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-155"><span class="toc-number">1.12.2.3.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-157"><span class="toc-number">1.12.2.3.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-150"><span class="toc-number">1.12.2.3.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-149"><span class="toc-number">1.12.2.3.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-141"><span class="toc-number">1.12.2.3.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getLastSSLError-%E2%80%93-%E8%8E%B7%E5%8F%96SSL%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">1.12.2.3.2.</span> <span class="toc-text">getLastSSLError – 获取SSL错误信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-156"><span class="toc-number">1.12.2.3.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-158"><span class="toc-number">1.12.2.3.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-151"><span class="toc-number">1.12.2.3.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-150"><span class="toc-number">1.12.2.3.2.4.</span> <span class="toc-text">返回值</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-142"><span class="toc-number">1.12.3.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.12.4.</span> <span class="toc-text">发送数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#print-%E2%80%93-%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89-1"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">print – 发送信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-157"><span class="toc-number">1.12.4.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-159"><span class="toc-number">1.12.4.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-152"><span class="toc-number">1.12.4.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-151"><span class="toc-number">1.12.4.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-143"><span class="toc-number">1.12.4.1.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E6%8C%87%E7%BA%B9%E8%AE%A4%E8%AF%81%EF%BC%89"><span class="toc-number">1.12.4.1.5.1.</span> <span class="toc-text">示例1：ESP8266实现HTTPS通讯（指纹认证）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81%EF%BC%89"><span class="toc-number">1.12.4.1.5.2.</span> <span class="toc-text">示例2：ESP8266实现HTTPS通讯（证书认证）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#println-%E2%80%93-%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89-1"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">println – 发送信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-158"><span class="toc-number">1.12.4.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-160"><span class="toc-number">1.12.4.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-153"><span class="toc-number">1.12.4.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-152"><span class="toc-number">1.12.4.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-144"><span class="toc-number">1.12.4.2.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E6%8C%87%E7%BA%B9%E8%AE%A4%E8%AF%81%EF%BC%89-1"><span class="toc-number">1.12.4.2.5.1.</span> <span class="toc-text">示例1：ESP8266实现HTTPS通讯（指纹认证）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#write-%E2%80%93-%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89-1"><span class="toc-number">1.12.4.3.</span> <span class="toc-text">write – 发送信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-159"><span class="toc-number">1.12.4.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-161"><span class="toc-number">1.12.4.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-154"><span class="toc-number">1.12.4.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-153"><span class="toc-number">1.12.4.3.4.</span> <span class="toc-text">返回值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.12.5.</span> <span class="toc-text">响应信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#readString-%E2%80%93-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%BF%9D%E5%AD%98%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.12.5.1.</span> <span class="toc-text">readString – 读取数据并保存为字符串（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-160"><span class="toc-number">1.12.5.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-162"><span class="toc-number">1.12.5.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-155"><span class="toc-number">1.12.5.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-154"><span class="toc-number">1.12.5.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-145"><span class="toc-number">1.12.5.1.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E6%8C%87%E7%BA%B9%E8%AE%A4%E8%AF%81%EF%BC%89-2"><span class="toc-number">1.12.5.1.5.1.</span> <span class="toc-text">示例1：ESP8266实现HTTPS通讯（指纹认证）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81%EF%BC%89-1"><span class="toc-number">1.12.5.1.5.2.</span> <span class="toc-text">示例2：ESP8266实现HTTPS通讯（证书认证）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readStringUntil-%E2%80%93-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9B%B4%E5%88%B0%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E5%B9%B6%E4%BF%9D%E5%AD%98%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88Stream%E7%B1%BB%EF%BC%89"><span class="toc-number">1.12.5.2.</span> <span class="toc-text">readStringUntil – 读取数据直到指定字符并保存为字符串（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-161"><span class="toc-number">1.12.5.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-163"><span class="toc-number">1.12.5.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-156"><span class="toc-number">1.12.5.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-155"><span class="toc-number">1.12.5.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-146"><span class="toc-number">1.12.5.2.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E6%8C%87%E7%BA%B9%E8%AE%A4%E8%AF%81%EF%BC%89-3"><span class="toc-number">1.12.5.2.5.1.</span> <span class="toc-text">示例1：ESP8266实现HTTPS通讯（指纹认证）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2%EF%BC%9AESP8266%E5%AE%9E%E7%8E%B0HTTPS%E9%80%9A%E8%AE%AF%EF%BC%88%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81%EF%BC%89-2"><span class="toc-number">1.12.5.2.5.2.</span> <span class="toc-text">示例2：ESP8266实现HTTPS通讯（证书认证）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#find-%E2%80%93-%E5%9C%A8%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%AF%BB%E6%89%BE%E4%BF%A1%E6%81%AF%EF%BC%88Stream%E7%B1%BB%EF%BC%89-1"><span class="toc-number">1.12.5.3.</span> <span class="toc-text">find – 在数据中寻找信息（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-162"><span class="toc-number">1.12.5.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-164"><span class="toc-number">1.12.5.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-157"><span class="toc-number">1.12.5.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-156"><span class="toc-number">1.12.5.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-147"><span class="toc-number">1.12.5.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parseInt-%E2%80%93-%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E6%95%B4%E6%95%B0%EF%BC%88Stream%E7%B1%BB%EF%BC%89-1"><span class="toc-number">1.12.5.4.</span> <span class="toc-text">parseInt – 解析数据中的整数（Stream类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-163"><span class="toc-number">1.12.5.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-165"><span class="toc-number">1.12.5.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-158"><span class="toc-number">1.12.5.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-157"><span class="toc-number">1.12.5.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-148"><span class="toc-number">1.12.5.4.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-WiFiServerSecure%E5%BA%93"><span class="toc-number">1.13.</span> <span class="toc-text">ESP8266 – WiFiServerSecure库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WiFiServerSecure-%E2%80%93-%E5%BB%BA%E7%AB%8BWiFiServerSecure-%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.13.1.</span> <span class="toc-text">WiFiServerSecure – 建立WiFiServerSecure 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-164"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-166"><span class="toc-number">1.13.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-159"><span class="toc-number">1.13.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-158"><span class="toc-number">1.13.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-149"><span class="toc-number">1.13.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setRSACert-%E2%80%93-%E8%AE%BE%E7%BD%AERSA%E8%AF%81%E4%B9%A6"><span class="toc-number">1.13.2.</span> <span class="toc-text">setRSACert – 设置RSA证书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-165"><span class="toc-number">1.13.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-167"><span class="toc-number">1.13.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-160"><span class="toc-number">1.13.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-159"><span class="toc-number">1.13.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-150"><span class="toc-number">1.13.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setClientTrustAnchor-%E2%80%93-%E8%AE%BE%E7%BD%AE%E4%BF%A1%E4%BB%BB%E9%94%9A"><span class="toc-number">1.13.3.</span> <span class="toc-text">setClientTrustAnchor – 设置信任锚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-166"><span class="toc-number">1.13.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-168"><span class="toc-number">1.13.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-161"><span class="toc-number">1.13.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-160"><span class="toc-number">1.13.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-151"><span class="toc-number">1.13.3.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-WiFiUDP%E5%BA%93"><span class="toc-number">1.14.</span> <span class="toc-text">ESP8266 – WiFiUDP库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP%E6%9C%8D%E5%8A%A1%E6%8E%A7%E5%88%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.14.1.</span> <span class="toc-text">UDP服务控制类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#begin-%E2%80%93-%E5%90%AF%E5%8A%A8UDP%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">begin – 启动UDP服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-167"><span class="toc-number">1.14.1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-169"><span class="toc-number">1.14.1.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-162"><span class="toc-number">1.14.1.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-161"><span class="toc-number">1.14.1.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-152"><span class="toc-number">1.14.1.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-65"><span class="toc-number">1.14.1.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stop-%E2%80%93-%E5%81%9C%E6%AD%A2UDP%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.14.1.2.</span> <span class="toc-text">stop – 停止UDP服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-168"><span class="toc-number">1.14.1.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-170"><span class="toc-number">1.14.1.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-163"><span class="toc-number">1.14.1.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-162"><span class="toc-number">1.14.1.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-153"><span class="toc-number">1.14.1.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6-%E5%A4%84%E7%90%86UDP%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.14.2.</span> <span class="toc-text">接收&#x2F;处理UDP数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#parsePacket-%E2%80%93-%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE"><span class="toc-number">1.14.2.1.</span> <span class="toc-text">parsePacket – 解析数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-169"><span class="toc-number">1.14.2.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-171"><span class="toc-number">1.14.2.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-164"><span class="toc-number">1.14.2.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-163"><span class="toc-number">1.14.2.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-154"><span class="toc-number">1.14.2.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-66"><span class="toc-number">1.14.2.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#available-Stream%E7%B1%BB-%E2%80%93-%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%B0%E6%8D%AE%E8%A2%AB%E6%8E%A5%E6%94%B6"><span class="toc-number">1.14.2.2.</span> <span class="toc-text">available(Stream类) – 检查是否有数据被接收</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-170"><span class="toc-number">1.14.2.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-172"><span class="toc-number">1.14.2.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-165"><span class="toc-number">1.14.2.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-164"><span class="toc-number">1.14.2.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-155"><span class="toc-number">1.14.2.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-67"><span class="toc-number">1.14.2.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#read-Stream%E7%B1%BB-%E2%80%93-%E8%AF%BB%E5%8F%96UDP%E6%95%B0%E6%8D%AE"><span class="toc-number">1.14.2.3.</span> <span class="toc-text">read(Stream类) – 读取UDP数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-171"><span class="toc-number">1.14.2.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-173"><span class="toc-number">1.14.2.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-166"><span class="toc-number">1.14.2.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-165"><span class="toc-number">1.14.2.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-156"><span class="toc-number">1.14.2.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-68"><span class="toc-number">1.14.2.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readString-Stream%E7%B1%BB-%E2%80%93-%E8%AF%BB%E5%8F%96UDP%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.14.2.4.</span> <span class="toc-text">readString(Stream类) – 读取UDP字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-172"><span class="toc-number">1.14.2.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-174"><span class="toc-number">1.14.2.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-167"><span class="toc-number">1.14.2.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-166"><span class="toc-number">1.14.2.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-157"><span class="toc-number">1.14.2.4.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-69"><span class="toc-number">1.14.2.4.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parseInt-Stream%E7%B1%BB-%E2%80%93-%E8%A7%A3%E6%9E%90UDP%E6%95%B0%E6%8D%AE%E4%B8%AD%E6%95%B4%E6%95%B0"><span class="toc-number">1.14.2.5.</span> <span class="toc-text">parseInt(Stream类) – 解析UDP数据中整数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-173"><span class="toc-number">1.14.2.5.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-175"><span class="toc-number">1.14.2.5.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-168"><span class="toc-number">1.14.2.5.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-167"><span class="toc-number">1.14.2.5.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-158"><span class="toc-number">1.14.2.5.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-70"><span class="toc-number">1.14.2.5.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#find-Stream%E7%B1%BB-%E2%80%93-%E5%9C%A8UDP%E6%95%B0%E6%8D%AE%E4%B8%AD%E6%9F%A5%E6%89%BE%E4%BF%A1%E6%81%AF"><span class="toc-number">1.14.2.6.</span> <span class="toc-text">find(Stream类) – 在UDP数据中查找信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-174"><span class="toc-number">1.14.2.6.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-176"><span class="toc-number">1.14.2.6.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-169"><span class="toc-number">1.14.2.6.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-168"><span class="toc-number">1.14.2.6.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-159"><span class="toc-number">1.14.2.6.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-71"><span class="toc-number">1.14.2.6.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.14.3.</span> <span class="toc-text">发送UDP数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#beginPacket-%E2%80%93-%E9%85%8D%E7%BD%AEUDP%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8E%A5%E6%94%B6%E8%AE%BE%E5%A4%87%E7%9A%84IP%E5%92%8C%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.14.3.1.</span> <span class="toc-text">beginPacket – 配置UDP数据包接收设备的IP和端口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-175"><span class="toc-number">1.14.3.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-177"><span class="toc-number">1.14.3.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-170"><span class="toc-number">1.14.3.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-169"><span class="toc-number">1.14.3.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-160"><span class="toc-number">1.14.3.1.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-72"><span class="toc-number">1.14.3.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#endPacket-%E2%80%93-%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">1.14.3.2.</span> <span class="toc-text">endPacket – 发送UDP数据包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-176"><span class="toc-number">1.14.3.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-178"><span class="toc-number">1.14.3.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-171"><span class="toc-number">1.14.3.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-170"><span class="toc-number">1.14.3.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-161"><span class="toc-number">1.14.3.2.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-73"><span class="toc-number">1.14.3.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#write-%E2%80%93-%E5%90%91UDP%E6%95%B0%E6%8D%AE%E5%8C%85%E5%86%99%E5%85%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">1.14.3.3.</span> <span class="toc-text">write – 向UDP数据包写入信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-177"><span class="toc-number">1.14.3.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-179"><span class="toc-number">1.14.3.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-172"><span class="toc-number">1.14.3.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-171"><span class="toc-number">1.14.3.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-162"><span class="toc-number">1.14.3.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.14.3.3.6.</span> <span class="toc-text">发送UDP数据类型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#print-println-Stream%E7%B1%BB-%E2%80%93-%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE"><span class="toc-number">1.14.3.4.</span> <span class="toc-text">print &#x2F; println (Stream类) – 发送UDP数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-178"><span class="toc-number">1.14.3.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-180"><span class="toc-number">1.14.3.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-173"><span class="toc-number">1.14.3.4.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-172"><span class="toc-number">1.14.3.4.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-163"><span class="toc-number">1.14.3.4.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#print%E5%87%BD%E6%95%B0%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.14.3.4.5.1.</span> <span class="toc-text">print函数示例</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#println%E5%87%BD%E6%95%B0%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.14.3.4.5.2.</span> <span class="toc-text">println函数示例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-2"><span class="toc-number">1.14.3.4.6.</span> <span class="toc-text">发送UDP数据类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.14.4.</span> <span class="toc-text">获取发送UDP数据设备信息类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#remoteIP-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E8%AE%BE%E5%A4%87IP"><span class="toc-number">1.14.4.1.</span> <span class="toc-text">remoteIP – 获取发送UDP数据包的设备IP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-179"><span class="toc-number">1.14.4.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-181"><span class="toc-number">1.14.4.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-174"><span class="toc-number">1.14.4.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-173"><span class="toc-number">1.14.4.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-164"><span class="toc-number">1.14.4.1.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#remotePort-%E2%80%93-%E8%8E%B7%E5%8F%96%E5%8F%91%E9%80%81UDP%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E8%AE%BE%E5%A4%87%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.14.4.2.</span> <span class="toc-text">remotePort – 获取发送UDP数据包的设备的端口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-180"><span class="toc-number">1.14.4.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-182"><span class="toc-number">1.14.4.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-175"><span class="toc-number">1.14.4.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-174"><span class="toc-number">1.14.4.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-165"><span class="toc-number">1.14.4.2.5.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266-%E2%80%93-DNSServer%E5%BA%93"><span class="toc-number">1.15.</span> <span class="toc-text">ESP8266 – DNSServer库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#start-%E2%80%93-%E5%90%AF%E5%8A%A8DNS%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.15.1.</span> <span class="toc-text">start – 启动DNS服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-181"><span class="toc-number">1.15.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-183"><span class="toc-number">1.15.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-176"><span class="toc-number">1.15.1.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-175"><span class="toc-number">1.15.1.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-166"><span class="toc-number">1.15.1.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E"><span class="toc-number">1.15.1.5.1.</span> <span class="toc-text">示例程序操作说明</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-74"><span class="toc-number">1.15.1.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stop-%E2%80%93-%E5%81%9C%E6%AD%A2DNS%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.15.2.</span> <span class="toc-text">stop – 停止DNS服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-182"><span class="toc-number">1.15.2.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-184"><span class="toc-number">1.15.2.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-177"><span class="toc-number">1.15.2.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-176"><span class="toc-number">1.15.2.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-167"><span class="toc-number">1.15.2.5.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-75"><span class="toc-number">1.15.2.5.1.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-76"><span class="toc-number">1.15.2.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#processNextRequest-%E2%80%93-%E5%A4%84%E7%90%86DNS%E8%AF%B7%E6%B1%82"><span class="toc-number">1.15.3.</span> <span class="toc-text">processNextRequest – 处理DNS请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-183"><span class="toc-number">1.15.3.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-185"><span class="toc-number">1.15.3.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-178"><span class="toc-number">1.15.3.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-177"><span class="toc-number">1.15.3.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-168"><span class="toc-number">1.15.3.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-77"><span class="toc-number">1.15.3.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setErrorReplyCode-%E2%80%93-%E8%AE%BE%E7%BD%AE%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94%E7%A0%81"><span class="toc-number">1.15.4.</span> <span class="toc-text">setErrorReplyCode – 设置错误响应码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-184"><span class="toc-number">1.15.4.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-186"><span class="toc-number">1.15.4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-179"><span class="toc-number">1.15.4.3.</span> <span class="toc-text">参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-178"><span class="toc-number">1.15.5.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-169"><span class="toc-number">1.15.6.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-78"><span class="toc-number">1.15.6.1.</span> <span class="toc-text">相关内容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setTTL-%E2%80%93-%E8%AE%BE%E7%BD%AETTL"><span class="toc-number">1.15.7.</span> <span class="toc-text">setTTL – 设置TTL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E-185"><span class="toc-number">1.15.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-187"><span class="toc-number">1.15.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-180"><span class="toc-number">1.15.7.3.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-179"><span class="toc-number">1.15.7.4.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-170"><span class="toc-number">1.15.7.5.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9-79"><span class="toc-number">1.15.7.6.</span> <span class="toc-text">相关内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP8266%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86-%E2%80%93-Ticker%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.16.</span> <span class="toc-text">ESP8266多任务处理 – Ticker库使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-Ticker%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.16.1.</span> <span class="toc-text">示例1. Ticker库基本操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-%E5%81%9C%E6%AD%A2%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.2.</span> <span class="toc-text">示例2. 停止定时执行函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-%E5%90%91%E5%AE%9A%E6%97%B6%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-number">1.16.3.</span> <span class="toc-text">示例3. 向定时调用函数传递参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B4-%E5%88%A9%E7%94%A8%E5%A4%9A%E4%B8%AATicker%E5%AF%B9%E8%B1%A1%E8%AE%A9ESP8266%E5%A4%84%E7%90%86%E5%A4%9A%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.16.4.</span> <span class="toc-text">示例4. 利用多个Ticker对象让ESP8266处理多任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B5-%E4%BD%BF%E7%94%A8%E2%80%9D%E8%AE%A1%E6%95%B0%E5%99%A8%E2%80%9D%E6%9D%A5%E6%8E%A7%E5%88%B6ESP8266%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E8%BE%83%E5%A4%8D%E6%9D%82%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.5.</span> <span class="toc-text">示例5. 使用”计数器”来控制ESP8266定时执行较复杂的函数</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/12/Hexo%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB%E6%A0%87%E7%AD%BE%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E8%AF%A6%E8%A7%A3/" title="Hexo 新增分类、标签与自定义页面详解">Hexo 新增分类、标签与自定义页面详解</a><time datetime="2025-10-12T05:46:03.000Z" title="发表于 2025-10-12 13:46:03">2025-10-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84%E9%80%9A%E7%94%A8%E8%93%9D%E5%9B%BE/" title="高可用高并发后端架构通用蓝图">高可用高并发后端架构通用蓝图</a><time datetime="2025-10-08T15:42:00.000Z" title="发表于 2025-10-08 23:42:00">2025-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/AI%E6%8F%90%E7%A4%BA%E8%AF%8D_%E8%AF%95%E9%A2%98%E7%94%9F%E6%88%90/" title="AI提示词_试题生成">AI提示词_试题生成</a><time datetime="2025-10-08T15:15:00.000Z" title="发表于 2025-10-08 23:15:00">2025-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/AI%E6%8F%90%E7%A4%BA%E8%AF%8D_%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E7%94%9F%E6%88%90/" title="AI提示词_学习笔记生成">AI提示词_学习笔记生成</a><time datetime="2025-10-08T15:15:00.000Z" title="发表于 2025-10-08 23:15:00">2025-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/Golang_swag/" title="Golang swag 库">Golang swag 库</a><time datetime="2025-10-08T15:07:00.000Z" title="发表于 2025-10-08 23:07:00">2025-10-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/Image/topImage.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2025 By 棨</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div></body></html>