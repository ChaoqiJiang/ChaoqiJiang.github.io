<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Golang validator 库 | 柊</title><meta name="author" content="棨"><meta name="copyright" content="棨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#59b9c6"><meta name="description" content="主要讲解如何在Go中使用validator库进行数据验证。通过一系列章节，你将学会如何使用validator库来确保你的数据符合预期。从基本的验证规则到自定义的验证函数，再到处理错误信息的高级技巧，本教程将带你一步步深入学习。validator 是一个非常强大的库，它可以帮助你确保你的数据在进入程序之前就已经是干净、合规的。让我们一起开始这段学习之旅吧！">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang validator 库">
<meta property="og:url" content="https://chaoqijiang.github.io/2025/10/06/Golang_validator/index.html">
<meta property="og:site_name" content="柊">
<meta property="og:description" content="主要讲解如何在Go中使用validator库进行数据验证。通过一系列章节，你将学会如何使用validator库来确保你的数据符合预期。从基本的验证规则到自定义的验证函数，再到处理错误信息的高级技巧，本教程将带你一步步深入学习。validator 是一个非常强大的库，它可以帮助你确保你的数据在进入程序之前就已经是干净、合规的。让我们一起开始这段学习之旅吧！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chaoqijiang.github.io/Image/avatar.png">
<meta property="article:published_time" content="2025-10-06T15:00:00.000Z">
<meta property="article:modified_time" content="2025-10-06T15:10:00.000Z">
<meta property="article:author" content="棨">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="Golang">
<meta property="article:tag" content="protected">
<meta property="article:tag" content="validator">
<meta property="article:tag" content="三方库">
<meta property="article:tag" content="使用教程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chaoqijiang.github.io/Image/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Golang validator 库",
  "url": "https://chaoqijiang.github.io/2025/10/06/Golang_validator/",
  "image": "https://chaoqijiang.github.io/Image/avatar.png",
  "datePublished": "2025-10-06T15:00:00.000Z",
  "dateModified": "2025-10-06T15:10:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "棨",
      "url": "https://chaoqijiang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://chaoqijiang.github.io/2025/10/06/Golang_validator/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#59b9c6')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 24 || hour >= 24
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":30,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#165e83","bgDark":"#507ea4","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Golang validator 库',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/Image/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">62</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">44</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴/归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/Image/topImage.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/Image/Logo.ico" alt="Logo"><span class="site-name">柊</span></a><a class="nav-page-title" href="/"><span class="site-name">Golang validator 库</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴/归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Golang validator 库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-06T15:00:00.000Z" title="发表于 2025-10-06 23:00:00">2025-10-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-06T15:10:00.000Z" title="更新于 2025-10-06 23:10:00">2025-10-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/Golang/">Golang</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">14.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>52分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Golang-validator-库"><a href="#Golang-validator-库" class="headerlink" title="Golang validator 库"></a><strong>Golang validator 库</strong></h1><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p><strong>第1章：为什么需要“数据检查员”？—— validator 库简介</strong></p>
<ul>
<li>（本章核心：用一个生活中的例子，让你明白为什么程序里需要一个专门检查数据的工具。）</li>
</ul>
<p><strong>第2章：上岗第一天！—— validator 的基本使用</strong></p>
<ul>
<li>（本章核心：手把手带你完成最简单的“检查”任务，让你对 validator 的工作流程有个整体印象。）</li>
</ul>
<p><strong>第3-1章：检查员的“规则手册”—— 常用验证标签（上）</strong></p>
<ul>
<li>（本章核心：学习最常用的检查规则，比如“不能为空”、“必须是邮箱格式”、“长度必须达标”等。）</li>
</ul>
<p><strong>第3-2章：检查员的“规则手册”—— 常用验证标签（下）</strong></p>
<ul>
<li>（本章核心：继续学习更多实用的检查规则，比如数字大小比较、多选一等，让你的检查能力变得更强。）</li>
</ul>
<p><strong>第4章：“检查不通过！”—— 如何看懂并处理错误信息</strong></p>
<ul>
<li>（本章核心：学习当数据不符合规则时，如何获取、理解并展示友好的错误提示。）</li>
</ul>
<p><strong>第5章：制定你自己的“特殊规则”—— 自定义验证函数</strong></p>
<ul>
<li>（本章核心：学习当 validator 自带规则不够用时，如何创建一条完全属于你自己的、独一无二的检查规则。）</li>
</ul>
<p><strong>第6章：经验之谈 —— 使用 validator 的注意事项与技巧</strong></p>
<ul>
<li>（本章核心：总结一些高手们在实际工作中会注意的小细节和最佳实践，帮你避免踩坑。）</li>
</ul>
<p><strong>第7章：实战演练 —— 用户注册信息校验</strong></p>
<ul>
<li>（本章核心：将前面学到的所有知识串联起来，完成一个完整的、贴近真实场景的练习。</li>
</ul>
<hr>
<h2 id="第1章：为什么需要“数据检查员”？——-validator-库简介"><a href="#第1章：为什么需要“数据检查员”？——-validator-库简介" class="headerlink" title="第1章：为什么需要“数据检查员”？—— validator 库简介"></a>第1章：为什么需要“数据检查员”？—— validator 库简介</h2><p>同学你好！在我们开始学习具体的代码之前，我想先问你一个问题：你有没有在网上注册账号或者填写表格的经历？</p>
<p>一定有吧！比如你在注册一个新邮箱时，如果密码栏你没填，系统会提示“密码不能为空”；如果你输入的邮箱地址不带<code>@</code>符号，它会说“请输入有效的邮箱格式”。</p>
<p>这个过程，其实就是 <strong>数据校验</strong>（Data Validation）。</p>
<h3 id="生活中的“数据检查”"><a href="#生活中的“数据检查”" class="headerlink" title="生活中的“数据检查”"></a>生活中的“数据检查”</h3><p>我们来把这个场景具体化一下：</p>
<p>想象一下，你正在一个重要的网站上填写一份个人信息登记表。这张表上有几个栏目：</p>
<ul>
<li><strong>姓名</strong>: （必填）</li>
<li><strong>年龄</strong>: （必填，且必须是 18 岁以上）</li>
<li><strong>邮箱</strong>: （必填，且格式必须正确，比如 <code>xxx@example.com</code>）</li>
<li><strong>个人简介</strong>: （选填，但如果填写，长度不能超过 200 字）</li>
</ul>
<p>当你填完点击“提交”时，网站后台的程序就像一个一丝不苟的办事员。它会拿起你的表格，一项一项地检查：</p>
<ol>
<li>“姓名填了吗？嗯，填了，通过。”</li>
<li>“年龄是 25，大于 18，通过。”</li>
<li>“邮箱是 <code>my-email@qq.com</code>，格式正确，通过。”</li>
<li>“个人简介写了 150 个字，没超过 200，通过。”</li>
</ol>
<p>所有检查都通过后，这位“办事员”才会满意地盖上“合格”的章，把你的信息存入数据库。如果任何一项不合格，他就会把表格退给你，并告诉你哪里填错了。</p>
<h3 id="程序世界的“数据检查”：又长又麻烦的-if-else"><a href="#程序世界的“数据检查”：又长又麻烦的-if-else" class="headerlink" title="程序世界的“数据检查”：又长又麻烦的 if-else"></a>程序世界的“数据检查”：又长又麻烦的 if-else</h3><p>在我们的 Go 程序里，我们当然也需要这样一位“办事员”。否则，用户提交了乱七八糟的数据，比如年龄填了-5岁，或者邮箱写成了“我的邮箱”，那我们的程序可能就会出问题，甚至崩溃。</p>
<p>在没有 <code>validator</code> 库之前，我们是怎么实现这个“办事员”的呢？通常是这样的：</p>
<p>假设我们用一个结构体 <code>User</code> 来表示用户提交的信息：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// User 结构体，用来存放用户注册信息</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name    <span class="type">string</span></span><br><span class="line">    Age     <span class="type">int</span></span><br><span class="line">    Email   <span class="type">string</span></span><br><span class="line">    Intro   <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了检查一个 <code>User</code> 对象里的数据是否合格，我们可能会写一个充满 <code>if-else</code> 的函数：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;errors&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动检查用户信息的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">validateUserManually</span><span class="params">(user User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 检查姓名是不是空的</span></span><br><span class="line">    <span class="keyword">if</span> user.Name == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;姓名不能为空&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 检查年龄是不是小于18岁</span></span><br><span class="line">    <span class="keyword">if</span> user.Age &lt; <span class="number">18</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;年龄必须年满18周岁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 检查邮箱格式是不是正确 (一个非常简化的检查)</span></span><br><span class="line">    <span class="keyword">if</span> !strings.Contains(user.Email, <span class="string">&quot;@&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;请输入有效的邮箱格式&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 检查个人简介长度</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(user.Intro) &gt; <span class="number">200</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;个人简介不能超过200个字符&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 所有检查都通过了，返回 nil (表示没有错误)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>思考一下：</strong> 上面这段代码有什么问题？</p>
<p>乍一看好像没问题，功能也实现了。但想象一下，如果 <code>User</code> 结构体有 30 个字段需要检查呢？那我们的 <code>validateUserManually</code> 函数是不是会变得超级长、超级复杂？每次新增或修改一个检查规则，都要小心翼翼地去改动那一大堆 <code>if-else</code>，非常容易出错，而且代码看起来一点也不优雅。</p>
<h3 id="我们的“超级检查员”登场：validator-库"><a href="#我们的“超级检查员”登场：validator-库" class="headerlink" title="我们的“超级检查员”登场：validator 库"></a>我们的“超级检查员”登场：validator 库</h3><p>为了解决这种“体力活”，社区里的大神们就开发了 <code>validator</code> 库。</p>
<p><code>validator</code> 就像一个高度自动化、自带规则手册的“超级检查员”。我们不再需要手写一大堆 <code>if-else</code>，而是用一种更简单、更直观的方式，直接在我们的结构体上“贴标签”（在 Go 语言里这叫 <code>Tag</code>），告诉检查员每个字段需要遵守什么规则。</p>
<p>同样是上面的 <code>User</code> 结构体，用了 <code>validator</code> 之后会变成这样（先混个眼熟，下一章我们就来写）：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name    <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    Age     <span class="type">int</span>    <span class="string">`validate:&quot;required,gte=18&quot;`</span></span><br><span class="line">    Email   <span class="type">string</span> <span class="string">`validate:&quot;required,email&quot;`</span></span><br><span class="line">    Intro   <span class="type">string</span> <span class="string">`validate:&quot;lte=200&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你看，规则（<code>required</code> 表示必填，<code>gte=18</code> 表示大于等于18，<code>email</code> 表示邮箱格式）直接写在了字段的后面。代码是不是瞬间清爽了很多？</p>
<p>当我们把一个 <code>User</code> 对象交给 <code>validator</code> 时，它会自动读取这些“标签”，然后一次性帮我们把所有的规则都检查一遍。我们只需要处理最终的检查结果就行了。</p>
<p><strong><code>validator</code> 库的好处：</strong></p>
<ul>
<li><strong>代码更整洁：</strong> 验证规则和数据结构定义在一起，一目了然。</li>
<li><strong>开发效率高：</strong> 大量内置的常用规则（比如判空、邮箱、URL、IP地址等）开箱即用，不用自己重复造轮子。</li>
<li><strong>易于维护：</strong> 修改规则只需要改动标签，而不用去动复杂的逻辑代码。</li>
<li><strong>功能强大：</strong> 支持自定义规则，满足各种刁钻的检查需求。</li>
</ul>
<h3 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a>本章小结</h3><p>好了，第一章的内容就是这么多。我们没有写任何实际能运行的代码，但我们搞清楚了一个最重要的问题：<strong>为什么需要 <code>validator</code>？</strong></p>
<ul>
<li><strong>数据校验是什么？</strong> 它是保证我们程序接收到的数据是正确、有效、符合预期的“守门员”。</li>
<li><strong>为什么它很重要？</strong> 它可以防止“垃圾数据”进入我们的系统，保证程序的稳定和安全。</li>
<li><strong>传统方式的痛点？</strong> 手写 <code>if-else</code> 来做校验，在字段多、规则复杂时，会变得冗长、混乱且难以维护。</li>
<li><strong><code>validator</code> 库的价值？</strong> 它提供了一种声明式、自动化的方式来完成数据校验，让我们的代码更简洁、开发效率更高。</li>
</ul>
<p>现在你已经知道了我们为什么需要这位“检查员”，下一章，我们就正式带它上岗，亲手写下第一段 <code>validator</code> 的代码，看看它到底是怎么工作的！</p>
<p>没问题，我们继续！</p>
<p>上一章我们理解了“为什么”，现在我们来解决“怎么做”的问题。准备好，我们要让这位“检查员”正式上岗了！</p>
<hr>
<h2 id="第2章：上岗第一天！——-validator-的基本使用"><a href="#第2章：上岗第一天！——-validator-的基本使用" class="headerlink" title="第2章：上岗第一天！—— validator 的基本使用"></a>第2章：上岗第一天！—— validator 的基本使用</h2><p>在这一章，我们的目标非常简单：完成一次最基本的“数据检查”任务。我们会经历从“请人”（安装库）到“下达指令”（编写代码）再到“看报告”（检查结果）的全过程。</p>
<h3 id="第一步：招聘检查员（安装-validator-库）"><a href="#第一步：招聘检查员（安装-validator-库）" class="headerlink" title="第一步：招聘检查员（安装 validator 库）"></a>第一步：招聘检查员（安装 validator 库）</h3><p>在 Go 语言中，“招聘”一个外部库，就是用一个命令把它下载到你的电脑里。</p>
<p>打开你的终端（命令行工具），输入下面的命令然后回车：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get github.com/go-playground/validator/v10</span><br></pre></td></tr></table></figure>

<p>看到一些下载信息滚动，最后没有报红色的错误，就说明我们的“检查员”已经成功“入职”了！<code>v10</code> 是它的版本号，目前这是最稳定和推荐的版本。</p>
<h3 id="第二步：给他一本“规则手册”（定义带标签的结构体）"><a href="#第二步：给他一本“规则手册”（定义带标签的结构体）" class="headerlink" title="第二步：给他一本“规则手册”（定义带标签的结构体）"></a>第二步：给他一本“规则手册”（定义带标签的结构体）</h3><p>我们的检查员很厉害，但他不是神，他不知道你的数据需要遵守什么规则。所以，我们需要给他一本“规则手册”。在 <code>validator</code> 里，这本手册就是带有 <code>validate</code> 标签的结构体。</p>
<p>我们还是用上一章的 <code>User</code> 例子，但为了简单起见，这次我们只检查一个字段：<code>Name</code>。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User 结构体，我们的“规则手册”</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 我们给 Name 字段贴上了一个叫 `validate` 的标签</span></span><br><span class="line">    <span class="comment">// 标签里的 &quot;required&quot; 就是一条规则，意思是“这个字段是必填的，不能为空”</span></span><br><span class="line">    Name <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    Age  <span class="type">int</span>    <span class="comment">// 这个字段没有标签，validator 会忽略它</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>看这里！</strong> <code>validate:&quot;required&quot;</code> 就是我们给检查员下的指令。</p>
<ul>
<li><code>validate</code>：这是告诉 <code>validator</code> 库：“嘿，看这里，这个字段有检查规则！”</li>
<li><code>&quot;required&quot;</code>：这就是具体的规则，意思是“必须有值”（不能是空字符串、0、nil 等）。</li>
</ul>
<h3 id="第三步：让他开始工作（创建实例并执行校验）"><a href="#第三步：让他开始工作（创建实例并执行校验）" class="headerlink" title="第三步：让他开始工作（创建实例并执行校验）"></a>第三步：让他开始工作（创建实例并执行校验）</h3><p>“手册”准备好了，现在我们要创建一个“检查员”实例，然后把需要检查的数据交给他。</p>
<p>我们来看一个完整的、可以运行的例子：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User 结构体，定义了验证规则</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    Age  <span class="type">int</span>    <span class="comment">// Age 字段没有规则，所以不会被检查</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 1. 创建一个 validator “检查员”实例</span></span><br><span class="line">    validate := validator.New()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景一：提供一份合格的数据 ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;--- 场景一：合格数据 ---&quot;</span>)</span><br><span class="line">    userOK := User&#123;</span><br><span class="line">        Name: <span class="string">&quot;Alice&quot;</span>, <span class="comment">// Name 字段有值</span></span><br><span class="line">        Age:  <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 把 userOK 交给检查员，让他按照结构体里的标签规则进行检查</span></span><br><span class="line">    err := validate.Struct(userOK)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 查看检查报告</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 如果 err 不是 nil，说明有错误，检查不通过！</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;数据校验失败, 错误: %v\n&quot;</span>, err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果 err 是 nil，说明没错误，检查通过！</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;数据校验成功!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;\n--- 场景二：提供一份不合格的数据 ---&quot;</span>)</span><br><span class="line">    <span class="comment">// --- 场景二：提供一份不合格的数据 ---</span></span><br><span class="line">    userFail := User&#123;</span><br><span class="line">        Name: <span class="string">&quot;&quot;</span>, <span class="comment">// Name 字段是空的，不符合 &quot;required&quot; 规则</span></span><br><span class="line">        Age:  <span class="number">30</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 同样地，把 userFail 交给检查员检查</span></span><br><span class="line">    err = validate.Struct(userFail)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 查看检查报告</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;数据校验失败, 错误: %v\n&quot;</span>, err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;数据校验成功!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>自己动手试试：</strong><br>把上面这段代码保存为一个 <code>main.go</code> 文件，然后在终端里进入到这个文件所在的目录，运行 <code>go run main.go</code>，看看会输出什么？</p>
<p>你应该会看到类似下面的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--- 场景一：合格数据 ---</span><br><span class="line">数据校验成功!</span><br><span class="line"></span><br><span class="line">--- 场景二：不合格的数据 ---</span><br><span class="line">数据校验失败, 错误: Key: &#x27;User.Name&#x27; Error:Field validation for &#x27;Name&#x27; failed on the &#x27;required&#x27; tag</span><br></pre></td></tr></table></figure>

<p><strong>结果分析：</strong></p>
<ul>
<li>在<strong>场景一</strong>中，<code>userOK</code> 里的 <code>Name</code> 字段是 “Alice”，不为空，符合 <code>required</code> 规则，所以 <code>validate.Struct()</code> 返回的 <code>err</code> 是 <code>nil</code>，程序打印“数据校验成功!”。</li>
<li>在<strong>场景二</strong>中，<code>userFail</code> 里的 <code>Name</code> 字段是空字符串 <code>&quot;&quot;</code>，违反了 <code>required</code> 规则，所以 <code>validate.Struct()</code> 返回了一个具体的错误信息，程序打印了“数据校验失败”和那串有点难懂的错误。</li>
</ul>
<p><strong>想一想：</strong><br>那个错误信息 <code>Key: &#39;User.Name&#39; Error:Field validation for &#39;Name&#39; failed on the &#39;required&#39; tag</code> 是什么意思？<br>虽然它看起来有点“程序员化”，但仔细读读，它其实在告诉我们：<code>User</code> 结构体的 <code>Name</code> 字段，在 <code>required</code> 这个规则上，验证失败了。<br>（别担心这个错误信息太丑，我们在后面的章节会学习如何把它变得更友好！）</p>
<h3 id="本章小结-1"><a href="#本章小结-1" class="headerlink" title="本章小结"></a>本章小结</h3><p>恭喜你！你已经成功让 <code>validator</code> 帮你完成了第一次检查工作。我们来回顾一下核心的三个步骤：</p>
<ol>
<li><strong>准备工作</strong>：通过 <code>go get</code> 安装库。</li>
<li><strong>定义规则</strong>：在结构体的字段后面，使用 <code>validate</code> 标签来声明验证规则（例如 <code>validate:&quot;required&quot;</code>）。</li>
<li><strong>执行校验</strong>：<ul>
<li>通过 <code>validator.New()</code> 创建一个校验器实例。</li>
<li>调用 <code>validate.Struct(你的结构体实例)</code> 来执行校验。</li>
<li>检查返回的 <code>error</code> 是否为 <code>nil</code>，<code>nil</code> 代表成功，非 <code>nil</code> 代表失败。</li>
</ul>
</li>
</ol>
<p>现在你已经掌握了 <code>validator</code> 最基本的工作流程。但是，一个只会检查“不能为空”的检查员能力还远远不够。下一章，我们将为他的“规则手册”增加更多、更强大的规则，让他能应对更复杂的检查任务！</p>
<p>好的，我们马上进入第三章！</p>
<p>我们的检查员已经学会了最基本的一招——<code>required</code>（不能为空）。但这显然不够用，就像一个交通警察只会检查司机有没有系安全带一样，他还需要学会检查是否超速、是否闯红灯等等。</p>
<p>现在，我们就来给他的“规则手册”增加几页，让他学会更多强大的检查技巧！由于规则比较多，我们把它分成上下两部分来学习。</p>
<hr>
<h2 id="第3-1章：检查员的“规则手册”——-常用验证标签（上）"><a href="#第3-1章：检查员的“规则手册”——-常用验证标签（上）" class="headerlink" title="第3-1章：检查员的“规则手册”—— 常用验证标签（上）"></a>第3-1章：检查员的“规则手册”—— 常用验证标签（上）</h2><p>在这一章，我们主要学习一些最常用、最基础的验证规则，它们主要和长度、大小、格式有关。</p>
<h3 id="规则一：关于“长度”的检查"><a href="#规则一：关于“长度”的检查" class="headerlink" title="规则一：关于“长度”的检查"></a>规则一：关于“长度”的检查</h3><p>在网站注册时，我们经常看到“用户名长度必须在6到20个字符之间”这样的提示。这就是对长度的限制。</p>
<ul>
<li><code>min=x</code>：最小长度&#x2F;个数不能小于 <code>x</code>。</li>
<li><code>max=x</code>：最大长度&#x2F;个数不能超过 <code>x</code>。</li>
<li><code>len=x</code>：长度&#x2F;个数必须正好等于 <code>x</code>。</li>
</ul>
<p>这些规则不仅能用在字符串上，还能用在数组、切片等有“长度”概念的东西上。</p>
<p><strong>示例：</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Username <span class="type">string</span> <span class="string">`validate:&quot;min=3,max=20&quot;`</span> <span class="comment">// 用户名长度在3到20之间</span></span><br><span class="line">    UserType <span class="type">string</span> <span class="string">`validate:&quot;len=5&quot;`</span>      <span class="comment">// 用户类型必须是5个字符，比如 &quot;admin&quot;</span></span><br><span class="line">    Hobbies  []<span class="type">string</span> <span class="string">`validate:&quot;max=5&quot;`</span>    <span class="comment">// 兴趣爱好最多只能选5个</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>重点：如何组合多个规则？</strong></p>
<p>你可能已经注意到了 <code>validate:&quot;min=3,max=20&quot;</code>。如果一个字段需要同时满足多个规则怎么办？很简单，<strong>用逗号 <code>,</code> 把它们隔开就行了！</strong> 这句话的意思就是，<code>Username</code> 字段必须<strong>同时满足</strong>最小长度为3 <strong>和</strong> 最大长度为20。</p>
<h3 id="规则二：关于“数字大小”的检查"><a href="#规则二：关于“数字大小”的检查" class="headerlink" title="规则二：关于“数字大小”的检查"></a>规则二：关于“数字大小”的检查</h3><p>这个规则非常直观，就是我们数学里学过的 <code>&gt;</code>、<code>&gt;=</code>、<code>&lt;</code>、<code>&lt;=</code>。</p>
<ul>
<li><code>gt=x</code>：必须 <strong>大于</strong> <code>x</code> (Greater Than)</li>
<li><code>gte=x</code>：必须 <strong>大于或等于</strong> <code>x</code> (Greater Than or Equal)</li>
<li><code>lt=x</code>：必须 <strong>小于</strong> <code>x</code> (Less Than)</li>
<li><code>lte=x</code>：必须 <strong>小于或等于</strong> <code>x</code> (Less Than or Equal)</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> &#123;</span><br><span class="line">    Price    <span class="type">float64</span> <span class="string">`validate:&quot;gt=0&quot;`</span>  <span class="comment">// 价格必须大于0</span></span><br><span class="line">    Quantity <span class="type">int</span>     <span class="string">`validate:&quot;gte=1&quot;`</span> <span class="comment">// 库存数量必须大于等于1</span></span><br><span class="line">    Rating   <span class="type">int</span>     <span class="string">`validate:&quot;min=1,max=5&quot;`</span> <span class="comment">// 评分在1到5星之间 (这里用min/max更合适)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>思考一下：</strong> 为什么评分用 <code>min=1,max=5</code> 而不是 <code>gte=1,lte=5</code>？<br>对于整数来说，这两种写法效果是一样的！<code>min/max</code> 通常用于描述长度、数量，而 <code>gte/lte</code> 用于描述数值的范围，但在这里它们可以通用。这说明规则的选择有时也很灵活。</p>
<h3 id="规则三：关于“特定格式”的检查"><a href="#规则三：关于“特定格式”的检查" class="headerlink" title="规则三：关于“特定格式”的检查"></a>规则三：关于“特定格式”的检查</h3><p><code>validator</code> 最强大的功能之一，就是它内置了很多对通用格式的检查，我们不需要自己用复杂的方法去判断。</p>
<ul>
<li><code>email</code>：必须是有效的邮箱格式。</li>
<li><code>url</code>：必须是有效的 URL 链接格式。</li>
<li><code>ip</code>：必须是有效的 IP 地址格式（包括 IPv4 和 IPv6）。</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ContactInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    Email   <span class="type">string</span> <span class="string">`validate:&quot;required,email&quot;`</span> <span class="comment">// 必填，且必须是邮箱格式</span></span><br><span class="line">    Website <span class="type">string</span> <span class="string">`validate:&quot;url&quot;`</span>            <span class="comment">// 选填，但如果填了，必须是URL格式</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你看，检查一个复杂的邮箱格式，我们只需要写上 <code>email</code> 这五个字母就行了，是不是超级方便？</p>
<h3 id="实战演练：组合使用"><a href="#实战演练：组合使用" class="headerlink" title="实战演练：组合使用"></a>实战演练：组合使用</h3><p>好了，我们已经学了好几个新规则了。现在我们把它们组合起来，创建一个更真实的“用户注册表单”结构体，并进行校验。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// RegisterForm 定义了一个用户注册表单的结构和它的验证规则</span></span><br><span class="line"><span class="keyword">type</span> RegisterForm <span class="keyword">struct</span> &#123;</span><br><span class="line">    Username <span class="type">string</span>   <span class="string">`validate:&quot;required,min=3,max=20&quot;`</span></span><br><span class="line">    Age      <span class="type">int</span>      <span class="string">`validate:&quot;required,gte=18,lte=120&quot;`</span></span><br><span class="line">    Email    <span class="type">string</span>   <span class="string">`validate:&quot;required,email&quot;`</span></span><br><span class="line">    Tags     []<span class="type">string</span> <span class="string">`validate:&quot;max=5&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    validate := validator.New()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景一：一份填写完美的表单 ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;--- 场景一：完美表单 ---&quot;</span>)</span><br><span class="line">    formOK := RegisterForm&#123;</span><br><span class="line">        Username: <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">        Age:      <span class="number">25</span>,</span><br><span class="line">        Email:    <span class="string">&quot;jack@example.com&quot;</span>,</span><br><span class="line">        Tags:     []<span class="type">string</span>&#123;<span class="string">&quot;music&quot;</span>, <span class="string">&quot;sports&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    err := validate.Struct(formOK)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;表单校验通过！&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景二：一份问题百出的表单 ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;\n--- 场景二：问题表单 ---&quot;</span>)</span><br><span class="line">    formFail := RegisterForm&#123;</span><br><span class="line">        Username: <span class="string">&quot;Li&quot;</span>, <span class="comment">// 太短，不满足 min=3</span></span><br><span class="line">        Age:      <span class="number">16</span>,   <span class="comment">// 太小，不满足 gte=18</span></span><br><span class="line">        Email:    <span class="string">&quot;this-is-not-an-email&quot;</span>, <span class="comment">// 格式错误</span></span><br><span class="line">        Tags:     []<span class="type">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>&#125;, <span class="comment">// 标签太多，不满足 max=5</span></span><br><span class="line">    &#125;</span><br><span class="line">    err = validate.Struct(formFail)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 这里我们先简单打印错误，下一章会学习如何处理它</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;表单校验失败: %v\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--- 场景一：完美表单 ---</span><br><span class="line">表单校验通过！</span><br><span class="line"></span><br><span class="line">--- 场景二：问题表单 ---</span><br><span class="line">表单校验失败: Key: &#x27;RegisterForm.Username&#x27; Error:Field validation for &#x27;Username&#x27; failed on the &#x27;min&#x27; tag</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 在场景二中，虽然表单有多个错误，但 <code>validator</code> 默认只要发现一个错误就会停止并返回。我们会在后面的章节学习如何一次性获取所有错误。目前你只需要知道，只要 <code>err</code> 不是 <code>nil</code>，就代表数据有问题。</p>
<h3 id="本章小结-2"><a href="#本章小结-2" class="headerlink" title="本章小结"></a>本章小结</h3><p>太棒了！我们给检查员的“规则手册”增加了厚厚的一叠。来总结一下今天学到的核心规则：</p>
<ul>
<li><strong>组合规则</strong>：用逗号 <code>,</code> 分隔，表示“并且”的关系。</li>
<li><strong>长度规则</strong>：<ul>
<li><code>min=x</code> (最小长度)</li>
<li><code>max=x</code> (最大长度)</li>
<li><code>len=x</code> (固定长度)</li>
</ul>
</li>
<li><strong>数值规则</strong>：<ul>
<li><code>gt=x</code> (大于 <code>&gt;</code>)</li>
<li><code>gte=x</code> (大于等于 <code>&gt;=</code>)</li>
<li><code>lt=x</code> (小于 <code>&lt;</code>)</li>
<li><code>lte=x</code> (小于等于 <code>&lt;=</code>)</li>
</ul>
</li>
<li><strong>格式规则</strong>：<ul>
<li><code>email</code> (邮箱格式)</li>
<li><code>url</code> (链接格式)</li>
<li><code>ip</code> (IP地址格式)</li>
</ul>
</li>
</ul>
<p>这些规则已经能覆盖我们日常开发中 80% 的校验需求了。但这还不是全部！在下一节课，我们会学习更多高级和有趣的规则，比如“二选一”、“密码确认”等场景，让我们的检查员变得更加智能！</p>
<p>当然！我们的检查员已经掌握了基础技能，现在是时候让他学习一些更酷、更智能的“高级招式”了。</p>
<hr>
<h2 id="第3-2章：检查员的“规则手册”——-常用验证标签（下）"><a href="#第3-2章：检查员的“规则手册”——-常用验证标签（下）" class="headerlink" title="第3-2章：检查员的“规则手册”—— 常用验证标签（下）"></a>第3-2章：检查员的“规则手册”—— 常用验证标签（下）</h2><p>在上一节，我们学习了关于长度、数字和基本格式的规则。这一节，我们将接触一些更灵活、更强大的规则，它们能处理一些更复杂的场景，比如“多选一”或者“两个字段必须相等”。</p>
<h3 id="规则四：多选一（从固定选项里选）"><a href="#规则四：多选一（从固定选项里选）" class="headerlink" title="规则四：多选一（从固定选项里选）"></a>规则四：多选一（从固定选项里选）</h3><p>想象一下，你有一个表示“订单状态”的字段，它的值只能是“待处理”、“处理中”或“已发货”这三种之一，绝不能是其他任何值。这时 <code>oneof</code> 规则就派上用场了。</p>
<ul>
<li><code>oneof=value1 value2 value3</code>：字段的值必须是后面列出的值之一。</li>
</ul>
<p><strong>请注意：</strong> 多个选项之间是用 <strong>空格</strong> 分隔的，而不是逗号！</p>
<p><strong>示例：</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Order <span class="keyword">struct</span> &#123;</span><br><span class="line">    Status <span class="type">string</span> <span class="string">`validate:&quot;oneof=pending processing shipped&quot;`</span> <span class="comment">// 状态只能是这三个字符串之一</span></span><br><span class="line">    Color  <span class="type">string</span> <span class="string">`validate:&quot;oneof=&#x27;red blue&#x27; &#x27;green yellow&#x27;&quot;`</span> <span class="comment">// 如果选项本身包含空格，可以用单引号 &#x27; &#x27; 括起来</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="规则五：字段间的比较（跨字段验证）"><a href="#规则五：字段间的比较（跨字段验证）" class="headerlink" title="规则五：字段间的比较（跨字段验证）"></a>规则五：字段间的比较（跨字段验证）</h3><p>这是个非常实用的功能！最经典的场景就是“注册时，确认密码必须和密码一致”。</p>
<ul>
<li><code>eqfield=FieldName</code>：当前字段的值必须 <strong>等于</strong> <code>FieldName</code> 字段的值。</li>
<li><code>nefield=FieldName</code>：当前字段的值必须 <strong>不等于</strong> <code>FieldName</code> 字段的值。</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> SignUpForm <span class="keyword">struct</span> &#123;</span><br><span class="line">    Password        <span class="type">string</span> <span class="string">`validate:&quot;required,min=8&quot;`</span></span><br><span class="line">    ConfirmPassword <span class="type">string</span> <span class="string">`validate:&quot;required,eqfield=Password&quot;`</span> <span class="comment">// 此字段必须和 Password 字段的值相等</span></span><br><span class="line">    </span><br><span class="line">    OldPassword     <span class="type">string</span> <span class="string">`validate:&quot;required,min=8&quot;`</span></span><br><span class="line">    NewPassword     <span class="type">string</span> <span class="string">`validate:&quot;required,min=8,nefield=OldPassword&quot;`</span> <span class="comment">// 新密码不能和旧密码一样</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这个，我们再也不用在代码里手动写 <code>if form.Password != form.ConfirmPassword</code> 这样的逻辑了！</p>
<h3 id="规则六：深入检查（校验切片或数组中的每一个元素）"><a href="#规则六：深入检查（校验切片或数组中的每一个元素）" class="headerlink" title="规则六：深入检查（校验切片或数组中的每一个元素）"></a>规则六：深入检查（校验切片或数组中的每一个元素）</h3><p>这个规则超级重要！假设你有一个订单，订单里包含一个商品列表（一个切片），你需要确保列表里的 <strong>每一个</strong> 商品都符合规定（比如商品名不能为空，价格必须大于0）。这时候就要用 <code>dive</code> 规则了。</p>
<ul>
<li><code>dive</code>：告诉检查员，“请深入到这个数组&#x2F;切片&#x2F;map 的内部，对里面的每一个元素都进行检查”。</li>
</ul>
<p><code>dive</code> 规则本身不带参数，它需要和内部元素的结构体标签配合使用。</p>
<p><strong>示例：</strong><br>让我们来看一个完整的订单校验场景。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 首先，定义列表里单个元素的规则</span></span><br><span class="line"><span class="keyword">type</span> Item <span class="keyword">struct</span> &#123;</span><br><span class="line">    SKU   <span class="type">string</span>  <span class="string">`validate:&quot;required&quot;`</span>       <span class="comment">// 商品编号必填</span></span><br><span class="line">    Price <span class="type">float64</span> <span class="string">`validate:&quot;required,gt=0&quot;`</span>  <span class="comment">// 价格必填且大于0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后，在订单结构体里使用 dive</span></span><br><span class="line"><span class="keyword">type</span> Order <span class="keyword">struct</span> &#123;</span><br><span class="line">    OrderID <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    <span class="comment">// 1. required: 订单必须有商品，Items 列表不能为空</span></span><br><span class="line">    <span class="comment">// 2. min=1: 列表里至少要有一个商品</span></span><br><span class="line">    <span class="comment">// 3. dive: 请深入到 Items 列表内部，对每一个 Item 对象进行校验</span></span><br><span class="line">    <span class="comment">//    (校验规则就是 Item 结构体上定义的那些标签)</span></span><br><span class="line">    Items   []Item <span class="string">`validate:&quot;required,min=1,dive&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>思考一下：</strong> 如果 <code>Items</code> 字段的标签是 <code>validate:&quot;required&quot;</code> 而没有 <code>dive</code>，会发生什么？<br><code>validator</code> 只会检查 <code>Items</code> 这个切片本身是不是 <code>nil</code>，但它完全不会关心切片里面的 <code>Item</code> 对象的 <code>SKU</code> 和 <code>Price</code> 是否合法。<code>dive</code> 就像一个指令，告诉检查员：“打开这个包裹，检查里面的每个小盒子！”</p>
<h3 id="实战演练：一个复杂的订单校验"><a href="#实战演练：一个复杂的订单校验" class="headerlink" title="实战演练：一个复杂的订单校验"></a>实战演练：一个复杂的订单校验</h3><p>我们来把刚刚学的 <code>dive</code> 和 <code>oneof</code> 结合起来，写一个完整的例子。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Item <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name  <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    Price <span class="type">int</span>    <span class="string">`validate:&quot;gt=0&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PurchaseOrder <span class="keyword">struct</span> &#123;</span><br><span class="line">    UserEmail <span class="type">string</span> <span class="string">`validate:&quot;required,email&quot;`</span></span><br><span class="line">    <span class="comment">// 订单类型只能是 &#x27;online&#x27; 或 &#x27;store&#x27;</span></span><br><span class="line">    Type      <span class="type">string</span> <span class="string">`validate:&quot;required,oneof=online store&quot;`</span></span><br><span class="line">    <span class="comment">// 商品列表不能为空，且列表里的每个 Item 都要符合规则</span></span><br><span class="line">    Items     []Item <span class="string">`validate:&quot;required,min=1,dive&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    validate := validator.New()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景一：一个合法的订单 ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;--- 场景一：合法订单 ---&quot;</span>)</span><br><span class="line">    orderOK := PurchaseOrder&#123;</span><br><span class="line">        UserEmail: <span class="string">&quot;customer@test.com&quot;</span>,</span><br><span class="line">        Type:      <span class="string">&quot;online&quot;</span>,</span><br><span class="line">        Items: []Item&#123;</span><br><span class="line">            &#123;Name: <span class="string">&quot;Laptop&quot;</span>, Price: <span class="number">1200</span>&#125;,</span><br><span class="line">            &#123;Name: <span class="string">&quot;Mouse&quot;</span>, Price: <span class="number">25</span>&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    err := validate.Struct(orderOK)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;订单校验通过！&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景二：一个非法的订单 (商品价格为0) ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;\n--- 场景二：非法订单 ---&quot;</span>)</span><br><span class="line">    orderFail := PurchaseOrder&#123;</span><br><span class="line">        UserEmail: <span class="string">&quot;customer@test.com&quot;</span>,</span><br><span class="line">        Type:      <span class="string">&quot;store&quot;</span>,</span><br><span class="line">        Items: []Item&#123;</span><br><span class="line">            &#123;Name: <span class="string">&quot;Keyboard&quot;</span>, Price: <span class="number">60</span>&#125;,</span><br><span class="line">            &#123;Name: <span class="string">&quot;USB Cable&quot;</span>, Price: <span class="number">0</span>&#125;, <span class="comment">// 这里的 Price 不满足 &quot;gt=0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    err = validate.Struct(orderFail)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;订单校验失败: %v\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--- 场景一：合法订单 ---</span><br><span class="line">订单校验通过！</span><br><span class="line"></span><br><span class="line">--- 场景二：非法订单 ---</span><br><span class="line">订单校验失败: Key: &#x27;PurchaseOrder.Items[1].Price&#x27; Error:Field validation for &#x27;Price&#x27; failed on the &#x27;gt&#x27; tag</span><br></pre></td></tr></table></figure>

<p>看到那个错误信息 <code>PurchaseOrder.Items[1].Price</code> 了吗？它非常精确地告诉我们：是 <code>PurchaseOrder</code> 结构体的 <code>Items</code> 字段里的、索引为 <code>1</code> 的那个元素的 <code>Price</code> 字段，在 <code>gt</code> 规则上校验失败了！这就是 <code>dive</code> 的强大之处。</p>
<h3 id="本章小结-3"><a href="#本章小结-3" class="headerlink" title="本章小结"></a>本章小结</h3><p>我们的检查员又学会了三项强大的技能，变得更加全能了：</p>
<ul>
<li><strong>多选一</strong>：<code>oneof=value1 value2</code> (注意是空格分隔)，确保值在一个给定的集合内。</li>
<li><strong>跨字段比较</strong>：<ul>
<li><code>eqfield=FieldName</code> (等于另一个字段)</li>
<li><code>nefield=FieldName</code> (不等于另一个字段)</li>
</ul>
</li>
<li><strong>深入校验</strong>：<code>dive</code>，用于校验切片&#x2F;数组&#x2F;map中的每一个元素，必须和元素自身的结构体标签配合使用。</li>
</ul>
<p>到目前为止，你已经掌握了 <code>validator</code> 90% 以上的常用功能！你已经可以应对绝大多数的数据校验场景了。</p>
<p>不过，我们一直看到那个不太友好的错误信息。如果数据校验失败了，我们总不能把 <code>Key: &#39;PurchaseOrder.Items[1].Price&#39; ...</code> 这样一长串东西直接展示给用户看吧？下一章，我们就来解决这个问题，学习如何优雅地处理和翻译这些错误信息。</p>
<p>好的，我们继续！</p>
<p>到目前为止，我们的“检查员”工作完成得非常出色，总能准确地发现问题。但是，他写的“错误报告”实在是太“专业”了，就像医生写的病历一样，普通人（用户）根本看不懂。</p>
<p><code>Key: &#39;User.Name&#39; Error:Field validation for &#39;Name&#39; failed on the &#39;required&#39; tag</code></p>
<p>把这个给用户看，用户估计会一脸茫然。所以，这一章我们的任务就是学会当一个“翻译官”，把这些专业的错误报告翻译成用户能看懂的友好提示，比如“用户名不能为空”。</p>
<hr>
<h2 id="第4章：“检查不通过！”——-如何看懂并处理错误信息"><a href="#第4章：“检查不通过！”——-如何看懂并处理错误信息" class="headerlink" title="第4章：“检查不通过！”—— 如何看懂并处理错误信息"></a>第4章：“检查不通过！”—— 如何看懂并处理错误信息</h2><p>当 <code>validate.Struct()</code> 返回的 <code>error</code> 不为 <code>nil</code> 时，就表示校验失败了。这个 <code>error</code> 对象里其实包含了非常丰富的错误信息，我们需要学会如何把它解析出来。</p>
<h3 id="第一步：拆开“错误”这个大包裹"><a href="#第一步：拆开“错误”这个大包裹" class="headerlink" title="第一步：拆开“错误”这个大包裹"></a>第一步：拆开“错误”这个大包裹</h3><p><code>validator</code> 返回的错误不是一个普通的 <code>error</code>，它是一个特殊类型 <code>validator.ValidationErrors</code>。我们可以把它想象成一个装满了“具体错误项”的包裹。我们需要先把它从通用的 <code>error</code> 类型里“拆”出来。</p>
<p>这在 Go 语言里叫做 <strong>类型断言</strong>。你可以这么理解：我们拿到一个盒子（<code>error</code>），我们猜测（或者说我们确定）里面装的是苹果（<code>validator.ValidationErrors</code>），于是我们就尝试把它当成苹果拿出来。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">err := validate.Struct(someStruct)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// 这里进行类型断言</span></span><br><span class="line">    validationErrors, ok := err.(validator.ValidationErrors)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="comment">// 如果 ok 是 false，说明这不是一个校验错误，可能是别的意外，直接打印</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;An unexpected error:&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果 ok 是 true，说明类型断言成功！</span></span><br><span class="line">    <span class="comment">// validationErrors 就是我们想要的、包含了所有校验失败信息的对象</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;恭喜，我们成功拆开了错误包裹！&quot;</span>)</span><br><span class="line">    <span class="comment">// 接下来就可以处理 validationErrors 了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第二步：遍历每一个“错误项”"><a href="#第二步：遍历每一个“错误项”" class="headerlink" title="第二步：遍历每一个“错误项”"></a>第二步：遍历每一个“错误项”</h3><p>一个表单提交过来，可能同时有好几个字段都不合格（比如用户名太短，并且邮箱格式也不对）。<code>validationErrors</code> 其实是一个切片（可以理解为列表），里面装着每一个字段的具体错误信息。所以，我们可以用一个 <code>for</code> 循环来遍历它。</p>
<p>里面的每一项都是一个 <code>validator.FieldError</code> 对象，它包含了关于单个字段校验失败的所有细节。</p>
<p>我们来看一个 <code>FieldError</code> 包含了哪些有用的信息（我们只挑最重要的几个）：</p>
<ul>
<li><code>.Field()</code>: 返回字段的 <strong>名称</strong> (比如 <code>Name</code>, <code>Age</code>)。</li>
<li><code>.Tag()</code>: 返回导致失败的那个 <strong>规则标签</strong> (比如 <code>required</code>, <code>min</code>, <code>email</code>)。</li>
<li><code>.Value()</code>: 返回导致失败的那个 <strong>不合法的值</strong> (比如空字符串 <code>&quot;&quot;</code>，不合法的邮箱地址 <code>abcde</code>)。</li>
<li><code>.Param()</code>: 返回规则标签的 <strong>参数</strong> (比如规则是 <code>min=6</code>，那 <code>.Param()</code> 返回的就是 <code>6</code>)。</li>
</ul>
<p><strong>示例：把错误信息“说人话”</strong></p>
<p>结合上面的知识，我们来写一个例子，把专业的错误报告翻译成对用户友好的提示。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Username <span class="type">string</span> <span class="string">`validate:&quot;required,min=3&quot;`</span></span><br><span class="line">    Email    <span class="type">string</span> <span class="string">`validate:&quot;required,email&quot;`</span></span><br><span class="line">    Age      <span class="type">int</span>    <span class="string">`validate:&quot;gte=18&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    validate := validator.New()</span><br><span class="line"></span><br><span class="line">    user := User&#123;</span><br><span class="line">        Username: <span class="string">&quot;a&quot;</span>,    <span class="comment">// 违反 min=3</span></span><br><span class="line">        Email:    <span class="string">&quot;test&quot;</span>, <span class="comment">// 违反 email</span></span><br><span class="line">        Age:      <span class="number">17</span>,     <span class="comment">// 违反 gte=18</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err := validate.Struct(user)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 进行类型断言</span></span><br><span class="line">        validationErrors, ok := err.(validator.ValidationErrors)</span><br><span class="line">        <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            fmt.Println(err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历所有错误</span></span><br><span class="line">        <span class="keyword">for</span> _, fieldError := <span class="keyword">range</span> validationErrors &#123;</span><br><span class="line">            <span class="comment">// 根据不同的字段和规则，生成不同的错误信息</span></span><br><span class="line">            <span class="keyword">switch</span> fieldError.Field() &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Username&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> fieldError.Tag() == <span class="string">&quot;required&quot;</span> &#123;</span><br><span class="line">                    fmt.Println(<span class="string">&quot;用户名是必填的！&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> fieldError.Tag() == <span class="string">&quot;min&quot;</span> &#123;</span><br><span class="line">                    <span class="comment">// 使用 Param() 获取参数</span></span><br><span class="line">                    fmt.Printf(<span class="string">&quot;用户名长度不能小于 %s 个字符！\n&quot;</span>, fieldError.Param())</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Email&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> fieldError.Tag() == <span class="string">&quot;required&quot;</span> &#123;</span><br><span class="line">                    fmt.Println(<span class="string">&quot;邮箱是必填的！&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> fieldError.Tag() == <span class="string">&quot;email&quot;</span> &#123;</span><br><span class="line">                    fmt.Println(<span class="string">&quot;邮箱格式不正确！&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Age&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> fieldError.Tag() == <span class="string">&quot;gte&quot;</span> &#123;</span><br><span class="line">                    fmt.Printf(<span class="string">&quot;年龄必须大于或等于 %s 岁！\n&quot;</span>, fieldError.Param())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong><br>你会看到，这次的输出非常清晰友好！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">用户名长度不能小于 3 个字符！</span><br><span class="line">邮箱格式不正确！</span><br><span class="line">年龄必须大于或等于 18 岁！</span><br></pre></td></tr></table></figure>

<p>（注意：错误的顺序可能每次不一样，因为 <code>validator</code> 内部是并发校验的）</p>
<p><strong>思考一下：</strong> 上面的 <code>switch-case</code> 和 <code>if-else</code> 是不是还是有点繁琐？如果结构体变得非常复杂，这里的代码也会变得很长。</p>
<p>是的，这只是最基础的错误处理方式。在真实的项目中，大家通常会结合“翻译库”（如 <code>go-i18n</code>）或者自己写一个“错误消息映射表”（<code>map</code>），来把 <code>fieldError.Tag()</code> 自动映射成对应的错误消息，这样代码会更优雅。但原理都是一样的：<strong>遍历 <code>validationErrors</code>，获取每一个 <code>FieldError</code>，然后根据它的 <code>.Field()</code> 和 <code>.Tag()</code> 来生成消息。</strong></p>
<h3 id="本章小结-4"><a href="#本章小结-4" class="headerlink" title="本章小结"></a>本章小结</h3><p>这一章是 <code>validator</code> 从“能用”到“好用”的关键一步。我们学会了如何处理它返回的错误：</p>
<ol>
<li><strong>核心概念</strong>：校验失败返回的 <code>error</code> 实际上是 <code>validator.ValidationErrors</code> 类型，它是一个包含了所有错误详情的集合。</li>
<li><strong>关键步骤</strong>：<ul>
<li>使用 <strong>类型断言</strong> <code>err.(validator.ValidationErrors)</code> 来拆开错误包裹。</li>
<li>使用 <code>for</code> 循环 <strong>遍历</strong> <code>validationErrors</code> 切片。</li>
</ul>
</li>
<li><strong>信息提取</strong>：在循环中，从 <code>FieldError</code> 对象中提取关键信息：<ul>
<li><code>.Field()</code> 获取字段名。</li>
<li><code>.Tag()</code> 获取失败的规则。</li>
<li><code>.Param()</code> 获取规则的参数。</li>
</ul>
</li>
<li><strong>最终目的</strong>：根据提取出的信息，组合成用户能看懂的、友好的错误提示。</li>
</ol>
<p>现在，你不仅能让检查员发现问题，还能让他用清晰的语言把问题报告出来。这已经非常接近一个专业的开发者了！</p>
<p>不过，如果检查员自带的“规则手册”里没有我们想要的规则怎么办？比如，我想检查一个字段“必须是有效的中国手机号码”，<code>validator</code> 可没有内置这个规则。别担心，下一章，我们就来学习终极技巧：给他编写一本属于我们自己的“独家规则手册”！</p>
<h2 id="第5章：制定你自己的“特殊规则”——-自定义验证函数"><a href="#第5章：制定你自己的“特殊规则”——-自定义验证函数" class="headerlink" title="第5章：制定你自己的“特殊规则”—— 自定义验证函数"></a>第5章：制定你自己的“特殊规则”—— 自定义验证函数</h2><p>这一章，我们将学习 <code>validator</code> 的终极技巧：创建并注册一个我们自己写的验证函数。这让 <code>validator</code> 的能力可以无限扩展，去适应任何奇特的业务需求。</p>
<p>这听起来可能有点复杂，但其实是一个非常清晰的三步流程：</p>
<ol>
<li><strong>编写规则</strong>：写一个符合 <code>validator</code> 要求的函数。</li>
<li><strong>登记规则</strong>：把我们写的函数告诉 <code>validator</code> 实例，并给它起一个名字（也就是标签名）。</li>
<li><strong>使用规则</strong>：像使用 <code>required</code> 一样，在结构体里使用我们自己起的名字。</li>
</ol>
<h3 id="第一步：编写规则（定义一个验证函数）"><a href="#第一步：编写规则（定义一个验证函数）" class="headerlink" title="第一步：编写规则（定义一个验证函数）"></a>第一步：编写规则（定义一个验证函数）</h3><p>一个自定义验证函数有固定的格式，就像填表一样，你必须按照它的模板来写：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(fl validator.FieldLevel)</span></span> <span class="type">bool</span></span><br></pre></td></tr></table></figure>

<ul>
<li>它必须是一个函数。</li>
<li>它只接收一个参数，类型是 <code>validator.FieldLevel</code>。</li>
<li>它必须返回一个 <code>bool</code> 类型的值 (<code>true</code> 表示验证通过，<code>false</code> 表示验证失败)。</li>
</ul>
<p><strong><code>validator.FieldLevel</code> 是什么？</strong><br>你可以把它想象成检查员在检查某个具体字段时，拿到的“工作台”。这个工作台上放着关于这个字段的所有信息，比如它的值、它的类型、它的名字等等。</p>
<p>我们最常用的就是通过 <code>fl.Field().String()</code> 来获取这个字段 <strong>作为字符串的值</strong>。</p>
<p><strong>示例：创建一个检查“手机号”的函数</strong><br>我们来写一个函数，规则是：手机号必须是 11 位，并且以 ‘1’ 开头。（这是一个简化的规则，真实的手机号校验会更复杂，通常使用正则表达式，但原理是相通的）。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">    <span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// isValidMobile 是我们的自定义验证函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValidMobile</span><span class="params">(fl validator.FieldLevel)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 从 &quot;工作台&quot; (fl) 上获取字段的值，并转为字符串</span></span><br><span class="line">    mobile := fl.Field().String()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 编写我们的检查逻辑</span></span><br><span class="line">    <span class="comment">// 规则1：长度必须是 11 位</span></span><br><span class="line">    <span class="keyword">if</span> utf8.RuneCountInString(mobile) != <span class="number">11</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 不通过</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 规则2：必须以 &#x27;1&#x27; 开头</span></span><br><span class="line">    <span class="keyword">if</span> !strings.HasPrefix(mobile, <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 不通过</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 所有规则都满足了</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 通过！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第二步：登记规则（注册自定义函数）"><a href="#第二步：登记规则（注册自定义函数）" class="headerlink" title="第二步：登记规则（注册自定义函数）"></a>第二步：登记规则（注册自定义函数）</h3><p>我们写好了规则，但检查员还不知道它的存在。我们需要在创建 <code>validator</code> 实例后，把它“登记”到检查员的规则手册里，并给它起一个响亮的名字（标签）。</p>
<p>这个登记动作通过 <code>validate.RegisterValidation()</code> 函数完成。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 创建检查员实例</span></span><br><span class="line">validate := validator.New()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 登记我们的新规则</span></span><br><span class="line"><span class="comment">// 第一个参数是我们要起的 &quot;标签名&quot;，比如叫 &quot;is-valid-mobile&quot;</span></span><br><span class="line"><span class="comment">// 第二个参数是我们上面写的函数 isValidMobile</span></span><br><span class="line">err := validate.RegisterValidation(<span class="string">&quot;is-valid-mobile&quot;</span>, isValidMobile)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// 如果注册失败，一般是标签名有问题，程序应该中止</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;Failed to register validation&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，检查员的规则手册里就多了一页，标题是 <code>is-valid-mobile</code>，内容就是我们 <code>isValidMobile</code> 函数里的逻辑。</p>
<h3 id="第三步：使用规则（在结构体里贴上新标签）"><a href="#第三步：使用规则（在结构体里贴上新标签）" class="headerlink" title="第三步：使用规则（在结构体里贴上新标签）"></a>第三步：使用规则（在结构体里贴上新标签）</h3><p>一旦注册成功，我们就可以像使用任何内置标签一样，使用我们自己的 <code>is-valid-mobile</code> 标签了！</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> UserProfile <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    Mobile <span class="type">string</span> <span class="string">`validate:&quot;required,is-valid-mobile&quot;`</span> <span class="comment">// 看！我们用上了自己的规则！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实战演练：完整的自定义校验流程"><a href="#实战演练：完整的自定义校验流程" class="headerlink" title="实战演练：完整的自定义校验流程"></a>实战演练：完整的自定义校验流程</h3><p>下面是一个可以完整运行的例子，把上面三步串联了起来。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">    <span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserProfile 结构体使用了我们的自定义标签</span></span><br><span class="line"><span class="keyword">type</span> UserProfile <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    Mobile <span class="type">string</span> <span class="string">`validate:&quot;required,is-valid-mobile&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们的自定义验证函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValidMobile</span><span class="params">(fl validator.FieldLevel)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    mobile := fl.Field().String()</span><br><span class="line">    <span class="keyword">if</span> utf8.RuneCountInString(mobile) != <span class="number">11</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !strings.HasPrefix(mobile, <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 1. 创建 validator 实例</span></span><br><span class="line">    validate := validator.New()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 注册我们的自定义函数</span></span><br><span class="line">    validate.RegisterValidation(<span class="string">&quot;is-valid-mobile&quot;</span>, isValidMobile)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景一：合法的手机号 ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;--- 场景一：合法手机号 ---&quot;</span>)</span><br><span class="line">    profileOK := UserProfile&#123;Name: <span class="string">&quot;Bob&quot;</span>, Mobile: <span class="string">&quot;13800138000&quot;</span>&#125;</span><br><span class="line">    err := validate.Struct(profileOK)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;校验通过！&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景二：非法的手机号 (太短) ---</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;\n--- 场景二：非法手机号 ---&quot;</span>)</span><br><span class="line">    profileFail := UserProfile&#123;Name: <span class="string">&quot;Charlie&quot;</span>, Mobile: <span class="string">&quot;12345&quot;</span>&#125;</span><br><span class="line">    err = validate.Struct(profileFail)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 我们同样可以处理这个自定义规则的错误</span></span><br><span class="line">        validationErrors := err.(validator.ValidationErrors)</span><br><span class="line">        <span class="keyword">for</span> _, fieldError := <span class="keyword">range</span> validationErrors &#123;</span><br><span class="line">            <span class="keyword">if</span> fieldError.Field() == <span class="string">&quot;Mobile&quot;</span> &amp;&amp; fieldError.Tag() == <span class="string">&quot;is-valid-mobile&quot;</span> &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;手机号码格式不正确，必须是11位且以1开头！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--- 场景一：合法手机号 ---</span><br><span class="line">校验通过！</span><br><span class="line"></span><br><span class="line">--- 场景二：非法手机号 ---</span><br><span class="line">手机号码格式不正确，必须是11位且以1开头！</span><br></pre></td></tr></table></figure>

<h3 id="本章小结-5"><a href="#本章小结-5" class="headerlink" title="本章小结"></a>本章小结</h3><p>太厉害了！你已经掌握了 <code>validator</code> 最核心、最灵活的用法。我们来回顾一下自定义校验的“三部曲”：</p>
<ol>
<li><strong>定义函数</strong>：创建一个函数，签名必须是 <code>func(fl validator.FieldLevel) bool</code>，并在函数体内实现你的校验逻辑。</li>
<li><strong>注册函数</strong>：使用 <code>validate.RegisterValidation(&quot;your-tag-name&quot;, yourFunction)</code> 将函数和标签名绑定，并注册到 <code>validator</code> 实例中。</li>
<li><strong>使用标签</strong>：在你的结构体 <code>validate</code> 标签中，像使用内置标签一样使用你自定义的 <code>your-tag-name</code>。</li>
</ol>
<p>有了这个能力，再也没有 <code>validator</code> 无法完成的校验任务了。从现在起，你可以为你的项目量身定做任何你需要的“检查规则”。</p>
<p>到这里，<code>validator</code> 的主要功能我们已经全部学完了。接下来的章节，我们会聊一些经验之谈和最佳实践，帮助你在真实项目中用得更稳、更好。最后再通过一个完整的实战练习来巩固所有知识。</p>
<hr>
<h2 id="第6章：经验之谈-——-使用-validator-的注意事项与技巧"><a href="#第6章：经验之谈-——-使用-validator-的注意事项与技巧" class="headerlink" title="第6章：经验之谈 —— 使用 validator 的注意事项与技巧"></a>第6章：经验之谈 —— 使用 validator 的注意事项与技巧</h2><p>这一章我们不学新功能，而是围绕“如何更好地使用”展开。</p>
<h3 id="技巧一：校验器实例，全局单例就够了"><a href="#技巧一：校验器实例，全局单例就够了" class="headerlink" title="技巧一：校验器实例，全局单例就够了"></a>技巧一：校验器实例，全局单例就够了</h3><p>你在前面的例子中可能注意到了，我们每次都是在 <code>main</code> 函数里用 <code>validator.New()</code> 创建一个新的校验器实例。在小程序里这样做没问题，但在一个大的Web应用里，每次处理一个请求就创建一个新的实例，是一种浪费。</p>
<p><code>validator</code> 的实例是 <strong>并发安全</strong> 的，这意味着在多个协程（goroutine，你可以简单理解为多个任务同时进行）中共享同一个实例是完全安全的。</p>
<p><strong>最佳实践：</strong><br>在你的项目中，只创建一个全局的 <code>validator</code> 实例，然后在所有需要校验的地方重复使用它。如果需要注册自定义验证，也在程序启动时一次性完成注册。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在包级别（全局）创建一个 Validator 实例</span></span><br><span class="line"><span class="keyword">var</span> validate *validator.Validate</span><br><span class="line"></span><br><span class="line"><span class="comment">// init 函数在包被导入时自动执行，是进行初始化的好地方</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    validate = validator.New()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有自定义验证，也在这里一次性注册好</span></span><br><span class="line">    <span class="comment">// validate.RegisterValidation(&quot;my-tag&quot;, myValidationFunc)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你的业务函数可以直接使用这个全局的 validate 实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleUserRegistration</span><span class="params">(user User)</span></span> &#123;</span><br><span class="line">    err := validate.Struct(user)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// ... 处理错误</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样做的好处是：</p>
<ul>
<li><strong>性能更好</strong>：避免了重复创建对象的开销。</li>
<li><strong>管理方便</strong>：所有自定义规则的注册都集中在一个地方，清晰明了。</li>
</ul>
<h3 id="技巧二：校验单个变量，而不仅仅是结构体"><a href="#技巧二：校验单个变量，而不仅仅是结构体" class="headerlink" title="技巧二：校验单个变量，而不仅仅是结构体"></a>技巧二：校验单个变量，而不仅仅是结构体</h3><p>我们一直都在用 <code>validate.Struct()</code> 来校验整个结构体。但有时，你可能只想校验一个独立的变量。比如，你想确认某个函数接收的字符串参数 <code>email</code> 是不是合法的邮箱格式。</p>
<p><code>validator</code> 提供了 <code>validate.Var()</code> 方法来满足这个需求。</p>
<p><strong>示例：</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    validate := validator.New()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景一：校验一个合法的邮箱字符串 ---</span></span><br><span class="line">    emailOK := <span class="string">&quot;test@example.com&quot;</span></span><br><span class="line">    <span class="comment">// 第一个参数是变量本身，第二个参数是应用在它身上的规则</span></span><br><span class="line">    err := validate.Var(emailOK, <span class="string">&quot;required,email&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;emailOK 是一个合法的邮箱地址！&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- 场景二：校验一个非法的 IP 地址字符串 ---</span></span><br><span class="line">    ipFail := <span class="string">&quot;127.0.0&quot;</span></span><br><span class="line">    err = validate.Var(ipFail, <span class="string">&quot;ip&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;ipFail 不是一个合法的 IP 地址: %v\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>validate.Var()</code> 非常适合用在那些不方便或不需要定义一个完整结构体的零散校验场景中。</p>
<h3 id="技巧三：注意-required-与-omitempty-的区别"><a href="#技巧三：注意-required-与-omitempty-的区别" class="headerlink" title="技巧三：注意 required 与 omitempty 的区别"></a>技巧三：注意 <code>required</code> 与 <code>omitempty</code> 的区别</h3><p>这是一个新手很容易混淆的地方。</p>
<ul>
<li><code>required</code>：<strong>必须存在</strong>。字段不能是其类型的“零值”（比如 <code>int</code> 的 <code>0</code>，<code>string</code> 的 <code>&quot;&quot;</code>，指针或切片的 <code>nil</code>）。如果不存在，就报错。</li>
<li><code>omitempty</code>：<strong>如果有值，才校验</strong>。<code>omit</code> 是忽略的意思。这个标签告诉 <code>validator</code>：“如果这个字段是零值，那就跳过它，别管它后面的其他规则了。但如果它有值，那就请继续检查后面的规则。”</li>
</ul>
<p><strong>一个经典的例子：更新用户信息</strong><br>假设用户只想更新他的昵称，提交的 JSON 数据可能只包含 <code>nickname</code> 字段，而 <code>email</code> 字段是空的。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> UserUpdateForm <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 如果 nickname 不为空，则必须满足最小长度为2</span></span><br><span class="line">    Nickname <span class="type">string</span> <span class="string">`validate:&quot;omitempty,min=2&quot;`</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 email 不为空，则必须是 email 格式</span></span><br><span class="line">    Email    <span class="type">string</span> <span class="string">`validate:&quot;omitempty,email&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景一：用户只更新昵称</span></span><br><span class="line">form1 := UserUpdateForm&#123;Nickname: <span class="string">&quot;NewName&quot;</span>&#125;</span><br><span class="line"><span class="comment">// 校验会通过，因为 Email 是空字符串，`omitempty` 使 `email` 规则被跳过。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景二：用户更新了一个错误的邮箱</span></span><br><span class="line">form2 := UserUpdateForm&#123;Email: <span class="string">&quot;not-an-email&quot;</span>&#125;</span><br><span class="line"><span class="comment">// 校验会失败，因为 Email 不为空，所以 `email` 规则被触发且校验失败。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景三：用户啥也没填</span></span><br><span class="line">form3 := UserUpdateForm&#123;&#125;</span><br><span class="line"><span class="comment">// 校验会通过，因为两个字段都是空，所有规则都被 `omitempty` 跳过了。</span></span><br></pre></td></tr></table></figure>

<p><strong>记住这个组合</strong>：<code>omitempty</code> 经常和其它规则一起使用，用于“可选字段”的校验，非常实用！</p>
<h3 id="技巧四：校验嵌套结构体"><a href="#技巧四：校验嵌套结构体" class="headerlink" title="技巧四：校验嵌套结构体"></a>技巧四：校验嵌套结构体</h3><p>如果你的结构体里包含了另一个结构体，<code>validator</code> 默认是不会自动深入进去校验的。你需要明确告诉它。</p>
<p>和 <code>dive</code> 校验切片&#x2F;数组类似，对于嵌套的结构体，你只需要在字段上加上 <code>dive</code> 标签，或者简单地加上 <code>required</code>（或其他任何标签）来触发校验。更规范的方式是在嵌套的结构体字段上直接进行校验。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Address <span class="keyword">struct</span> &#123;</span><br><span class="line">    Street <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    City   <span class="type">string</span> <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name    <span class="type">string</span>  <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    <span class="comment">// Address 字段本身是必填的（不能是nil），</span></span><br><span class="line">    <span class="comment">// 并且需要对 Address 内部的字段进行校验</span></span><br><span class="line">    Address Address <span class="string">`validate:&quot;required&quot;`</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>更正与修改:</strong><br>实际上，对于嵌套结构体，<code>validator</code> 默认就会递归地进行校验。你只需要确保在外层结构体验证时，内层结构体的字段也已经定义了标签。上面的<code>validate:&quot;required&quot;</code>是针对<code>Address</code>这个结构体本身不能是零值，而它内部的<code>Street</code>和<code>City</code>的<code>required</code>标签会在校验<code>User</code>时被自动检查。</p>
<p>为了更清晰地表达“请深入校验”，通常可以直接写 <code>validate:&quot;&quot;</code> 配合内部的标签，或者如果该嵌套结构体本身是可选的指针类型，则可以使用<code>dive</code>。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> UserWithOptionalAddress <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name    <span class="type">string</span>   <span class="string">`validate:&quot;required&quot;`</span></span><br><span class="line">    <span class="comment">// 如果 Address 字段存在（不是nil），则深入校验其内部</span></span><br><span class="line">    Address *Address <span class="string">`validate:&quot;omitempty,dive&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对于<code>struct</code>类型，<code>validator</code>会自动深入。</li>
<li>对于<code>*struct</code>（指针）、<code>[]struct</code>（切片）等，使用<code>dive</code>来告诉校验器需要深入检查。</li>
</ul>
<h3 id="本章小结-6"><a href="#本章小结-6" class="headerlink" title="本章小结"></a>本章小结</h3><p>这一章我们没有学习新标签，而是修炼了“内功”，让使用 <code>validator</code> 的方式更加地道和高效：</p>
<ul>
<li><strong>全局单例</strong>：整个应用共享一个 <code>validator</code> 实例，在 <code>init</code> 函数中初始化和注册规则。</li>
<li><strong>校验单个变量</strong>：使用 <code>validate.Var()</code> 来校验零散的变量。</li>
<li><strong>可选字段校验</strong>：<code>omitempty</code> 是处理“非必填但有值时需满足规则”场景的利器。</li>
<li><strong>嵌套结构体</strong>：对于指针、切片、数组或 map 里的结构体，记得使用 <code>dive</code> 来进行深度校验。</li>
</ul>
<p>掌握了这些技巧，你就可以自信地在任何规模的项目中使用 <code>validator</code> 库了。理论学习已经足够，下一章，我们将把目前学到的所有知识融会贯通，完成一个最终的实战演练！</p>
<p>好的，激动人心的时刻到了！</p>
<p>我们已经学习了 <code>validator</code> 的方方面面，从基础概念到高级技巧。现在是时候把所有知识碎片拼接到一起，像在真实项目中那样，完成一个完整的、有挑战性的任务了。</p>
<hr>
<h2 id="第7章：实战演练-——-用户注册信息校验"><a href="#第7章：实战演练-——-用户注册信息校验" class="headerlink" title="第7章：实战演练 —— 用户注册信息校验"></a>第7章：实战演练 —— 用户注册信息校验</h2><p><strong>演练目标：</strong><br>我们要创建一个用户注册的后端校验逻辑。这个逻辑需要能够接收一个模拟的用户注册表单，并使用 <code>validator</code> 对其进行全面的校验。最后，将专业的校验错误翻译成对用户友好的提示信息列表。</p>
<p><strong>需求清单：</strong></p>
<ol>
<li><strong>用户名 (Username)</strong>:<ul>
<li>必填。</li>
<li>长度在 4 到 20 个字符之间。</li>
<li>不能包含 “admin” 这个词（这是个自定义规则！）。</li>
</ul>
</li>
<li><strong>密码 (Password)</strong>:<ul>
<li>必填。</li>
<li>长度至少为 8 个字符。</li>
</ul>
</li>
<li><strong>确认密码 (ConfirmPassword)</strong>:<ul>
<li>必填。</li>
<li>必须和 <code>Password</code> 字段的值一致。</li>
</ul>
</li>
<li><strong>邮箱 (Email)</strong>:<ul>
<li>必填。</li>
<li>必须是有效的邮箱格式。</li>
</ul>
</li>
<li><strong>年龄 (Age)</strong>:<ul>
<li>非必填。</li>
<li>但如果填写了，必须年满 18 周岁。</li>
</ul>
</li>
<li><strong>兴趣爱好 (Hobbies)</strong>:<ul>
<li>非必填。</li>
<li>但如果填写了，最多只能选择 5 个。</li>
<li>每个兴趣爱好的字符串本身不能为空（深入校验！）。</li>
</ul>
</li>
</ol>
<p><strong>错误处理要求：</strong><br>将所有校验失败的信息收集起来，格式化成一个清晰的 <code>map[string]string</code>，其中 <code>key</code> 是字段名，<code>value</code> 是友好的错误提示。</p>
<p>好了，需求明确，我们开始动手吧！</p>
<h3 id="第一步：定义结构体和自定义验证函数"><a href="#第一步：定义结构体和自定义验证函数" class="headerlink" title="第一步：定义结构体和自定义验证函数"></a>第一步：定义结构体和自定义验证函数</h3><p>根据需求清单，我们需要先设计我们的 <code>RegisterForm</code> 结构体，并为 “不能包含 admin” 这个特殊需求编写一个自定义验证函数。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 定义我们的注册表单结构体，并贴上所有需要的标签</span></span><br><span class="line"><span class="keyword">type</span> RegisterForm <span class="keyword">struct</span> &#123;</span><br><span class="line">	Username        <span class="type">string</span>   <span class="string">`validate:&quot;required,min=4,max=20,no-admin&quot;`</span></span><br><span class="line">	Password        <span class="type">string</span>   <span class="string">`validate:&quot;required,min=8&quot;`</span></span><br><span class="line">	ConfirmPassword <span class="type">string</span>   <span class="string">`validate:&quot;required,eqfield=Password&quot;`</span></span><br><span class="line">	Email           <span class="type">string</span>   <span class="string">`validate:&quot;required,email&quot;`</span></span><br><span class="line">	Age             <span class="type">int</span>      <span class="string">`validate:&quot;omitempty,gte=18&quot;`</span></span><br><span class="line">	Hobbies         []<span class="type">string</span> <span class="string">`validate:&quot;omitempty,max=5,dive,required&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 编写自定义验证函数 `noAdmin`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">noAdmin</span><span class="params">(fl validator.FieldLevel)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="comment">// 判断字段值（转为小写后）是否包含 &quot;admin&quot;</span></span><br><span class="line">	<span class="keyword">return</span> !strings.Contains(strings.ToLower(fl.Field().String()), <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>代码解析：</strong></p>
<ul>
<li><code>Username</code>: 我们用了一个自定义标签 <code>no-admin</code>，准备稍后注册它。</li>
<li><code>Age</code>: 使用 <code>omitempty,gte=18</code>，完美实现了“可选但填了就要大于等于18”的需求。</li>
<li><code>Hobbies</code>: <code>omitempty</code> 表示整个爱好列表可以不填。<code>max=5</code> 限制列表长度。<code>dive</code> 表示要深入列表内部。最后的 <code>required</code> 是应用在 <code>dive</code> 之后的，意思是列表里的 <strong>每个字符串</strong> 都不能为空。</li>
</ul>
<h3 id="第二步：初始化校验器并注册自定义规则"><a href="#第二步：初始化校验器并注册自定义规则" class="headerlink" title="第二步：初始化校验器并注册自定义规则"></a>第二步：初始化校验器并注册自定义规则</h3><p>我们遵循最佳实践，把校验器和自定义规则的注册放在一起。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在这个文件中，我们直接在 main 函数里初始化</span></span><br><span class="line"><span class="comment">// 在真实项目中，这部分代码应该在程序的初始化阶段（如 init 函数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupValidator</span><span class="params">()</span></span> *validator.Validate &#123;</span><br><span class="line">	validate := validator.New()</span><br><span class="line">	<span class="comment">// 注册 &quot;no-admin&quot; 标签对应的验证函数</span></span><br><span class="line">	err := validate.RegisterValidation(<span class="string">&quot;no-admin&quot;</span>, noAdmin)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;Failed to register custom validation&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> validate</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第三步：编写校验和错误翻译的核心逻辑"><a href="#第三步：编写校验和错误翻译的核心逻辑" class="headerlink" title="第三步：编写校验和错误翻译的核心逻辑"></a>第三步：编写校验和错误翻译的核心逻辑</h3><p>这是本次实战的核心。我们将创建一个函数，它接收一个 <code>RegisterForm</code>，返回一个 <code>map</code> 形式的错误信息。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// translateErrors 函数负责执行校验并翻译错误</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">translateErrors</span><span class="params">(validate *validator.Validate, form <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span> &#123;</span><br><span class="line">	err := validate.Struct(form)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span> <span class="comment">// 如果没有错误，返回 nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 类型断言，获取 ValidationErrors</span></span><br><span class="line">	validationErrors, ok := err.(validator.ValidationErrors)</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="comment">// 如果不是校验错误，返回一个通用错误</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;An unexpected error occurred&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个 map 用于存放翻译后的错误信息</span></span><br><span class="line">	errorMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, fieldError := <span class="keyword">range</span> validationErrors &#123;</span><br><span class="line">		<span class="comment">// 使用 switch-case 为每个字段和规则生成友好的消息</span></span><br><span class="line">		field := fieldError.Field()</span><br><span class="line">		tag := fieldError.Tag()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> field &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;Username&quot;</span>:</span><br><span class="line">			<span class="keyword">switch</span> tag &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;required&quot;</span>:</span><br><span class="line">				errorMap[field] = <span class="string">&quot;用户名是必填项。&quot;</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;min&quot;</span>:</span><br><span class="line">				errorMap[field] = <span class="string">&quot;用户名长度不能少于4个字符。&quot;</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;max&quot;</span>:</span><br><span class="line">				errorMap[field] = <span class="string">&quot;用户名长度不能超过20个字符。&quot;</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;no-admin&quot;</span>:</span><br><span class="line">				errorMap[field] = <span class="string">&quot;用户名不能包含 &#x27;admin&#x27;。&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;Password&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> tag == <span class="string">&quot;min&quot;</span> &#123;</span><br><span class="line">				errorMap[field] = <span class="string">&quot;密码长度不能少于8个字符。&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;ConfirmPassword&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> tag == <span class="string">&quot;eqfield&quot;</span> &#123;</span><br><span class="line">				errorMap[field] = <span class="string">&quot;两次输入的密码不一致。&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;Email&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> tag == <span class="string">&quot;email&quot;</span> &#123;</span><br><span class="line">				errorMap[field] = <span class="string">&quot;请输入有效的邮箱地址。&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;Age&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> tag == <span class="string">&quot;gte&quot;</span> &#123;</span><br><span class="line">				errorMap[field] = <span class="string">&quot;必须年满18周岁。&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;Hobbies&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> tag == <span class="string">&quot;max&quot;</span> &#123;</span><br><span class="line">				errorMap[field] = <span class="string">&quot;最多只能选择5个兴趣爱好。&quot;</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> tag == <span class="string">&quot;required&quot;</span> &#123;</span><br><span class="line">				<span class="comment">// 这个 required 是 dive 之后的，说明是列表内的元素有问题</span></span><br><span class="line">				errorMap[field] = <span class="string">&quot;兴趣爱好不能为空字符串。&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> errorMap</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第四步：整合与测试"><a href="#第四步：整合与测试" class="headerlink" title="第四步：整合与测试"></a>第四步：整合与测试</h3><p>现在，我们把所有部分组合在 <code>main</code> 函数里，并创建几个测试用例来看看我们的成果。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 初始化校验器</span></span><br><span class="line">	validate := setupValidator()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// --- 测试用例 1: 一个问题百出的表单 ---</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;--- 测试用例 1: 问题表单 ---&quot;</span>)</span><br><span class="line">	badForm := RegisterForm&#123;</span><br><span class="line">		Username:        <span class="string">&quot;adm&quot;</span>,                  <span class="comment">// 太短，且包含&#x27;adm&#x27;(我们的小写检查会发现) -&gt; 修正：太短</span></span><br><span class="line">		Password:        <span class="string">&quot;123&quot;</span>,                  <span class="comment">// 太短</span></span><br><span class="line">		ConfirmPassword: <span class="string">&quot;456&quot;</span>,                  <span class="comment">// 与密码不一致</span></span><br><span class="line">		Email:           <span class="string">&quot;test@&quot;</span>,                <span class="comment">// 格式错误</span></span><br><span class="line">		Age:             <span class="number">16</span>,                     <span class="comment">// 年龄太小</span></span><br><span class="line">		Hobbies:         []<span class="type">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>&#125;, <span class="comment">// 太多爱好</span></span><br><span class="line">	&#125;</span><br><span class="line">	errors := translateErrors(validate, badForm)</span><br><span class="line">	<span class="keyword">if</span> errors != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;校验失败，错误信息如下：&quot;</span>)</span><br><span class="line">		<span class="keyword">for</span> field, msg := <span class="keyword">range</span> errors &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;- %s: %s\n&quot;</span>, field, msg)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// --- 测试用例 2: 另一个问题表单，包含自定义规则失败 ---</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 测试用例 2: 用户名含 admin ---&quot;</span>)</span><br><span class="line">	adminForm := RegisterForm&#123;</span><br><span class="line">		Username:        <span class="string">&quot;super-admin-user&quot;</span>,</span><br><span class="line">		Password:        <span class="string">&quot;12345678&quot;</span>,</span><br><span class="line">		ConfirmPassword: <span class="string">&quot;12345678&quot;</span>,</span><br><span class="line">		Email:           <span class="string">&quot;admin@test.com&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	errors = translateErrors(validate, adminForm)</span><br><span class="line">	<span class="keyword">if</span> errors != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;校验失败，错误信息如下：&quot;</span>)</span><br><span class="line">		<span class="keyword">for</span> field, msg := <span class="keyword">range</span> errors &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;- %s: %s\n&quot;</span>, field, msg)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// --- 测试用例 3: 一个完美的表单 ---</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 测试用例 3: 完美表单 ---&quot;</span>)</span><br><span class="line">	goodForm := RegisterForm&#123;</span><br><span class="line">		Username:        <span class="string">&quot;gooduser&quot;</span>,</span><br><span class="line">		Password:        <span class="string">&quot;password123&quot;</span>,</span><br><span class="line">		ConfirmPassword: <span class="string">&quot;password123&quot;</span>,</span><br><span class="line">		Email:           <span class="string">&quot;good@user.com&quot;</span>,</span><br><span class="line">		Age:             <span class="number">25</span>,</span><br><span class="line">		Hobbies:         []<span class="type">string</span>&#123;<span class="string">&quot;coding&quot;</span>, <span class="string">&quot;reading&quot;</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	errors = translateErrors(validate, goodForm)</span><br><span class="line">	<span class="keyword">if</span> errors == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;表单校验通过，可以进行注册！&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>预期运行结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--- 测试用例 1: 问题表单 ---</span><br><span class="line">校验失败，错误信息如下：</span><br><span class="line">- Username: 用户名长度不能少于4个字符。</span><br><span class="line">- Password: 密码长度不能少于8个字符。</span><br><span class="line">- ConfirmPassword: 两次输入的密码不一致。</span><br><span class="line">- Email: 请输入有效的邮箱地址。</span><br><span class="line">- Age: 必须年满18周岁。</span><br><span class="line">- Hobbies: 最多只能选择5个兴趣爱好。</span><br><span class="line"></span><br><span class="line">--- 测试用例 2: 用户名含 admin ---</span><br><span class="line">校验失败，错误信息如下：</span><br><span class="line">- Username: 用户名不能包含 &#x27;admin&#x27;。</span><br><span class="line"></span><br><span class="line">--- 测试用例 3: 完美表单 ---</span><br><span class="line">表单校验通过，可以进行注册！</span><br></pre></td></tr></table></figure>

<h3 id="本章总结与复习"><a href="#本章总结与复习" class="headerlink" title="本章总结与复习"></a>本章总结与复习</h3><p>恭喜你！你已经成功地将我们前面六章学到的所有知识点融会贯通，解决了一个非常贴近真实项目的需求。</p>
<p>我们再回顾一下这个过程中用到的所有知识点：</p>
<ul>
<li><strong>基本使用</strong>：<code>validator.New()</code> 创建实例，<code>validate.Struct()</code> 执行校验。</li>
<li><strong>常用标签</strong>：<code>required</code>, <code>min</code>, <code>max</code>, <code>eqfield</code>, <code>email</code>, <code>gte</code>。</li>
<li><strong>高级标签</strong>：<code>omitempty</code>, <code>dive</code>。</li>
<li><strong>自定义规则</strong>：自己写了 <code>noAdmin</code> 函数，并通过 <code>RegisterValidation</code> 注册了 <code>no-admin</code> 标签。</li>
<li><strong>错误处理</strong>：通过类型断言获取 <code>ValidationErrors</code>，遍历它，并根据 <code>Field()</code> 和 <code>Tag()</code> 将错误信息翻译成用户友好的 <code>map</code>。</li>
<li><strong>最佳实践</strong>：将校验器的创建和注册逻辑封装起来。</li>
</ul>
<p>通过这个实战，你应该对 <code>validator</code> 库的强大和便捷有了非常深刻的理解。它几乎是所有 Go Web 开发和 API 开发项目中的必备工具。希望这份学习笔记能成为你未来项目开发中的好帮手！</p>
<p>课程到此结束，继续探索和练习吧！</p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="Go-Validator-常用校验标签总览（含用途说明）"><a href="#Go-Validator-常用校验标签总览（含用途说明）" class="headerlink" title="Go Validator 常用校验标签总览（含用途说明）"></a>Go Validator 常用校验标签总览（含用途说明）</h2><table>
<thead>
<tr>
<th>作用描述</th>
<th>校验标签（可直接复制）</th>
<th>适用类型</th>
<th>含义说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>判断是否等于指定值</td>
<td><code>eq</code></td>
<td>所有类型</td>
<td>等于指定值</td>
<td><code>eq=100</code> → 值必须等于100</td>
</tr>
<tr>
<td>判断是否不等于指定值</td>
<td><code>ne</code></td>
<td>所有类型</td>
<td>不等于指定值</td>
<td><code>ne=0</code> → 值不能等于0</td>
</tr>
<tr>
<td>判断是否大于指定值或长度</td>
<td><code>gt</code></td>
<td>数字、字符串、切片、数组</td>
<td>大于指定值&#x2F;长度</td>
<td><code>gt=10</code> → 数字&gt;10；长度&gt;10</td>
</tr>
<tr>
<td>判断是否大于等于指定值或长度</td>
<td><code>gte</code></td>
<td>数字、字符串、切片、数组</td>
<td>大于等于指定值&#x2F;长度</td>
<td><code>gte=1</code> → 值≥1</td>
</tr>
<tr>
<td>判断是否小于指定值或长度</td>
<td><code>lt</code></td>
<td>数字、字符串、切片、数组</td>
<td>小于指定值&#x2F;长度</td>
<td><code>lt=5</code> → 数字&lt;5；长度&lt;5</td>
</tr>
<tr>
<td>判断是否小于等于指定值或长度</td>
<td><code>lte</code></td>
<td>数字、字符串、切片、数组</td>
<td>小于等于指定值&#x2F;长度</td>
<td><code>lte=100</code> → 值≤100</td>
</tr>
<tr>
<td>判断长度是否等于指定值</td>
<td><code>len</code></td>
<td>字符串、切片、数组</td>
<td>长度等于指定值</td>
<td><code>len=6</code> → 长度必须为6</td>
</tr>
<tr>
<td>判断是否达到最小值或最小长度</td>
<td><code>min</code></td>
<td>数字、字符串、切片、数组</td>
<td>最小值&#x2F;长度下限</td>
<td><code>min=3</code> → 值或长度≥3</td>
</tr>
<tr>
<td>判断是否超过最大值或最大长度</td>
<td><code>max</code></td>
<td>数字、字符串、切片、数组</td>
<td>最大值&#x2F;长度上限</td>
<td><code>max=10</code> → 值或长度≤10</td>
</tr>
<tr>
<td>判断值是否在给定集合内</td>
<td><code>oneof</code></td>
<td>所有类型</td>
<td>值必须是给定选项之一</td>
<td><code>oneof=red green blue</code></td>
</tr>
<tr>
<td>强制字段必须有值</td>
<td><code>required</code></td>
<td>所有类型</td>
<td>不可为零值或空值</td>
<td><code>required</code></td>
</tr>
<tr>
<td>允许字段为空时跳过其他校验</td>
<td><code>omitempty</code></td>
<td>所有类型</td>
<td>为空则跳过后续校验</td>
<td><code>omitempty,gte=1,lte=10</code></td>
</tr>
<tr>
<td>校验邮箱格式</td>
<td><code>email</code></td>
<td>字符串</td>
<td>必须为合法邮箱</td>
<td><code>email</code></td>
</tr>
<tr>
<td>校验URL格式</td>
<td><code>url</code></td>
<td>字符串</td>
<td>必须为合法URL</td>
<td><code>url</code></td>
</tr>
<tr>
<td>校验URI格式</td>
<td><code>uri</code></td>
<td>字符串</td>
<td>必须为合法URI</td>
<td><code>uri</code></td>
</tr>
<tr>
<td>校验是否为IPv4或IPv6地址</td>
<td><code>ip</code></td>
<td>字符串</td>
<td>IPv4 或 IPv6 地址</td>
<td><code>ip</code></td>
</tr>
<tr>
<td>校验是否为IPv4地址</td>
<td><code>ipv4</code></td>
<td>字符串</td>
<td>IPv4 地址格式</td>
<td><code>ipv4</code></td>
</tr>
<tr>
<td>校验是否为IPv6地址</td>
<td><code>ipv6</code></td>
<td>字符串</td>
<td>IPv6 地址格式</td>
<td><code>ipv6</code></td>
</tr>
<tr>
<td>校验是否为合法UUID（任意版本）</td>
<td><code>uuid</code></td>
<td>字符串</td>
<td>UUID v1~v5</td>
<td><code>uuid</code></td>
</tr>
<tr>
<td>校验是否为UUID v4</td>
<td><code>uuid4</code></td>
<td>字符串</td>
<td>仅限 UUID v4</td>
<td><code>uuid4</code></td>
</tr>
<tr>
<td>校验时间格式</td>
<td><code>datetime</code></td>
<td>字符串</td>
<td>指定格式的时间字符串</td>
<td><code>datetime=2006-01-02</code></td>
</tr>
<tr>
<td>校验是否只包含字母</td>
<td><code>alpha</code></td>
<td>字符串</td>
<td>仅允许字母字符</td>
<td><code>alpha</code></td>
</tr>
<tr>
<td>校验是否只包含字母和数字</td>
<td><code>alphanum</code></td>
<td>字符串</td>
<td>仅允许字母和数字</td>
<td><code>alphanum</code></td>
</tr>
<tr>
<td>校验是否仅包含数字字符</td>
<td><code>numeric</code></td>
<td>字符串</td>
<td>仅数字（可字符串形式）</td>
<td><code>numeric</code></td>
</tr>
<tr>
<td>校验布尔格式</td>
<td><code>boolean</code></td>
<td>字符串</td>
<td>“true”&#x2F;“false”&#x2F;“1”&#x2F;“0”</td>
<td><code>boolean</code></td>
</tr>
<tr>
<td>校验是否包含指定子串</td>
<td><code>contains</code></td>
<td>字符串</td>
<td>必须包含指定内容</td>
<td><code>contains=@</code></td>
</tr>
<tr>
<td>校验是否不包含指定子串</td>
<td><code>excludes</code></td>
<td>字符串</td>
<td>不得包含指定内容</td>
<td><code>excludes=admin</code></td>
</tr>
<tr>
<td>校验是否以指定前缀开头</td>
<td><code>startswith</code></td>
<td>字符串</td>
<td>必须以指定前缀开头</td>
<td><code>startswith=ABC</code></td>
</tr>
<tr>
<td>校验是否以指定后缀结尾</td>
<td><code>endswith</code></td>
<td>字符串</td>
<td>必须以指定后缀结尾</td>
<td><code>endswith=.com</code></td>
</tr>
<tr>
<td>校验是否为Base64格式</td>
<td><code>base64</code></td>
<td>字符串</td>
<td>Base64 字符串</td>
<td><code>base64</code></td>
</tr>
<tr>
<td>校验是否为十六进制字符串</td>
<td><code>hexadecimal</code></td>
<td>字符串</td>
<td>十六进制格式</td>
<td><code>hexadecimal</code></td>
</tr>
<tr>
<td>校验是否为颜色的十六进制格式</td>
<td><code>hexcolor</code></td>
<td>字符串</td>
<td>#RRGGBB 或 #RGB</td>
<td><code>hexcolor</code></td>
</tr>
<tr>
<td>校验是否为RGB格式</td>
<td><code>rgb</code></td>
<td>字符串</td>
<td>rgb(255,255,255) 格式</td>
<td><code>rgb</code></td>
</tr>
<tr>
<td>校验是否为RGBA格式</td>
<td><code>rgba</code></td>
<td>字符串</td>
<td>rgba(255,255,255,1) 格式</td>
<td><code>rgba</code></td>
</tr>
<tr>
<td>校验是否不包含任意给定字符</td>
<td><code>excludesall</code></td>
<td>字符串</td>
<td>不允许出现指定字符集合</td>
<td><code>excludesall=!@#</code></td>
</tr>
<tr>
<td>校验是否不包含特定Unicode符号</td>
<td><code>excludesrune</code></td>
<td>字符串</td>
<td>不允许包含特定字符</td>
<td><code>excludesrune=你</code></td>
</tr>
<tr>
<td>校验路径是否为文件</td>
<td><code>file</code></td>
<td>文件路径</td>
<td>必须是存在的文件</td>
<td><code>file</code></td>
</tr>
<tr>
<td>校验路径是否为目录</td>
<td><code>dir</code></td>
<td>文件路径</td>
<td>必须是存在的目录</td>
<td><code>dir</code></td>
</tr>
<tr>
<td>比较当前字段是否等于另一个字段</td>
<td><code>eqfield</code></td>
<td>同结构体内字段</td>
<td>当前字段等于指定字段</td>
<td><code>eqfield=Password</code></td>
</tr>
<tr>
<td>比较当前字段是否不等于另一个字段</td>
<td><code>nefield</code></td>
<td>同结构体内字段</td>
<td>当前字段不等于指定字段</td>
<td><code>nefield=Username</code></td>
</tr>
<tr>
<td>比较当前字段是否大于另一个字段</td>
<td><code>gtfield</code></td>
<td>同结构体内字段</td>
<td>大于指定字段</td>
<td><code>gtfield=MinAge</code></td>
</tr>
<tr>
<td>比较当前字段是否大于等于另一个字段</td>
<td><code>gtefield</code></td>
<td>同结构体内字段</td>
<td>大于等于指定字段</td>
<td><code>gtefield=MinAge</code></td>
</tr>
<tr>
<td>比较当前字段是否小于另一个字段</td>
<td><code>ltfield</code></td>
<td>同结构体内字段</td>
<td>小于指定字段</td>
<td><code>ltfield=MaxAge</code></td>
</tr>
<tr>
<td>比较当前字段是否小于等于另一个字段</td>
<td><code>ltefield</code></td>
<td>同结构体内字段</td>
<td>小于等于指定字段</td>
<td><code>ltefield=MaxAge</code></td>
</tr>
<tr>
<td>正则匹配自定义规则</td>
<td><code>regexp</code></td>
<td>字符串</td>
<td>匹配指定正则表达式</td>
<td><code>regexp=^[A-Z]{3}[0-9]{4}$</code></td>
</tr>
<tr>
<td>条件必填：若其他字段存在</td>
<td><code>required_with</code></td>
<td>同结构体内字段</td>
<td>若指定字段存在，则本字段必填</td>
<td><code>required_with=Email</code></td>
</tr>
<tr>
<td>条件必填：若其他字段存在任意</td>
<td><code>required_with_all</code></td>
<td>同结构体内字段</td>
<td>若任意一个字段存在，则必填</td>
<td><code>required_with_all=Phone Email</code></td>
</tr>
<tr>
<td>条件必填：若其他字段不存在</td>
<td><code>required_without</code></td>
<td>同结构体内字段</td>
<td>若指定字段不存在，则必填</td>
<td><code>required_without=Email</code></td>
</tr>
<tr>
<td>条件排除：若某字段存在</td>
<td><code>excluded_with</code></td>
<td>同结构体内字段</td>
<td>若指定字段存在，则本字段不得存在</td>
<td><code>excluded_with=Password</code></td>
</tr>
<tr>
<td>切片唯一性校验</td>
<td><code>unique</code></td>
<td>切片、数组</td>
<td>所有元素必须唯一</td>
<td><code>unique</code></td>
</tr>
</tbody></table>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://chaoqijiang.github.io">棨</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://chaoqijiang.github.io/2025/10/06/Golang_validator/">https://chaoqijiang.github.io/2025/10/06/Golang_validator/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://chaoqijiang.github.io" target="_blank">柊</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">使用教程</a><a class="post-meta__tags" href="/tags/AI/">AI</a><a class="post-meta__tags" href="/tags/protected/">protected</a><a class="post-meta__tags" href="/tags/Golang/">Golang</a><a class="post-meta__tags" href="/tags/%E4%B8%89%E6%96%B9%E5%BA%93/">三方库</a><a class="post-meta__tags" href="/tags/validator/">validator</a></div><div class="post-share"><div class="social-share" data-image="/Image/avatar.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/26/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Redis学习笔记"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Redis学习笔记</div></div><div class="info-2"><div class="info-item-1">Redis学习笔记</div></div></div></a><a class="pagination-related" href="/2025/10/08/Golang_swag/" title="Golang swag 库"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Golang swag 库</div></div><div class="info-2"><div class="info-item-1">Go swag 从入门到实践，带你一步步掌握如何自动生成 API 文档。从安装、使用注解到理解其工作原理，再到常见问题的解决，让你轻松应对团队协作中的文档需求。</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/08/Golang_swag/" title="Golang swag 库"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-08</div><div class="info-item-2">Golang swag 库</div></div><div class="info-2"><div class="info-item-1">Go swag 从入门到实践，带你一步步掌握如何自动生成 API 文档。从安装、使用注解到理解其工作原理，再到常见问题的解决，让你轻松应对团队协作中的文档需求。</div></div></div></a><a class="pagination-related" href="/2025/10/08/AI%E6%8F%90%E7%A4%BA%E8%AF%8D_%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E7%94%9F%E6%88%90/" title="AI提示词_学习笔记生成"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-08</div><div class="info-item-2">AI提示词_学习笔记生成</div></div><div class="info-2"><div class="info-item-1">AI提示词，用于引导AI生成学习笔记，根据提示的设定，对没有基础背景背景的小白生成学习笔记。</div></div></div></a><a class="pagination-related" href="/2025/10/08/AI%E6%8F%90%E7%A4%BA%E8%AF%8D_%E8%AF%95%E9%A2%98%E7%94%9F%E6%88%90/" title="AI提示词_试题生成"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-08</div><div class="info-item-2">AI提示词_试题生成</div></div><div class="info-2"><div class="info-item-1">AI提示词，用于根据提示信息生成对应的试题，帮助学习者检验理解深度。</div></div></div></a><a class="pagination-related" href="/2025/05/04/Armbian%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8RNDIS%E5%8D%8F%E8%AE%AE%E8%BF%9B%E8%A1%8C%E4%B8%8A%E7%BD%91/" title="Armbian系统使用RNDIS协议进行上网"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-04</div><div class="info-item-2">Armbian系统使用RNDIS协议进行上网</div></div><div class="info-2"><div class="info-item-1">Armbian系统使用RNDIS协议进行上网</div></div></div></a><a class="pagination-related" href="/2024/02/28/HTTP%20%E7%8A%B6%E6%80%81%E7%A0%81%E5%88%97%E8%A1%A8/" title="HTTP 状态码列表"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-28</div><div class="info-item-2">HTTP 状态码列表</div></div><div class="info-2"><div class="info-item-1">HTTP 状态码列表</div></div></div></a><a class="pagination-related" href="/2024/01/14/Linux%E7%B3%BB%E7%BB%9F%E6%9F%A5%E8%AF%A2%E8%AE%BE%E5%A4%87%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF/" title="Linux系统查询设备的详细信息"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-14</div><div class="info-item-2">Linux系统查询设备的详细信息</div></div><div class="info-2"><div class="info-item-1">Linux系统下查询设备的详细信息</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/Image/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">棨</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">62</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">44</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:chaoqijiang@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Golang-validator-%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">Golang validator 库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E2%80%9C%E6%95%B0%E6%8D%AE%E6%A3%80%E6%9F%A5%E5%91%98%E2%80%9D%EF%BC%9F%E2%80%94%E2%80%94-validator-%E5%BA%93%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.</span> <span class="toc-text">第1章：为什么需要“数据检查员”？—— validator 库简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E2%80%9C%E6%95%B0%E6%8D%AE%E6%A3%80%E6%9F%A5%E2%80%9D"><span class="toc-number">1.2.1.</span> <span class="toc-text">生活中的“数据检查”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%B8%96%E7%95%8C%E7%9A%84%E2%80%9C%E6%95%B0%E6%8D%AE%E6%A3%80%E6%9F%A5%E2%80%9D%EF%BC%9A%E5%8F%88%E9%95%BF%E5%8F%88%E9%BA%BB%E7%83%A6%E7%9A%84-if-else"><span class="toc-number">1.2.2.</span> <span class="toc-text">程序世界的“数据检查”：又长又麻烦的 if-else</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E7%9A%84%E2%80%9C%E8%B6%85%E7%BA%A7%E6%A3%80%E6%9F%A5%E5%91%98%E2%80%9D%E7%99%BB%E5%9C%BA%EF%BC%9Avalidator-%E5%BA%93"><span class="toc-number">1.2.3.</span> <span class="toc-text">我们的“超级检查员”登场：validator 库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93"><span class="toc-number">1.2.4.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0%EF%BC%9A%E4%B8%8A%E5%B2%97%E7%AC%AC%E4%B8%80%E5%A4%A9%EF%BC%81%E2%80%94%E2%80%94-validator-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">第2章：上岗第一天！—— validator 的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%8B%9B%E8%81%98%E6%A3%80%E6%9F%A5%E5%91%98%EF%BC%88%E5%AE%89%E8%A3%85-validator-%E5%BA%93%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">第一步：招聘检查员（安装 validator 库）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E7%BB%99%E4%BB%96%E4%B8%80%E6%9C%AC%E2%80%9C%E8%A7%84%E5%88%99%E6%89%8B%E5%86%8C%E2%80%9D%EF%BC%88%E5%AE%9A%E4%B9%89%E5%B8%A6%E6%A0%87%E7%AD%BE%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">第二步：给他一本“规则手册”（定义带标签的结构体）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E8%AE%A9%E4%BB%96%E5%BC%80%E5%A7%8B%E5%B7%A5%E4%BD%9C%EF%BC%88%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E5%B9%B6%E6%89%A7%E8%A1%8C%E6%A0%A1%E9%AA%8C%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">第三步：让他开始工作（创建实例并执行校验）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93-1"><span class="toc-number">1.3.4.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC3-1%E7%AB%A0%EF%BC%9A%E6%A3%80%E6%9F%A5%E5%91%98%E7%9A%84%E2%80%9C%E8%A7%84%E5%88%99%E6%89%8B%E5%86%8C%E2%80%9D%E2%80%94%E2%80%94-%E5%B8%B8%E7%94%A8%E9%AA%8C%E8%AF%81%E6%A0%87%E7%AD%BE%EF%BC%88%E4%B8%8A%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">第3-1章：检查员的“规则手册”—— 常用验证标签（上）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E4%B8%80%EF%BC%9A%E5%85%B3%E4%BA%8E%E2%80%9C%E9%95%BF%E5%BA%A6%E2%80%9D%E7%9A%84%E6%A3%80%E6%9F%A5"><span class="toc-number">1.4.1.</span> <span class="toc-text">规则一：关于“长度”的检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E4%BA%8C%EF%BC%9A%E5%85%B3%E4%BA%8E%E2%80%9C%E6%95%B0%E5%AD%97%E5%A4%A7%E5%B0%8F%E2%80%9D%E7%9A%84%E6%A3%80%E6%9F%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">规则二：关于“数字大小”的检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E4%B8%89%EF%BC%9A%E5%85%B3%E4%BA%8E%E2%80%9C%E7%89%B9%E5%AE%9A%E6%A0%BC%E5%BC%8F%E2%80%9D%E7%9A%84%E6%A3%80%E6%9F%A5"><span class="toc-number">1.4.3.</span> <span class="toc-text">规则三：关于“特定格式”的检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83%EF%BC%9A%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.4.</span> <span class="toc-text">实战演练：组合使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93-2"><span class="toc-number">1.4.5.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC3-2%E7%AB%A0%EF%BC%9A%E6%A3%80%E6%9F%A5%E5%91%98%E7%9A%84%E2%80%9C%E8%A7%84%E5%88%99%E6%89%8B%E5%86%8C%E2%80%9D%E2%80%94%E2%80%94-%E5%B8%B8%E7%94%A8%E9%AA%8C%E8%AF%81%E6%A0%87%E7%AD%BE%EF%BC%88%E4%B8%8B%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">第3-2章：检查员的“规则手册”—— 常用验证标签（下）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E5%9B%9B%EF%BC%9A%E5%A4%9A%E9%80%89%E4%B8%80%EF%BC%88%E4%BB%8E%E5%9B%BA%E5%AE%9A%E9%80%89%E9%A1%B9%E9%87%8C%E9%80%89%EF%BC%89"><span class="toc-number">1.5.1.</span> <span class="toc-text">规则四：多选一（从固定选项里选）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E4%BA%94%EF%BC%9A%E5%AD%97%E6%AE%B5%E9%97%B4%E7%9A%84%E6%AF%94%E8%BE%83%EF%BC%88%E8%B7%A8%E5%AD%97%E6%AE%B5%E9%AA%8C%E8%AF%81%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">规则五：字段间的比较（跨字段验证）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E5%85%AD%EF%BC%9A%E6%B7%B1%E5%85%A5%E6%A3%80%E6%9F%A5%EF%BC%88%E6%A0%A1%E9%AA%8C%E5%88%87%E7%89%87%E6%88%96%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">规则六：深入检查（校验切片或数组中的每一个元素）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83%EF%BC%9A%E4%B8%80%E4%B8%AA%E5%A4%8D%E6%9D%82%E7%9A%84%E8%AE%A2%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.5.4.</span> <span class="toc-text">实战演练：一个复杂的订单校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93-3"><span class="toc-number">1.5.5.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E2%80%9C%E6%A3%80%E6%9F%A5%E4%B8%8D%E9%80%9A%E8%BF%87%EF%BC%81%E2%80%9D%E2%80%94%E2%80%94-%E5%A6%82%E4%BD%95%E7%9C%8B%E6%87%82%E5%B9%B6%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.</span> <span class="toc-text">第4章：“检查不通过！”—— 如何看懂并处理错误信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%8B%86%E5%BC%80%E2%80%9C%E9%94%99%E8%AF%AF%E2%80%9D%E8%BF%99%E4%B8%AA%E5%A4%A7%E5%8C%85%E8%A3%B9"><span class="toc-number">1.6.1.</span> <span class="toc-text">第一步：拆开“错误”这个大包裹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%81%8D%E5%8E%86%E6%AF%8F%E4%B8%80%E4%B8%AA%E2%80%9C%E9%94%99%E8%AF%AF%E9%A1%B9%E2%80%9D"><span class="toc-number">1.6.2.</span> <span class="toc-text">第二步：遍历每一个“错误项”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93-4"><span class="toc-number">1.6.3.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0%EF%BC%9A%E5%88%B6%E5%AE%9A%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E2%80%9C%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99%E2%80%9D%E2%80%94%E2%80%94-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.</span> <span class="toc-text">第5章：制定你自己的“特殊规则”—— 自定义验证函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99%EF%BC%88%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E9%AA%8C%E8%AF%81%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-number">1.7.1.</span> <span class="toc-text">第一步：编写规则（定义一个验证函数）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E7%99%BB%E8%AE%B0%E8%A7%84%E5%88%99%EF%BC%88%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-number">1.7.2.</span> <span class="toc-text">第二步：登记规则（注册自定义函数）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BD%BF%E7%94%A8%E8%A7%84%E5%88%99%EF%BC%88%E5%9C%A8%E7%BB%93%E6%9E%84%E4%BD%93%E9%87%8C%E8%B4%B4%E4%B8%8A%E6%96%B0%E6%A0%87%E7%AD%BE%EF%BC%89"><span class="toc-number">1.7.3.</span> <span class="toc-text">第三步：使用规则（在结构体里贴上新标签）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83%EF%BC%9A%E5%AE%8C%E6%95%B4%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.7.4.</span> <span class="toc-text">实战演练：完整的自定义校验流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93-5"><span class="toc-number">1.7.5.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E7%BB%8F%E9%AA%8C%E4%B9%8B%E8%B0%88-%E2%80%94%E2%80%94-%E4%BD%BF%E7%94%A8-validator-%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%8A%80%E5%B7%A7"><span class="toc-number">1.8.</span> <span class="toc-text">第6章：经验之谈 —— 使用 validator 的注意事项与技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7%E4%B8%80%EF%BC%9A%E6%A0%A1%E9%AA%8C%E5%99%A8%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%85%A8%E5%B1%80%E5%8D%95%E4%BE%8B%E5%B0%B1%E5%A4%9F%E4%BA%86"><span class="toc-number">1.8.1.</span> <span class="toc-text">技巧一：校验器实例，全局单例就够了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7%E4%BA%8C%EF%BC%9A%E6%A0%A1%E9%AA%8C%E5%8D%95%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E8%80%8C%E4%B8%8D%E4%BB%85%E4%BB%85%E6%98%AF%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.8.2.</span> <span class="toc-text">技巧二：校验单个变量，而不仅仅是结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7%E4%B8%89%EF%BC%9A%E6%B3%A8%E6%84%8F-required-%E4%B8%8E-omitempty-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.8.3.</span> <span class="toc-text">技巧三：注意 required 与 omitempty 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7%E5%9B%9B%EF%BC%9A%E6%A0%A1%E9%AA%8C%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.8.4.</span> <span class="toc-text">技巧四：校验嵌套结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93-6"><span class="toc-number">1.8.5.</span> <span class="toc-text">本章小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0%EF%BC%9A%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83-%E2%80%94%E2%80%94-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.9.</span> <span class="toc-text">第7章：实战演练 —— 用户注册信息校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.1.</span> <span class="toc-text">第一步：定义结构体和自定义验证函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A0%A1%E9%AA%8C%E5%99%A8%E5%B9%B6%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E5%88%99"><span class="toc-number">1.9.2.</span> <span class="toc-text">第二步：初始化校验器并注册自定义规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99%E6%A0%A1%E9%AA%8C%E5%92%8C%E9%94%99%E8%AF%AF%E7%BF%BB%E8%AF%91%E7%9A%84%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91"><span class="toc-number">1.9.3.</span> <span class="toc-text">第三步：编写校验和错误翻译的核心逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%95%B4%E5%90%88%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.4.</span> <span class="toc-text">第四步：整合与测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E6%80%BB%E7%BB%93%E4%B8%8E%E5%A4%8D%E4%B9%A0"><span class="toc-number">1.9.5.</span> <span class="toc-text">本章总结与复习</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">2.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-Validator-%E5%B8%B8%E7%94%A8%E6%A0%A1%E9%AA%8C%E6%A0%87%E7%AD%BE%E6%80%BB%E8%A7%88%EF%BC%88%E5%90%AB%E7%94%A8%E9%80%94%E8%AF%B4%E6%98%8E%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">Go Validator 常用校验标签总览（含用途说明）</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/12/Hexo%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB%E6%A0%87%E7%AD%BE%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E8%AF%A6%E8%A7%A3/" title="Hexo 新增分类、标签与自定义页面详解">Hexo 新增分类、标签与自定义页面详解</a><time datetime="2025-10-12T05:46:03.000Z" title="发表于 2025-10-12 13:46:03">2025-10-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84%E9%80%9A%E7%94%A8%E8%93%9D%E5%9B%BE/" title="高可用高并发后端架构通用蓝图">高可用高并发后端架构通用蓝图</a><time datetime="2025-10-08T15:42:00.000Z" title="发表于 2025-10-08 23:42:00">2025-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/AI%E6%8F%90%E7%A4%BA%E8%AF%8D_%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E7%94%9F%E6%88%90/" title="AI提示词_学习笔记生成">AI提示词_学习笔记生成</a><time datetime="2025-10-08T15:15:00.000Z" title="发表于 2025-10-08 23:15:00">2025-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/AI%E6%8F%90%E7%A4%BA%E8%AF%8D_%E8%AF%95%E9%A2%98%E7%94%9F%E6%88%90/" title="AI提示词_试题生成">AI提示词_试题生成</a><time datetime="2025-10-08T15:15:00.000Z" title="发表于 2025-10-08 23:15:00">2025-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/08/Golang_swag/" title="Golang swag 库">Golang swag 库</a><time datetime="2025-10-08T15:07:00.000Z" title="发表于 2025-10-08 23:07:00">2025-10-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/Image/topImage.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2025 By 棨</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div></body></html>